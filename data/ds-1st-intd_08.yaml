- en: Chapter 4 Effective data visualization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第4章 有效数据可视化
- en: 原文：[https://datasciencebook.ca/viz.html](https://datasciencebook.ca/viz.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://datasciencebook.ca/viz.html](https://datasciencebook.ca/viz.html)
- en: 4.1 Overview
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.1 概述
- en: This chapter will introduce concepts and tools relating to data visualization
    beyond what we have seen and practiced so far. We will focus on guiding principles
    for effective data visualization and explaining visualizations independent of
    any particular tool or programming language. In the process, we will cover some
    specifics of creating visualizations (scatter plots, bar plots, line plots, and
    histograms) for data using R.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将介绍与数据可视化相关的概念和工具，这些概念和工具超出了我们迄今为止所看到和实践的内容。我们将重点关注有效数据可视化的指导原则，并解释独立于任何特定工具或编程语言的可视化。在这个过程中，我们将涵盖使用R创建数据可视化（散点图、条形图、折线图和直方图）的一些具体细节。
- en: 4.2 Chapter learning objectives
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.2 章节学习目标
- en: 'By the end of the chapter, readers will be able to do the following:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，读者将能够做到以下几点：
- en: 'Describe when to use the following kinds of visualizations to answer specific
    questions using a data set:'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 描述在数据集上使用以下类型的可视化来回答特定问题的时机：
- en: scatter plots
  id: totrans-7
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 散点图
- en: line plots
  id: totrans-8
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 折线图
- en: bar plots
  id: totrans-9
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 条形图
- en: histogram plots
  id: totrans-10
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 直方图
- en: Given a data set and a question, select from the above plot types and use R
    to create a visualization that best answers the question.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 给定一个数据集和一个问题，从上述绘图类型中选择，并使用R创建一个最佳回答问题的可视化。
- en: Evaluate the effectiveness of a visualization and suggest improvements to better
    answer a given question.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估可视化的有效性，并提出改进建议以更好地回答给定问题。
- en: Referring to the visualization, communicate the conclusions in non-technical
    terms.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 参考可视化，用非技术术语传达结论。
- en: Identify rules of thumb for creating effective visualizations.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定创建有效可视化的一些经验法则。
- en: 'Use the `ggplot2` package in R to create and refine the above visualizations
    using:'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用R中的`ggplot2`包创建和改进上述可视化：
- en: 'geometric objects: `geom_point`, `geom_line`, `geom_histogram`, `geom_bar`,
    `geom_vline`, `geom_hline`'
  id: totrans-16
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 几何对象：`geom_point`，`geom_line`，`geom_histogram`，`geom_bar`，`geom_vline`，`geom_hline`
- en: 'scales: `xlim`, `ylim`'
  id: totrans-17
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尺度：`xlim`，`ylim`
- en: 'aesthetic mappings: `x`, `y`, `fill`, `color`, `shape`'
  id: totrans-18
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 美学映射：`x`，`y`，`fill`，`color`，`shape`
- en: 'labeling: `xlab`, `ylab`, `labs`'
  id: totrans-19
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标签：`xlab`，`ylab`，`labs`
- en: 'font control and legend positioning: `theme`'
  id: totrans-20
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 字体控制和图例定位：`theme`
- en: 'subplots: `facet_grid`'
  id: totrans-21
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 子图：`facet_grid`
- en: 'Define the three key aspects of `ggplot2` objects:'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义`ggplot2`对象的三项关键方面：
- en: aesthetic mappings
  id: totrans-23
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 美学映射
- en: geometric objects
  id: totrans-24
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 几何对象
- en: scales
  id: totrans-25
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尺度
- en: Describe the difference in raster and vector output formats.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 描述栅格和矢量输出格式的区别。
- en: Use `ggsave` to save visualizations in `.png` and `.svg` format.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`ggsave`将可视化保存为`.png`和`.svg`格式。
- en: 4.3 Choosing the visualization
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.3 选择可视化
- en: '*Ask a question, and answer it*'
  id: totrans-29
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '*提出问题，并回答它*'
- en: The purpose of a visualization is to answer a question about a data set of interest.
    So naturally, the first thing to do **before** creating a visualization is to
    formulate the question about the data you are trying to answer. A good visualization
    will clearly answer your question without distraction; a *great* visualization
    will suggest even what the question was itself without additional explanation.
    Imagine your visualization as part of a poster presentation for a project; even
    if you aren’t standing at the poster explaining things, an effective visualization
    will convey your message to the audience.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 可视化的目的是回答关于感兴趣数据集的问题。因此，在创建可视化之前，首先要明确你试图回答的数据问题。一个好的可视化将清楚地回答你的问题而不会分散注意力；一个*优秀*的可视化甚至可以暗示问题本身，而无需额外的解释。想象一下你的可视化是项目海报展示的一部分；即使你不在海报前解释，一个有效的可视化也能将你的信息传达给观众。
- en: Recall the different data analysis questions from Chapter [1](intro.html#intro).
    With the visualizations we will cover in this chapter, we will be able to answer
    *only descriptive and exploratory* questions. Be careful to not answer any *predictive,
    inferential, causal* *or mechanistic* questions with the visualizations presented
    here, as we have not learned the tools necessary to do that properly just yet.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 回忆起第[1](intro.html#intro)章中的不同数据分析问题。在本章中我们将涵盖的视觉化中，我们只能回答*描述性和探索性*问题。请注意，不要使用这里展示的视觉化来回答任何*预测性、推断性、因果性*或*机制性*问题，因为我们还没有学习到正确完成这些任务的工具。
- en: 'As with most coding tasks, it is totally fine (and quite common) to make mistakes
    and iterate a few times before you find the right visualization for your data
    and question. There are many different kinds of plotting graphics available to
    use (see Chapter 5 of *Fundamentals of Data Visualization* ([Wilke 2019](#ref-wilkeviz))
    for a directory). The types of plot that we introduce in this book are shown in
    Figure [4.1](viz.html#fig:plot-sketches); which one you should select depends
    on your data and the question you want to answer. In general, the guiding principles
    of when to use each type of plot are as follows:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 与大多数编码任务一样，犯错并在找到适合你数据和问题的正确可视化之前迭代几次是完全正常（并且相当常见）的。有许多不同类型的绘图图形可供使用（参见*数据可视化基础*的第5章（Wilke
    2019）以获取目录）。本书中介绍的类型如图[4.1](viz.html#fig:plot-sketches)所示；你应该选择哪一种取决于你的数据和你要回答的问题。一般来说，何时使用每种类型的图表的指导原则如下：
- en: '**scatter plots** visualize the relationship between two quantitative variables'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**散点图**用于展示两个定量变量之间的关系'
- en: '**line plots** visualize trends with respect to an independent, ordered quantity
    (e.g., time)'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**折线图**用于展示相对于一个独立有序量（例如，时间）的趋势'
- en: '**bar plots** visualize comparisons of amounts'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**条形图**用于展示数量的比较'
- en: '**histograms** visualize the distribution of one quantitative variable (i.e.,
    all its possible values and how often they occur)'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**直方图**用于展示一个定量变量的分布（即所有可能的值及其出现频率）'
- en: '![Examples of scatter, line and bar plots, as well as histograms.](../Images/16aa2b388babab4fe76812fda587ea1f.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![散点图、折线图、条形图以及直方图的示例](../Images/16aa2b388babab4fe76812fda587ea1f.png)'
- en: 'Figure 4.1: Examples of scatter, line and bar plots, as well as histograms.'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.1：散点图、折线图、条形图以及直方图的示例。
- en: All types of visualization have their (mis)uses, but three kinds are usually
    hard to understand or are easily replaced with an oft-better alternative. In particular,
    you should avoid **pie charts**; it is generally better to use bars, as it is
    easier to compare bar heights than pie slice sizes. You should also not use **3-D
    visualizations**, as they are typically hard to understand when converted to a
    static 2-D image format. Finally, do not use tables to make numerical comparisons;
    humans are much better at quickly processing visual information than text and
    math. Bar plots are again typically a better alternative.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 所有类型的可视化都有其（误）用途，但通常有三种难以理解或容易被更好的替代方案所取代。特别是，你应该避免使用**饼图**；通常使用条形图更好，因为比较条形高度比比较饼图切片大小更容易。你还应该不使用**三维可视化**，因为它们在转换为静态的二维图像格式时通常难以理解。最后，不要使用表格进行数值比较；人类在快速处理视觉信息方面比文本和数学更擅长。条形图再次通常是更好的替代方案。
- en: 4.4 Refining the visualization
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.4 精炼可视化
- en: '*Convey the message, minimize noise*'
  id: totrans-41
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '*传达信息，最小化噪声*'
- en: 'Just being able to make a visualization in R (or any other language, for that
    matter) doesn’t mean that it effectively communicates your message to others.
    Once you have selected a broad type of visualization to use, you will have to
    refine it to suit your particular need. Some rules of thumb for doing this are
    listed below. They generally fall into two classes: you want to *make your visualization
    convey your message*, and you want to *reduce visual noise* as much as possible.
    Humans have limited cognitive ability to process information; both of these types
    of refinement aim to reduce the mental load on your audience when viewing your
    visualization, making it easier for them to understand and remember your message
    quickly.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 仅能在R（或任何其他语言）中制作可视化并不意味着它能有效地将你的信息传达给他人。一旦你选择了要使用的可视化类型，你将需要对其进行精炼以适应你的特定需求。以下是一些进行此操作的实用规则，它们通常分为两类：你想要让你的可视化传达你的信息，并且你想要尽可能减少视觉噪声。人类处理信息的能力有限；这两种类型的精炼都旨在减少观众在查看你的可视化时的心理负担，使他们更容易快速理解和记住你的信息。
- en: '**Convey the message**'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '**传达信息**'
- en: Make sure the visualization answers the question you have asked most simply
    and plainly as possible.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保可视化尽可能简单明了地回答你提出的问题。
- en: Use legends and labels so that your visualization is understandable without
    reading the surrounding text.
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用图例和标签，以便你的可视化在没有阅读周围文本的情况下也能理解。
- en: Ensure the text, symbols, lines, etc., on your visualization are big enough
    to be easily read.
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保你可视化中的文本、符号、线条等足够大，以便容易阅读。
- en: Ensure the data are clearly visible; don’t hide the shape/distribution of the
    data behind other objects (e.g., a bar).
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保数据清晰可见；不要让数据形状/分布被其他对象（例如，条形图）隐藏。
- en: Make sure to use color schemes that are understandable by those with colorblindness
    (a surprisingly large fraction of the overall population—from about 1% to 10%,
    depending on sex and ancestry ([Deeb 2005](#ref-deebblind))). For example, [ColorBrewer](https://colorbrewer2.org)
    and [the `RColorBrewer` R package](https://cran.r-project.org/web/packages/RColorBrewer/index.html)
    ([Neuwirth 2014](#ref-RColorBrewer)) provide the ability to pick such color schemes,
    and you can check your visualizations after you have created them by uploading
    to online tools such as a [color blindness simulator](https://www.color-blindness.com/coblis-color-blindness-simulator/).
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保使用那些色盲的人也能理解的颜色方案（令人惊讶的是，总体人群中色盲的比例很大——从大约1%到10%，取决于性别和血统（[Deeb 2005](#ref-deebblind)））。例如，[ColorBrewer](https://colorbrewer2.org)和[`RColorBrewer`
    R包](https://cran.r-project.org/web/packages/RColorBrewer/index.html) ([Neuwirth
    2014](#ref-RColorBrewer))提供了选择此类颜色方案的能力，你可以在创建可视化后通过上传到在线工具（如一个[色盲模拟器](https://www.color-blindness.com/coblis-color-blindness-simulator/)）来检查你的可视化。
- en: Redundancy can be helpful; sometimes conveying the same message in multiple
    ways reinforces it for the audience.
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重复性可能是有帮助的；有时以多种方式传达相同的信息可以加强给观众的信息。
- en: '**Minimize noise**'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '**最小化噪声**'
- en: Use colors sparingly. Too many different colors can be distracting, create false
    patterns, and detract from the message.
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适度使用颜色。过多的不同颜色可能会分散注意力，创造虚假的模式，并削弱信息。
- en: Be wary of overplotting. Overplotting is when marks that represent the data
    overlap, and is problematic as it prevents you from seeing how many data points
    are represented in areas of the visualization where this occurs. If your plot
    has too many dots or lines and starts to look like a mess, you need to do something
    different.
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 警惕过度绘图。过度绘图是指代表数据的标记重叠，这会成为一个问题，因为它阻止你看到在可视化中发生这种情况的区域有多少数据点。如果你的图表中点或线太多，开始看起来像一团糟，你需要做些不同的事情。
- en: Only make the plot area (where the dots, lines, bars are) as big as needed.
    Simple plots can be made small.
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只让绘图区域（点、线、条形图所在的地方）达到所需的尺寸。简单的图表可以做得小一些。
- en: Don’t adjust the axes to zoom in on small differences. If the difference is
    small, show that it’s small!
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要调整坐标轴来放大小的差异。如果差异很小，就显示它很小！
- en: 4.5 Creating visualizations with `ggplot2`
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.5 使用 `ggplot2` 创建可视化
- en: '*Build the visualization iteratively*'
  id: totrans-56
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '*迭代构建可视化*'
- en: 'This section will cover examples of how to choose and refine a visualization
    given a data set and a question that you want to answer, and then how to create
    the visualization in R using the `ggplot2` R package. Given that the `ggplot2`
    package is loaded by the `tidyverse` metapackage, we still need to load only `tidyverse’:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将涵盖如何根据数据集和想要回答的问题选择和细化可视化，然后如何使用`ggplot2` R包在R中创建可视化。鉴于`ggplot2`包由`tidyverse`元包加载，我们仍然只需要加载`tidyverse`：
- en: '[PRE0]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '4.5.1 Scatter plots and line plots: the Mauna Loa CO\(_{\text{2}}\) data set'
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.1 散点图和线图：莫纳罗亚二氧化碳（CO\(_{\text{2}}\)）数据集
- en: The [Mauna Loa CO\(_{\text{2}}\) data set](https://www.esrl.noaa.gov/gmd/ccgg/trends/data.html),
    curated by Dr. Pieter Tans, NOAA/GML and Dr. Ralph Keeling, Scripps Institution
    of Oceanography, records the atmospheric concentration of carbon dioxide (CO\(_{\text{2}}\),
    in parts per million) at the Mauna Loa research station in Hawaii from 1959 onward
    ([Tans and Keeling 2020](#ref-maunadata)). For this book, we are going to focus
    on the years 1980-2020.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 莫纳罗亚二氧化碳（CO\(_{\text{2}}\)）数据集（[Mauna Loa CO\(_{\text{2}}\) data set](https://www.esrl.noaa.gov/gmd/ccgg/trends/data.html)），由Pieter
    Tans博士、NOAA/GML和Ralph Keeling博士、斯克里普斯海洋研究所整理，记录了从1959年起在夏威夷莫纳罗亚研究站的大气二氧化碳（CO\(_{\text{2}}\)，百万分之一）浓度（[Tans
    and Keeling 2020](#ref-maunadata)）。对于这本书，我们将专注于1980-2020年的年份。
- en: '**Question:** Does the concentration of atmospheric CO\(_{\text{2}}\) change
    over time, and are there any interesting patterns to note?'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '**问题：** 大气中二氧化碳（CO\(_{\text{2}}\)）的浓度随时间变化吗？有没有值得注意的有趣模式？'
- en: 'To get started, we will read and inspect the data:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始，我们将读取并检查数据：
- en: '[PRE1]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[PRE2]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: We see that there are two columns in the `co2_df` data frame; `date_measured`
    and `ppm`. The `date_measured` column holds the date the measurement was taken,
    and is of type `date`. The `ppm` column holds the value of CO\(_{\text{2}}\) in
    parts per million that was measured on each date, and is type `double`.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到`co2_df`数据框中有两列；`date_measured`和`ppm`。`date_measured`列包含测量的日期，类型为`date`。`ppm`列包含在每日期测量的二氧化碳（CO$_{\text{2}}$）的百万分之一值，类型为`double`。
- en: '**Note:** `read_csv` was able to parse the `date_measured` column into the
    `date` vector type because it was entered in the international standard date format,
    called ISO 8601, which lists dates as `year-month-day`. `date` vectors are `double`
    vectors with special properties that allow them to handle dates correctly. For
    example, `date` type vectors allow functions like `ggplot` to treat them as numeric
    dates and not as character vectors, even though they contain non-numeric characters
    (e.g., in the `date_measured` column in the `co2_df` data frame). This means R
    will not accidentally plot the dates in the wrong order (i.e., not alphanumerically
    as would happen if it was a character vector). An in-depth study of dates and
    times is beyond the scope of the book, but interested readers may consult the
    Dates and Times chapter of *R for Data Science* ([Wickham and Grolemund 2016](#ref-wickham2016r));
    see the additional resources at the end of this chapter.'
  id: totrans-66
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**注意**：`read_csv`能够将`date_measured`列解析为`date`向量类型，因为它是以国际标准日期格式（称为ISO 8601）输入的，该格式将日期列为`年-月-日`。`date`向量是具有特殊属性的`double`向量，允许它们正确处理日期。例如，`date`类型向量允许像`ggplot`这样的函数将它们视为数值日期，而不是字符向量，即使它们包含非数值字符（例如，在`co2_df`数据框中的`date_measured`列）。这意味着R不会意外地将日期以错误的顺序绘制（即不是按字母数字顺序，如果它是字符向量会发生这种情况）。对日期和时间的深入研究超出了本书的范围，但感兴趣的读者可以参考*《R
    for Data Science》*（Wickham和Grolemund 2016）中的日期和时间章节；请参阅本章末尾的附加资源。'
- en: 'Since we are investigating a relationship between two variables (CO\(_{\text{2}}\)
    concentration and date), a scatter plot is a good place to start. Scatter plots
    show the data as individual points with `x` (horizontal axis) and `y` (vertical
    axis) coordinates. Here, we will use the measurement date as the `x` coordinate
    and the CO\(_{\text{2}}\) concentration as the `y` coordinate. When using the
    `ggplot2` package, we create a plot object with the `ggplot` function. There are
    a few basic aspects of a plot that we need to specify:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们正在研究两个变量之间的关系（CO$_{\text{2}}$浓度和日期），散点图是一个好的起点。散点图将数据显示为具有`x`（水平轴）和`y`（垂直轴）坐标的单独点。在这里，我们将测量日期作为`x`坐标，将CO$_{\text{2}}$浓度作为`y`坐标。当使用`ggplot2`包时，我们使用`ggplot`函数创建一个绘图对象。我们需要指定绘图的一些基本方面：
- en: The name of the data frame object to visualize.
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要可视化的数据框对象的名称。
- en: Here, we specify the `co2_df` data frame.
  id: totrans-69
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在这里，我们指定了`co2_df`数据框。
- en: The **aesthetic mapping**, which tells `ggplot` how the columns in the data
    frame map to properties of the visualization.
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**美学映射**，它告诉`ggplot`数据框中的列如何映射到可视化属性。'
- en: To create an aesthetic mapping, we use the `aes` function.
  id: totrans-71
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要创建美学映射，我们使用`aes`函数。
- en: Here, we set the plot `x` axis to the `date_measured` variable, and the plot
    `y` axis to the `ppm` variable.
  id: totrans-72
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在这里，我们将绘图`x`轴设置为`date_measured`变量，将绘图`y`轴设置为`ppm`变量。
- en: The `+` operator, which tells `ggplot` that we would like to add another layer
    to the plot.
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`+`运算符，它告诉`ggplot`我们希望向绘图添加另一个图层。'
- en: The **geometric object**, which specifies how the mapped data should be displayed.
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**几何对象**，它指定了映射数据应该如何显示。'
- en: To create a geometric object, we use a `geom_*` function (see the [ggplot reference](https://ggplot2.tidyverse.org/reference/)
    for a list of geometric objects).
  id: totrans-75
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要创建几何对象，我们使用一个`geom_*`函数（参见[ggplot参考](https://ggplot2.tidyverse.org/reference/)以获取几何对象的列表）。
- en: Here, we use the `geom_point` function to visualize our data as a scatter plot.
  id: totrans-76
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在这里，我们使用`geom_point`函数将我们的数据可视化为散点图。
- en: '[PRE3]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![Scatter plot of atmospheric concentration of CO$_{2}$ over time.](../Images/ed74991b9bbf9bac05ca9a319fdfe5a9.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![随时间变化的二氧化碳大气浓度散点图](../Images/ed74991b9bbf9bac05ca9a319fdfe5a9.png)'
- en: 'Figure 4.2: Scatter plot of atmospheric concentration of CO\(_{2}\) over time.'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.2：随时间变化的二氧化碳大气浓度散点图。
- en: The visualization in Figure [4.2](viz.html#fig:03-data-co2-scatter) shows a
    clear upward trend in the atmospheric concentration of CO\(_{\text{2}}\) over
    time. This plot answers the first part of our question in the affirmative, but
    that appears to be the only conclusion one can make from the scatter visualization.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.2中的可视化显示了大气中CO\(_{\text{2}}\)浓度随时间的明显上升趋势。这个图表肯定了我们的第一个问题，但似乎只能从这个散点图中得出这个结论。
- en: One important thing to note about this data is that one of the variables we
    are exploring is time. Time is a special kind of quantitative variable because
    it forces additional structure on the data—the data points have a natural order.
    Specifically, each observation in the data set has a predecessor and a successor,
    and the order of the observations matters; changing their order alters their meaning.
    In situations like this, we typically use a line plot to visualize the data. Line
    plots connect the sequence of `x` and `y` coordinates of the observations with
    line segments, thereby emphasizing their order.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 关于这些数据的一个重要注意事项是，我们正在探索的变量之一是时间。时间是一种特殊的定量变量，因为它给数据增加了额外的结构——数据点具有自然顺序。具体来说，数据集中的每个观测值都有一个前驱和一个后继，观测值的顺序很重要；改变它们的顺序会改变它们的含义。在这种情况下，我们通常使用折线图来可视化数据。折线图通过线段连接观测值的`x`和`y`坐标序列，从而强调它们的顺序。
- en: 'We can create a line plot in `ggplot` using the `geom_line` function. Let’s
    now try to visualize the `co2_df` as a line plot with just the default arguments:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`ggplot`中的`geom_line`函数创建折线图。现在让我们尝试使用默认参数将`co2_df`可视化为一个折线图：
- en: '[PRE4]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![Line plot of atmospheric concentration of CO$_{2}$ over time.](../Images/aeb544db956bcfc43951dd6a3a06f03a.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![大气中CO\(_{2}\)浓度随时间的折线图。](../Images/aeb544db956bcfc43951dd6a3a06f03a.png)'
- en: 'Figure 4.3: Line plot of atmospheric concentration of CO\(_{2}\) over time.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.3：大气中CO\(_{2}\)浓度随时间的折线图。
- en: 'Aha! Figure [4.3](viz.html#fig:03-data-co2-line) shows us there *is* another
    interesting phenomenon in the data: in addition to increasing over time, the concentration
    seems to oscillate as well. Given the visualization as it is now, it is still
    hard to tell how fast the oscillation is, but nevertheless, the line seems to
    be a better choice for answering the question than the scatter plot was. The comparison
    between these two visualizations also illustrates a common issue with scatter
    plots: often, the points are shown too close together or even on top of one another,
    muddling information that would otherwise be clear (*overplotting*).'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 哎！图4.3显示数据中确实存在另一个有趣的现象：除了随时间增加外，浓度似乎还在振荡。鉴于目前的可视化，仍然很难判断振荡的速度有多快，但无论如何，折线图似乎比散点图更好地回答了问题。这两个可视化之间的比较也说明了散点图的一个常见问题：通常，点显示得太靠近，甚至重叠在一起，混淆了本应清晰的信息（*过度绘图*）。
- en: 'Now that we have settled on the rough details of the visualization, it is time
    to refine things. This plot is fairly straightforward, and there is not much visual
    noise to remove. But there are a few things we must do to improve clarity, such
    as adding informative axis labels and making the font a more readable size. To
    add axis labels, we use the `xlab` and `ylab` functions. To change the font size,
    we use the `theme` function with the `text` argument:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经确定了可视化的粗略细节，是时候进行细化了。这个图表相当直接，没有太多视觉噪声需要去除。但我们必须做一些事情来提高清晰度，比如添加信息丰富的坐标轴标签，并使字体大小更易读。要添加坐标轴标签，我们使用`xlab`和`ylab`函数。要更改字体大小，我们使用带有`text`参数的`theme`函数：
- en: '[PRE5]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![Line plot of atmospheric concentration of CO$_{2}$ over time with clearer
    axes and labels.](../Images/6a1f9e915bca879944bf93096f69e835.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![具有更清晰坐标轴和标签的大气中CO\(_{2}\)浓度随时间的折线图。](../Images/6a1f9e915bca879944bf93096f69e835.png)'
- en: 'Figure 4.4: Line plot of atmospheric concentration of CO\(_{2}\) over time
    with clearer axes and labels.'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.4：具有更清晰坐标轴和标签的大气中CO\(_{2}\)浓度随时间的折线图。
- en: '**Note:** The `theme` function is quite complex and has many arguments that
    can be specified to control many non-data aspects of a visualization. An in-depth
    discussion of the `theme` function is beyond the scope of this book. Interested
    readers may consult the `theme` function documentation; see the additional resources
    section at the end of this chapter.'
  id: totrans-91
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**注意：** `theme`函数相当复杂，有多个参数可以指定，用于控制可视化的许多非数据方面。对`theme`函数的深入讨论超出了本书的范围。感兴趣的读者可以查阅`theme`函数的文档；请参阅本章末尾的附加资源部分。'
- en: Finally, let’s see if we can better understand the oscillation by changing the
    visualization slightly. Note that it is totally fine to use a small number of
    visualizations to answer different aspects of the question you are trying to answer.
    We will accomplish this by using *scales*, another important feature of `ggplot2`
    that easily transforms the different variables and set limits. We scale the horizontal
    axis using the `xlim` function, and the vertical axis with the `ylim` function.
    In particular, here, we will use the `xlim` function to zoom in on just five years
    of data (say, 1990-1994). `xlim` takes a vector of length two to specify the upper
    and lower bounds to limit the axis. We can create that using the `c` function.
    Note that it is important that the vector given to `xlim` must be of the same
    type as the data that is mapped to that axis. Here, we have mapped a date to the
    x-axis, and so we need to use the `date` function (from the `tidyverse` [`lubridate`
    R package](https://lubridate.tidyverse.org/) ([Spinu, Grolemund, and Wickham 2021](#ref-lubridate);
    [Grolemund and Wickham 2011](#ref-lubridatepaper))) to convert the character strings
    we provide to `c` to `date` vectors.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，让我们通过稍微改变可视化方式来更好地理解振荡。请注意，使用少量可视化来回答你试图回答的问题的不同方面是完全可行的。我们将通过使用**尺度**来实现这一点，这是`ggplot2`的另一个重要特性，它能够轻松地转换不同的变量并设置限制。我们使用`xlim`函数来缩放水平轴，使用`ylim`函数来缩放垂直轴。特别是，在这里，我们将使用`xlim`函数来聚焦于仅五年数据（比如，1990-1994年）。`xlim`接受一个长度为两个的向量来指定轴的上限和下限。我们可以使用`c`函数来创建这样的向量。请注意，给`xlim`提供的向量必须与映射到该轴的数据类型相同。在这里，我们已经将日期映射到x轴，因此我们需要使用`date`函数（来自`tidyverse`的`lubridate`
    R包（[Spinu, Grolemund, and Wickham 2021](#ref-lubridate); [Grolemund and Wickham
    2011](#ref-lubridatepaper)))来将我们提供给`c`的字符字符串转换为`date`向量。
- en: '**Note:** `lubridate` is a package that is installed by the `tidyverse` metapackage,
    but is not loaded by it. Hence we need to load it separately in the code below.'
  id: totrans-93
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**注意：** `lubridate`是一个由`tidyverse`元包安装的包，但它并没有被加载。因此，我们需要在下面的代码中单独加载它。'
- en: '[PRE6]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![Line plot of atmospheric concentration of CO$_{2}$ from 1990 to 1994.](../Images/fb012b1f1e2e32c3bc6f364eb177ebe1.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![1990至1994年大气中二氧化碳浓度的线图](../Images/fb012b1f1e2e32c3bc6f364eb177ebe1.png)'
- en: 'Figure 4.5: Line plot of atmospheric concentration of CO\(_{2}\) from 1990
    to 1994.'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.5：1990至1994年大气中二氧化碳浓度的线图。
- en: 'Interesting! It seems that each year, the atmospheric CO\(_{\text{2}}\) increases
    until it reaches its peak somewhere around April, decreases until around late
    September, and finally increases again until the end of the year. In Hawaii, there
    are two seasons: summer from May through October, and winter from November through
    April. Therefore, the oscillating pattern in CO\(_{\text{2}}\) matches up fairly
    closely with the two seasons.'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 有趣！看起来每年大气中的CO$_{\text{2}}$浓度都会增加，直到大约4月份达到峰值，然后减少，直到大约9月底，最后又增加，直到年底。在夏威夷，有两个季节：5月至10月的夏季和11月至4月的冬季。因此，CO$_{\text{2}}$的振荡模式与这两个季节相当吻合。
- en: As you might have noticed from the code used to create the final visualization
    of the `co2_df` data frame, we construct the visualizations in `ggplot` with layers.
    New layers are added with the `+` operator, and we can really add as many as we
    would like! A useful analogy to constructing a data visualization is painting
    a picture. We start with a blank canvas, and the first thing we do is prepare
    the surface for our painting by adding primer. In our data visualization this
    is akin to calling `ggplot` and specifying the data set we will be using. Next,
    we sketch out the background of the painting. In our data visualization, this
    would be when we map data to the axes in the `aes` function. Then we add our key
    visual subjects to the painting. In our data visualization, this would be the
    geometric objects (e.g., `geom_point`, `geom_line`, etc.). And finally, we work
    on adding details and refinements to the painting. In our data visualization this
    would be when we fine tune axis labels, change the font, adjust the point size,
    and do other related things.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从创建`co2_df`数据框最终可视化的代码中可能已经注意到的，我们在`ggplot`中使用层构建可视化。使用`+`运算符添加新层，我们可以添加尽可能多的层！构建数据可视化的一个有用类比是绘画。我们从一张空白画布开始，首先做的事情是为我们的绘画准备表面，添加底漆。在我们的数据可视化中，这类似于调用`ggplot`并指定我们将使用的数据集。接下来，我们绘制绘画的背景。在我们的数据可视化中，这将是我们在`aes`函数中将数据映射到轴上时。然后我们向绘画中添加关键视觉主题。在我们的数据可视化中，这将是几何对象（例如，`geom_point`、`geom_line`等）。最后，我们专注于添加细节和改进绘画。在我们的数据可视化中，这将是当我们微调轴标签、更改字体、调整点大小以及进行其他相关操作时。
- en: '4.5.2 Scatter plots: the Old Faithful eruption time data set'
  id: totrans-99
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.2 散点图：老忠实喷泉喷发时间数据集
- en: The `faithful` data set contains measurements of the waiting time between eruptions
    and the subsequent eruption duration (in minutes) of the Old Faithful geyser in
    Yellowstone National Park, Wyoming, United States. The `faithful` data set is
    available in base R as a data frame, so it does not need to be loaded. We convert
    it to a tibble to take advantage of the nicer print output these specialized data
    frames provide.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '`faithful`数据集包含了黄石国家公园怀俄明州老忠实喷泉喷发之间的等待时间以及随后的喷发持续时间（以分钟计）的测量。`faithful`数据集在基础R中作为数据框提供，因此不需要加载。我们将其转换为tibble，以利用这些专用数据框提供的更佳打印输出。'
- en: '**Question:** Is there a relationship between the waiting time before an eruption
    and the duration of the eruption?'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '**问题：** 喷发前的等待时间与喷发持续时间之间是否存在关系？'
- en: '[PRE7]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Here again, we investigate the relationship between two quantitative variables
    (waiting time and eruption time). But if you look at the output of the data frame,
    you’ll notice that unlike time in the Mauna Loa CO\(_{\text{2}}\) data set, neither
    of the variables here have a natural order to them. So a scatter plot is likely
    to be the most appropriate visualization. Let’s create a scatter plot using the
    `ggplot` function with the `waiting` variable on the horizontal axis, the `eruptions`
    variable on the vertical axis, and the `geom_point` geometric object. The result
    is shown in Figure [4.6](viz.html#fig:03-data-faithful-scatter).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们再次研究两个定量变量（等待时间和喷发时间）之间的关系。但如果你查看数据框的输出，你会注意到，与马乌纳洛亚二氧化碳数据集中的时间不同，这里的两个变量都没有自然顺序。因此，散点图可能是最合适的可视化方式。让我们使用`ggplot`函数创建一个散点图，其中`waiting`变量位于水平轴上，`eruptions`变量位于垂直轴上，并使用`geom_point`几何对象。结果如图[4.6](viz.html#fig:03-data-faithful-scatter)所示。
- en: '[PRE9]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![Scatter plot of waiting time and eruption time.](../Images/ec915413d9368bc7542ee1e2ecb1e435.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![等待时间和喷发时间的散点图。](../Images/ec915413d9368bc7542ee1e2ecb1e435.png)'
- en: 'Figure 4.6: Scatter plot of waiting time and eruption time.'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.6：等待时间和喷发时间的散点图。
- en: 'We can see in Figure [4.6](viz.html#fig:03-data-faithful-scatter) that the
    data tend to fall into two groups: one with short waiting and eruption times,
    and one with long waiting and eruption times. Note that in this case, there is
    no overplotting: the points are generally nicely visually separated, and the pattern
    they form is clear. In order to refine the visualization, we need only to add
    axis labels and make the font more readable:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在图[4.6](viz.html#fig:03-data-faithful-scatter)中看到数据倾向于分为两组：一组等待和喷发时间较短，另一组等待和喷发时间较长。请注意，在这种情况下，没有过度绘图：点通常在视觉上很好地分离，形成的模式也很清晰。为了细化可视化，我们只需要添加轴标签并使字体更易读：
- en: '[PRE10]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![Scatter plot of waiting time and eruption time with clearer axes and labels.](../Images/548d7d9c1cd6c195ae6b1ffb8ac7a604.png)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![带有更清晰轴和标签的等待时间和爆发时间散点图](../Images/548d7d9c1cd6c195ae6b1ffb8ac7a604.png)'
- en: 'Figure 4.7: Scatter plot of waiting time and eruption time with clearer axes
    and labels.'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.7：带有更清晰轴和标签的等待时间和爆发时间散点图。
- en: '4.5.3 Axis transformation and colored scatter plots: the Canadian languages
    data set'
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.3 轴变换和彩色散点图：加拿大语言数据集
- en: Recall the `can_lang` data set ([Timbers 2020](#ref-timbers2020canlang)) from
    Chapters [1](intro.html#intro), [2](reading.html#reading), and [3](wrangling.html#wrangling),
    which contains counts of languages from the 2016 Canadian census.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 回忆一下来自第[1](intro.html#intro)、[2](reading.html#reading)和[3](wrangling.html#wrangling)章的`can_lang`数据集([Timbers
    2020](#ref-timbers2020canlang))，它包含了2016年加拿大人口普查中的语言计数。
- en: '**Question:** Is there a relationship between the percentage of people who
    speak a language as their mother tongue and the percentage for whom that is the
    primary language spoken at home? And is there a pattern in the strength of this
    relationship in the higher-level language categories (Official languages, Aboriginal
    languages, or non-official and non-Aboriginal languages)?'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '**问题：说某种语言作为母语的人的百分比与在家说该语言作为主要语言的人的百分比之间是否存在关系？在高级语言类别（官方语言、原住民语言或非官方和非原住民语言）中，这种关系的强度是否存在模式？**'
- en: 'To get started, we will read and inspect the data:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始，我们将读取和检查数据：
- en: '[PRE11]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: We will begin with a scatter plot of the `mother_tongue` and `most_at_home`
    columns from our data frame. The resulting plot is shown in Figure [4.8](viz.html#fig:03-mother-tongue-vs-most-at-home).
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从我们的数据框中的`mother_tongue`和`most_at_home`列开始，绘制散点图。生成的图表显示在图[4.8](viz.html#fig:03-mother-tongue-vs-most-at-home)中。
- en: '[PRE13]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![Scatter plot of number of Canadians reporting a language as their mother
    tongue vs the primary language at home.](../Images/dd61eda6d028d7e0bdb5607e2f403193.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![报告母语为加拿大语言的加拿大人与家庭主要语言散点图](../Images/dd61eda6d028d7e0bdb5607e2f403193.png)'
- en: 'Figure 4.8: Scatter plot of number of Canadians reporting a language as their
    mother tongue vs the primary language at home.'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.8：报告母语为加拿大语言的加拿大人与家庭主要语言散点图。
- en: To make an initial improvement in the interpretability of Figure [4.8](viz.html#fig:03-mother-tongue-vs-most-at-home),
    we should replace the default axis names with more informative labels. We can
    use `\n` to create a line break in the axis names so that the words after `\n`
    are printed on a new line. This will make the axes labels on the plots more readable.
    We should also increase the font size to further improve readability.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提高图[4.8](viz.html#fig:03-mother-tongue-vs-most-at-home)的可解释性，我们应该用更信息丰富的标签替换默认的轴名称。我们可以使用`\n`在轴名称中创建换行符，这样`\n`之后的单词就会打印在新的一行上。这将使图表上的轴标签更易读。我们还应该增加字体大小以进一步提高可读性。
- en: '[PRE14]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![Scatter plot of number of Canadians reporting a language as their mother
    tongue vs the primary language at home with x and y labels.](../Images/f2a3f63361d25c1eda816a698fb22d48.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![报告母语为加拿大语言的加拿大人与家庭主要语言散点图，带有x轴和y轴标签](../Images/f2a3f63361d25c1eda816a698fb22d48.png)'
- en: 'Figure 4.9: Scatter plot of number of Canadians reporting a language as their
    mother tongue vs the primary language at home with x and y labels.'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.9：报告母语为加拿大语言的加拿大人与家庭主要语言散点图，x轴和y轴带有标签。
- en: 'Okay! The axes and labels in Figure [4.9](viz.html#fig:03-mother-tongue-vs-most-at-home-labs)
    are much more readable and interpretable now. However, the scatter points themselves
    could use some work; most of the 214 data points are bunched up in the lower left-hand
    side of the visualization. The data is clumped because many more people in Canada
    speak English or French (the two points in the upper right corner) than other
    languages. In particular, the most common mother tongue language has 19,460,850
    speakers, while the least common has only 10. That’s a 6-decimal-place difference
    in the magnitude of these two numbers! We can confirm that the two points in the
    upper right-hand corner correspond to Canada’s two official languages by filtering
    the data:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 好的！图[4.9](viz.html#fig:03-mother-tongue-vs-most-at-home-labs)中的轴和标签现在更加易读和可解释。然而，散点本身可能需要一些改进；大多数214个数据点都聚集在可视化的左下角。数据聚集是因为在加拿大说英语或法语的人（右上角的两点）比其他语言的人多得多。特别是，最常见的母语语言有1,946,085,0人使用，而最不常见的只有10人。这两个数字的大小相差6位小数！我们可以通过过滤数据来确认右上角的两点对应于加拿大的两种官方语言：
- en: '[PRE15]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '[PRE16]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Recall that our question about this data pertains to *all* languages; so to
    properly answer our question, we will need to adjust the scale of the axes so
    that we can clearly see all of the scatter points. In particular, we will improve
    the plot by adjusting the horizontal and vertical axes so that they are on a **logarithmic**
    (or **log**) scale. Log scaling is useful when your data take both *very large*
    and *very small* values, because it helps space out small values and squishes
    larger values together. For example, \(\log_{10}(1) = 0\), \(\log_{10}(10) = 1\),
    \(\log_{10}(100) = 2\), and \(\log_{10}(1000) = 3\); on the logarithmic scale,
    the values 1, 10, 100, and 1000 are all the same distance apart! So we see that
    applying this function is moving big values closer together and moving small values
    farther apart. Note that if your data can take the value 0, logarithmic scaling
    may not be appropriate (since `log10(0)` is `-Inf` in R). There are other ways
    to transform the data in such a case, but these are beyond the scope of the book.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 回想一下，我们关于这些数据的问题涉及到**所有**语言；因此，为了正确回答我们的问题，我们需要调整坐标轴的刻度，以便我们可以清楚地看到所有的散点。特别是，我们将通过调整水平和垂直坐标轴，使它们处于**对数**（或**log**）刻度上。当你的数据既有**非常大**的值也有**非常小**的值时，对数刻度很有用，因为它有助于分散小值并将大值挤压在一起。例如，\(\log_{10}(1)
    = 0\)，\(\log_{10}(10) = 1\)，\(\log_{10}(100) = 2\)，以及\(\log_{10}(1000) = 3\)；在对数刻度上，值1、10、100和1000之间的距离都是相同的！因此，我们看到应用这个函数是将大值拉近，将小值推远。请注意，如果你的数据可以取值为0，对数刻度可能不合适（因为在R中`log10(0)`是`-Inf`）。在这种情况下，还有其他方法可以转换数据，但这些超出了本书的范围。
- en: We can accomplish logarithmic scaling in a `ggplot` visualization using the
    `scale_x_log10` and `scale_y_log10` functions. Given that the x and y axes have
    large numbers, we should also format the axis labels to put commas in these numbers
    to increase their readability. We can do this in R by passing the `label_comma`
    function (from the `scales` package) to the `labels` argument of the `scale_x_log10`
    and `scale_x_log10` functions.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`ggplot`可视化中的`scale_x_log10`和`scale_y_log10`函数来实现对数刻度。鉴于x和y轴有大量数字，我们还应该格式化轴标签，在这些数字中添加逗号以增加其可读性。我们可以在R中将`label_comma`函数（来自`scales`包）传递给`scale_x_log10`和`scale_y_log10`函数的`labels`参数。
- en: '[PRE17]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![Scatter plot of number of Canadians reporting a language as their mother
    tongue vs the primary language at home with log adjusted x and y axes.](../Images/b71fa51ae6bbdc80fac97efbe48b5196.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![散点图：报告母语为加拿大人的语言与在家使用的主要语言，带有调整后的对数x和y轴。](../Images/b71fa51ae6bbdc80fac97efbe48b5196.png)'
- en: 'Figure 4.10: Scatter plot of number of Canadians reporting a language as their
    mother tongue vs the primary language at home with log adjusted x and y axes.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.10：报告母语为加拿大人的语言与在家使用的主要语言之间的散点图，带有调整后的对数x和y轴。
- en: Similar to some of the examples in Chapter [3](wrangling.html#wrangling), we
    can convert the counts to percentages to give them context and make them easier
    to understand. We can do this by dividing the number of people reporting a given
    language as their mother tongue or primary language at home by the number of people
    who live in Canada and multiplying by 100%. For example, the percentage of people
    who reported that their mother tongue was English in the 2016 Canadian census
    was 19,460,850 / 35,151,728 \(\times\) 100 % = 55.36%.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 与第[3](wrangling.html#wrangling)章中的一些示例类似，我们可以将计数转换为百分比以提供上下文并使其更容易理解。我们可以通过将报告母语或在家使用的主要语言为给定语言的人数除以居住在加拿大的人数，然后乘以100%来实现这一点。例如，2016年加拿大人口普查中报告母语为英语的人数为19,460,850
    / 35,151,728 \(\times\) 100 % = 55.36%。
- en: Below we use `mutate` to calculate the percentage of people reporting a given
    language as their mother tongue and primary language at home for all the languages
    in the `can_lang` data set. Since the new columns are appended to the end of the
    data table, we selected the new columns after the transformation so you can clearly
    see the mutated output from the table.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面，我们使用`mutate`计算报告母语和在家使用的主要语言为所有语言的百分比，对于`can_lang`数据集中的所有语言。由于新列被附加到数据表的末尾，我们在转换后选择了新列，以便您可以清楚地看到从表中突变输出的结果。
- en: '[PRE18]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Finally, we will edit the visualization to use the percentages we just computed
    (and change our axis labels to reflect this change in units). Figure [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props)
    displays the final result.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们将编辑可视化，使用我们刚刚计算出的百分比（并更改轴标签以反映这种单位变化）。图[4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props)显示了最终结果。
- en: '[PRE20]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![Scatter plot of percentage of Canadians reporting a language as their mother
    tongue vs the primary language at home.](../Images/64ba2939c39fd4ee6b97ce7760d8ed51.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![散点图：报告将某种语言作为母语的加拿大人百分比与在家使用的主要语言](../Images/64ba2939c39fd4ee6b97ce7760d8ed51.png)'
- en: 'Figure 4.11: Scatter plot of percentage of Canadians reporting a language as
    their mother tongue vs the primary language at home.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.11：报告将某种语言作为母语的加拿大人百分比与在家使用的主要语言散点图。
- en: 'Figure [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props) is
    the appropriate visualization to use to answer the first question in this section,
    i.e., whether there is a relationship between the percentage of people who speak
    a language as their mother tongue and the percentage for whom that is the primary
    language spoken at home. To fully answer the question, we need to use Figure [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props)
    to assess a few key characteristics of the data:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 图 [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props) 是回答本节第一个问题的适当可视化方式，即说某种语言作为母语的人数百分比与在家说该语言作为主要语言的人数百分比之间是否存在关系。要完全回答这个问题，我们需要使用图
    [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props) 来评估数据的几个关键特征：
- en: '**Direction:** if the y variable tends to increase when the x variable increases,
    then y has a **positive** relationship with x. If y tends to decrease when x increases,
    then y has a **negative** relationship with x. If y does not meaningfully increase
    or decrease as x increases, then y has **little or no** relationship with x.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方向**：如果当 x 变量增加时，y 变量倾向于增加，那么 y 与 x 有**正相关**关系。如果 y 在 x 增加时倾向于减少，那么 y 与 x
    有**负相关**关系。如果 y 在 x 增加时没有明显增加或减少，那么 y 与 x 有**很小或没有**关系。'
- en: '**Strength:** if the y variable *reliably* increases, decreases, or stays flat
    as x increases, then the relationship is **strong**. Otherwise, the relationship
    is **weak**. Intuitively, the relationship is strong when the scatter points are
    close together and look more like a “line” or “curve” than a “cloud.”'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**强度**：如果当 x 变量增加时，y 变量可靠地增加、减少或保持平稳，那么这种关系是**强的**。否则，这种关系是**弱的**。直观上，当散点彼此靠近，看起来更像“线”或“曲线”而不是“云”时，关系是强的。'
- en: '**Shape:** if you can draw a straight line roughly through the data points,
    the relationship is **linear**. Otherwise, it is **nonlinear**.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**形状**：如果你可以通过大致穿过数据点的直线，那么这种关系是**线性的**。否则，它是**非线性的**。'
- en: In Figure [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props),
    we see that as the percentage of people who have a language as their mother tongue
    increases, so does the percentage of people who speak that language at home. Therefore,
    there is a **positive** relationship between these two variables. Furthermore,
    because the points in Figure [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props)
    are fairly close together, and the points look more like a “line” than a “cloud”,
    we can say that this is a **strong** relationship. And finally, because drawing
    a straight line through these points in Figure [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props)
    would fit the pattern we observe quite well, we say that the relationship is **linear**.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在图 [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props) 中，我们看到，随着将某种语言作为母语的人数百分比增加，在家说这种语言的人数百分比也相应增加。因此，这两个变量之间存在**正相关**关系。此外，由于图
    [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props) 中的点相当接近，而且点看起来更像“线”而不是“云”，我们可以说这是一种**强的**关系。最后，由于通过图
    [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props) 中的这些点画直线可以很好地符合我们观察到的模式，我们可以说这种关系是**线性的**。
- en: Onto the second part of our exploratory data analysis question! Recall that
    we are interested in knowing whether the strength of the relationship we uncovered
    in Figure [4.11](viz.html#fig:03-mother-tongue-vs-most-at-home-scale-props) depends
    on the higher-level language category (Official languages, Aboriginal languages,
    and non-official, non-Aboriginal languages). One common way to explore this is
    to color the data points on the scatter plot we have already created by group.
    For example, given that we have the higher-level language category for each language
    recorded in the 2016 Canadian census, we can color the points in our previous
    scatter plot to represent each language’s higher-level language category.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是探索性数据分析问题的第二部分！回想一下，我们感兴趣的是了解我们在图4.11中发现的关系的强度是否取决于更高级别的语言类别（官方语言、原住民语言和非官方、非原住民语言）。探索这一点的常见方法是通过按组着色我们已创建的散点图中的数据点。例如，鉴于我们拥有2016年加拿大人口普查中记录的每种语言的更高级别语言类别，我们可以在先前的散点图中着色点，以表示每种语言的更高级别语言类别。
- en: Here we want to distinguish the values according to the `category` group with
    which they belong. We can add an argument to the `aes` function, specifying that
    the `category` column should color the points. Adding this argument will color
    the points according to their group and add a legend at the side of the plot.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们希望根据它们所属的`category`组来区分值。我们可以在`aes`函数中添加一个参数，指定`category`列应该着色点。添加此参数将根据它们的组着色点，并在绘图旁边添加图例。
- en: '[PRE21]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![Scatter plot of percentage of Canadians reporting a language as their mother
    tongue vs the primary language at home colored by language category.](../Images/6f735755f2f21d04a1d8248d5ddb852e.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![加拿大人报告的母语百分比与家庭主要语言散点图，按语言类别着色](../Images/6f735755f2f21d04a1d8248d5ddb852e.png)'
- en: 'Figure 4.12: Scatter plot of percentage of Canadians reporting a language as
    their mother tongue vs the primary language at home colored by language category.'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.12：按语言类别着色的加拿大人报告的母语百分比与家庭主要语言的散点图。
- en: The legend in Figure [4.12](viz.html#fig:03-scatter-color-by-category) takes
    up valuable plot area. We can improve this by moving the legend title using the
    `legend.position` and `legend.direction` arguments of the `theme` function. Here
    we set `legend.position` to `"top"` to put the legend above the plot and `legend.direction`
    to `"vertical"` so that the legend items remain vertically stacked on top of each
    other. When the `legend.position` is set to either `"top"` or `"bottom"` the default
    direction is to stack the legend items horizontally. However, that will not work
    well for this particular visualization because the legend labels are quite long
    and would run off the page if displayed this way.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.12中的图例占据了宝贵的绘图区域。我们可以通过使用`theme`函数的`legend.position`和`legend.direction`参数来移动图例标题来改进这一点。在这里，我们将`legend.position`设置为`"top"`，以便将图例放在绘图上方，并将`legend.direction`设置为`"vertical"`，这样图例项就会垂直堆叠。当`legend.position`设置为`"top"`或`"bottom"`时，默认方向是水平堆叠图例项。然而，这对于这个特定的可视化效果来说效果不佳，因为图例标签相当长，如果这样显示，就会超出页面范围。
- en: '[PRE22]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '![Scatter plot of percentage of Canadians reporting a language as their mother
    tongue vs the primary language at home colored by language category with the legend
    edited.](../Images/858190de7f44b437d6d6085f122b7d82.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![加拿大人报告的母语百分比与家庭主要语言散点图，按语言类别着色，图例已编辑](../Images/858190de7f44b437d6d6085f122b7d82.png)'
- en: 'Figure 4.13: Scatter plot of percentage of Canadians reporting a language as
    their mother tongue vs the primary language at home colored by language category
    with the legend edited.'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.13：按语言类别着色并编辑图例的加拿大人报告的母语百分比与家庭主要语言的散点图。
- en: In Figure [4.13](viz.html#fig:03-scatter-color-by-category-legend-edit), the
    points are colored with the default `ggplot2` color palette. But what if you want
    to use different colors? In R, two packages that provide alternative color palettes
    are `RColorBrewer` ([Neuwirth 2014](#ref-RColorBrewer)) and `ggthemes` ([Arnold
    2019](#ref-ggthemes)); in this book we will cover how to use `RColorBrewer`. You
    can visualize the list of color palettes that `RColorBrewer` has to offer with
    the `display.brewer.all` function. You can also print a list of color-blind friendly
    palettes by adding `colorblindFriendly = TRUE` to the function.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在图 [4.13](viz.html#fig:03-scatter-color-by-category-legend-edit) 中，点使用的是默认的
    `ggplot2` 颜色调色板。但如果你想要使用不同的颜色呢？在 R 中，有两个提供替代颜色调色板的包是 `RColorBrewer` ([Neuwirth
    2014](#ref-RColorBrewer)) 和 `ggthemes` ([Arnold 2019](#ref-ggthemes))；在这本书中，我们将介绍如何使用
    `RColorBrewer`。您可以使用 `display.brewer.all` 函数可视化 `RColorBrewer` 提供的颜色调色板列表。您还可以通过将
    `colorblindFriendly = TRUE` 添加到函数中来打印颜色盲友好调色板的列表。
- en: '[PRE23]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![Color palettes available from the RColorBrewer R package.](../Images/c57cf0eece52cedd4eba353637a9d917.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![来自 RColorBrewer R 包的可用的颜色调色板。](../Images/c57cf0eece52cedd4eba353637a9d917.png)'
- en: 'Figure 4.14: Color palettes available from the `RColorBrewer` R package.'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.14：来自 `RColorBrewer` R 包的可用的颜色调色板。
- en: From Figure [4.14](viz.html#fig:rcolorbrewer), we can choose the color palette
    we want to use in our plot. To change the color palette, we add the `scale_color_brewer`
    layer indicating the palette we want to use. You can use this [color blindness
    simulator](https://www.color-blindness.com/coblis-color-blindness-simulator/)
    to check if your visualizations are color-blind friendly. Below we pick the `"Set2"`
    palette, with the result shown in Figure [4.15](viz.html#fig:scatter-color-by-category-palette).
    We also set the `shape` aesthetic mapping to the `category` variable as well;
    this makes the scatter point shapes different for each category. This kind of
    visual redundancy—i.e., conveying the same information with both scatter point
    color and shape—can further improve the clarity and accessibility of your visualization.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 从图 [4.14](viz.html#fig:rcolorbrewer) 中，我们可以选择我们想要在图表中使用的颜色调色板。要更改颜色调色板，我们添加表示我们想要使用的调色板的
    `scale_color_brewer` 层。您可以使用这个 [色盲模拟器](https://www.color-blindness.com/coblis-color-blindness-simulator/)
    来检查您的可视化是否对色盲友好。下面我们选择了 `"Set2"` 调色板，结果如图 [4.15](viz.html#fig:scatter-color-by-category-palette)
    所示。我们还设置了 `shape` 美学映射到 `category` 变量；这使得散点图中的点形状因类别而异。这种视觉冗余——即，通过散点图的颜色和形状传达相同的信息——可以进一步提高您可视化的清晰度和可访问性。
- en: '[PRE24]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![Scatter plot of percentage of Canadians reporting a language as their mother
    tongue vs the primary language at home colored by language category with color-blind
    friendly colors.](../Images/d03246987f0470378a2013ec0ab307a4.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![加拿大人报告的语言作为母语与家庭主要语言百分比的散点图，按语言类别着色，使用色盲友好颜色。](../Images/d03246987f0470378a2013ec0ab307a4.png)'
- en: 'Figure 4.15: Scatter plot of percentage of Canadians reporting a language as
    their mother tongue vs the primary language at home colored by language category
    with color-blind friendly colors.'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.15：加拿大人报告的语言作为母语与家庭主要语言百分比的散点图，按语言类别着色，使用色盲友好颜色。
- en: From the visualization in Figure [4.15](viz.html#fig:scatter-color-by-category-palette),
    we can now clearly see that the vast majority of Canadians reported one of the
    official languages as their mother tongue and as the language they speak most
    often at home. What do we see when considering the second part of our exploratory
    question? Do we see a difference in the relationship between languages spoken
    as a mother tongue and as a primary language at home across the higher-level language
    categories? Based on Figure [4.15](viz.html#fig:scatter-color-by-category-palette),
    there does not appear to be much of a difference. For each higher-level language
    category, there appears to be a strong, positive, and linear relationship between
    the percentage of people who speak a language as their mother tongue and the percentage
    who speak it as their primary language at home. The relationship looks similar
    regardless of the category.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 从图 [4.15](viz.html#fig:scatter-color-by-category-palette) 的可视化中，我们现在可以清楚地看到，绝大多数加拿大人报告说，他们的一种官方语言是他们的母语，也是他们在家里最常说的语言。当我们考虑探索性问题的第二部分时，我们会看到什么？我们会看到作为母语和作为家庭主要语言的所说话语之间的关系有何不同？根据图
    [4.15](viz.html#fig:scatter-color-by-category-palette)，似乎没有太大的差异。对于每个高级语言类别，似乎存在一个强烈的、积极的、线性的关系，即说某种语言作为母语的人数百分比与说它作为家庭主要语言的人数百分比之间的关系。无论类别如何，这种关系看起来都很相似。
- en: Does this mean that this relationship is positive for all languages in the world?
    And further, can we use this data visualization on its own to predict how many
    people have a given language as their mother tongue if we know how many people
    speak it as their primary language at home? The answer to both these questions
    is “no!” However, with exploratory data analysis, we can create new hypotheses,
    ideas, and questions (like the ones at the beginning of this paragraph). Answering
    those questions often involves doing more complex analyses, and sometimes even
    gathering additional data. We will see more of such complex analyses later on
    in this book.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 这是否意味着这种关系在世界上所有语言中都是正相关的？更进一步，如果我们知道有多少人将其作为家庭中的主要语言，我们能否仅使用这种数据可视化来预测有多少人将某种语言作为母语？这两个问题的答案都是“不！”然而，通过探索性数据分析，我们可以创建新的假设、想法和问题（如本段开头所述）。回答这些问题通常涉及进行更复杂的分析，有时甚至需要收集额外的数据。我们将在本书的后面部分看到更多这样的复杂分析。
- en: '4.5.4 Bar plots: the island landmass data set'
  id: totrans-166
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.4 条形图：岛屿陆地数据集
- en: The `islands.csv` data set contains a list of Earth’s landmasses as well as
    their area (in thousands of square miles) ([McNeil 1977](#ref-islandsdata)).
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '`islands.csv` 数据集包含地球陆地面积列表以及它们的面积（以千平方英里为单位）([McNeil 1977](#ref-islandsdata))。'
- en: '**Question:** Are the continents (North / South America, Africa, Europe, Asia,
    Australia, Antarctica) Earth’s seven largest landmasses? If so, what are the next
    few largest landmasses after those?'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '**问题：** 大陆（北美洲/南美洲、非洲、欧洲、亚洲、澳大利亚、南极洲）是地球最大的七个陆地吗？如果是这样，那么在这些大陆之后，接下来几个最大的陆地是什么？'
- en: 'To get started, we will read and inspect the data:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始，我们将读取并检查数据：
- en: '[PRE25]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '[PRE26]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Here, we have a data frame of Earth’s landmasses, and are trying to compare
    their sizes. The right type of visualization to answer this question is a bar
    plot. In a bar plot, the height of each bar represents the value of an *amount*
    (a size, count, proportion, percentage, etc). They are particularly useful for
    comparing counts or proportions across different groups of a categorical variable.
    Note, however, that bar plots should generally not be used to display mean or
    median values, as they hide important information about the variation of the data.
    Instead it’s better to show the distribution of all the individual data points,
    e.g., using a histogram, which we will discuss further in Section [4.5.5](viz.html#histogramsviz).
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们有一个地球陆地面积的数据框，并试图比较它们的面积。回答这个问题的正确可视化类型是条形图。在条形图中，每个条形的高度代表一个 *数量*（大小、计数、比例、百分比等）。它们特别适用于比较分类变量不同组之间的计数或比例。然而，请注意，条形图通常不应用于显示平均值或中位数，因为它们隐藏了关于数据变异的重要信息。相反，最好显示所有单个数据点的分布，例如，使用直方图，我们将在第
    [4.5.5](viz.html#histogramsviz) 节中进一步讨论。
- en: We specify that we would like to use a bar plot via the `geom_bar` function
    in `ggplot2`. However, by default, `geom_bar` sets the heights of bars to the
    number of times a value appears in a data frame (its *count*); here, we want to
    plot exactly the values in the data frame, i.e., the landmass sizes. So we have
    to pass the `stat = "identity"` argument to `geom_bar`. The result is shown in
    Figure [4.16](viz.html#fig:03-data-islands-bar).
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 我们指定我们想要使用 `ggplot2` 中的 `geom_bar` 函数来创建条形图。然而，默认情况下，`geom_bar` 将条形的高度设置为数据框中值出现的次数（其
    *计数*）；在这里，我们想要绘制数据框中的确切值，即陆地面积。因此，我们必须将 `stat = "identity"` 参数传递给 `geom_bar`。结果如图
    [4.16](viz.html#fig:03-data-islands-bar) 所示。
- en: '[PRE27]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '![Bar plot of Earth''s landmass sizes with squished labels.](../Images/0e06e49d3eda8c401e14d6b9b8ef9e7b.png)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![地球陆地面积的条形图，标签被压缩。](../Images/0e06e49d3eda8c401e14d6b9b8ef9e7b.png)'
- en: 'Figure 4.16: Bar plot of Earth’s landmass sizes with squished labels.'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.16：地球陆地面积的条形图，标签被压缩。
- en: 'Alright, not bad! The plot in Figure [4.16](viz.html#fig:03-data-islands-bar)
    is definitely the right kind of visualization, as we can clearly see and compare
    sizes of landmasses. The major issues are that the smaller landmasses’ sizes are
    hard to distinguish, and the names of the landmasses are obscuring each other
    as they have been squished into too little space. But remember that the question
    we asked was only about the largest landmasses; let’s make the plot a little bit
    clearer by keeping only the largest 12 landmasses. We do this using the `slice_max`
    function: the `order_by` argument is the name of the column we want to use for
    comparing which is largest, and the `n` argument specifies how many rows to keep.
    Then to give the labels enough space, we’ll use horizontal bars instead of vertical
    ones. We do this by swapping the `x` and `y` variables.'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 好的，不错！图[4.16](viz.html#fig:03-data-islands-bar)确实是我们需要的可视化类型，因为我们可以清楚地看到并比较陆地的面积。主要问题是较小陆地的面积难以区分，而且由于空间太小，陆地的名称相互遮挡。但请记住，我们提出的问题只是关于最大的陆地；让我们通过只保留最大的12个陆地来使图表更清晰。我们使用`slice_max`函数来做这件事：`order_by`参数是我们想要用于比较的列名，而`n`参数指定要保留的行数。然后为了给标签留出足够的空间，我们将使用水平条形而不是垂直条形。我们通过交换`x`和`y`变量来实现这一点。
- en: '**Note:** Recall that in Chapter [1](intro.html#intro), we used `arrange` followed
    by `slice` to obtain the ten rows with the largest values of a variable. We could
    have instead used the `slice_max` function for this purpose. The `slice_max` and
    `slice_min` functions achieve the same goal as `arrange` followed by `slice`,
    but are slightly more efficient because they are specialized for this purpose.
    In general, it is good to use more specialized functions when they are available!'
  id: totrans-178
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**注意：**回想一下，在第[1](intro.html#intro)章中，我们使用了`arrange`然后是`slice`来获取一个变量的最大值的前十行。我们也可以使用`slice_max`函数来完成这个目的。`slice_max`和`slice_min`函数与`arrange`后跟`slice`达到相同的目标，但它们更有效率，因为它们专门为此目的而设计。一般来说，当有更专业的函数可用时，使用它们是好的！'
- en: '[PRE28]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '![Bar plot of size for Earth''s largest 12 landmasses.](../Images/b7f7e82babb162849ae5b08267369e25.png)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![地球最大12个陆地的条形图](../Images/b7f7e82babb162849ae5b08267369e25.png)'
- en: 'Figure 4.17: Bar plot of size for Earth’s largest 12 landmasses.'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.17：地球最大12个陆地的条形图。
- en: The plot in Figure [4.17](viz.html#fig:03-data-islands-bar-2) is definitely
    clearer now, and allows us to answer our question (“Are the top 7 largest landmasses
    continents?”) in the affirmative. However, we could still improve this visualization
    by coloring the bars based on whether they correspond to a continent, and by organizing
    the bars by landmass size rather than by alphabetical order. The data for coloring
    the bars is stored in the `landmass_type` column, so we add the `fill` argument
    to the aesthetic mapping and set it to `landmass_type`. We manually select two
    colors for the bars using the `scale_fill_manual` function:`"darkorange"` for
    orange and `"steelblue"` for blue. To organize the landmasses by their `size`
    variable, we will use the `tidyverse` `fct_reorder` function in the aesthetic
    mapping to organize the landmasses by their `size` variable. The first argument
    passed to `fct_reorder` is the name of the factor column whose levels we would
    like to reorder (here, `landmass`). The second argument is the column name that
    holds the values we would like to use to do the ordering (here, `size`). The `fct_reorder`
    function uses ascending order by default, but this can be changed to descending
    order by setting `.desc = TRUE`. We do this here so that the largest bar will
    be closest to the axis line, which is more visually appealing.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图[4.17](viz.html#fig:03-data-islands-bar-2)现在确实更清晰了，并允许我们肯定地回答我们的问题（“最大的7个陆地是大陆吗？”）。然而，我们仍然可以通过根据条形是否对应大陆来着色条形，以及通过按陆地面积而不是按字母顺序组织条形来改进这个可视化。用于着色条形的数据存储在`landmass_type`列中，所以我们向美学映射中添加了`fill`参数并将其设置为`landmass_type`。我们使用`scale_fill_manual`函数手动选择两种颜色用于条形：“darkorange”用于橙色和“steelblue”用于蓝色。为了按`size`变量组织陆地，我们将在美学映射中使用`tidyverse`的`fct_reorder`函数，按其`size`变量组织陆地。传递给`fct_reorder`的第一个参数是我们想要重新排序的水平因子列的名称（在这里，`landmass`）。第二个参数是我们想要用于排序的列名（在这里，`size`）。`fct_reorder`函数默认按升序排序，但可以通过设置`.desc
    = TRUE`改为降序排序。我们在这里这样做是为了让最大的条形最接近轴线，这更具有视觉吸引力。
- en: To finalize this plot we will customize the axis and legend labels, and add
    a title to the chart. Plot titles are not always required, especially when it
    would be redundant with an already-existing caption or surrounding context (e.g.,
    in a slide presentation with annotations). But if you decide to include one, a
    good plot title should provide the take home message that you want readers to
    focus on, e.g., “Earth’s seven largest landmasses are continents,” or a more general
    summary of the information displayed, e.g., “Earth’s twelve largest landmasses.”
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 为了最终完成这个图表，我们将自定义坐标轴和图例标签，并为图表添加标题。图表标题并不总是必需的，尤其是在它将与现有的标题或周围上下文重复时（例如，在带有注释的幻灯片演示中）。但是，如果您决定包含一个，一个好的图表标题应该提供您希望读者关注的要点，例如，“地球的七个最大陆地是大陆，”或对显示信息的更一般性总结，例如，“地球的十二个最大陆地。”
- en: To make these final adjustments we will use the `labs` function rather than
    the `xlab` and `ylab` functions we have seen earlier in this chapter, as `labs`
    lets us modify the legend label and title in addition to axis labels. We provide
    a label for each aesthetic mapping in the plot—in this case, `x`, `y`, and `fill`—as
    well as one for the `title` argument. Finally, we again use the `theme` function
    to change the font size.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进行这些最终调整，我们将使用`labs`函数而不是本章前面看到的`xlab`和`ylab`函数，因为`labs`允许我们修改图例标签和标题，以及坐标轴标签。我们在图中为每个美学映射提供一个标签——在这种情况下，`x`、`y`和`fill`——以及一个用于`title`参数的标签。最后，我们再次使用`theme`函数来更改字体大小。
- en: '[PRE29]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '![Bar plot of size for Earth''s largest 12 landmasses, colored by landmass
    type, with clearer axes and labels.](../Images/2fb90b6936633f3b3077e3471eaf21a9.png)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![按陆地类型着色的大地球12个最大陆地的条形图，具有更清晰的坐标轴和标签。](../Images/2fb90b6936633f3b3077e3471eaf21a9.png)'
- en: 'Figure 4.18: Bar plot of size for Earth’s largest 12 landmasses, colored by
    landmass type, with clearer axes and labels.'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.18：按陆地类型着色的大地球12个最大陆地的条形图，具有更清晰的坐标轴和标签。
- en: The plot in Figure [4.18](viz.html#fig:03-data-islands-bar-4) is now a very
    effective visualization for answering our original questions. Landmasses are organized
    by their size, and continents are colored differently than other landmasses, making
    it quite clear that continents are the largest seven landmasses.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.18[4.18](viz.html#fig:03-data-islands-bar-4)现在是一个非常有效的可视化工具，用于回答我们的原始问题。陆地按其大小组织，并且大陆的颜色与其他陆地不同，这使得大陆是最大的七个陆地这一点非常清晰。
- en: '4.5.5 Histograms: the Michelson speed of light data set'
  id: totrans-189
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.5 直方图：米歇尔逊光速数据集
- en: The `morley` data set contains measurements of the speed of light collected
    in experiments performed in 1879. Five experiments were performed, and in each
    experiment, 20 runs were performed—meaning that 20 measurements of the speed of
    light were collected in each experiment ([Michelson 1882](#ref-lightdata)). The
    `morley` data set is available in base R as a data frame, so it does not need
    to be loaded. Because the speed of light is a very large number (the true value
    is 299,792.458 km/sec), the data is coded to be the measured speed of light minus
    299,000. This coding allows us to focus on the variations in the measurements,
    which are generally much smaller than 299,000. If we used the full large speed
    measurements, the variations in the measurements would not be noticeable, making
    it difficult to study the differences between the experiments. Note that we convert
    the `morley` data to a tibble to take advantage of the nicer print output these
    specialized data frames provide.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: '`morley`数据集包含了在1879年进行的实验中收集到的光速测量数据。进行了五个实验，每个实验进行了20次运行——这意味着每个实验中收集了20次光速的测量数据([Michelson
    1882](#ref-lightdata))。`morley`数据集在基础R中作为数据框提供，因此不需要加载。由于光速是一个非常大的数字（真实值是299,792.458
    km/sec），数据被编码为测量光速减去299,000。这种编码使我们能够关注测量中的变化，这些变化通常比299,000小得多。如果我们使用完整的大速度测量，测量中的变化将不明显，这将使得研究实验之间的差异变得困难。请注意，我们将`morley`数据转换为tibble，以利用这些专用数据框提供的更美观的打印输出。'
- en: '**Question:** Given what we know now about the speed of light (299,792.458
    kilometres per second), how accurate were each of the experiments?'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: '**问题**：鉴于我们现在对光速（每秒299,792.458公里）的了解，每个实验的准确性如何？'
- en: '[PRE30]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '[PRE31]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: In this experimental data, Michelson was trying to measure just a single quantitative
    number (the speed of light). The data set contains many measurements of this single
    quantity. To tell how accurate the experiments were, we need to visualize the
    distribution of the measurements (i.e., all their possible values and how often
    each occurs). We can do this using a *histogram*. A histogram helps us visualize
    how a particular variable is distributed in a data set by separating the data
    into bins, and then using vertical bars to show how many data points fell in each
    bin.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个实验数据中，迈克尔逊试图测量一个单一的定量数值（光速）。数据集包含对这个单一数量的许多测量。为了了解实验的准确性，我们需要可视化测量的分布（即所有可能的值及其出现的频率）。我们可以使用
    *直方图* 来做到这一点。直方图通过将数据分成组，然后使用垂直条来显示每个组中数据点的数量，帮助我们可视化特定变量在数据集中的分布情况。
- en: To create a histogram in `ggplot2` we will use the `geom_histogram` geometric
    object, setting the `x` axis to the `Speed` measurement variable. As usual, let’s
    use the default arguments just to see how things look.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 `ggplot2` 中创建直方图，我们将使用 `geom_histogram` 几何对象，将 x 轴设置为 `Speed` 测量变量。像往常一样，让我们使用默认参数来看看效果如何。
- en: '[PRE32]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '![Histogram of Michelson''s speed of light data.](../Images/e11294ed8810f7f673af38fe9b97267e.png)'
  id: totrans-197
  prefs: []
  type: TYPE_IMG
  zh: '![迈克尔逊光速数据直方图](../Images/e11294ed8810f7f673af38fe9b97267e.png)'
- en: 'Figure 4.19: Histogram of Michelson’s speed of light data.'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.19：迈克尔逊光速数据的直方图。
- en: Figure [4.19](viz.html#fig:03-data-morley-hist) is a great start. However, we
    cannot tell how accurate the measurements are using this visualization unless
    we can see the true value. In order to visualize the true speed of light, we will
    add a vertical line with the `geom_vline` function. To draw a vertical line with
    `geom_vline`, we need to specify where on the x-axis the line should be drawn.
    We can do this by setting the `xintercept` argument. Here we set it to 792.458,
    which is the true value of light speed minus 299,000; this ensures it is coded
    the same way as the measurements in the `morley` data frame. We would also like
    to fine tune this vertical line, styling it so that it is dashed by setting `linetype
    = "dashed"`. There is a similar function, `geom_hline`, that is used for plotting
    horizontal lines. Note that *vertical lines* are used to denote quantities on
    the *horizontal axis*, while *horizontal lines* are used to denote quantities
    on the *vertical axis*.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 图 [4.19](viz.html#fig:03-data-morley-hist) 是一个很好的起点。然而，除非我们能看到真实值，否则我们无法通过这个可视化来判断测量的准确性。为了可视化光速的真实值，我们将使用
    `geom_vline` 函数添加一条垂直线。要使用 `geom_vline` 绘制垂直线，我们需要指定线应该在 x 轴的哪个位置绘制。我们可以通过设置 `xintercept`
    参数来实现。在这里，我们将其设置为 792.458，这是光速的真实值减去 299,000；这确保了它与 `morley` 数据框中的测量方式相同。我们还想微调这条垂直线，通过设置
    `linetype = "dashed"` 使其呈现虚线样式。还有一个类似的功能，`geom_hline`，用于绘制水平线。请注意，*垂直线* 用于表示 *水平轴*
    上的数量，而 *水平线* 用于表示 *垂直轴* 上的数量。
- en: '[PRE33]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '![Histogram of Michelson''s speed of light data with vertical line indicating
    true speed of light.](../Images/1ecfd31c676ace4a001123dbabb4ddfd.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![带有表示真实光速的垂直线的迈克尔逊光速数据直方图](../Images/1ecfd31c676ace4a001123dbabb4ddfd.png)'
- en: 'Figure 4.20: Histogram of Michelson’s speed of light data with vertical line
    indicating true speed of light.'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.20：带有表示真实光速的垂直线的迈克尔逊光速数据直方图。
- en: In Figure [4.20](viz.html#fig:03-data-morley-hist-2), we still cannot tell which
    experiments (denoted in the `Expt` column) led to which measurements; perhaps
    some experiments were more accurate than others. To fully answer our question,
    we need to separate the measurements from each other visually. We can try to do
    this using a *colored* histogram, where counts from different experiments are
    stacked on top of each other in different colors. We can create a histogram colored
    by the `Expt` variable by adding it to the `fill` aesthetic mapping. We make sure
    the different colors can be seen (despite them all sitting on top of each other)
    by setting the `alpha` argument in `geom_histogram` to `0.5` to make the bars
    slightly translucent. We also specify `position = "identity"` in `geom_histogram`
    to ensure the histograms for each experiment will be overlaid side-by-side, instead
    of stacked bars (which is the default for bar plots or histograms when they are
    colored by another categorical variable).
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在图 [4.20](viz.html#fig:03-data-morley-hist-2) 中，我们仍然无法判断哪些实验（在 `Expt` 列中表示）导致了哪些测量；也许有些实验比其他实验更准确。为了完全回答我们的问题，我们需要在视觉上将测量值分开。我们可以尝试使用
    *彩色* 直方图来实现这一点，其中不同实验的计数以不同的颜色堆叠在一起。我们可以通过将 `Expt` 变量添加到 `fill` 美学映射中来创建按 `Expt`
    变量着色的直方图。我们通过将 `geom_histogram` 中的 `alpha` 参数设置为 `0.5` 来确保不同的颜色可以被人看到（尽管它们都堆叠在一起），这使得条形稍微半透明。我们还指定了
    `position = "identity"` 在 `geom_histogram` 中，以确保每个实验的直方图将并排叠加，而不是堆叠条形（这是条形图或当它们按另一个分类变量着色时的默认设置）。
- en: '[PRE34]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '![Histogram of Michelson''s speed of light data where an attempt is made to
    color the bars by experiment.](../Images/aa605740997f0c7acf2ed3d5ddacce86.png)'
  id: totrans-205
  prefs: []
  type: TYPE_IMG
  zh: '![米歇尔逊光速数据直方图，尝试通过实验对条形进行着色。](../Images/aa605740997f0c7acf2ed3d5ddacce86.png)'
- en: 'Figure 4.21: Histogram of Michelson’s speed of light data where an attempt
    is made to color the bars by experiment.'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.21：尝试按实验着色米歇尔逊光速数据直方图。
- en: Alright great, Figure [4.21](viz.html#fig:03-data-morley-hist-3) looks…wait
    a second! The histogram is still all the same color! What is going on here? Well,
    if you recall from Chapter [3](wrangling.html#wrangling), the *data type* you
    use for each variable can influence how R and `tidyverse` treats it. Here, we
    indeed have an issue with the data types in the `morley` data frame. In particular,
    the `Expt` column is currently an *integer* (you can see the label `<int>` underneath
    the `Expt` column in the printed data frame at the start of this section). But
    we want to treat it as a *category*, i.e., there should be one category per type
    of experiment.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，图 [4.21](viz.html#fig:03-data-morley-hist-3) 看起来……等等！直方图的颜色还是全部一样的！这里发生了什么？嗯，如果你还记得第
    [3](wrangling.html#wrangling) 章，你为每个变量使用的 *数据类型* 可以影响 R 和 `tidyverse` 如何处理它。在这里，我们确实在
    `morley` 数据框中的数据类型上遇到了问题。特别是，`Expt` 列目前是一个 *整数*（你可以在本节开头打印的数据框中 `Expt` 列下面的 `<int>`
    标签看到）。但我们要将其视为 *类别*，即每种实验类型应该有一个类别。
- en: To fix this issue we can convert the `Expt` variable into a *factor* by passing
    it to `as_factor` in the `fill` aesthetic mapping. Recall that factor is a data
    type in R that is often used to represent categories. By writing `as_factor(Expt)`
    we are ensuring that R will treat this variable as a factor, and the color will
    be mapped discretely.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决这个问题，我们可以通过在 `fill` 美学映射中传递它来将 `Expt` 变量转换为 *因子*。回想一下，因子是 R 中常用来表示类别的数据类型。通过编写
    `as_factor(Expt)`，我们确保 R 会将此变量视为因子，并且颜色将被离散映射。
- en: '[PRE35]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '![Histogram of Michelson''s speed of light data colored by experiment as factor.](../Images/ba59c9f7783f6a987486487b5a25c20e.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![按实验着色的米歇尔逊光速数据直方图。](../Images/ba59c9f7783f6a987486487b5a25c20e.png)'
- en: 'Figure 4.22: Histogram of Michelson’s speed of light data colored by experiment
    as factor.'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.22：按实验因子着色的米歇尔逊光速数据直方图。
- en: '**Note:** Factors impact plots in two ways: (1) ensuring a color is mapped
    as discretely where appropriate (as in this example) and (2) the ordering of levels
    in a plot. `ggplot` takes into account the order of the factor levels as opposed
    to the order of data in your data frame. Learning how to reorder your factor levels
    will help you with reordering the labels of a factor on a plot.'
  id: totrans-212
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**注意：**因子以两种方式影响图表：（1）确保在适当的地方将颜色映射为离散（如本例所示），以及（2）图表中级别的顺序。`ggplot` 考虑因子级别的顺序，而不是数据框中数据的顺序。学习如何重新排序你的因子级别将帮助你重新排序图表中因子的标签。'
- en: Unfortunately, the attempt to separate out the experiment number visually has
    created a bit of a mess. All of the colors in Figure [4.22](viz.html#fig:03-data-morley-hist-with-factor)
    are blending together, and although it is possible to derive *some* insight from
    this (e.g., experiments 1 and 3 had some of the most incorrect measurements),
    it isn’t the clearest way to convey our message and answer the question. Let’s
    try a different strategy of creating grid of separate histogram plots.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，尝试通过视觉上分离实验编号的做法造成了一些混乱。图4.22中的所有颜色都混合在一起了，尽管可以从这里得出一些见解（例如，实验1和3有一些最不准确的测量），但这并不是传达我们的信息和回答问题的最清晰方式。让我们尝试一种不同的策略，即创建一个单独直方图网格。
- en: We use the `facet_grid` function to create a plot that has multiple subplots
    arranged in a grid. The argument to `facet_grid` specifies the variable(s) used
    to split the plot into subplots, and how to split them (i.e., into rows or columns).
    If the plot is to be split horizontally, into rows, then the `rows` argument is
    used. If the plot is to be split vertically, into columns, then the `cols` argument
    is used. Both the `rows` and `cols` arguments take the column names on which to
    split the data when creating the subplots. Note that the column names must be
    surrounded by the `vars` function. This function allows the column names to be
    correctly evaluated in the context of the data frame.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用`facet_grid`函数来创建一个由多个子图组成的网格状图表。`facet_grid`的参数指定了用于将图表分割成子图的变量（s），以及如何分割它们（即，行或列）。如果要将图表水平分割，即分割成行，则使用`rows`参数。如果要将图表垂直分割，即分割成列，则使用`cols`参数。`rows`和`cols`参数都用于指定在创建子图时分割数据的列名。请注意，列名必须被`vars`函数包围。此函数允许列名在数据框的上下文中正确评估。
- en: '[PRE36]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '![Histogram of Michelson''s speed of light data split vertically by experiment.](../Images/88f9e2e972a470850f1c81f8b20e3efe.png)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![按实验垂直分割的迈克尔逊光速数据直方图。](../Images/88f9e2e972a470850f1c81f8b20e3efe.png)'
- en: 'Figure 4.23: Histogram of Michelson’s speed of light data split vertically
    by experiment.'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.23：按实验垂直分割的迈克尔逊光速数据直方图。
- en: The visualization in Figure [4.23](viz.html#fig:03-data-morley-hist-4) now makes
    it quite clear how accurate the different experiments were with respect to one
    another. The most variable measurements came from Experiment 1. There the measurements
    ranged from about 650–1050 km/sec. The least variable measurements came from Experiment
    2. There, the measurements ranged from about 750–950 km/sec. The most different
    experiments still obtained quite similar results!
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.23中的可视化现在清楚地显示了不同实验之间的准确性。最不稳定的测量来自实验1。那里的测量值从大约650–1050 km/sec不等。最稳定的测量来自实验2。那里的测量值从大约750–950
    km/sec不等。最不同的实验仍然得到了相当相似的结果！
- en: 'There are two finishing touches to make this visualization even clearer. First
    and foremost, we need to add informative axis labels using the `labs` function,
    and increase the font size to make it readable using the `theme` function. Second,
    and perhaps more subtly, even though it is easy to compare the experiments on
    this plot to one another, it is hard to get a sense of just how accurate all the
    experiments were overall. For example, how accurate is the value 800 on the plot,
    relative to the true speed of light? To answer this question, we’ll use the `mutate`
    function to transform our data into a relative measure of accuracy rather than
    absolute measurements:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使这个可视化更加清晰，我们需要做两个细节处理。首先，我们需要使用`labs`函数添加信息丰富的轴标签，并使用`theme`函数增加字体大小以便阅读。其次，尽管在这个图表上比较实验相对容易，但要获得所有实验整体准确性的感觉却很困难。例如，图表上的值800相对于光速的真实值有多准确？为了回答这个问题，我们将使用`mutate`函数将我们的数据转换成相对准确度的度量，而不是绝对度量：
- en: '[PRE37]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '![Histogram of relative accuracy split vertically by experiment with clearer
    axes and labels.](../Images/4ea65bb5ae116b5d0e556e4e4524494c.png)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![按实验垂直分割的相对精度直方图，具有更清晰的轴和标签。](../Images/4ea65bb5ae116b5d0e556e4e4524494c.png)'
- en: 'Figure 4.24: Histogram of relative accuracy split vertically by experiment
    with clearer axes and labels.'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.24：按实验垂直分割的相对精度直方图，具有更清晰的轴和标签。
- en: Wow, impressive! These measurements of the speed of light from 1879 had errors
    around *0.05%* of the true speed. Figure [4.24](viz.html#fig:03-data-morley-hist-5)
    shows you that even though experiments 2 and 5 were perhaps the most accurate,
    all of the experiments did quite an admirable job given the technology available
    at the time.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 哇，令人印象深刻！从1879年对这些光速的测量中，误差大约为真实速度的*0.05%*。图[4.24](viz.html#fig:03-data-morley-hist-5)展示了尽管实验2和5可能是最准确的，但考虑到当时的技术水平，所有实验都做得相当出色。
- en: Choosing a binwidth for histograms
  id: totrans-224
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 为直方图选择箱宽
- en: When you create a histogram in R, the default number of bins used is 30. Naturally,
    this is not always the right number to use. You can set the number of bins yourself
    by using the `bins` argument in the `geom_histogram` geometric object. You can
    also set the *width* of the bins using the `binwidth` argument in the `geom_histogram`
    geometric object. But what number of bins, or bin width, is the right one to use?
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 当你在R中创建直方图时，默认使用的箱数是30。自然地，这并不总是正确的数字。你可以通过在`geom_histogram`几何对象中使用`bins`参数来自定义箱数。你还可以使用`geom_histogram`几何对象中的`binwidth`参数设置箱的*宽度*。但是，应该使用多少个箱或箱宽才是正确的呢？
- en: Unfortunately there is no hard rule for what the right bin number or width is.
    It depends entirely on your problem; the *right* number of bins or bin width is
    the one that *helps you answer the question* you asked. Choosing the correct setting
    for your problem is something that commonly takes iteration. We recommend setting
    the *bin width* (not the *number of bins*) because it often more directly corresponds
    to values in your problem of interest. For example, if you are looking at a histogram
    of human heights, a bin width of 1 inch would likely be reasonable, while the
    number of bins to use is not immediately clear. It’s usually a good idea to try
    out several bin widths to see which one most clearly captures your data in the
    context of the question you want to answer.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 很遗憾，没有硬性规则来确定正确的箱数或宽度。这完全取决于你的问题；正确的箱数或箱宽是帮助你回答你提出的问题的那个。为你的问题选择正确的设置通常需要迭代。我们建议设置*箱宽*（而不是*箱数*），因为它通常更直接地对应于你感兴趣的问题中的值。例如，如果你正在查看人类身高的直方图，1英寸的箱宽可能是合理的，而要使用的箱数并不立即明确。通常，尝试几个箱宽以查看哪个最能清楚地捕捉你想要回答的问题中的数据是个好主意。
- en: To get a sense for how different bin widths affect visualizations, let’s experiment
    with the histogram that we have been working on in this section. In Figure [4.25](viz.html#fig:03-data-morley-hist-binwidth),
    we compare the default setting with three other histograms where we set the `binwidth`
    to 0.001, 0.01 and 0.1. In this case, we can see that both the default number
    of bins and the binwidth of 0.01 are effective for helping answer our question.
    On the other hand, the bin widths of 0.001 and 0.1 are too small and too big,
    respectively.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解不同的箱宽如何影响可视化效果，让我们在这个章节中实验一下我们一直在工作的直方图。在图[4.25](viz.html#fig:03-data-morley-hist-binwidth)中，我们比较了默认设置与设置了`binwidth`为0.001、0.01和0.1的三个其他直方图。在这种情况下，我们可以看到默认的箱数和0.01的箱宽都有效地帮助我们回答了问题。另一方面，0.001和0.1的箱宽太小和太大。
- en: '![Effect of varying bin width on histograms.](../Images/129fb2378760de7c4bdb4edfa401797e.png)'
  id: totrans-228
  prefs: []
  type: TYPE_IMG
  zh: '![箱宽变化对直方图的影响。](../Images/129fb2378760de7c4bdb4edfa401797e.png)'
- en: 'Figure 4.25: Effect of varying bin width on histograms.'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.25：箱宽变化对直方图的影响。
- en: Adding layers to a `ggplot` plot object
  id: totrans-230
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 向`ggplot`绘图对象添加层
- en: One of the powerful features of `ggplot` is that you can continue to iterate
    on a single plot object, adding and refining one layer at a time. If you stored
    your plot as a named object using the assignment symbol (`<-`), you can add to
    it using the `+` operator. For example, if we wanted to add a title to the last
    plot we created (`morley_hist`), we can use the `+` operator to add a title layer
    with the `ggtitle` function. The result is shown in Figure [4.26](viz.html#fig:03-data-morley-hist-addlayer).
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot`的一个强大功能是你可以对单个绘图对象进行迭代，一次添加和改进一层。如果你使用赋值符号（`<-`）将你的绘图存储为命名对象，你可以使用`+`运算符对其进行添加。例如，如果我们想给最后一个创建的绘图（`morley_hist`）添加一个标题，我们可以使用`+`运算符和`ggtitle`函数添加一个标题层。结果如图[4.26](viz.html#fig:03-data-morley-hist-addlayer)所示。'
- en: '[PRE38]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: '![Histogram of relative accuracy split vertically by experiment with a descriptive
    title highlighting the take home message of the visualization.](../Images/3924d80a7d804b28d211e1d3217e58eb.png)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![按实验垂直分割的相对准确度直方图，带有描述性标题，突出可视化的要点](../Images/3924d80a7d804b28d211e1d3217e58eb.png)'
- en: 'Figure 4.26: Histogram of relative accuracy split vertically by experiment
    with a descriptive title highlighting the take home message of the visualization.'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.26：按实验垂直分割的相对准确度直方图，带有描述性标题，突出可视化的要点。
- en: '**Note:** Good visualization titles clearly communicate the take home message
    to the audience. Typically, that is the answer to the question you posed before
    making the visualization.'
  id: totrans-235
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**注意：** 好的可视化标题清楚地传达了给观众的要点。通常，那是在制作可视化之前提出的问题的答案。'
- en: 4.6 Explaining the visualization
  id: totrans-236
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.6 解释可视化
- en: '*Tell a story*'
  id: totrans-237
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '*讲述一个故事*'
- en: Typically, your visualization will not be shown entirely on its own, but rather
    it will be part of a larger presentation. Further, visualizations can provide
    supporting information for any aspect of a presentation, from opening to conclusion.
    For example, you could use an exploratory visualization in the opening of the
    presentation to motivate your choice of a more detailed data analysis / model,
    a visualization of the results of your analysis to show what your analysis has
    uncovered, or even one at the end of a presentation to help suggest directions
    for future work.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，你的可视化不会单独展示，而是作为更大演示的一部分。此外，可视化可以为演示的任何方面提供支持信息，从开场到结论。例如，你可以在演示的开头使用探索性可视化来激发你对更详细的数据分析/模型的兴趣，使用分析结果的可视化来展示你的分析发现了什么，甚至可以在演示结束时提出未来工作的方向。
- en: 'Regardless of where it appears, a good way to discuss your visualization is
    as a story:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 无论可视化出现在哪里，讨论你的可视化作为一个故事都是一种好方法：
- en: Establish the setting and scope, and describe why you did what you did.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 建立背景和范围，并描述你为什么这样做。
- en: Pose the question that your visualization answers. Justify why the question
    is important to answer.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提出你的可视化回答的问题。说明为什么回答这个问题很重要。
- en: 'Answer the question using your visualization. Make sure you describe *all*
    aspects of the visualization (including describing the axes). But you can emphasize
    different aspects based on what is important to answer your question:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用你的可视化来回答问题。确保你描述了可视化的所有方面（包括描述坐标轴）。但你可以根据回答问题的需要强调不同的方面：
- en: '**trends (lines):** Does a line describe the trend well? If so, the trend is
    *linear*, and if not, the trend is *nonlinear*. Is the trend increasing, decreasing,
    or neither? Is there a periodic oscillation (wiggle) in the trend? Is the trend
    noisy (does the line “jump around” a lot) or smooth?'
  id: totrans-243
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**趋势（线条）：** 线条是否很好地描述了趋势？如果是这样，趋势是**线性**的，如果不是，趋势是**非线性**的。趋势是增加、减少还是两者都不是？趋势中是否存在周期性的振荡（波动）？趋势是嘈杂的（线条是否“跳来跳去”）还是平滑的？'
- en: '**distributions (scatters, histograms):** How spread out are the data? Where
    are they centered, roughly? Are there any obvious “clusters” or “subgroups”, which
    would be visible as multiple bumps in the histogram?'
  id: totrans-244
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分布（散点、直方图）：** 数据分布有多广？它们大致集中在哪里？是否存在任何明显的“簇”或“子组”，这些在直方图中会表现为多个峰值？'
- en: '**distributions of two variables (scatters):** Is there a clear / strong relationship
    between the variables (points fall in a distinct pattern), a weak one (points
    fall in a pattern but there is some noise), or no discernible relationship (the
    data are too noisy to make any conclusion)?'
  id: totrans-245
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**两个变量的分布（散点）：** 变量之间是否存在清晰/强烈的关联（点落在明显的模式中），是弱关联（点落在模式中但存在一些噪声），还是没有可识别的关联（数据太嘈杂，无法得出任何结论）？'
- en: '**amounts (bars):** How large are the bars relative to one another? Are there
    patterns in different groups of bars?'
  id: totrans-246
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数量（条形）：** 条形相对于彼此有多大？不同组条形中是否存在模式？'
- en: Summarize your findings, and use them to motivate whatever you will discuss
    next.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 总结你的发现，并使用它们来激发你接下来要讨论的内容。
- en: Below are two examples of how one might take these four steps in describing
    the example visualizations that appeared earlier in this chapter. Each of the
    steps is denoted by its numeral in parentheses, e.g. (3).
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是两个例子，说明了如何描述本章前面出现的示例可视化，并采取这四个步骤。每个步骤都用其数字编号表示，例如（3）。
- en: '**Mauna Loa Atmospheric CO\(_{\text{2}}\) Measurements:** (1) Many current
    forms of energy generation and conversion—from automotive engines to natural gas
    power plants—rely on burning fossil fuels and produce greenhouse gases, typically
    primarily carbon dioxide (CO\(_{\text{2}}\)), as a byproduct. Too much of these
    gases in the Earth’s atmosphere will cause it to trap more heat from the sun,
    leading to global warming. (2) In order to assess how quickly the atmospheric
    concentration of CO\(_{\text{2}}\) is increasing over time, we (3) used a data
    set from the Mauna Loa observatory in Hawaii, consisting of CO\(_{\text{2}}\)
    measurements from 1980 to 2020\. We plotted the measured concentration of CO\(_{\text{2}}\)
    (on the vertical axis) over time (on the horizontal axis). From this plot, you
    can see a clear, increasing, and generally linear trend over time. There is also
    a periodic oscillation that occurs once per year and aligns with Hawaii’s seasons,
    with an amplitude that is small relative to the growth in the overall trend. This
    shows that atmospheric CO\(_{\text{2}}\) is clearly increasing over time, and
    (4) it is perhaps worth investigating more into the causes.'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '**莫纳罗亚大气二氧化碳测量：** (1) 许多当前形式的能源生成和转换——从汽车引擎到天然气发电厂——都依赖于燃烧化石燃料，并产生温室气体，通常是二氧化碳（CO\(_{\text{2}}\））作为副产品。地球大气中这些气体的过多积累将导致其捕获更多的太阳热量，从而导致全球变暖。
    (2) 为了评估大气中二氧化碳浓度随时间增加的速度，我们（3）使用了来自夏威夷莫纳罗亚观测站的数据集，该数据集包含1980年至2020年的二氧化碳测量数据。我们绘制了二氧化碳浓度（垂直轴）随时间（水平轴）的变化图。从这张图中，你可以看到随着时间的推移，一个清晰、持续上升且总体上呈线性趋势。也存在一种每年发生一次的周期性振荡，与夏威夷的季节相吻合，其振幅相对于整体趋势的增长来说很小。这表明大气中的二氧化碳浓度随时间明显增加，并且（4）也许值得进一步调查其成因。'
- en: '**Michelson Light Speed Experiments:** (1) Our modern understanding of the
    physics of light has advanced significantly from the late 1800s when Michelson
    and Morley’s experiments first demonstrated that it had a finite speed. We now
    know, based on modern experiments, that it moves at roughly 299,792.458 kilometers
    per second. (2) But how accurately were we first able to measure this fundamental
    physical constant, and did certain experiments produce more accurate results than
    others? (3) To better understand this, we plotted data from 5 experiments by Michelson
    in 1879, each with 20 trials, as histograms stacked on top of one another. The
    horizontal axis shows the accuracy of the measurements relative to the true speed
    of light as we know it today, expressed as a percentage. From this visualization,
    you can see that most results had relative errors of at most 0.05%. You can also
    see that experiments 1 and 3 had measurements that were the farthest from the
    true value, and experiment 5 tended to provide the most consistently accurate
    result. (4) It would be worth further investigating the differences between these
    experiments to see why they produced different results.'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '**米歇尔光速实验：** (1) 我们对光物理学的现代理解从19世纪末以来有了显著的进步，当时米歇尔和莫雷的实验首次证明了光具有有限的速度。根据现代实验，我们知道它以大约299,792.458千米/秒的速度移动。
    (2) 但我们最初是如何准确测量这个基本物理常数的，以及某些实验是否比其他实验产生了更准确的结果？ (3) 为了更好地理解这一点，我们绘制了米歇尔在1879年进行的5个实验的数据，每个实验有20次试验，并将它们作为堆叠在一起的历史图。水平轴显示了测量精度相对于我们今天所知的真光速的百分比。从这种可视化中，你可以看到大多数结果的最大相对误差不超过0.05%。你还可以看到实验1和3的测量值与真实值相差最远，而实验5倾向于提供最一致准确的结果。
    (4) 值得进一步调查这些实验之间的差异，以了解为什么它们产生了不同的结果。'
- en: 4.7 Saving the visualization
  id: totrans-251
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.7 保存可视化
- en: '*Choose the right output format for your needs*'
  id: totrans-252
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '*选择适合您需求的输出格式*'
- en: 'Just as there are many ways to store data sets, there are many ways to store
    visualizations and images. Which one you choose can depend on several factors,
    such as file size/type limitations (e.g., if you are submitting your visualization
    as part of a conference paper or to a poster printing shop) and where it will
    be displayed (e.g., online, in a paper, on a poster, on a billboard, in talk slides).
    Generally speaking, images come in two flavors: *raster* formats and *vector*
    formats.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 正如存储数据集有多种方式一样，存储可视化图像也有多种方式。你选择哪种方式可能取决于几个因素，例如文件大小/类型限制（例如，如果你将可视化作为会议论文的一部分提交或提交给海报印刷店）以及它将在哪里显示（例如，在线、在论文中、在海报上、在广告牌上、在演讲幻灯片上）。一般来说，图像有两种类型：*光栅*格式和*矢量*格式。
- en: '**Raster** images are represented as a 2-D grid of square pixels, each with
    its own color. Raster images are often *compressed* before storing so they take
    up less space. A compressed format is *lossy* if the image cannot be perfectly
    re-created when loading and displaying, with the hope that the change is not noticeable.
    *Lossless* formats, on the other hand, allow a perfect display of the original
    image.'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '**位图**图像表示为二维的方形像素网格，每个像素都有自己的颜色。位图图像在存储之前通常会被压缩，以减少占用的空间。如果加载和显示时图像不能完美地重新创建，则压缩格式是有损的，希望这种变化不会引起注意。另一方面，无损格式允许完美地显示原始图像。'
- en: '*Common file types:*'
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*常见文件类型:*'
- en: '[JPEG](https://en.wikipedia.org/wiki/JPEG) (`.jpg`, `.jpeg`): lossy, usually
    used for photographs'
  id: totrans-256
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[JPEG](https://en.wikipedia.org/wiki/JPEG) (`.jpg`, `.jpeg`): 有损，通常用于照片'
- en: '[PNG](https://en.wikipedia.org/wiki/Portable_Network_Graphics) (`.png`): lossless,
    usually used for plots / line drawings'
  id: totrans-257
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[PNG](https://en.wikipedia.org/wiki/Portable_Network_Graphics) (`.png`): 无损，通常用于图表/线图'
- en: '[BMP](https://en.wikipedia.org/wiki/BMP_file_format) (`.bmp`): lossless, raw
    image data, no compression (rarely used)'
  id: totrans-258
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[BMP](https://en.wikipedia.org/wiki/BMP_file_format) (`.bmp`): 无损，原始图像数据，无压缩（很少使用）'
- en: '[TIFF](https://en.wikipedia.org/wiki/TIFF) (`.tif`, `.tiff`): typically lossless,
    no compression, used mostly in graphic arts, publishing'
  id: totrans-259
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[TIFF](https://en.wikipedia.org/wiki/TIFF) (`.tif`, `.tiff`): 通常无损，无压缩，主要用于图形艺术、出版'
- en: '*Open-source software:* [GIMP](https://www.gimp.org/)'
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*开源软件:* [GIMP](https://www.gimp.org/)'
- en: '**Vector** images are represented as a collection of mathematical objects (lines,
    surfaces, shapes, curves). When the computer displays the image, it redraws all
    of the elements using their mathematical formulas.'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: '**矢量**图像表示为数学对象（线条、表面、形状、曲线）的集合。当计算机显示图像时，它会使用它们的数学公式重新绘制所有元素。'
- en: '*Common file types:*'
  id: totrans-262
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*常见文件类型:*'
- en: '[SVG](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics) (`.svg`): general-purpose
    use'
  id: totrans-263
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[SVG](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics) (`.svg`): 通用用途'
- en: '[EPS](https://en.wikipedia.org/wiki/Encapsulated_PostScript) (`.eps`), general-purpose
    use (rarely used)'
  id: totrans-264
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[EPS](https://en.wikipedia.org/wiki/Encapsulated_PostScript) (`.eps`): 通用用途（很少使用）'
- en: '*Open-source software:* [Inkscape](https://inkscape.org/)'
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*开源软件:* [Inkscape](https://inkscape.org/)'
- en: Raster and vector images have opposing advantages and disadvantages. A raster
    image of a fixed width / height takes the same amount of space and time to load
    regardless of what the image shows (the one caveat is that the compression algorithms
    may shrink the image more or run faster for certain images). A vector image takes
    space and time to load corresponding to how complex the image is, since the computer
    has to draw all the elements each time it is displayed. For example, if you have
    a scatter plot with 1 million points stored as an SVG file, it may take your computer
    some time to open the image. On the other hand, you can zoom into / scale up vector
    graphics as much as you like without the image looking bad, while raster images
    eventually start to look “pixelated.”
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 矢量和位图图像具有相反的优点和缺点。固定宽度和高度的位图图像无论显示什么内容，加载所需的空间和时间都是相同的（一个例外是压缩算法可能会使某些图像的图像缩小更多或运行更快）。矢量图像根据图像的复杂程度占用空间和时间，因为每次显示时计算机都必须绘制所有元素。例如，如果你有一个存储为SVG文件的包含一百万个点的散点图，打开图像可能需要你的计算机一些时间。另一方面，你可以随意放大/缩放矢量图形，而不会使图像看起来不好，而位图图像最终会开始看起来“像素化”。
- en: '**Note:** The portable document format [PDF](https://en.wikipedia.org/wiki/PDF)
    (`.pdf`) is commonly used to store *both* raster and vector formats. If you try
    to open a PDF and it’s taking a long time to load, it may be because there is
    a complicated vector graphics image that your computer is rendering.'
  id: totrans-267
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**注意:** 可移植文档格式[PDF](https://en.wikipedia.org/wiki/PDF) (`.pdf`)通常用于存储**矢量**和**位图**格式。如果你尝试打开一个PDF，并且它加载时间很长，那可能是因为有一个复杂的矢量图形图像，你的计算机正在渲染。'
- en: Let’s learn how to save plot images to these different file formats using a
    scatter plot of the [Old Faithful data set](https://www.stat.cmu.edu/~larry/all-of-statistics/=data/faithful.dat)
    ([Hardle 1991](#ref-faithfuldata)), shown in Figure [4.27](viz.html#fig:03-plot-line).
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们学习如何使用[Old Faithful数据集](https://www.stat.cmu.edu/~larry/all-of-statistics/=data/faithful.dat)
    ([Hardle 1991](#ref-faithfuldata))的散点图将这些不同的文件格式保存图像，如图[4.27](viz.html#fig:03-plot-line)所示。
- en: '[PRE39]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: '![Scatter plot of waiting time and eruption time.](../Images/0871d2e3a6ec91788424b89b833e9d0d.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![等待时间和喷发时间的散点图](../Images/0871d2e3a6ec91788424b89b833e9d0d.png)'
- en: 'Figure 4.27: Scatter plot of waiting time and eruption time.'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.27：等待时间和喷发时间的散点图。
- en: 'Now that we have a named `ggplot` plot object, we can use the `ggsave` function
    to save a file containing this image. `ggsave` works by taking a file name to
    create for the image as its first argument. This can include the path to the directory
    where you would like to save the file (e.g., `img/viz/filename.png` to save a
    file named `filename` to the `img/viz/` directory), and the name of the plot object
    to save as its second argument. The kind of image to save is specified by the
    file extension. For example, to create a PNG image file, we specify that the file
    extension is `.png`. Below we demonstrate how to save PNG, JPG, BMP, TIFF and
    SVG file types for the `faithful_plot`:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有一个命名的 `ggplot` 图表对象，我们可以使用 `ggsave` 函数保存包含此图像的文件。`ggsave` 通过将其第一个参数作为要创建的图像的文件名来工作。这可以包括你想要保存文件的目录路径（例如，`img/viz/filename.png`
    将文件名为 `filename` 的文件保存到 `img/viz/` 目录），以及作为第二个参数的图表对象名称。要保存的图像类型由文件扩展名指定。例如，要创建PNG图像文件，我们指定文件扩展名为
    `.png`。以下我们演示如何为 `faithful_plot` 保存PNG、JPG、BMP、TIFF和SVG文件类型：
- en: '[PRE40]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Table 4.1: File sizes of the scatter plot of the Old Faithful data set when
    saved as different file formats.'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 表 4.1：将 Old Faithful 数据集的散点图保存为不同文件格式时的文件大小。
- en: '| Image type | File type | Image size |'
  id: totrans-275
  prefs: []
  type: TYPE_TB
  zh: '| 图像类型 | 文件类型 | 图像大小 |'
- en: '| --- | --- | --- |'
  id: totrans-276
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Raster | PNG | 0.15 MB |'
  id: totrans-277
  prefs: []
  type: TYPE_TB
  zh: '| 位图 | PNG | 0.15 MB |'
- en: '| Raster | JPG | 0.42 MB |'
  id: totrans-278
  prefs: []
  type: TYPE_TB
  zh: '| 位图 | JPG | 0.42 MB |'
- en: '| Raster | BMP | 3.15 MB |'
  id: totrans-279
  prefs: []
  type: TYPE_TB
  zh: '| 位图 | BMP | 3.15 MB |'
- en: '| Raster | TIFF | 9.44 MB |'
  id: totrans-280
  prefs: []
  type: TYPE_TB
  zh: '| 位图 | TIFF | 9.44 MB |'
- en: '| Vector | SVG | 0.03 MB |'
  id: totrans-281
  prefs: []
  type: TYPE_TB
  zh: '| 矢量 | SVG | 0.03 MB |'
- en: Take a look at the file sizes in Table [4.1](viz.html#tab:filesizes). Wow, that’s
    quite a difference! Notice that for such a simple plot with few graphical elements
    (points), the vector graphics format (SVG) is over 100 times smaller than the
    uncompressed raster images (BMP, TIFF). Also, note that the JPG format is twice
    as large as the PNG format since the JPG compression algorithm is designed for
    natural images (not plots).
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 查看表 [4.1](viz.html#tab:filesizes) 中的文件大小。哇，这差距相当大！注意，对于这样一个简单的包含少量图形元素（点）的图表，矢量图形格式（SVG）比未压缩的位图图像（BMP、TIFF）小100多倍。此外，JPG格式是PNG格式的两倍大，因为JPG压缩算法是为自然图像（而非图表）设计的。
- en: 'In Figure [4.28](viz.html#fig:03-raster-image), we also show what the images
    look like when we zoom in to a rectangle with only 2 data points. You can see
    why vector graphics formats are so useful: because they’re just based on mathematical
    formulas, vector graphics can be scaled up to arbitrary sizes. This makes them
    great for presentation media of all sizes, from papers to posters to billboards.'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 在图 [4.28](viz.html#fig:03-raster-image) 中，我们还展示了当我们放大到一个只有2个数据点的矩形时图像的样子。你可以看到矢量图形格式为什么如此有用：因为它们只是基于数学公式，矢量图形可以放大到任意大小。这使得它们非常适合各种尺寸的演示媒体，从论文到海报到广告牌。
- en: '![Zoomed in faithful, raster (PNG, left) and vector (SVG, right) formats.](../Images/96b7aa0070d5c1f5fc453b62010cee6a.png)'
  id: totrans-284
  prefs: []
  type: TYPE_IMG
  zh: '![放大查看 `faithful`，位图（PNG，左侧）和矢量（SVG，右侧）格式。](../Images/96b7aa0070d5c1f5fc453b62010cee6a.png)'
- en: 'Figure 4.28: Zoomed in `faithful`, raster (PNG, left) and vector (SVG, right)
    formats.'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.28：放大查看 `faithful`，位图（PNG，左侧）和矢量（SVG，右侧）格式。
- en: 4.8 Exercises
  id: totrans-286
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.8 练习
- en: Practice exercises for the material covered in this chapter can be found in
    the accompanying [worksheets repository](https://worksheets.datasciencebook.ca)
    in the “Effective data visualization” row. You can launch an interactive version
    of the worksheet in your browser by clicking the “launch binder” button. You can
    also preview a non-interactive version of the worksheet by clicking “view worksheet.”
    If you instead decide to download the worksheet and run it on your own machine,
    make sure to follow the instructions for computer setup found in Chapter [13](setup.html#setup).
    This will ensure that the automated feedback and guidance that the worksheets
    provide will function as intended.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖的练习可以在配套的 [worksheets 仓库](https://worksheets.datasciencebook.ca) 的“有效的数据可视化”行中找到。你可以通过点击“启动
    binder”按钮在你的浏览器中启动工作表的交互式版本。你也可以通过点击“查看工作表”预览非交互式版本的工作表。如果你决定下载工作表并在自己的机器上运行它，请确保遵循第
    [13](setup.html#setup) 章中找到的计算机设置说明。这将确保工作表提供的自动反馈和指导按预期工作。
- en: 4.9 Additional resources
  id: totrans-288
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.9 其他资源
- en: The [`ggplot2` R package page](https://ggplot2.tidyverse.org) ([Wickham, Chang,
    et al. 2021](#ref-ggplot)) is where you should look if you want to learn more
    about the functions in this chapter, the full set of arguments you can use, and
    other related functions. The site also provides a very nice cheat sheet that summarizes
    many of the data wrangling functions from this chapter.
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[ggplot2 R包页面](https://ggplot2.tidyverse.org) ([Wickham, Chang, et al. 2021](#ref-ggplot))是您想了解更多关于本章中函数、您可以使用的一整套参数以及其他相关函数的地方。该网站还提供了一个非常棒的速查表，总结了本章中的许多数据处理函数。'
- en: The *Fundamentals of Data Visualization* ([Wilke 2019](#ref-wilkeviz)) has a
    wealth of information on designing effective visualizations. It is not specific
    to any particular programming language or library. If you want to improve your
    visualization skills, this is the next place to look.
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 《数据可视化基础》（[Wilke 2019](#ref-wilkeviz)）提供了大量关于设计有效可视化信息。它不特定于任何特定的编程语言或库。如果您想提高您的可视化技能，这是您应该查看的下一个地方。
- en: '*R for Data Science* ([Wickham and Grolemund 2016](#ref-wickham2016r)) has
    a [chapter on creating visualizations using `ggplot2`](https://r4ds.had.co.nz/data-visualisation.html).
    This reference is specific to R and `ggplot2`, but provides a much more detailed
    introduction to the full set of tools that `ggplot2` provides. This chapter is
    where you should look if you want to learn how to make more intricate visualizations
    in `ggplot2` than what is included in this chapter.'
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 《R数据科学》（[Wickham and Grolemund 2016](#ref-wickham2016r)）有一章关于使用`ggplot2`创建可视化（[Wickham
    and Grolemund 2016](#ref-wickham2016r)）。这个参考专门针对R和`ggplot2`，但它提供了对`ggplot2`提供的全部工具集的更详细介绍。如果您想学习如何在`ggplot2`中制作比本章中包含的更复杂的可视化，您应该查看这一章。
- en: The [`theme` function documentation](https://ggplot2.tidyverse.org/reference/theme.html)
    is an excellent reference to see how you can fine tune the non-data aspects of
    your visualization.
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[主题函数文档](https://ggplot2.tidyverse.org/reference/theme.html)是查看您如何微调可视化中非数据方面的绝佳参考。'
- en: '*R for Data Science* ([Wickham and Grolemund 2016](#ref-wickham2016r)) has
    a chapter on [dates and times](https://r4ds.had.co.nz/dates-and-times.html). This
    chapter is where you should look if you want to learn about `date` vectors, including
    how to create them, and how to use them to effectively handle durations, periods
    and intervals using the `lubridate` package.'
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 《R数据科学》（[Wickham and Grolemund 2016](#ref-wickham2016r)）有一章关于[日期和时间](https://r4ds.had.co.nz/dates-and-times.html)。如果您想了解`date`向量，包括如何创建它们，以及如何使用`lubridate`包有效地处理持续时间、时期和区间，您应该查看这一章。
- en: References
  id: totrans-294
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参考文献
- en: 'Arnold, Jeffrey. 2019\. *ggthemes*. [https://jrnold.github.io/ggthemes/](https://jrnold.github.io/ggthemes/).Deeb,
    Sameer. 2005\. “The Molecular Basis of Variation in Human Color Vision.” *Clinical
    Genetics* 67: 369–77.Grolemund, Garrett, and Hadley Wickham. 2011\. “Dates and
    Times Made Easy with lubridate.” *Journal of Statistical Software* 40 (3): 1–25.Hardle,
    Wolfgang. 1991\. *Smoothing Techniques with Implementation in S*. New York: Springer.McNeil,
    Donald R. 1977\. *Interactive Data Analysis: A Practical Primer*. Wiley.Michelson,
    Albert. 1882\. “Experimental Determination of the Velocity of Light Made at the
    United States Naval Academy, Annapolis.” *Astronomic Papers* 1: 135–38.Neuwirth,
    Erich. 2014\. *RColorBrewer: ColorBrewer Palettes*. [https://cran.r-project.org/web/packages/RColorBrewer/index.html](https://cran.r-project.org/web/packages/RColorBrewer/index.html).Spinu,
    Vitalie, Garrett Grolemund, and Hadley Wickham. 2021\. *lubridate R package*.
    [https://lubridate.tidyverse.org/](https://lubridate.tidyverse.org/).Tans, Pieter,
    and Ralph Keeling. 2020\. “Trends in Atmospheric Carbon Dioxide.” [https://gml.noaa.gov/ccgg/trends/data.html](https://gml.noaa.gov/ccgg/trends/data.html).Timbers,
    Tiffany. 2020\. *canlang: Canadian Census Language Data*. [https://ttimbers.github.io/canlang/](https://ttimbers.github.io/canlang/).Wickham,
    Hadley, Winston Chang, Lionel Henry, Thomas Lin Pederson, Kohske Takahashi, Claus
    Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2021\. *ggplot2 R package*.
    [https://ggplot2.tidyverse.org/](https://ggplot2.tidyverse.org/).Wickham, Hadley,
    and Garrett Grolemund. 2016\. *R for Data Science: Import, Tidy, Transform, Visualize,
    and Model Data*. O’Reilly. [https://r4ds.had.co.nz/](https://r4ds.had.co.nz/).Wilke,
    Claus. 2019\. *Fundamentals of Data Visualization*. O’Reilly Media. [https://clauswilke.com/dataviz/](https://clauswilke.com/dataviz/).'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
