- en: 12.1Â Mutating StructuresğŸ”—
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 12.1Â ä¿®æ”¹ç»“æ„ğŸ”—
- en: åŸæ–‡ï¼š[https://dcic-world.org/2025-08-27/mutating-structures.html](https://dcic-world.org/2025-08-27/mutating-structures.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://dcic-world.org/2025-08-27/mutating-structures.html](https://dcic-world.org/2025-08-27/mutating-structures.html)
- en: '| Â Â Â Â [12.1.1Â Example: Bank Accounts](#%28part._eg-bank-acc%29) |'
  id: totrans-2
  prefs: []
  type: TYPE_TB
  zh: '| Â Â Â Â [12.1.1Â ç¤ºä¾‹ï¼šé“¶è¡Œè´¦æˆ·](#%28part._eg-bank-acc%29) |'
- en: '| Â Â Â Â [12.1.2Â Testing Functions that Mutate Structures](#%28part._.Testing_.Functions_that_.Mutate_.Structures%29)
    |'
  id: totrans-3
  prefs: []
  type: TYPE_TB
  zh: '|Â Â Â [12.1.2Â æµ‹è¯•ä¿®æ”¹ç»“æ„çš„å‡½æ•°](#%28part._.Testing_.Functions_that_.Mutate_.Structures%29)
    |'
- en: '| Â Â Â Â [12.1.3Â Aliasing](#%28part._mult-bank-acct%29) |'
  id: totrans-4
  prefs: []
  type: TYPE_TB
  zh: '| Â Â Â Â [12.1.3Â åˆ«å](#%28part._mult-bank-acct%29) |'
- en: '| Â Â Â Â [12.1.4Â Structure Mutation and the Directory](#%28part._structure-mut-dir%29)
    |'
  id: totrans-5
  prefs: []
  type: TYPE_TB
  zh: '| Â Â Â Â [12.1.4Â ç»“æ„ä¿®æ”¹å’Œç›®å½•](#%28part._structure-mut-dir%29) |'
- en: '| Â Â Â Â Â Â [12.1.4.1Â Introducing the Heap](#%28part._heap-intro%29) |'
  id: totrans-6
  prefs: []
  type: TYPE_TB
  zh: '| Â Â Â Â Â Â [12.1.4.1Â å †çš„ä»‹ç»](#%28part._heap-intro%29) |'
- en: '| Â Â Â Â Â Â [12.1.4.2Â Basic Data and the Heap](#%28part._basic-data-heap%29) |'
  id: totrans-7
  prefs: []
  type: TYPE_TB
  zh: '| Â Â Â Â Â Â [12.1.4.2Â åŸºæœ¬æ•°æ®å’Œå †](#%28part._basic-data-heap%29) |'
- en: We will now study a new kind of data and the programming style that accompanies
    it. This will give us both great power and great responsibility. We will develop
    this idea in both Pyret and Python, both because the core concept arises in both
    (indeed in nearly all) languages and because their contrast is instructive.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç°åœ¨å°†ç ”ç©¶ä¸€ç§æ–°çš„æ•°æ®ç±»å‹åŠå…¶ä¼´éšçš„ç¼–ç¨‹é£æ ¼ã€‚è¿™å°†èµ‹äºˆæˆ‘ä»¬å·¨å¤§çš„åŠ›é‡å’Œè´£ä»»ã€‚æˆ‘ä»¬å°†åœ¨ Pyret å’Œ Python ä¸­å‘å±•è¿™ä¸€æƒ³æ³•ï¼Œä¸€æ–¹é¢å› ä¸ºæ ¸å¿ƒæ¦‚å¿µåœ¨è¿™ä¸¤ç§è¯­è¨€ï¼ˆå®é™…ä¸Šåœ¨å‡ ä¹æ‰€æœ‰è¯­è¨€ä¸­ï¼‰ä¸­éƒ½ä¼šå‡ºç°ï¼Œå¦ä¸€æ–¹é¢å› ä¸ºå®ƒä»¬çš„å¯¹æ¯”å…·æœ‰æ•™è‚²æ„ä¹‰ã€‚
- en: '12.1.1Â Example: Bank Accounts[ğŸ”—](#(part._eg-bank-acc) "Link to here")'
  id: totrans-9
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 12.1.1Â ç¤ºä¾‹ï¼šé“¶è¡Œè´¦æˆ·[ğŸ”—](#(part._eg-bank-acc) "é“¾æ¥åˆ°æ­¤å¤„")
- en: 'Imagine that we want to represent bank accounts, where each account has a (unique)
    id number and a balance:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦è¡¨ç¤ºé“¶è¡Œè´¦æˆ·ï¼Œæ¯ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€ä¸ªï¼ˆå”¯ä¸€çš„ï¼‰id å·ç å’Œä½™é¢ï¼š
- en: '| Python | Pyret |'
  id: totrans-11
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE0]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '|'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE1]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '|'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Letâ€™s now make an account:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼š
- en: '| Python | Pyret |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE2]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '|'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE3]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '|'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Now letâ€™s say we learn that the account has just earned another 200\. We could
    always reflect the resulting account as follows:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å‡è®¾æˆ‘ä»¬å¾—çŸ¥è¯¥è´¦æˆ·åˆšåˆšèµšäº†å¦å¤– 200 å…ƒã€‚æˆ‘ä»¬å¯ä»¥å§‹ç»ˆæŒ‰ç…§ä»¥ä¸‹æ–¹å¼åæ˜ ç»“æœè´¦æˆ·ï¼š
- en: '| Python |  |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE4]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '|'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE5]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '|'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: However, this creates a new account; if we look at the current `balance` of
    `acct1`, by writing `acct1.balance`, it is still `500`. If this were our account,
    we would be quite sad!
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œè¿™åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è´¦æˆ·ï¼›å¦‚æœæˆ‘ä»¬æŸ¥çœ‹ `acct1` çš„å½“å‰ `balance`ï¼Œé€šè¿‡ç¼–å†™ `acct1.balance`ï¼Œå®ƒä»ç„¶æ˜¯ `500`ã€‚å¦‚æœè¿™æ˜¯æˆ‘ä»¬è‡ªå·±çš„è´¦æˆ·ï¼Œæˆ‘ä»¬ä¼šéå¸¸éš¾è¿‡ï¼
- en: 'Rather, we want to change the balance in the existing account. This requires
    a programming feature that we have not encountered until now: data that can be
    changed. Such data are called mutable, and we explore them below. In contrast,
    until now we have worked with immutable data: data that cannot be altered.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: è€Œæ˜¯æˆ‘ä»¬æƒ³è¦æ›´æ”¹ç°æœ‰è´¦æˆ·çš„ä½™é¢ã€‚è¿™éœ€è¦ä¸€ç§æˆ‘ä»¬è‡³ä»Šæœªé‡åˆ°è¿‡çš„ç¼–ç¨‹åŠŸèƒ½ï¼šå¯ä»¥æ›´æ”¹çš„æ•°æ®ã€‚è¿™ç§æ•°æ®è¢«ç§°ä¸ºå¯å˜æ•°æ®ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢æ¢è®¨å®ƒä»¬ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¤„ç†ä¸å¯å˜æ•°æ®ï¼šæ— æ³•æ›´æ”¹çš„æ•°æ®ã€‚
- en: 'First, we have to declare that the data can be changed. In Python, this is
    automatically true, always, so nothing changes. In Pyret, however, fields cannot
    be changedâ€”<wbr>they are immutableâ€”<wbr>by default. We have to explicitly say
    they can be changed:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å£°æ˜æ•°æ®å¯ä»¥æ›´æ”¹ã€‚åœ¨ Python ä¸­ï¼Œè¿™å§‹ç»ˆæ˜¯è‡ªåŠ¨çš„ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚ç„¶è€Œï¼Œåœ¨ Pyret ä¸­ï¼Œå­—æ®µé»˜è®¤æƒ…å†µä¸‹ä¸èƒ½æ›´æ”¹â€”â€”å®ƒä»¬æ˜¯ä¸å¯å˜çš„â€”â€”æˆ‘ä»¬å¿…é¡»æ˜ç¡®åœ°è¯´å®ƒä»¬å¯ä»¥æ›´æ”¹ï¼š
- en: '| Python | Pyret |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE6]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '|'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE7]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '|'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: This Pyret definition says that `id` cannot be changed, while `balance` can.
    This ensures that no programmer can accidentally change the bank account number.
    In Python, every programmer has to make sure they donâ€™t accidentally change it.
    (If we did want `id` to be mutable in Pyret, we would add a `ref` in front of
    it, too.)
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ª Pyret å®šä¹‰è¯´æ˜ `id` ä¸èƒ½è¢«æ›´æ”¹ï¼Œè€Œ `balance` å¯ä»¥ã€‚è¿™ç¡®ä¿äº†æ²¡æœ‰ç¨‹åºå‘˜ä¼šæ„å¤–åœ°æ›´æ”¹é“¶è¡Œè´¦æˆ·å·ç ã€‚åœ¨ Python ä¸­ï¼Œæ¯ä¸ªç¨‹åºå‘˜éƒ½å¿…é¡»ç¡®ä¿ä»–ä»¬ä¸ä¼šæ„å¤–åœ°æ›´æ”¹å®ƒã€‚ï¼ˆå¦‚æœæˆ‘ä»¬æƒ³åœ¨
    Pyret ä¸­ä½¿ `id` å¯å˜ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåœ¨å…¶å‰é¢æ·»åŠ ä¸€ä¸ª `ref`ã€‚ï¼‰
- en: 'With this definition, making accounts looks the same (unsurprisingly in Python,
    since nothing has changed):'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨è¿™ä¸ªå®šä¹‰ï¼Œåˆ›å»ºè´¦æˆ·çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼ˆåœ¨ Python ä¸­ä¸å‡ºæ‰€æ–™ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•å˜åŒ–ï¼‰ï¼š
- en: '| Python | Pyret |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE8]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '|'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE9]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '|'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'When we view the account in Pyret, we see something special:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘ä»¬åœ¨ Pyret ä¸­æŸ¥çœ‹è´¦æˆ·æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€äº›ç‰¹åˆ«çš„ä¸œè¥¿ï¼š
- en: '![](../Images/f5f80ba55f5bfb86404617db2b19812e.png)'
  id: totrans-51
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](../Images/f5f80ba55f5bfb86404617db2b19812e.png)'
- en: The yellow-and-black â€œcaution tapeâ€ indicator is a reminder that the value can
    change, so what is shown on screen may not be the current value.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: é»„è‰²å’Œé»‘è‰²çš„â€œè­¦æˆ’å¸¦â€æŒ‡ç¤ºå™¨æ˜¯ä¸€ä¸ªæé†’ï¼Œè¡¨ç¤ºå€¼å¯èƒ½ä¼šæ”¹å˜ï¼Œå› æ­¤å±å¹•ä¸Šæ˜¾ç¤ºçš„å€¼å¯èƒ½ä¸æ˜¯å½“å‰å€¼ã€‚
- en: 'Accessing an immutable field in Pyret remains the same:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Pyret ä¸­è®¿é—®ä¸å¯å˜å­—æ®µçš„æ–¹å¼ä¿æŒä¸å˜ï¼š
- en: '| Python | Pyret |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE10]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '|'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE11]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '|'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'However, accessing a mutable field looks different in Pyret:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œåœ¨ Pyret ä¸­è®¿é—®å¯å˜å­—æ®µçš„æ–¹å¼ä¸åŒï¼š
- en: '| Python | Pyret |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE12]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '|'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE13]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '|'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: The `!` is there to remind that what you are getting is the current value of
    `balance`, and it may be different later. Python does not offer a similar syntactic
    warning, but then again, recall that every field is always mutable.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '`!` å­˜åœ¨æ˜¯ä¸ºäº†æé†’ä½ å¾—åˆ°çš„æ˜¯ `balance` çš„å½“å‰å€¼ï¼Œå®ƒå¯èƒ½ç¨åä¼šä¸åŒã€‚Python æ²¡æœ‰æä¾›ç±»ä¼¼çš„è¯­æ³•è­¦å‘Šï¼Œä½†å†æ¬¡æé†’ï¼Œæ¯ä¸ªå­—æ®µå§‹ç»ˆæ˜¯å¯å˜çš„ã€‚'
- en: 'So now letâ€™s see how to change that account balance. For simplicity, letâ€™s
    first see how to set the account balance to zero. We use slightly different syntaxes
    for it in the two languages:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: å› æ­¤ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ›´æ”¹è´¦æˆ·ä½™é¢ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œè®©æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹å¦‚ä½•å°†è´¦æˆ·ä½™é¢è®¾ç½®ä¸ºé›¶ã€‚åœ¨ä¸¤ç§è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¨å¾®ä¸åŒçš„è¯­æ³•æ¥å®Œæˆè¿™ä¸ªæ“ä½œï¼š
- en: '| Python | Pyret |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '| `acct1.balance = 0` | `acct1!{balance: 0}` |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| `acct1.balance = 0` | `acct1!{balance: 0}` |'
- en: 'In Pyret, again, we use `!` in the syntax for changing the field: read it as
    â€œchange the value now!â€'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Pyret ä¸­ï¼Œå†æ¬¡ä½¿ç”¨ `!` æ¥è¡¨ç¤ºè¯­æ³•ä¸­æ›´æ”¹å­—æ®µçš„æ“ä½œï¼šè¯»ä½œâ€œç«‹å³æ›´æ”¹å€¼ï¼â€
- en: Do Now!
  id: totrans-72
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨èµ·æ¥ï¼
- en: ''
  id: totrans-73
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: You now know all the parts you need to figure out how to set `balance` to be
    `200` more than its previous value. Can you figure out how to write that?
  id: totrans-74
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä½ ç°åœ¨çŸ¥é“äº†æ‰€æœ‰ä½ éœ€è¦ç”¨æ¥æ‰¾å‡ºå¦‚ä½•å°† `balance` è®¾ç½®ä¸ºå…¶å…ˆå‰å€¼å¤š `200` çš„éƒ¨åˆ†ã€‚ä½ èƒ½æƒ³å‡ºå¦‚ä½•ç¼–å†™è¿™ä¸ªå—ï¼Ÿ
- en: 'Hereâ€™s how we combine the piecesâ€”<wbr>accessing the value and then setting
    it:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°±æ˜¯æˆ‘ä»¬å°†è¿™äº›éƒ¨åˆ†ç»„åˆèµ·æ¥çš„æ–¹æ³•â€”â€”è®¿é—®å€¼ç„¶åè®¾ç½®å®ƒï¼š
- en: '| Python |  |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  | `acct1.balance = acct1.balance + 200` |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '|  | `acct1.balance = acct1.balance + 200` |'
- en: '| Pyret |  |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  | `acct1!{balance: acct1!balance + 200}` |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
  zh: '|  | `acct1!{balance: acct1!balance + 200}` |'
- en: While Pyretâ€™s syntax is a little more onerous for changing the value of one
    field, it proves to be ligher-weight if we want to change multiple fields. In
    Python weâ€™d have to write `acct1.` for each of them, whereas in Pyret we need
    only the one `acct1!`. So there is a trade-off between the two syntaxes.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶ Pyret çš„è¯­æ³•åœ¨æ›´æ”¹å•ä¸ªå­—æ®µå€¼æ—¶å¯èƒ½ç¨å¾®ç¹çä¸€äº›ï¼Œä½†å¦‚æœæˆ‘ä»¬è¦æ›´æ”¹å¤šä¸ªå­—æ®µï¼Œå®ƒå°±è¯æ˜æ˜¯æ›´è½»é‡çº§çš„ã€‚åœ¨ Python ä¸­ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä¸ºæ¯ä¸ªå­—æ®µç¼–å†™
    `acct1.`ï¼Œè€Œåœ¨ Pyret ä¸­æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ª `acct1!`ã€‚å› æ­¤ï¼Œè¿™ä¸¤ç§è¯­æ³•ä¹‹é—´å­˜åœ¨æƒè¡¡ã€‚
- en: 'We hadnâ€™t written any tests above. Suppose we had: already we might notice
    something a bit odd. Say we had written'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬åœ¨ä¸Šé¢è¿˜æ²¡æœ‰ç¼–å†™ä»»ä½•æµ‹è¯•ã€‚å‡è®¾æˆ‘ä»¬å·²ç»ç¼–å†™äº†ï¼šæˆ‘ä»¬å¯èƒ½å·²ç»æ³¨æ„åˆ°ä¸€äº›æœ‰ç‚¹å¥‡æ€ªçš„äº‹æƒ…ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœæˆ‘ä»¬å·²ç»ç¼–å†™äº†
- en: '| Python | Pyret |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE14]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '|'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE15]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '|'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: This would pass before we performed the update, but fails after the update is
    performed. In Python, tests are run when we call the testing functions, which
    we typically do after loading the full file (either by running them at the prompt
    or by putting our tests in a separate file).
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æˆ‘ä»¬æ‰§è¡Œæ›´æ–°ä¹‹å‰ï¼Œè¿™ä¼šé€šè¿‡ï¼Œä½†åœ¨æ›´æ–°æ‰§è¡Œä¹‹åä¼šå¤±è´¥ã€‚åœ¨ Python ä¸­ï¼Œæµ‹è¯•æ˜¯åœ¨æˆ‘ä»¬è°ƒç”¨æµ‹è¯•å‡½æ•°æ—¶è¿è¡Œçš„ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨åŠ è½½å®Œæ•´æ–‡ä»¶åè¿™æ ·åšï¼ˆé€šè¿‡åœ¨æç¤ºç¬¦ä¸­è¿è¡Œå®ƒä»¬æˆ–åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­æ”¾å…¥ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼‰ã€‚
- en: 'In Pyret, tests are run as if they were written at the very bottom of definitions.
    Therefore, even if the program looked like this in Pyret:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Pyret ä¸­ï¼Œæµ‹è¯•å°±åƒå®ƒä»¬è¢«å†™åœ¨å®šä¹‰çš„åº•éƒ¨ä¸€æ ·è¿è¡Œã€‚å› æ­¤ï¼Œå³ä½¿ç¨‹åºåœ¨ Pyret ä¸­çœ‹èµ·æ¥åƒè¿™æ ·ï¼š
- en: '[PRE16]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: the test fails. Alternatively, we can write
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: æµ‹è¯•å¤±è´¥ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™
- en: '[PRE17]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: and it passes, but not if we comment out the update.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒä¼šé€šè¿‡ï¼Œä½†å¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰æ›´æ–°ï¼Œåˆ™ä¸ä¼šé€šè¿‡ã€‚
- en: 'In both languages, then, we see a new phenomenon: tests that are only sometimes
    true. This phenomenon is called state. There is a â€œstateâ€ (a collection of values
    for the defined names) in which the balance is `500`, and another where it is
    `700`. This is not merely limited to testing! Testing is just a reflection of
    what is going on in the program as it runs. From now on, every programming instruction
    will run in some state, and its actions will depend on the other values in that
    state. If those values change, the same instructionâ€”<wbr>i.e., the same piece
    of program textâ€”<wbr>may produce different answers. This makes programming much
    harder, and we will have to get used to the subtleties that come along with it.'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸¤ç§è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªæ–°ç°è±¡ï¼šæœ‰æ—¶ä¸ºçœŸæœ‰æ—¶ä¸ä¸ºçœŸçš„æµ‹è¯•ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸ºçŠ¶æ€ã€‚æœ‰ä¸€ä¸ªâ€œçŠ¶æ€â€ï¼ˆå®šä¹‰åç§°çš„å€¼çš„é›†åˆï¼‰ï¼Œå…¶ä¸­ä½™é¢æ˜¯ `500`ï¼Œå¦ä¸€ä¸ªæ˜¯
    `700`ã€‚è¿™ä¸ä»…ä»…å±€é™äºæµ‹è¯•ï¼æµ‹è¯•åªæ˜¯åæ˜ äº†ç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿçš„äº‹æƒ…ã€‚ä»ç°åœ¨å¼€å§‹ï¼Œæ¯ä¸ªç¼–ç¨‹æŒ‡ä»¤éƒ½å°†åœ¨ä¸€ä¸ªçŠ¶æ€ä¸­è¿è¡Œï¼Œå…¶æ“ä½œå°†å–å†³äºè¯¥çŠ¶æ€ä¸­çš„å…¶ä»–å€¼ã€‚å¦‚æœè¿™äº›å€¼å‘ç”Ÿå˜åŒ–ï¼Œç›¸åŒçš„æŒ‡ä»¤â€”â€”å³ï¼Œç›¸åŒçš„ç¨‹åºæ–‡æœ¬â€”â€”å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ç­”æ¡ˆã€‚è¿™ä½¿å¾—ç¼–ç¨‹å˜å¾—æ›´åŠ å›°éš¾ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä¹ æƒ¯éšä¹‹è€Œæ¥çš„å¾®å¦™ä¹‹å¤„ã€‚
- en: 12.1.2Â Testing Functions that Mutate Structures[ğŸ”—](#(part._.Testing_.Functions_that_.Mutate_.Structures)
    "Link to here")
  id: totrans-95
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 12.1.2Â æµ‹è¯•ä¿®æ”¹ç»“æ„çš„å‡½æ•°[ğŸ”—](#(part._.Testing_.Functions_that_.Mutate_.Structures) "é“¾æ¥åˆ°æ­¤å¤„")
- en: 'Our example of adding funds to an account corresponds to making a deposit into
    a bank account. Letâ€™s turn our balance-updating expression into a function (named
    `deposit`) that takes the deposit amount as input. Then, weâ€™ll look at how to
    write tests for that function. First, the function definition:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å‘è´¦æˆ·æ·»åŠ èµ„é‡‘çš„ä¾‹å­ç›¸å½“äºå‘é“¶è¡Œè´¦æˆ·å­˜æ¬¾ã€‚è®©æˆ‘ä»¬å°†æˆ‘ä»¬çš„ä½™é¢æ›´æ–°è¡¨è¾¾å¼è½¬æ¢æˆä¸€ä¸ªå‡½æ•°ï¼ˆå‘½åä¸º `deposit`ï¼‰ï¼Œè¯¥å‡½æ•°æ¥å—å­˜æ¬¾é‡‘é¢ä½œä¸ºè¾“å…¥ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹å¦‚ä½•ä¸ºè¯¥å‡½æ•°ç¼–å†™æµ‹è¯•ã€‚é¦–å…ˆï¼Œå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š
- en: '| Python |  |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE18]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '|'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE19]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '|'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: How do we test this?
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è¯¥å¦‚ä½•æµ‹è¯•è¿™ä¸ªï¼Ÿ
- en: In Python, this function does not return anything. In Pyret, the update operation
    does return the value being updated, but in a larger function we canâ€™t always
    assume that it will be the value returned. Therefore, we have to set up our test
    to assume otherwise.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Python ä¸­ï¼Œæ­¤å‡½æ•°ä¸è¿”å›ä»»ä½•å†…å®¹ã€‚åœ¨ Pyret ä¸­ï¼Œæ›´æ–°æ“ä½œç¡®å®è¿”å›æ­£åœ¨æ›´æ–°çš„å€¼ï¼Œä½†åœ¨æ›´å¤§çš„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½æ€»æ˜¯å‡è®¾å®ƒå°†è¿”å›è¯¥å€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è®¾ç½®æˆ‘ä»¬çš„æµ‹è¯•ï¼Œå‡è®¾æƒ…å†µå¹¶éå¦‚æ­¤ã€‚
- en: 'In general, tests for functions that contain mutation need to have three to
    four parts:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: é€šå¸¸ï¼ŒåŒ…å«çªå˜çš„å‡½æ•°çš„æµ‹è¯•éœ€è¦ä¸‰åˆ°å››ä¸ªéƒ¨åˆ†ï¼š
- en: 'Setup: set up the necessary values to provide the function.'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è®¾ç½®ï¼šè®¾ç½®æä¾›å‡½æ•°æ‰€éœ€çš„ä»·å€¼ã€‚
- en: 'Call: call the function.'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è°ƒç”¨ï¼šè°ƒç”¨å‡½æ•°ã€‚
- en: 'Check: check that the function had the desired behavior.'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ£€æŸ¥ï¼šæ£€æŸ¥å‡½æ•°æ˜¯å¦å…·æœ‰æœŸæœ›çš„è¡Œä¸ºã€‚
- en: 'Teardown: restore data to their expected state.'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ¸…ç†ï¼šå°†æ•°æ®æ¢å¤åˆ°é¢„æœŸçŠ¶æ€ã€‚
- en: '| Python | Pyret |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE20]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '|'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE21]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '|'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: In this case we donâ€™t need to perform a Teardown step because we created data
    purely for testing the function. But if, for instance, we had run the test over
    a dataset whose values matter, we would need to restore the changes.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰§è¡Œæ¸…ç†æ­¥éª¤ï¼Œå› ä¸ºæˆ‘ä»¬åªä¸ºæµ‹è¯•å‡½æ•°åˆ›å»ºäº†æ•°æ®ã€‚ä½†å¦‚æœæˆ‘ä»¬ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå€¼å¾ˆé‡è¦çš„æ•°æ®é›†ä¸Šè¿è¡Œäº†æµ‹è¯•ï¼Œæˆ‘ä»¬å°±éœ€è¦æ¢å¤è¿™äº›æ›´æ”¹ã€‚
- en: Similarly, the Setup phase needs to make sure that all data have the right values.
    Until now, once created, data did not change. But now, data may have been changed
    by some other mutations, and this may cause tests to fail. Therefore, the Setup
    phase requires not only creating necessary data but also setting the values of
    previously-created data to be what the test expects. (Again, note that in Python
    it is difficult to know which fields might have been changed, whereas in Pyret,
    we only have to reset the value of mutable fields.)
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: ç±»ä¼¼åœ°ï¼Œè®¾ç½®é˜¶æ®µéœ€è¦ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½æœ‰æ­£ç¡®çš„å€¼ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€æ—¦åˆ›å»ºï¼Œæ•°æ®ä¸ä¼šæ”¹å˜ã€‚ä½†ç°åœ¨ï¼Œæ•°æ®å¯èƒ½å·²ç»è¢«æŸäº›å…¶ä»–çªå˜æ‰€æ›´æ”¹ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æµ‹è¯•å¤±è´¥ã€‚å› æ­¤ï¼Œè®¾ç½®é˜¶æ®µä¸ä»…éœ€è¦åˆ›å»ºå¿…è¦çš„æ•°æ®ï¼Œè¿˜éœ€è¦å°†ä¹‹å‰åˆ›å»ºçš„æ•°æ®çš„å€¼è®¾ç½®ä¸ºæµ‹è¯•æ‰€æœŸæœ›çš„ã€‚
    (å†æ¬¡æé†’ï¼Œåœ¨ Python ä¸­ï¼Œå¾ˆéš¾çŸ¥é“å“ªäº›å­—æ®µå¯èƒ½å·²ç»è¢«æ›´æ”¹ï¼Œè€Œåœ¨ Pyret ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦é‡ç½®å¯å˜å­—æ®µçš„å€¼ã€‚)
- en: Exercise
  id: totrans-120
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç»ƒä¹ 
- en: ''
  id: totrans-121
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Write tests for the following function that adds interest to an account balance:'
  id: totrans-122
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä¸ºä»¥ä¸‹æ·»åŠ åˆ©æ¯åˆ°è´¦æˆ·ä½™é¢çš„å‡½æ•°ç¼–å†™æµ‹è¯•ï¼š
- en: ''
  id: totrans-123
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Python |  |'
  id: totrans-124
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-125
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE22]'
  id: totrans-126
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE22]'
- en: ''
  id: totrans-127
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-128
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-129
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-130
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE23]'
  id: totrans-131
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE23]'
- en: ''
  id: totrans-132
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-133
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: 12.1.3Â Aliasing[ğŸ”—](#(part._mult-bank-acct) "Link to here")
  id: totrans-134
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 12.1.3Â åˆ«å[ğŸ”—](#(part._mult-bank-acct) "é“¾æ¥åˆ°æ­¤å¤„")
- en: 'Now letâ€™s suppose our bank allows accounts to be shared by multiple customers.
    We should thus separate information about customers from that of the account:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å‡è®¾æˆ‘ä»¬çš„é“¶è¡Œå…è®¸å¤šä¸ªå®¢æˆ·å…±äº«è´¦æˆ·ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°†å®¢æˆ·ä¿¡æ¯ä¸è´¦æˆ·ä¿¡æ¯åˆ†å¼€ï¼š
- en: '| Python | Pyret |'
  id: totrans-136
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE24]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '|'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE25]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '|'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Specifically, suppose we have two accounts (`acct1` and `acct2`), where `acct1`
    is owned jointly by Elena and Jorge:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: å…·ä½“æ¥è¯´ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªè´¦æˆ·ï¼ˆ`acct1` å’Œ `acct2`ï¼‰ï¼Œå…¶ä¸­ `acct1` ç”± Elena å’Œ Jorge å…±åŒæ‹¥æœ‰ï¼š
- en: '| Python | Pyret |'
  id: totrans-143
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE26]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '|'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE27]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '|'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Now letâ€™s say Elena earns an additional `150`. We want to update the account
    to reflect this. How might we do it? First we have to access the account itself:
    `elena.acct` (in both languages). Then we would update it using the syntax above:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å‡è®¾ Elena è·å¾—äº†é¢å¤–çš„ `150`ã€‚æˆ‘ä»¬æƒ³è¦æ›´æ–°è´¦æˆ·ä»¥åæ˜ è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•åšï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»è®¿é—®è´¦æˆ·æœ¬èº«ï¼š`elena.acct`ï¼ˆåœ¨ä¸¤ç§è¯­è¨€ä¸­ï¼‰ã€‚ç„¶åï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸Šè¿°è¯­æ³•æ¥æ›´æ–°å®ƒï¼š
- en: '| Python | Pyret |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE28]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '|'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE29]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '|'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Sure enough, Elenaâ€™s account will now have the value of `850` (the original
    `500`, the bonus of `200`, and now the extra `150`):'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: æœç„¶ï¼ŒElena çš„è´¦æˆ·ç°åœ¨å°†å…·æœ‰ `850` çš„å€¼ï¼ˆåŸå§‹çš„ `500`ï¼Œå¥–é‡‘ `200`ï¼Œç°åœ¨é¢å¤–çš„ `150`ï¼‰ï¼š
- en: '| Python |  |'
  id: totrans-157
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-158
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE30]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '|'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-161
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-162
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE31]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '|'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Observe that in Pyret we use `.` to get the account but `!` to get the balance:
    a reminder that Elenaâ€™s account will never change (the way we have defined the
    data structure), but that accountâ€™s balance may and, indeed, does. Between the
    designs of Python and Pyret, thereâ€™s a trade-off between convenience and precision.'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œåœ¨ Pyret ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `.` æ¥è·å–è´¦æˆ·ï¼Œä½†ä½¿ç”¨ `!` æ¥è·å–ä½™é¢ï¼šè¿™æ˜¯ä¸€ä¸ªæé†’ï¼ŒElena çš„è´¦æˆ·æ°¸è¿œä¸ä¼šæ”¹å˜ï¼ˆæŒ‰ç…§æˆ‘ä»¬å®šä¹‰çš„æ•°æ®ç»“æ„ï¼‰ï¼Œä½†è´¦æˆ·çš„ä½™é¢å¯èƒ½ä¼šæ”¹å˜ï¼Œå®é™…ä¸Šç¡®å®å¦‚æ­¤ã€‚åœ¨
    Python å’Œ Pyret çš„è®¾è®¡ä¹‹é—´ï¼Œå­˜åœ¨ç€ä¾¿åˆ©æ€§å’Œç²¾ç¡®æ€§ä¹‹é—´çš„æƒè¡¡ã€‚
- en: 'The key question now is: what is Jorgeâ€™s balance? Put differently, will this
    test pass or fail?'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨çš„å…³é”®é—®é¢˜æ˜¯ï¼šè±ªå°”èµ«çš„ä½™é¢æ˜¯å¤šå°‘ï¼Ÿæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæµ‹è¯•ä¼šé€šè¿‡è¿˜æ˜¯å¤±è´¥ï¼Ÿ
- en: '| Python |  |'
  id: totrans-167
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-168
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE32]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '|'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-171
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-172
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE33]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '|'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Or even more simply: what is the value of this program?'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ–è€…æ›´ç®€å•åœ°è¯´ï¼šè¿™ä¸ªç¨‹åºçš„ä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿ
- en: '| Python | Pyret |'
  id: totrans-176
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE34]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '|'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE35]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '|'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'There are two very reasonable answers here:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæœ‰ä¸¤ä¸ªéå¸¸åˆç†çš„ç­”æ¡ˆï¼š
- en: Going by our prose, Jorgeâ€™s account should also have `850`, because thatâ€™s what
    it means to â€œshareâ€ an account.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ ¹æ®æˆ‘ä»¬çš„æ–‡æœ¬ï¼Œè±ªå°”èµ«çš„è´¦æˆ·ä¹Ÿåº”è¯¥æœ‰`850`ï¼Œå› ä¸ºâ€œå…±äº«â€è´¦æˆ·çš„å«ä¹‰å°±æ˜¯å¦‚æ­¤ã€‚
- en: Going by the visible code, Jorgeâ€™s account should still have `700`, because
    the update was made through `elena.acct`, not `jorge.acct`.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ ¹æ®å¯è§çš„ä»£ç ï¼Œè±ªå°”èµ«çš„è´¦æˆ·ä»ç„¶åº”è¯¥æœ‰`700`ï¼Œå› ä¸ºæ›´æ–°æ˜¯é€šè¿‡`elena.acct`è€Œä¸æ˜¯`jorge.acct`è¿›è¡Œçš„ã€‚
- en: Do Now!
  id: totrans-185
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-186
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Run the above code and see what you get.
  id: totrans-187
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è¿è¡Œä¸Šé¢çš„ä»£ç å¹¶æŸ¥çœ‹ä½ å¾—åˆ°çš„ç»“æœã€‚
- en: 'What you find is that the above test passes: Jorgeâ€™s account also has `850`.
    We say that `elena.acct` and `jorge.acct` are aliases: they are two different
    â€œnamesâ€ for the exact same datum.'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ ä¼šå‘ç°ä¸Šè¿°æµ‹è¯•é€šè¿‡äº†ï¼šè±ªå°”èµ«çš„è´¦æˆ·ä¹Ÿæœ‰`850`ã€‚æˆ‘ä»¬è¯´`elena.acct`å’Œ`jorge.acct`æ˜¯åˆ«åï¼šå®ƒä»¬æ˜¯åŒä¸€æ•°æ®çš„ä¸¤ä¸ªä¸åŒçš„â€œåç§°â€ã€‚
- en: 'This is not the first time we have had shared data. However, until now, it
    hasnâ€™t mattered that the data were aliased. But now that we have mutation, aliases
    matter: the balance in `jorge.acct` has changed even though we never made an explicit
    change using that name. It is as if `elena.acct` exhibited spooky action at a
    distance.'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡é‡åˆ°å…±äº«æ•°æ®ã€‚ç„¶è€Œï¼Œç›´åˆ°ç°åœ¨ï¼Œæ•°æ®è¢«åˆ«ååŒ–å¹¶æ²¡æœ‰å…³ç³»ã€‚ä½†ç°åœ¨æˆ‘ä»¬æœ‰çªå˜ï¼Œåˆ«åå¾ˆé‡è¦ï¼š`jorge.acct`ä¸­çš„ä½™é¢å·²ç»æ”¹å˜ï¼Œå°½ç®¡æˆ‘ä»¬ä»æœªä½¿ç”¨è¯¥åç§°è¿›è¡Œæ˜¾å¼æ›´æ”¹ã€‚è¿™å°±åƒ`elena.acct`å±•ç¤ºäº†è¶…è·ä½œç”¨ã€‚
- en: Again, there is a linguistic difference here. Because all fields are mutable
    in Python, you have to always be on the alert for this. Because only `ref` fields
    are mutable in Pyret, you can be sure that fields accessed through `.` will never
    change in value over time or even if there are aliases, but those accessed through
    `!` might change over time (and via aliases).
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: å†æ¬¡ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªè¯­è¨€ä¸Šçš„å·®å¼‚ã€‚å› ä¸ºæ‰€æœ‰å­—æ®µåœ¨Pythonä¸­éƒ½æ˜¯å¯å˜çš„ï¼Œä½ å¿…é¡»å§‹ç»ˆä¿æŒè­¦æƒ•ã€‚å› ä¸ºåœ¨Pyretä¸­åªæœ‰`ref`å­—æ®µæ˜¯å¯å˜çš„ï¼Œä½ å¯ä»¥ç¡®ä¿¡é€šè¿‡`.`è®¿é—®çš„å­—æ®µå…¶å€¼åœ¨æ—¶é—´ä¸Šä¸ä¼šæ”¹å˜ï¼Œå³ä½¿æœ‰åˆ«åä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½†é€šè¿‡`!`è®¿é—®çš„å­—æ®µå¯èƒ½ä¼šéšæ—¶é—´æ”¹å˜ï¼ˆä»¥åŠé€šè¿‡åˆ«åï¼‰ã€‚
- en: 12.1.4Â Structure Mutation and the Directory[ğŸ”—](#(part._structure-mut-dir) "Link
    to here")
  id: totrans-191
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 12.1.4 ç»“æ„çªå˜å’Œç›®å½•[ğŸ”—](#(part._structure-mut-dir) "é“¾æ¥åˆ°è¿™é‡Œ")
- en: 'Now that we have the ability to mutate the contents of data, we will need to
    show and then revise our notion of directories. The directories are essentially
    the same between Pyret and Python, with one exception: we have different naming
    conventions in the two languages. For instance, we write `Account(8404, 500)`
    in Python versus `account(8404, 500)` in Pyret. It would be annoying to write
    every one of these twice, with the only difference being the capitalization. Therefore,
    where the only difference is the naming, we will ignore this difference and show
    only one version (in this case, the Python version); you should assume that the
    exact same thing is true for Pyret, other than the capitalization.'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¿®æ”¹æ•°æ®å†…å®¹çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬éœ€è¦å±•ç¤ºå¹¶ä¿®æ”¹æˆ‘ä»¬å¯¹ç›®å½•çš„ç†è§£ã€‚Pyretå’ŒPythonä¹‹é—´çš„ç›®å½•åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ï¼Œåªæœ‰ä¸€ä¸ªä¾‹å¤–ï¼šæˆ‘ä»¬åœ¨ä¸¤ç§è¯­è¨€ä¸­æœ‰ä¸åŒçš„å‘½åçº¦å®šã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨Pythonä¸­å†™`Account(8404,
    500)`ï¼Œè€Œåœ¨Pyretä¸­å†™`account(8404, 500)`ã€‚å†™è¿™äº›ä¸¤æ¬¡ä¼šå¾ˆçƒ¦äººï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å¤§å°å†™ã€‚å› æ­¤ï¼Œåªæœ‰åœ¨å‘½åä¸Šæœ‰åŒºåˆ«çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å°†å¿½ç•¥è¿™ç§åŒºåˆ«ï¼Œåªå±•ç¤ºä¸€ä¸ªç‰ˆæœ¬ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPythonç‰ˆæœ¬ï¼‰ï¼›ä½ åº”è¯¥å‡è®¾Pyretä¸­é™¤äº†å¤§å°å†™ä¹‹å¤–ï¼Œå®Œå…¨ç›¸åŒã€‚
- en: 'As a reminder, here are our initial definitions once again:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œä¸ºæé†’ï¼Œè¿™é‡Œå†æ¬¡åˆ—å‡ºæˆ‘ä»¬çš„åˆå§‹å®šä¹‰ï¼š
- en: '[PRE36]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Do Now!
  id: totrans-195
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-196
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Review the following proposal for the directory contents after running the initial
    definitions. Is this what you expect to see?
  id: totrans-197
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åœ¨è¿è¡Œåˆå§‹å®šä¹‰ä¹‹åï¼Œè¯·å®¡æŸ¥ä»¥ä¸‹ç›®å½•å†…å®¹çš„ææ¡ˆã€‚è¿™æ˜¯ä½ æœŸæœ›çœ‹åˆ°çš„å—ï¼Ÿ
- en: ''
  id: totrans-198
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: Directory
  id: totrans-199
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: ''
  id: totrans-200
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE37]'
  id: totrans-201
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE37]'
- en: ''
  id: totrans-202
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-203
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-204
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: â†’
  id: totrans-205
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: ''
  id: totrans-206
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-207
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-208
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE38]'
  id: totrans-209
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: ''
  id: totrans-210
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-211
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE39]'
  id: totrans-212
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE39]'
- en: ''
  id: totrans-213
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-214
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-215
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: â†’
  id: totrans-216
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: ''
  id: totrans-217
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-218
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-219
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE40]'
  id: totrans-220
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: ''
  id: totrans-221
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-222
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE41]'
  id: totrans-223
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE41]'
- en: ''
  id: totrans-224
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-225
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-226
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: â†’
  id: totrans-227
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: ''
  id: totrans-228
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-229
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-230
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE42]'
  id: totrans-231
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: ''
  id: totrans-232
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-233
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE43]'
  id: totrans-234
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE43]'
- en: ''
  id: totrans-235
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-236
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-237
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: â†’
  id: totrans-238
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: ''
  id: totrans-239
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-240
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-241
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE44]'
  id: totrans-242
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Thereâ€™s a problem with this version, namely the use of `acct1` in the values
    associated with `elena` and `jorge`. Remember, the values in the directory canâ€™t
    refer to names in the directory: both Pyret and Python replace names with their
    values when evaluating expressions. Here is the corresponding version of the directory
    that uses the value of `acct1`:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªç‰ˆæœ¬å­˜åœ¨é—®é¢˜ï¼Œå³ä¸`elena`å’Œ`jorge`å…³è”çš„å€¼ä¸­ä½¿ç”¨äº†`acct1`ã€‚è®°ä½ï¼Œç›®å½•ä¸­çš„å€¼ä¸èƒ½å¼•ç”¨ç›®å½•ä¸­çš„åç§°ï¼šPyretå’ŒPythonåœ¨è¯„ä¼°è¡¨è¾¾å¼æ—¶éƒ½ä¼šç”¨å®ƒä»¬çš„å€¼æ›¿æ¢åç§°ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨`acct1`å€¼çš„ç›®å½•çš„å¯¹åº”ç‰ˆæœ¬ï¼š
- en: Directory
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE45]'
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE45]'
- en: â†’
  id: totrans-246
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE46]'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '[PRE47]'
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE47]'
- en: â†’
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE48]'
  id: totrans-250
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: '[PRE49]'
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE49]'
- en: â†’
  id: totrans-252
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE50]'
  id: totrans-253
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: '[PRE51]'
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE51]'
- en: â†’
  id: totrans-255
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE52]'
  id: totrans-256
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: Observe that this is also what you would see if you were to evaluate the corresponding
    variable names.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œå¦‚æœä½ è¯„ä¼°ç›¸åº”çš„å˜é‡åï¼Œä½ ä¹Ÿä¼šçœ‹åˆ°è¿™ä¸ªç»“æœã€‚
- en: 'Now, letâ€™s add funds to Elenaâ€™s account:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œè®©æˆ‘ä»¬å‘ä¼Šè²å¨œçš„è´¦æˆ·æ·»åŠ èµ„é‡‘ï¼š
- en: '| Python |  |'
  id: totrans-259
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-260
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE53]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: '|'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-263
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-264
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE54]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: '|'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: Do Now!
  id: totrans-267
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-268
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Show how the directory changes if you run the above code.
  id: totrans-269
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å±•ç¤ºè¿è¡Œä¸Šè¿°ä»£ç æ—¶ç›®å½•å¦‚ä½•å˜åŒ–ã€‚
- en: If we follow the code precisely, we might expect the following directory, in
    which only the balance in Elenaâ€™s version of the account changes.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬ç²¾ç¡®åœ°éµå¾ªä»£ç ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœŸæœ›ä»¥ä¸‹ç›®å½•ï¼Œå…¶ä¸­åªæœ‰Elenaè´¦æˆ·ç‰ˆæœ¬ä¸­çš„ä½™é¢å‘ç”Ÿå˜åŒ–ã€‚
- en: Directory
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE55]'
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE55]'
- en: â†’
  id: totrans-273
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE56]'
  id: totrans-274
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: '[PRE57]'
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE57]'
- en: â†’
  id: totrans-276
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE58]'
  id: totrans-277
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: '[PRE59]'
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE59]'
- en: â†’
  id: totrans-279
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE60]'
  id: totrans-280
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: '[PRE61]'
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE61]'
- en: â†’
  id: totrans-282
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE62]'
  id: totrans-283
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: We know from running the code, however, that the account is aliased, so that
    the balances accessible from each of `acct`, `elena.acct`, and `jorge.acct` all
    reflect the update. This suggests that the actual directory should look something
    like
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œä»è¿è¡Œä»£ç æˆ‘ä»¬çŸ¥é“ï¼Œè¯¥è´¦æˆ·å·²è¢«åˆ«ååŒ–ï¼Œå› æ­¤ä»`acct`ã€`elena.acct`å’Œ`jorge.acct`æ¯ä¸ªè´¦æˆ·å¯è®¿é—®çš„ä½™é¢éƒ½åæ˜ äº†æ›´æ–°ã€‚è¿™è¡¨æ˜å®é™…çš„ç›®å½•åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·
- en: Directory
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE63]'
  id: totrans-286
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE63]'
- en: â†’
  id: totrans-287
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE64]'
  id: totrans-288
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: '[PRE65]'
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE65]'
- en: â†’
  id: totrans-290
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE66]'
  id: totrans-291
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: '[PRE67]'
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE67]'
- en: â†’
  id: totrans-293
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE68]'
  id: totrans-294
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE68]'
- en: '[PRE69]'
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE69]'
- en: â†’
  id: totrans-296
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE70]'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: But this is also weird. The directory represents the information that Pyret
    or Python maintain about your defined names and their values. What in the directory
    indicates that those three balances should change, but not the balance of `acct2`)?
    Put differently, what reflects the aliasing? Nothing!
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†è¿™ä¹Ÿå¾ˆå¥‡æ€ªã€‚ç›®å½•ä»£è¡¨äº†Pyretæˆ–Pythonç»´æŠ¤çš„å…³äºä½ å®šä¹‰çš„åç§°åŠå…¶å€¼çš„ä¿¡æ¯ã€‚ç›®å½•ä¸­æœ‰ä»€ä¹ˆè¡¨æ˜è¿™ä¸‰ä¸ªä½™é¢åº”è¯¥æ”¹å˜ï¼Œä½†`acct2`çš„ä½™é¢ä¸æ”¹å˜å‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼Œä»€ä¹ˆåæ˜ äº†åˆ«ååŒ–ï¼Ÿä»€ä¹ˆéƒ½æ²¡æœ‰ï¼
- en: The directory as we have used it up until now works fine for programs without
    mutation. But once we have both mutation and aliasing, this simple idea of mapping
    names to values breaks down because it doesnâ€™t capture the aliases. We need a
    refined representation of the connections between names and values that does capture
    aliasing.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è‡³ä»Šä½¿ç”¨çš„ç›®å½•å¯¹äºæ²¡æœ‰çªå˜çš„ç¨‹åºæ¥è¯´å·¥ä½œå¾—å¾ˆå¥½ã€‚ä½†ä¸€æ—¦æˆ‘ä»¬æœ‰äº†çªå˜å’Œåˆ«ååŒ–ï¼Œè¿™ç§ç®€å•çš„å°†åç§°æ˜ å°„åˆ°å€¼çš„æ€æƒ³å°±ä¼šå´©æºƒï¼Œå› ä¸ºå®ƒæ²¡æœ‰æ•æ‰åˆ°åˆ«åã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´ç²¾ç»†çš„è¡¨ç¤ºåç§°å’Œå€¼ä¹‹é—´è¿æ¥çš„è¡¨ç¤ºï¼Œå®ƒèƒ½æ•æ‰åˆ°åˆ«ååŒ–ã€‚
- en: 12.1.4.1Â Introducing the Heap[ğŸ”—](#(part._heap-intro) "Link to here")
  id: totrans-300
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 12.1.4.1Â ä»‹ç»å †[ğŸ”—](#(part._heap-intro) "é“¾æ¥åˆ°æ­¤å¤„")
- en: Our original presentation of the directory reflected the aliases that referred
    to a single `Account` through repeated use of the name `acct1`. We only lost that
    sharing when we replaced `acct1` with itâ€™s value while setting up the data for
    Elena and Jorge. The rule that names canâ€™t appear in the values is still important,
    especially in the presence of mutation (weâ€™ll return to this later in [Mutating
    Variables in Memory](mutating-variables.html#%28part._mutating-vars-memory%29)).
    But the idea of having a single term that can be reused to reflect sharing is
    a good one. Indeed, it reflects what happens inside your computer.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: â†’
- en: 'Every time you use a constructor to create data, your programming environment
    stores it in the memory of your computer. Memory consists of a (large) number
    of slots. Your newly-created datum goes into one of these slots. Each slot is
    labeled with an address. Just as a street address refers to a specific building,
    a memory address refers to a specific slot where a datum is stored. Memory slots
    are physical entities, not conceptual ones. A computer with a 500GB hard drive
    has about 500 billion slots in which it can store data. Not all of that memory
    is available to your programming environment: your Web browser, applications,
    operating system, and so on all get stored in the memory. Your programming environment
    does get a portion of memory to use for storing its data. That portion is called
    the heap.'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯æ¬¡ä½ ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºæ•°æ®æ—¶ï¼Œä½ çš„ç¼–ç¨‹ç¯å¢ƒéƒ½ä¼šå°†å…¶å­˜å‚¨åœ¨ç”µè„‘çš„å†…å­˜ä¸­ã€‚å†…å­˜ç”±å¤§é‡æ§½ä½ç»„æˆã€‚ä½ æ–°åˆ›å»ºçš„æ•°æ®å°†è¿›å…¥è¿™äº›æ§½ä½ä¸­çš„ä¸€ä¸ªã€‚æ¯ä¸ªæ§½ä½éƒ½æ ‡æœ‰åœ°å€ã€‚å°±åƒè¡—é“åœ°å€æŒ‡ä»£ç‰¹å®šçš„å»ºç­‘ä¸€æ ·ï¼Œå†…å­˜åœ°å€æŒ‡ä»£å­˜å‚¨æ•°æ®çš„ç‰¹å®šæ§½ä½ã€‚å†…å­˜æ§½ä½æ˜¯ç‰©ç†å®ä½“ï¼Œè€Œä¸æ˜¯æ¦‚å¿µæ€§çš„ã€‚ä¸€ä¸ªæ‹¥æœ‰500GBç¡¬ç›˜çš„ç”µè„‘å¤§çº¦æœ‰5000äº¿ä¸ªæ§½ä½å¯ä»¥å­˜å‚¨æ•°æ®ã€‚å¹¶éæ‰€æœ‰è¿™äº›å†…å­˜éƒ½å¯¹ç¼–ç¨‹ç¯å¢ƒå¯ç”¨ï¼šä½ çš„ç½‘ç»œæµè§ˆå™¨ã€åº”ç”¨ç¨‹åºã€æ“ä½œç³»ç»Ÿç­‰éƒ½è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ä½ çš„ç¼–ç¨‹ç¯å¢ƒç¡®å®è·å¾—äº†ä¸€éƒ¨åˆ†å†…å­˜æ¥ç”¨äºå­˜å‚¨å…¶æ•°æ®ã€‚è¿™éƒ¨åˆ†è¢«ç§°ä¸ºå †ã€‚
- en: When you write a statement like
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ä½ ç¼–å†™å¦‚ä¸‹è¯­å¥æ—¶
- en: '[PRE71]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'your programming environment puts the new `Account` into a physical slot in
    the heap, then associates the address of that slot with the variable name in the
    directory. The name in the directory doesnâ€™t map to the value itself, but rather
    to the address that holds the value. The address bridges between the physical
    storage location and the conceptual name you want to associate with the new datum.
    In other words, our directory really looks like:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ çš„ç¼–ç¨‹ç¯å¢ƒå°†æ–°çš„`Account`æ”¾å…¥å †ä¸­çš„ç‰©ç†æ§½ä½ï¼Œç„¶åå°†è¯¥æ§½ä½çš„åœ°å€ä¸ç›®å½•ä¸­çš„å˜é‡åç§°å…³è”ã€‚ç›®å½•ä¸­çš„åç§°ä¸æ˜ å°„åˆ°å€¼æœ¬èº«ï¼Œè€Œæ˜¯æ˜ å°„åˆ°å­˜å‚¨å€¼çš„åœ°å€ã€‚åœ°å€åœ¨ç‰©ç†å­˜å‚¨ä½ç½®å’Œæ‚¨æƒ³è¦ä¸ä¹‹å…³è”çš„æ¦‚å¿µåç§°ä¹‹é—´æ¶èµ·æ¡¥æ¢ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬çš„ç›®å½•å®é™…ä¸Šçœ‹èµ·æ¥åƒè¿™æ ·ï¼š
- en: Directory
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE72]'
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE72]'
- en: â†’Â 1001
  id: totrans-308
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: Heap
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-310
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 'Our revised version has two separate areas: the directory (mapping names to
    addresses) and the heap (showing the values stored at the addresses). We will
    use four-digit numbers for addresses, prefixed with an @ symbol (reserving numbers
    with fewer digits for data values). The specific number for the initial address
    (here 1001) is arbitrary. Subsequent storage of structured data values will use
    the addresses in order. Letâ€™s write out the directory and heap contents for our
    initial definitions of accounts in this new format, and see how it supports the
    aliasing that we intended.'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ä¿®è®¢çš„ç‰ˆæœ¬æœ‰ä¸¤ä¸ªç‹¬ç«‹åŒºåŸŸï¼šç›®å½•ï¼ˆå°†åç§°æ˜ å°„åˆ°åœ°å€ï¼‰å’Œå †ï¼ˆæ˜¾ç¤ºå­˜å‚¨åœ¨åœ°å€ä¸­çš„å€¼ï¼‰ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å››ä½æ•°å­—ä½œä¸ºåœ°å€ï¼Œå‰é¢åŠ ä¸Šä¸€ä¸ª@ç¬¦å·ï¼ˆä¸ºæ•°æ®å€¼ä¿ç•™æ›´å°‘æ•°å­—çš„æ•°å­—ï¼‰ã€‚åˆå§‹åœ°å€çš„å…·ä½“æ•°å­—ï¼ˆè¿™é‡Œä¸º1001ï¼‰æ˜¯ä»»æ„çš„ã€‚åç»­å­˜å‚¨ç»“æ„åŒ–æ•°æ®å€¼å°†æŒ‰é¡ºåºä½¿ç”¨åœ°å€ã€‚è®©æˆ‘ä»¬ä»¥è¿™ç§æ–°æ ¼å¼è®°å½•ç›®å½•å’Œå †çš„å†…å®¹ï¼Œä»¥æŸ¥çœ‹å®ƒå¦‚ä½•æ”¯æŒæˆ‘ä»¬é¢„æœŸçš„åˆ«ååŠŸèƒ½ã€‚
- en: First, we create both `acct1` and `acct2` in order as follows. Note that the
    `Account` associated with name `acct2` goes in address 1002.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬æŒ‰ç…§ä»¥ä¸‹é¡ºåºåˆ›å»ºäº†`acct1`å’Œ`acct2`ã€‚è¯·æ³¨æ„ï¼Œä¸åç§°`acct2`å…³è”çš„`Account`ä½äºåœ°å€1002ã€‚
- en: Directory
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE73]'
  id: totrans-314
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE73]'
- en: â†’Â 1001
  id: totrans-315
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE74]'
  id: totrans-316
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE74]'
- en: â†’Â 1002
  id: totrans-317
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1002
- en: Heap
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-319
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 1002:Â `Account(8404, 500)`
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `Account(8404, 500)`
- en: When we run
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘ä»¬è¿è¡Œ
- en: '| Python | Pyret |'
  id: totrans-322
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE75]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: '|'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE76]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: '|'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'what happens? As before, we look up what the name `acct1` refers to in the
    directory and substitute the result for the name in the `Customer` data. Now,
    `acct1` evaluates to an address, 1001\. Therefore, the `Customer` value in the
    heap contains an address:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨ç›®å½•ä¸­æŸ¥æ‰¾åç§°`acct1`æ‰€å¼•ç”¨çš„å†…å®¹ï¼Œå¹¶ç”¨ç»“æœæ›¿æ¢`Customer`æ•°æ®ä¸­çš„åç§°ã€‚ç°åœ¨ï¼Œ`acct1`è¯„ä¼°ä¸ºåœ°å€ï¼Œ1001ã€‚å› æ­¤ï¼Œå †ä¸­çš„`Customer`å€¼åŒ…å«ä¸€ä¸ªåœ°å€ï¼š
- en: Directory
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE77]'
  id: totrans-330
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE77]'
- en: â†’Â 1001
  id: totrans-331
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE78]'
  id: totrans-332
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE78]'
- en: â†’Â 1002
  id: totrans-333
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1002
- en: Heap
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 1002:Â `Customer("Elena", 1001)`
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `Customer("Elena", 1001)`
- en: Similarly, when we run
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: ç±»ä¼¼åœ°ï¼Œå½“æˆ‘ä»¬è¿è¡Œ
- en: '| Python | Pyret |'
  id: totrans-338
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE79]'
  id: totrans-340
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: '|'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE80]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: '|'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'the directory and heap look like this:'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•å’Œå †çœ‹èµ·æ¥åƒè¿™æ ·ï¼š
- en: Directory
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE81]'
  id: totrans-346
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE81]'
- en: â†’Â 1001
  id: totrans-347
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE82]'
  id: totrans-348
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE82]'
- en: â†’Â 1002
  id: totrans-349
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1002
- en: '[PRE83]'
  id: totrans-350
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE83]'
- en: â†’Â 1003
  id: totrans-351
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1003
- en: '[PRE84]'
  id: totrans-352
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE84]'
- en: â†’Â 1004
  id: totrans-353
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1004
- en: Heap
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-355
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 1002:Â `Account(8405, 3250)`
  id: totrans-356
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `Account(8405, 3250)`
- en: 1003:Â `Customer("Elena", 1001)`
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1003:Â `Customer("Elena", 1001)`
- en: 1004:Â `Customer("Jorge", 1001)`
  id: totrans-358
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1004:Â `Customer("Jorge", 1001)`
- en: Do Now!
  id: totrans-359
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-360
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Fun fact in the Web version of the book: Did you try hovering over the addresses?
    Try it now!'
  id: totrans-361
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä¹¦çš„Webç‰ˆæœ¬ä¸­çš„æœ‰è¶£äº‹å®ï¼šä½ å°è¯•å°†é¼ æ ‡æ‚¬åœåœ¨åœ°å€ä¸Šå—ï¼Ÿç°åœ¨è¯•è¯•ï¼
- en: 'With the heap articulated separately from the directory, we now see the relationship
    between the `acct` fields for the two customers and the name `acct1`: they refer
    to the same address, which in turn means they refer to the same value. In contrast,
    the name `acct2`, which was not aliased in the original code, refers to an address
    that is not referenced anywhere else. This is the heart of aliasing: thatâ€™s why
    changes made through one name also affect values viewed through another.'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: å°†å †ä¸ç›®å½•åˆ†å¼€é˜è¿°åï¼Œæˆ‘ä»¬ç°åœ¨çœ‹åˆ°ä¸¤ä¸ªå®¢æˆ·çš„`acct`å­—æ®µä¸åç§°`acct1`ä¹‹é—´çš„å…³ç³»ï¼šå®ƒä»¬å¼•ç”¨äº†ç›¸åŒçš„åœ°å€ï¼Œè¿™åè¿‡æ¥åˆæ„å‘³ç€å®ƒä»¬å¼•ç”¨äº†ç›¸åŒçš„å€¼ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåç§°`acct2`ï¼ˆåœ¨åŸå§‹ä»£ç ä¸­æ²¡æœ‰åˆ«åï¼‰ï¼Œå¼•ç”¨äº†ä¸€ä¸ªæ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨çš„åœ°å€ã€‚è¿™å°±æ˜¯åˆ«åçš„å¿ƒè„ï¼šè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€šè¿‡ä¸€ä¸ªåç§°æ‰€åšçš„æ›´æ”¹ä¹Ÿä¼šå½±å“é€šè¿‡å¦ä¸€ä¸ªåç§°æŸ¥çœ‹çš„å€¼ã€‚
- en: Do Now!
  id: totrans-363
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-364
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Write three distinct expressions each of which uses a different name in the
    directory to return the balance in account `acct1`.
  id: totrans-365
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç¼–å†™ä¸‰ä¸ªä¸åŒçš„è¡¨è¾¾å¼ï¼Œæ¯ä¸ªè¡¨è¾¾å¼ä½¿ç”¨ç›®å½•ä¸­çš„ä¸åŒåç§°æ¥è¿”å›è´¦æˆ·`acct1`çš„ä½™é¢ã€‚
- en: Do Now!
  id: totrans-366
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-367
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Would the following statement work to update the balance in Elena and Jorgeâ€™s
    shared account?
  id: totrans-368
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹è¯­å¥èƒ½å¦ç”¨äºæ›´æ–°Elenaå’ŒJorgeå…±äº«è´¦æˆ·çš„ä½™é¢ï¼Ÿ
- en: ''
  id: totrans-369
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Python |  |'
  id: totrans-370
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-371
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE85]'
  id: totrans-372
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE85]'
- en: ''
  id: totrans-373
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-374
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-375
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-376
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|'
- en: '[PRE86]'
  id: totrans-377
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE86]'
- en: ''
  id: totrans-378
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-379
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: ''
  id: totrans-380
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: Does this seem like a good or bad way to do this computation? Why?
  id: totrans-381
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è¿™ç§è®¡ç®—æ–¹å¼çœ‹èµ·æ¥æ˜¯å¥½æ˜¯åï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
- en: Do Now!
  id: totrans-382
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-383
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Extend the most recent directory and heap contents to reflect running the following
    statement:'
  id: totrans-384
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å°†æœ€æ–°çš„ç›®å½•å’Œå †å†…å®¹æ‰©å±•åˆ°åæ˜ è¿è¡Œä»¥ä¸‹è¯­å¥ï¼š
- en: ''
  id: totrans-385
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE87]'
  id: totrans-386
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE87]'
- en: ''
  id: totrans-387
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: Did you change the heap in the previous exercise? Should you have?
  id: totrans-388
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä½ åœ¨ä¹‹å‰çš„ç»ƒä¹ ä¸­æ›´æ”¹äº†å †å—ï¼Ÿä½ åº”è¯¥æ›´æ”¹å—ï¼Ÿ
- en: 'Three rules guide how the directory and heap are affected by running programs:'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‰æ¡è§„åˆ™æŒ‡å¯¼äº†ç›®å½•å’Œå †åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„å½±å“ï¼š
- en: If the code construct a new piece of structured data, put the new piece of structured
    data at the next address in the heap.
  id: totrans-390
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¦‚æœä»£ç æ„å»ºä¸€ä¸ªæ–°çš„ç»“æ„åŒ–æ•°æ®å—ï¼Œåˆ™åœ¨å †ä¸­çš„ä¸‹ä¸€ä¸ªåœ°å€æ”¾ç½®æ–°çš„ç»“æ„åŒ–æ•°æ®å—ã€‚
- en: If the code associates a name with a piece of structured data, the directory
    should map the name to the address of the datum in the heap.
  id: totrans-391
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¦‚æœä»£ç å°†ä¸€ä¸ªåç§°ä¸ç»“æ„åŒ–æ•°æ®ç›¸å…³è”ï¼Œç›®å½•åº”å°†åç§°æ˜ å°„åˆ°å †ä¸­æ•°æ®çš„åœ°å€ã€‚
- en: If the code modifies a field within structured data, modify the data in the
    heap.
  id: totrans-392
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¦‚æœä»£ç ä¿®æ”¹äº†ç»“æ„åŒ–æ•°æ®ä¸­çš„å­—æ®µï¼Œåˆ™ä¿®æ”¹å †ä¸­çš„æ•°æ®ã€‚
- en: In the example above, we did not alter the heap in any way; only the directory
    should be modified to reflect that `acct3` and `acct1` are now aliases.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä»¥ä»»ä½•æ–¹å¼æ›´æ”¹å †ï¼›åªéœ€ä¿®æ”¹ç›®å½•ä»¥åæ˜ `acct3`å’Œ`acct1`ç°åœ¨æ˜¯åˆ«åå³å¯ã€‚
- en: 12.1.4.2Â Basic Data and the Heap[ğŸ”—](#(part._basic-data-heap) "Link to here")
  id: totrans-394
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 12.1.4.2Â åŸºæœ¬æ•°æ®å’Œå †[ğŸ”—](#(part._basic-data-heap) "é“¾æ¥è‡³æ­¤")
- en: The above rules donâ€™t indicate what happens when we have basic data, such as
    numbers or strings, associated with names in the directory. Do those values also
    get addresses in the heap?
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸Šè¿°è§„åˆ™æ²¡æœ‰è¯´æ˜å½“æˆ‘ä»¬æœ‰åŸºæœ¬æ•°æ®ï¼Œå¦‚æ•°å­—æˆ–å­—ç¬¦ä¸²ï¼Œä¸ç›®å½•ä¸­çš„åç§°ç›¸å…³è”æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è¿™äº›å€¼ä¹Ÿä¼šåœ¨å †ä¸­è·å¾—åœ°å€å—ï¼Ÿ
- en: 'They do not. As our example with shared accounts illustrated, we need the heap
    so that updates to fields of shared data affect all aliases (names that refer
    to) those data. Basic data donâ€™t have fields, so there is no need to put them
    in the heap. Hereâ€™s a concrete example:'
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒä»¬å¹¶ä¸ã€‚æ­£å¦‚æˆ‘ä»¬ç”¨å…±äº«è´¦æˆ·çš„ç¤ºä¾‹æ‰€å±•ç¤ºçš„ï¼Œæˆ‘ä»¬éœ€è¦å †ä»¥ä¾¿æ›´æ–°å…±äº«æ•°æ®çš„å­—æ®µä¼šå½±å“æ‰€æœ‰åˆ«åï¼ˆæŒ‡å‘è¿™äº›æ•°æ®çš„åç§°ï¼‰ã€‚åŸºæœ¬æ•°æ®æ²¡æœ‰å­—æ®µï¼Œå› æ­¤æ²¡æœ‰å¿…è¦å°†å®ƒä»¬æ”¾åœ¨å †ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š
- en: '[PRE88]'
  id: totrans-397
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: 'The corresponding directory and heap contents would be as follows:'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹åº”çš„ç›®å½•å’Œå †å†…å®¹å¦‚ä¸‹ï¼š
- en: Directory
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE89]'
  id: totrans-400
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE89]'
- en: â†’
  id: totrans-401
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE90]'
  id: totrans-402
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE90]'
- en: '[PRE91]'
  id: totrans-403
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE91]'
- en: â†’Â `"Dr. Kumar"`
  id: totrans-404
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â `"Dr. Kumar"`
- en: 'Notice that this particular program puts nothing in the heap: according to
    our rules above, only structured data only go into the heap. Now assume our program
    also had a dataclass (Python) or datatype (Pyret) for `Office`s, with a professorâ€™s
    name and room number. Hereâ€™s another example showing a combination of basic and
    structured data:'
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œè¿™ä¸ªç‰¹å®šçš„ç¨‹åºæ²¡æœ‰åœ¨å †ä¸­æ”¾ç½®ä»»ä½•å†…å®¹ï¼šæ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„è§„åˆ™ï¼Œåªæœ‰ç»“æ„åŒ–æ•°æ®æ‰ä¼šè¿›å…¥å †ã€‚ç°åœ¨å‡è®¾æˆ‘ä»¬çš„ç¨‹åºä¹Ÿæœ‰ä¸€ä¸ªç”¨äº`Office`sçš„æ•°æ®ç±»ï¼ˆPythonï¼‰æˆ–æ•°æ®ç±»å‹ï¼ˆPyretï¼‰ï¼ŒåŒ…å«æ•™æˆçš„å§“åå’Œæˆ¿é—´å·ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå±•ç¤ºåŸºæœ¬æ•°æ®å’Œç»“æ„åŒ–æ•°æ®ç»„åˆçš„ç¤ºä¾‹ï¼š
- en: '[PRE92]'
  id: totrans-406
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: Directory
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE93]'
  id: totrans-408
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE93]'
- en: â†’
  id: totrans-409
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE94]'
  id: totrans-410
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE94]'
- en: '[PRE95]'
  id: totrans-411
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE95]'
- en: â†’Â `"Dr. Kumar"`
  id: totrans-412
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â `"Dr. Kumar"`
- en: '[PRE96]'
  id: totrans-413
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE96]'
- en: â†’Â 1005
  id: totrans-414
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1005
- en: '[PRE97]'
  id: totrans-415
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE97]'
- en: â†’Â 1006
  id: totrans-416
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1006
- en: Heap
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1005:Â `Office("Dr. Lakshmi", 311)`
  id: totrans-418
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1005:Â `Office("Dr. Lakshmi", 311)`
- en: 1006:Â `Office("Dr. Kumar", 314)`
  id: totrans-419
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1006:Â `Office("Dr. Kumar", 314)`
- en: Though specific language implementations can vary, this shows that it is sufficient
    to think of basic data as residing in the directory, not the heap. The whole point
    of structured data is that they have both their own identity and multiple components.
    The heap gives access to both concepts. Basic data canâ€™t be broken down (by definition).
    As such, there is nothing lost by putting them only in the directory.
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶å…·ä½“çš„è¯­è¨€å®ç°å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†è¿™è¡¨æ˜å°†åŸºæœ¬æ•°æ®è§†ä¸ºä½äºç›®å½•è€Œä¸æ˜¯å †ä¸­æ˜¯è¶³å¤Ÿçš„ã€‚ç»“æ„åŒ–æ•°æ®çš„æ ¸å¿ƒåœ¨äºå®ƒä»¬æ—¢æœ‰è‡ªå·±çš„èº«ä»½ï¼Œåˆæœ‰å¤šä¸ªç»„ä»¶ã€‚å †æä¾›äº†è®¿é—®è¿™ä¸¤ä¸ªæ¦‚å¿µçš„æ–¹å¼ã€‚åŸºæœ¬æ•°æ®ä¸èƒ½è¢«åˆ†è§£ï¼ˆæŒ‰å®šä¹‰ï¼‰ã€‚å› æ­¤ï¼Œå°†å®ƒä»¬ä»…æ”¾åœ¨ç›®å½•ä¸­å¹¶ä¸ä¼šä¸¢å¤±ä»»ä½•ä¸œè¥¿ã€‚
- en: But what about strings? Weâ€™ve referred to them as basic data until now, but
    donâ€™t they have â€œcomponentsâ€, namely the characters that make up the string? Yes,
    that is technically accurate. However, we are treating strings as basic data because
    we arenâ€™t using operations that modify that sequence of characters. This is a
    subtle point, one that usually comes up later in computer science. This book will
    leave strings in the directory, but if you are writing programs that modify the
    internal characters, put them in the heap instead.
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†å­—ç¬¦ä¸²æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬ä¸€ç›´å°†å®ƒä»¬ç§°ä¸ºåŸºæœ¬æ•°æ®ï¼Œä½†å®ƒä»¬ä¸æ˜¯æœ‰â€œç»„ä»¶â€ï¼Œå³æ„æˆå­—ç¬¦ä¸²çš„å­—ç¬¦å—ï¼Ÿæ˜¯çš„ï¼Œè¿™åœ¨æŠ€æœ¯ä¸Šæ¥è¯´æ˜¯å‡†ç¡®çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å°†å­—ç¬¦ä¸²è§†ä¸ºåŸºæœ¬æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ä¿®æ”¹è¿™äº›å­—ç¬¦åºåˆ—çš„æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªå¾®å¦™çš„é—®é¢˜ï¼Œé€šå¸¸åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ç¨åæ‰ä¼šå‡ºç°ã€‚è¿™æœ¬ä¹¦å°†å­—ç¬¦ä¸²ç•™åœ¨ç›®å½•ä¸­ï¼Œä½†å¦‚æœä½ æ­£åœ¨ç¼–å†™ä¿®æ”¹å†…éƒ¨å­—ç¬¦çš„ç¨‹åºï¼Œè¯·å°†å®ƒä»¬æ”¾åœ¨å †ä¸­ã€‚
- en: '12.1.1Â Example: Bank Accounts[ğŸ”—](#(part._eg-bank-acc) "Link to here")'
  id: totrans-422
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 12.1.1Â ç¤ºä¾‹ï¼šé“¶è¡Œè´¦æˆ·[ğŸ”—](#(part._eg-bank-acc) "é“¾æ¥è‡³æ­¤")
- en: 'Imagine that we want to represent bank accounts, where each account has a (unique)
    id number and a balance:'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦è¡¨ç¤ºé“¶è¡Œè´¦æˆ·ï¼Œæ¯ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€ä¸ªï¼ˆå”¯ä¸€çš„ï¼‰idå·å’Œä½™é¢ï¼š
- en: '| Python | Pyret |'
  id: totrans-424
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE98]'
  id: totrans-426
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: '|'
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE99]'
  id: totrans-428
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: '|'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Letâ€™s now make an account:'
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ç°åœ¨åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼š
- en: '| Python | Pyret |'
  id: totrans-431
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE100]'
  id: totrans-433
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: '|'
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE101]'
  id: totrans-435
  prefs: []
  type: TYPE_PRE
  zh: '[PRE101]'
- en: '|'
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Now letâ€™s say we learn that the account has just earned another 200\. We could
    always reflect the resulting account as follows:'
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å‡è®¾æˆ‘ä»¬å¾—çŸ¥è´¦æˆ·åˆšåˆšåˆèµšäº† 200 å…ƒã€‚æˆ‘ä»¬å¯ä»¥å§‹ç»ˆæŒ‰ç…§ä»¥ä¸‹æ–¹å¼åæ˜ ç»“æœè´¦æˆ·ï¼š
- en: '| Python |  |'
  id: totrans-438
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-439
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE102]'
  id: totrans-440
  prefs: []
  type: TYPE_PRE
  zh: '[PRE102]'
- en: '|'
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-442
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-443
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE103]'
  id: totrans-444
  prefs: []
  type: TYPE_PRE
  zh: '[PRE103]'
- en: '|'
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: However, this creates a new account; if we look at the current `balance` of
    `acct1`, by writing `acct1.balance`, it is still `500`. If this were our account,
    we would be quite sad!
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œè¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è´¦æˆ·ï¼›å¦‚æœæˆ‘ä»¬æŸ¥çœ‹ `acct1` çš„å½“å‰ `balance`ï¼Œé€šè¿‡å†™å…¥ `acct1.balance`ï¼Œå®ƒä»ç„¶æ˜¯ `500`ã€‚å¦‚æœè¿™æ˜¯æˆ‘ä»¬è‡ªå·±çš„è´¦æˆ·ï¼Œæˆ‘ä»¬å°†ä¼šéå¸¸æ²®ä¸§ï¼
- en: 'Rather, we want to change the balance in the existing account. This requires
    a programming feature that we have not encountered until now: data that can be
    changed. Such data are called mutable, and we explore them below. In contrast,
    until now we have worked with immutable data: data that cannot be altered.'
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: ç›¸åï¼Œæˆ‘ä»¬æƒ³è¦æ›´æ”¹ç°æœ‰è´¦æˆ·çš„ä½™é¢ã€‚è¿™éœ€è¦æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢å°šæœªé‡åˆ°çš„ä¸€ç§ç¼–ç¨‹åŠŸèƒ½ï¼šå¯å˜æ•°æ®ã€‚è¿™ç§æ•°æ®è¢«ç§°ä¸ºå¯å˜ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢æ¢è®¨å®ƒä»¬ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¤„ç†ä¸å¯å˜æ•°æ®ï¼šæ— æ³•æ›´æ”¹çš„æ•°æ®ã€‚
- en: 'First, we have to declare that the data can be changed. In Python, this is
    automatically true, always, so nothing changes. In Pyret, however, fields cannot
    be changedâ€”<wbr>they are immutableâ€”<wbr>by default. We have to explicitly say
    they can be changed:'
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å£°æ˜æ•°æ®å¯ä»¥è¢«æ›´æ”¹ã€‚åœ¨ Python ä¸­ï¼Œè¿™å§‹ç»ˆæ˜¯è‡ªåŠ¨æˆç«‹çš„ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚ç„¶è€Œï¼Œåœ¨ Pyret ä¸­ï¼Œå­—æ®µä¸èƒ½è¢«æ›´æ”¹â€”â€”é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å¯å˜çš„â€”â€”æˆ‘ä»¬å¿…é¡»æ˜ç¡®è¡¨ç¤ºå®ƒä»¬å¯ä»¥è¢«æ›´æ”¹ï¼š
- en: '| Python | Pyret |'
  id: totrans-449
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE104]'
  id: totrans-451
  prefs: []
  type: TYPE_PRE
  zh: '[PRE104]'
- en: '|'
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE105]'
  id: totrans-453
  prefs: []
  type: TYPE_PRE
  zh: '[PRE105]'
- en: '|'
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: This Pyret definition says that `id` cannot be changed, while `balance` can.
    This ensures that no programmer can accidentally change the bank account number.
    In Python, every programmer has to make sure they donâ€™t accidentally change it.
    (If we did want `id` to be mutable in Pyret, we would add a `ref` in front of
    it, too.)
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ª Pyret å®šä¹‰è¯´æ˜ `id` ä¸èƒ½è¢«æ›´æ”¹ï¼Œè€Œ `balance` å¯ä»¥ã€‚è¿™ç¡®ä¿äº†æ²¡æœ‰ç¨‹åºå‘˜ä¼šæ„å¤–æ›´æ”¹é“¶è¡Œè´¦æˆ·å·ç ã€‚åœ¨ Python ä¸­ï¼Œæ¯ä¸ªç¨‹åºå‘˜éƒ½å¿…é¡»ç¡®ä¿ä»–ä»¬ä¸ä¼šæ„å¤–æ›´æ”¹å®ƒã€‚ï¼ˆå¦‚æœæˆ‘ä»¬æƒ³åœ¨
    Pyret ä¸­ä½¿ `id` å¯å˜ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåœ¨å…¶å‰é¢æ·»åŠ ä¸€ä¸ª `ref`ã€‚ï¼‰
- en: 'With this definition, making accounts looks the same (unsurprisingly in Python,
    since nothing has changed):'
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨è¿™ä¸ªå®šä¹‰ï¼Œåˆ›å»ºè´¦æˆ·çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼ˆåœ¨ Python ä¸­ä¸å‡ºæ‰€æ–™ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•å˜åŒ–ï¼‰ï¼š
- en: '| Python | Pyret |'
  id: totrans-457
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE106]'
  id: totrans-459
  prefs: []
  type: TYPE_PRE
  zh: '[PRE106]'
- en: '|'
  id: totrans-460
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE107]'
  id: totrans-461
  prefs: []
  type: TYPE_PRE
  zh: '[PRE107]'
- en: '|'
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'When we view the account in Pyret, we see something special:'
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘ä»¬åœ¨ Pyret ä¸­æŸ¥çœ‹è´¦æˆ·æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€äº›ç‰¹åˆ«ä¹‹å¤„ï¼š
- en: '![](../Images/f5f80ba55f5bfb86404617db2b19812e.png)'
  id: totrans-464
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](../Images/f5f80ba55f5bfb86404617db2b19812e.png)'
- en: The yellow-and-black â€œcaution tapeâ€ indicator is a reminder that the value can
    change, so what is shown on screen may not be the current value.
  id: totrans-465
  prefs: []
  type: TYPE_NORMAL
  zh: é»„è‰²å’Œé»‘è‰²çš„â€œè­¦å‘Šå¸¦â€æŒ‡ç¤ºå™¨æ˜¯ä¸€ä¸ªæé†’ï¼Œè¡¨æ˜å€¼å¯ä»¥æ›´æ”¹ï¼Œå› æ­¤å±å¹•ä¸Šæ˜¾ç¤ºçš„å¯èƒ½æ˜¯å½“å‰å€¼ã€‚
- en: 'Accessing an immutable field in Pyret remains the same:'
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Pyret ä¸­è®¿é—®ä¸å¯å˜å­—æ®µçš„æ–¹å¼ä¿æŒä¸å˜ï¼š
- en: '| Python | Pyret |'
  id: totrans-467
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE108]'
  id: totrans-469
  prefs: []
  type: TYPE_PRE
  zh: '[PRE108]'
- en: '|'
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE109]'
  id: totrans-471
  prefs: []
  type: TYPE_PRE
  zh: '[PRE109]'
- en: '|'
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'However, accessing a mutable field looks different in Pyret:'
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œåœ¨ Pyret ä¸­è®¿é—®å¯å˜å­—æ®µçš„æ–¹å¼ä¸åŒï¼š
- en: '| Python | Pyret |'
  id: totrans-474
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE110]'
  id: totrans-476
  prefs: []
  type: TYPE_PRE
  zh: '[PRE110]'
- en: '|'
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE111]'
  id: totrans-478
  prefs: []
  type: TYPE_PRE
  zh: '[PRE111]'
- en: '|'
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: The `!` is there to remind that what you are getting is the current value of
    `balance`, and it may be different later. Python does not offer a similar syntactic
    warning, but then again, recall that every field is always mutable.
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: '`!` çš„å­˜åœ¨æ˜¯ä¸ºäº†æé†’ä½ å¾—åˆ°çš„æ˜¯ `balance` çš„å½“å‰å€¼ï¼Œå¹¶ä¸”å®ƒå¯èƒ½ç¨åä¼šä¸åŒã€‚Python ä¸æä¾›ç±»ä¼¼çš„è¯­æ³•è­¦å‘Šï¼Œä½†å†æ¬¡æé†’ï¼Œæ¯ä¸ªå­—æ®µå§‹ç»ˆæ˜¯å¯å˜çš„ã€‚'
- en: 'So now letâ€™s see how to change that account balance. For simplicity, letâ€™s
    first see how to set the account balance to zero. We use slightly different syntaxes
    for it in the two languages:'
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: å› æ­¤ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ›´æ”¹è´¦æˆ·ä½™é¢ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œè®©æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹å¦‚ä½•å°†è´¦æˆ·ä½™é¢è®¾ç½®ä¸ºé›¶ã€‚åœ¨ä¸¤ç§è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¨å¾®ä¸åŒçš„è¯­æ³•æ¥å®Œæˆå®ƒï¼š
- en: '| Python | Pyret |'
  id: totrans-482
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '| `acct1.balance = 0` | `acct1!{balance: 0}` |'
  id: totrans-483
  prefs: []
  type: TYPE_TB
  zh: '| `acct1.balance = 0` | `acct1!{balance: 0}` |'
- en: 'In Pyret, again, we use `!` in the syntax for changing the field: read it as
    â€œchange the value now!â€'
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Pyret ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡åœ¨è¯­æ³•ä¸­ä½¿ç”¨ `!` æ¥æ›´æ”¹å­—æ®µï¼šæŠŠå®ƒè¯»ä½œâ€œç°åœ¨æ›´æ”¹å€¼ï¼â€
- en: Do Now!
  id: totrans-485
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨èµ·æ¥ï¼
- en: ''
  id: totrans-486
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: You now know all the parts you need to figure out how to set `balance` to be
    `200` more than its previous value. Can you figure out how to write that?
  id: totrans-487
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä½ ç°åœ¨çŸ¥é“äº†æ‰€æœ‰éœ€è¦ç”¨æ¥å°† `balance` è®¾ç½®ä¸ºå…¶å…ˆå‰å€¼å¤š 200 å…ƒçš„ç»„æˆéƒ¨åˆ†ã€‚ä½ èƒ½æƒ³å‡ºå¦‚ä½•ç¼–å†™è¿™ä¸ªå—ï¼Ÿ
- en: 'Hereâ€™s how we combine the piecesâ€”<wbr>accessing the value and then setting
    it:'
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯æˆ‘ä»¬å°†è¿™äº›éƒ¨åˆ†ç»„åˆèµ·æ¥çš„æ–¹æ³•â€”â€”è®¿é—®å€¼ç„¶åè®¾ç½®å®ƒï¼š
- en: '| Python |  |'
  id: totrans-489
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  | `acct1.balance = acct1.balance + 200` |'
  id: totrans-490
  prefs: []
  type: TYPE_TB
  zh: '|  | `acct1.balance = acct1.balance + 200` |'
- en: '| Pyret |  |'
  id: totrans-491
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  | `acct1!{balance: acct1!balance + 200}` |'
  id: totrans-492
  prefs: []
  type: TYPE_TB
  zh: '|  | `acct1!{balance: acct1!balance + 200}` |'
- en: While Pyretâ€™s syntax is a little more onerous for changing the value of one
    field, it proves to be ligher-weight if we want to change multiple fields. In
    Python weâ€™d have to write `acct1.` for each of them, whereas in Pyret we need
    only the one `acct1!`. So there is a trade-off between the two syntaxes.
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶ Pyret çš„è¯­æ³•åœ¨æ›´æ”¹å•ä¸ªå­—æ®µçš„å€¼æ—¶ç¨å¾®æœ‰äº›ç¹çï¼Œä½†å¦‚æœæˆ‘ä»¬è¦æ›´æ”¹å¤šä¸ªå­—æ®µï¼Œå®ƒå°±æ˜¾å¾—æ›´è½»é‡çº§ã€‚åœ¨ Python ä¸­ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä¸ºæ¯ä¸ªå­—æ®µéƒ½å†™ `acct1.`ï¼Œè€Œåœ¨
    Pyret ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ª `acct1!`ã€‚å› æ­¤ï¼Œè¿™ä¸¤ç§è¯­æ³•ä¹‹é—´å­˜åœ¨æƒè¡¡ã€‚
- en: 'We hadnâ€™t written any tests above. Suppose we had: already we might notice
    something a bit odd. Say we had written'
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬åœ¨ä¸Šé¢æ²¡æœ‰ç¼–å†™ä»»ä½•æµ‹è¯•ã€‚å‡è®¾æˆ‘ä»¬å·²ç»ç¼–å†™äº†ï¼šæˆ‘ä»¬å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€äº›æœ‰ç‚¹å¥‡æ€ªçš„äº‹æƒ…ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœæˆ‘ä»¬å·²ç»ç¼–å†™äº†
- en: '| Python | Pyret |'
  id: totrans-495
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE112]'
  id: totrans-497
  prefs: []
  type: TYPE_PRE
  zh: '[PRE112]'
- en: '|'
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE113]'
  id: totrans-499
  prefs: []
  type: TYPE_PRE
  zh: '[PRE113]'
- en: '|'
  id: totrans-500
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: This would pass before we performed the update, but fails after the update is
    performed. In Python, tests are run when we call the testing functions, which
    we typically do after loading the full file (either by running them at the prompt
    or by putting our tests in a separate file).
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åœ¨æˆ‘ä»¬æ‰§è¡Œæ›´æ–°ä¹‹å‰ä¼šé€šè¿‡ï¼Œä½†åœ¨æ‰§è¡Œæ›´æ–°ä¹‹åä¼šå¤±è´¥ã€‚åœ¨ Python ä¸­ï¼Œæµ‹è¯•æ˜¯åœ¨æˆ‘ä»¬è°ƒç”¨æµ‹è¯•å‡½æ•°æ—¶è¿è¡Œçš„ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨åŠ è½½å®Œæ•´æ–‡ä»¶åè¿™æ ·åšï¼ˆé€šè¿‡åœ¨æç¤ºç¬¦ä¸­è¿è¡Œå®ƒä»¬æˆ–åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­æ”¾å…¥ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼‰ã€‚
- en: 'In Pyret, tests are run as if they were written at the very bottom of definitions.
    Therefore, even if the program looked like this in Pyret:'
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Pyret ä¸­ï¼Œæµ‹è¯•å°±åƒå®ƒä»¬è¢«ç¼–å†™åœ¨å®šä¹‰çš„åº•éƒ¨ä¸€æ ·è¿è¡Œã€‚å› æ­¤ï¼Œå³ä½¿ç¨‹åºåœ¨ Pyret ä¸­çœ‹èµ·æ¥åƒè¿™æ ·ï¼š
- en: '[PRE114]'
  id: totrans-503
  prefs: []
  type: TYPE_PRE
  zh: '[PRE114]'
- en: the test fails. Alternatively, we can write
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
  zh: æµ‹è¯•å¤±è´¥ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™
- en: '[PRE115]'
  id: totrans-505
  prefs: []
  type: TYPE_PRE
  zh: '[PRE115]'
- en: and it passes, but not if we comment out the update.
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¶ä¸”å®ƒé€šè¿‡äº†ï¼Œä½†å¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰æ›´æ–°æ“ä½œï¼Œåˆ™ä¸ä¼šé€šè¿‡ã€‚
- en: 'In both languages, then, we see a new phenomenon: tests that are only sometimes
    true. This phenomenon is called state. There is a â€œstateâ€ (a collection of values
    for the defined names) in which the balance is `500`, and another where it is
    `700`. This is not merely limited to testing! Testing is just a reflection of
    what is going on in the program as it runs. From now on, every programming instruction
    will run in some state, and its actions will depend on the other values in that
    state. If those values change, the same instructionâ€”<wbr>i.e., the same piece
    of program textâ€”<wbr>may produce different answers. This makes programming much
    harder, and we will have to get used to the subtleties that come along with it.'
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸¤ç§è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°ä¸€ç§æ–°çš„ç°è±¡ï¼šåªæœ‰æœ‰æ—¶æ‰ä¸ºçœŸçš„æµ‹è¯•ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸ºçŠ¶æ€ã€‚æœ‰ä¸€ä¸ªâ€œçŠ¶æ€â€ï¼ˆå®šä¹‰åç§°çš„å€¼çš„é›†åˆï¼‰å…¶ä¸­ä½™é¢æ˜¯ `500`ï¼Œå¦ä¸€ä¸ªæ˜¯
    `700`ã€‚è¿™ä¸ä»…ä»…å±€é™äºæµ‹è¯•ï¼æµ‹è¯•åªæ˜¯åæ˜ äº†ç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿçš„äº‹æƒ…ã€‚ä»ç°åœ¨å¼€å§‹ï¼Œæ¯ä¸ªç¼–ç¨‹æŒ‡ä»¤éƒ½å°†åœ¨ä¸€ä¸ªçŠ¶æ€ä¸­è¿è¡Œï¼Œå…¶è¡Œä¸ºå°†å–å†³äºè¯¥çŠ¶æ€ä¸­çš„å…¶ä»–å€¼ã€‚å¦‚æœè¿™äº›å€¼å‘ç”Ÿå˜åŒ–ï¼Œç›¸åŒçš„æŒ‡ä»¤â€”â€”å³ï¼Œç›¸åŒçš„ç¨‹åºæ–‡æœ¬â€”â€”å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ç­”æ¡ˆã€‚è¿™ä½¿å¾—ç¼–ç¨‹å˜å¾—æ›´åŠ å›°éš¾ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä¹ æƒ¯éšä¹‹è€Œæ¥çš„å¾®å¦™ä¹‹å¤„ã€‚
- en: 12.1.2Â Testing Functions that Mutate Structures[ğŸ”—](#(part._.Testing_.Functions_that_.Mutate_.Structures)
    "Link to here")
  id: totrans-508
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 12.1.2Â æµ‹è¯•ä¿®æ”¹ç»“æ„çš„å‡½æ•°[ğŸ”—](#(part._.Testing_.Functions_that_.Mutate_.Structures) "é“¾æ¥åˆ°æ­¤å¤„")
- en: 'Our example of adding funds to an account corresponds to making a deposit into
    a bank account. Letâ€™s turn our balance-updating expression into a function (named
    `deposit`) that takes the deposit amount as input. Then, weâ€™ll look at how to
    write tests for that function. First, the function definition:'
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æ·»åŠ èµ„é‡‘åˆ°è´¦æˆ·çš„ä¾‹å­ç›¸å½“äºåœ¨é“¶è¡Œè´¦æˆ·ä¸­å­˜é’±ã€‚è®©æˆ‘ä»¬å°†æ›´æ–°ä½™é¢çš„è¡¨è¾¾å¼è½¬æ¢æˆä¸€ä¸ªå‡½æ•°ï¼ˆå‘½åä¸º `deposit`ï¼‰ï¼Œè¯¥å‡½æ•°æ¥å—å­˜æ¬¾é‡‘é¢ä½œä¸ºè¾“å…¥ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•ä¸ºè¯¥å‡½æ•°ç¼–å†™æµ‹è¯•ã€‚é¦–å…ˆï¼Œå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š
- en: '| Python |  |'
  id: totrans-510
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-511
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE116]'
  id: totrans-512
  prefs: []
  type: TYPE_PRE
  zh: '[PRE116]'
- en: '|'
  id: totrans-513
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-514
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-515
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE117]'
  id: totrans-516
  prefs: []
  type: TYPE_PRE
  zh: '[PRE117]'
- en: '|'
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: How do we test this?
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¦‚ä½•æµ‹è¯•è¿™ä¸ªï¼Ÿ
- en: In Python, this function does not return anything. In Pyret, the update operation
    does return the value being updated, but in a larger function we canâ€™t always
    assume that it will be the value returned. Therefore, we have to set up our test
    to assume otherwise.
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Python ä¸­ï¼Œè¿™ä¸ªå‡½æ•°ä¸è¿”å›ä»»ä½•å†…å®¹ã€‚åœ¨ Pyret ä¸­ï¼Œæ›´æ–°æ“ä½œç¡®å®è¿”å›è¢«æ›´æ–°çš„å€¼ï¼Œä½†åœ¨æ›´å¤§çš„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½æ€»æ˜¯å‡è®¾å®ƒå°†è¿”å›è¿™ä¸ªå€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è®¾ç½®æˆ‘ä»¬çš„æµ‹è¯•ï¼Œå‡è®¾æƒ…å†µå¹¶éå¦‚æ­¤ã€‚
- en: 'In general, tests for functions that contain mutation need to have three to
    four parts:'
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: é€šå¸¸ï¼Œå¯¹åŒ…å«ä¿®æ”¹çš„å‡½æ•°çš„æµ‹è¯•éœ€è¦åŒ…å«ä¸‰åˆ°å››ä¸ªéƒ¨åˆ†ï¼š
- en: 'Setup: set up the necessary values to provide the function.'
  id: totrans-521
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è®¾ç½®ï¼šè®¾ç½®å¿…è¦çš„å€¼ä»¥æä¾›ç»™å‡½æ•°ã€‚
- en: 'Call: call the function.'
  id: totrans-522
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è°ƒç”¨ï¼šè°ƒç”¨å‡½æ•°ã€‚
- en: 'Check: check that the function had the desired behavior.'
  id: totrans-523
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ£€æŸ¥ï¼šæ£€æŸ¥å‡½æ•°æ˜¯å¦å…·æœ‰é¢„æœŸçš„è¡Œä¸ºã€‚
- en: 'Teardown: restore data to their expected state.'
  id: totrans-524
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ‹†å¸ï¼šå°†æ•°æ®æ¢å¤åˆ°é¢„æœŸçŠ¶æ€ã€‚
- en: '| Python | Pyret |'
  id: totrans-525
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-526
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE118]'
  id: totrans-527
  prefs: []
  type: TYPE_PRE
  zh: '[PRE118]'
- en: '|'
  id: totrans-528
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE119]'
  id: totrans-529
  prefs: []
  type: TYPE_PRE
  zh: '[PRE119]'
- en: '|'
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: In this case we donâ€™t need to perform a Teardown step because we created data
    purely for testing the function. But if, for instance, we had run the test over
    a dataset whose values matter, we would need to restore the changes.
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰§è¡Œæ‹†å¸æ­¥éª¤ï¼Œå› ä¸ºæˆ‘ä»¬åªä¸ºæµ‹è¯•å‡½æ•°åˆ›å»ºäº†æ•°æ®ã€‚ä½†å¦‚æœï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªå€¼å¾ˆé‡è¦çš„æ•°æ®é›†ä¸Šè¿è¡Œäº†æµ‹è¯•ï¼Œæˆ‘ä»¬å°±éœ€è¦æ¢å¤è¿™äº›æ›´æ”¹ã€‚
- en: Similarly, the Setup phase needs to make sure that all data have the right values.
    Until now, once created, data did not change. But now, data may have been changed
    by some other mutations, and this may cause tests to fail. Therefore, the Setup
    phase requires not only creating necessary data but also setting the values of
    previously-created data to be what the test expects. (Again, note that in Python
    it is difficult to know which fields might have been changed, whereas in Pyret,
    we only have to reset the value of mutable fields.)
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
  zh: åŒæ ·ï¼Œè®¾ç½®é˜¶æ®µéœ€è¦ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½æœ‰æ­£ç¡®çš„å€¼ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€æ—¦åˆ›å»ºï¼Œæ•°æ®å°±ä¸ä¼šæ”¹å˜ã€‚ä½†ç°åœ¨ï¼Œæ•°æ®å¯èƒ½å·²ç»è¢«å…¶ä»–çªå˜æ‰€æ›´æ”¹ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æµ‹è¯•å¤±è´¥ã€‚å› æ­¤ï¼Œè®¾ç½®é˜¶æ®µä¸ä»…éœ€è¦åˆ›å»ºå¿…è¦çš„æ•°æ®ï¼Œè¿˜éœ€è¦å°†å…ˆå‰åˆ›å»ºçš„æ•°æ®çš„å€¼è®¾ç½®ä¸ºæµ‹è¯•æ‰€æœŸæœ›çš„ã€‚
    ï¼ˆå†æ¬¡æ³¨æ„ï¼Œåœ¨Pythonä¸­å¾ˆéš¾çŸ¥é“å“ªäº›å­—æ®µå¯èƒ½å·²ç»è¢«æ›´æ”¹ï¼Œè€Œåœ¨Pyretä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦é‡ç½®å¯å˜å­—æ®µçš„å€¼ã€‚ï¼‰
- en: Exercise
  id: totrans-533
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç»ƒä¹ 
- en: ''
  id: totrans-534
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Write tests for the following function that adds interest to an account balance:'
  id: totrans-535
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä¸ºä»¥ä¸‹æ·»åŠ åˆ©æ¯çš„è´¦æˆ·ä½™é¢å‡½æ•°ç¼–å†™æµ‹è¯•ï¼š
- en: ''
  id: totrans-536
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Python |  |'
  id: totrans-537
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-538
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE120]'
  id: totrans-539
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE120]'
- en: ''
  id: totrans-540
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-541
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-542
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-543
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE121]'
  id: totrans-544
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE121]'
- en: ''
  id: totrans-545
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-546
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: 12.1.3Â Aliasing[ğŸ”—](#(part._mult-bank-acct) "Link to here")
  id: totrans-547
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 12.1.3Â åˆ«å[ğŸ”—](#(part._mult-bank-acct) "é“¾æ¥åˆ°è¿™é‡Œ")
- en: 'Now letâ€™s suppose our bank allows accounts to be shared by multiple customers.
    We should thus separate information about customers from that of the account:'
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å‡è®¾æˆ‘ä»¬çš„é“¶è¡Œå…è®¸å¤šä¸ªå®¢æˆ·å…±äº«è´¦æˆ·ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°†å®¢æˆ·ä¿¡æ¯ä¸è´¦æˆ·ä¿¡æ¯åˆ†å¼€ï¼š
- en: '| Python | Pyret |'
  id: totrans-549
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE122]'
  id: totrans-551
  prefs: []
  type: TYPE_PRE
  zh: '[PRE122]'
- en: '|'
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE123]'
  id: totrans-553
  prefs: []
  type: TYPE_PRE
  zh: '[PRE123]'
- en: '|'
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Specifically, suppose we have two accounts (`acct1` and `acct2`), where `acct1`
    is owned jointly by Elena and Jorge:'
  id: totrans-555
  prefs: []
  type: TYPE_NORMAL
  zh: å…·ä½“æ¥è¯´ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªè´¦æˆ·ï¼ˆ`acct1`å’Œ`acct2`ï¼‰ï¼Œå…¶ä¸­`acct1`ç”±Elenaå’ŒJorgeå…±åŒæ‹¥æœ‰ï¼š
- en: '| Python | Pyret |'
  id: totrans-556
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE124]'
  id: totrans-558
  prefs: []
  type: TYPE_PRE
  zh: '[PRE124]'
- en: '|'
  id: totrans-559
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE125]'
  id: totrans-560
  prefs: []
  type: TYPE_PRE
  zh: '[PRE125]'
- en: '|'
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Now letâ€™s say Elena earns an additional `150`. We want to update the account
    to reflect this. How might we do it? First we have to access the account itself:
    `elena.acct` (in both languages). Then we would update it using the syntax above:'
  id: totrans-562
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å‡è®¾Elenaé¢å¤–èµšå–äº†`150`ã€‚æˆ‘ä»¬æƒ³è¦æ›´æ–°è´¦æˆ·ä»¥åæ˜ è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•åšï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»è®¿é—®è´¦æˆ·æœ¬èº«ï¼š`elena.acct`ï¼ˆåœ¨ä¸¤ç§è¯­è¨€ä¸­ï¼‰ã€‚ç„¶åæˆ‘ä»¬ä¼šä½¿ç”¨ä¸Šé¢çš„è¯­æ³•æ¥æ›´æ–°å®ƒï¼š
- en: '| Python | Pyret |'
  id: totrans-563
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE126]'
  id: totrans-565
  prefs: []
  type: TYPE_PRE
  zh: '[PRE126]'
- en: '|'
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE127]'
  id: totrans-567
  prefs: []
  type: TYPE_PRE
  zh: '[PRE127]'
- en: '|'
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Sure enough, Elenaâ€™s account will now have the value of `850` (the original
    `500`, the bonus of `200`, and now the extra `150`):'
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
  zh: æœç„¶ï¼ŒElenaçš„è´¦æˆ·ç°åœ¨å°†å…·æœ‰`850`çš„å€¼ï¼ˆåŸå§‹çš„`500`ï¼Œå¥–é‡‘`200`ï¼Œç°åœ¨é¢å¤–çš„`150`ï¼‰ï¼š
- en: '| Python |  |'
  id: totrans-570
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-571
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE128]'
  id: totrans-572
  prefs: []
  type: TYPE_PRE
  zh: '[PRE128]'
- en: '|'
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-574
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-575
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE129]'
  id: totrans-576
  prefs: []
  type: TYPE_PRE
  zh: '[PRE129]'
- en: '|'
  id: totrans-577
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Observe that in Pyret we use `.` to get the account but `!` to get the balance:
    a reminder that Elenaâ€™s account will never change (the way we have defined the
    data structure), but that accountâ€™s balance may and, indeed, does. Between the
    designs of Python and Pyret, thereâ€™s a trade-off between convenience and precision.'
  id: totrans-578
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œåœ¨Pyretä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`.`æ¥è·å–è´¦æˆ·ï¼Œä½†ä½¿ç”¨`!`æ¥è·å–ä½™é¢ï¼šè¿™æ˜¯ä¸€ä¸ªæé†’ï¼ŒElenaçš„è´¦æˆ·æ°¸è¿œä¸ä¼šæ”¹å˜ï¼ˆæŒ‰ç…§æˆ‘ä»¬å®šä¹‰çš„æ•°æ®ç»“æ„ï¼‰ï¼Œä½†è´¦æˆ·çš„ä½™é¢å¯èƒ½ä¼šæ”¹å˜ï¼Œäº‹å®ä¸Šç¡®å®å¦‚æ­¤ã€‚åœ¨Pythonå’ŒPyretçš„è®¾è®¡ä¹‹é—´ï¼Œå­˜åœ¨ç€ä¾¿åˆ©æ€§å’Œç²¾ç¡®æ€§ä¹‹é—´çš„æƒè¡¡ã€‚
- en: 'The key question now is: what is Jorgeâ€™s balance? Put differently, will this
    test pass or fail?'
  id: totrans-579
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨çš„å…³é”®é—®é¢˜æ˜¯ï¼šè±ªå°”èµ«çš„ä½™é¢æ˜¯å¤šå°‘ï¼Ÿæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæµ‹è¯•ä¼šé€šè¿‡è¿˜æ˜¯å¤±è´¥ï¼Ÿ
- en: '| Python |  |'
  id: totrans-580
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-581
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE130]'
  id: totrans-582
  prefs: []
  type: TYPE_PRE
  zh: '[PRE130]'
- en: '|'
  id: totrans-583
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-584
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-585
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE131]'
  id: totrans-586
  prefs: []
  type: TYPE_PRE
  zh: '[PRE131]'
- en: '|'
  id: totrans-587
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Or even more simply: what is the value of this program?'
  id: totrans-588
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ–è€…æ›´ç®€å•åœ°è¯´ï¼šè¿™ä¸ªç¨‹åºçš„ä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿ
- en: '| Python | Pyret |'
  id: totrans-589
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-590
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE132]'
  id: totrans-591
  prefs: []
  type: TYPE_PRE
  zh: '[PRE132]'
- en: '|'
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE133]'
  id: totrans-593
  prefs: []
  type: TYPE_PRE
  zh: '[PRE133]'
- en: '|'
  id: totrans-594
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'There are two very reasonable answers here:'
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæœ‰ä¸¤ä¸ªéå¸¸åˆç†çš„ç­”æ¡ˆï¼š
- en: Going by our prose, Jorgeâ€™s account should also have `850`, because thatâ€™s what
    it means to â€œshareâ€ an account.
  id: totrans-596
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ ¹æ®æˆ‘ä»¬çš„æ–‡å­—æè¿°ï¼Œè±ªå°”èµ«çš„è´¦æˆ·ä¹Ÿåº”è¯¥æœ‰`850`ï¼Œå› ä¸ºè¿™å°±æ˜¯â€œå…±äº«â€è´¦æˆ·çš„å«ä¹‰ã€‚
- en: Going by the visible code, Jorgeâ€™s account should still have `700`, because
    the update was made through `elena.acct`, not `jorge.acct`.
  id: totrans-597
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ ¹æ®å¯è§çš„ä»£ç ï¼Œè±ªå°”èµ«çš„è´¦æˆ·åº”è¯¥ä»ç„¶æ˜¯`700`ï¼Œå› ä¸ºæ›´æ–°æ˜¯é€šè¿‡`elena.acct`è€Œä¸æ˜¯`jorge.acct`è¿›è¡Œçš„ã€‚
- en: Do Now!
  id: totrans-598
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: Do Now!
- en: ''
  id: totrans-599
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Run the above code and see what you get.
  id: totrans-600
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œçœ‹çœ‹ä½ å¾—åˆ°ä»€ä¹ˆã€‚
- en: 'What you find is that the above test passes: Jorgeâ€™s account also has `850`.
    We say that `elena.acct` and `jorge.acct` are aliases: they are two different
    â€œnamesâ€ for the exact same datum.'
  id: totrans-601
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ ä¼šå‘ç°ä¸Šè¿°æµ‹è¯•é€šè¿‡äº†ï¼šè±ªå°”èµ«çš„è´¦æˆ·ä¹Ÿæœ‰`850`ã€‚æˆ‘ä»¬è¯´`elena.acct`å’Œ`jorge.acct`æ˜¯åˆ«åï¼šå®ƒä»¬æ˜¯åŒä¸€æ•°æ®çš„ä¸¤ä¸ªä¸åŒçš„â€œåç§°â€ã€‚
- en: 'This is not the first time we have had shared data. However, until now, it
    hasnâ€™t mattered that the data were aliased. But now that we have mutation, aliases
    matter: the balance in `jorge.acct` has changed even though we never made an explicit
    change using that name. It is as if `elena.acct` exhibited spooky action at a
    distance.'
  id: totrans-602
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡é‡åˆ°å…±äº«æ•°æ®ã€‚ç„¶è€Œï¼Œç›´åˆ°ç°åœ¨ï¼Œæ•°æ®è¢«åˆ«ååŒ–å¹¶æ²¡æœ‰å…³ç³»ã€‚ä½†ç°åœ¨æˆ‘ä»¬æœ‰çªå˜ï¼Œåˆ«åå¾ˆé‡è¦ï¼š`jorge.acct`ä¸­çš„ä½™é¢å·²ç»æ”¹å˜ï¼Œå°½ç®¡æˆ‘ä»¬ä»æœªä½¿ç”¨è¯¥åç§°è¿›è¡Œè¿‡æ˜ç¡®æ›´æ”¹ã€‚è¿™å°±åƒ`elena.acct`åœ¨è·ç¦»ä¸Šå±•ç¤ºäº†è¶…è·ä½œç”¨ã€‚
- en: Again, there is a linguistic difference here. Because all fields are mutable
    in Python, you have to always be on the alert for this. Because only `ref` fields
    are mutable in Pyret, you can be sure that fields accessed through `.` will never
    change in value over time or even if there are aliases, but those accessed through
    `!` might change over time (and via aliases).
  id: totrans-603
  prefs: []
  type: TYPE_NORMAL
  zh: å†æ¬¡å¼ºè°ƒï¼Œè¿™é‡Œä¹Ÿå­˜åœ¨è¯­è¨€ä¸Šçš„å·®å¼‚ã€‚å› ä¸ºåœ¨ Python ä¸­æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯å˜çš„ï¼Œä½ å¿…é¡»å§‹ç»ˆä¿æŒè­¦æƒ•ã€‚å› ä¸ºåœ¨ Pyret ä¸­åªæœ‰ `ref` å­—æ®µæ˜¯å¯å˜çš„ï¼Œä½ å¯ä»¥ç¡®ä¿¡é€šè¿‡
    `.` è®¿é—®çš„å­—æ®µåœ¨æ—¶é—´ä¸Šæ°¸è¿œä¸ä¼šæ”¹å˜å€¼ï¼Œå³ä½¿æœ‰åˆ«åä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½†é€šè¿‡ `!` è®¿é—®çš„å­—æ®µå¯èƒ½ä¼šéšæ—¶é—´æ”¹å˜ï¼ˆä»¥åŠé€šè¿‡åˆ«åï¼‰ã€‚
- en: 12.1.4Â Structure Mutation and the Directory[ğŸ”—](#(part._structure-mut-dir) "Link
    to here")
  id: totrans-604
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 12.1.4 ç»“æ„ä¿®æ”¹å’Œç›®å½•[ğŸ”—](#(part._structure-mut-dir) "é“¾æ¥åˆ°è¿™é‡Œ")
- en: 'Now that we have the ability to mutate the contents of data, we will need to
    show and then revise our notion of directories. The directories are essentially
    the same between Pyret and Python, with one exception: we have different naming
    conventions in the two languages. For instance, we write `Account(8404, 500)`
    in Python versus `account(8404, 500)` in Pyret. It would be annoying to write
    every one of these twice, with the only difference being the capitalization. Therefore,
    where the only difference is the naming, we will ignore this difference and show
    only one version (in this case, the Python version); you should assume that the
    exact same thing is true for Pyret, other than the capitalization.'
  id: totrans-605
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¿®æ”¹æ•°æ®å†…å®¹çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬éœ€è¦å±•ç¤ºå¹¶ä¿®è®¢æˆ‘ä»¬å¯¹ç›®å½•çš„ç†è§£ã€‚åœ¨ Pyret å’Œ Python ä¸­ï¼Œç›®å½•åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ï¼Œåªæœ‰ä¸€ä¸ªä¾‹å¤–ï¼šä¸¤ç§è¯­è¨€æœ‰ä¸åŒçš„å‘½åçº¦å®šã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨
    Python ä¸­å†™ `Account(8404, 500)`ï¼Œè€Œåœ¨ Pyret ä¸­å†™ `account(8404, 500)`ã€‚æ¯æ¬¡éƒ½å†™ä¸¤æ¬¡ï¼Œå”¯ä¸€çš„åŒºåˆ«åªæ˜¯å¤§å°å†™ï¼Œè¿™ä¼šè®©äººæ„Ÿåˆ°çƒ¦æ¼ã€‚å› æ­¤ï¼Œå½“å”¯ä¸€çš„åŒºåˆ«æ˜¯å‘½åæ—¶ï¼Œæˆ‘ä»¬å°†å¿½ç•¥è¿™ç§å·®å¼‚ï¼Œåªå±•ç¤ºä¸€ä¸ªç‰ˆæœ¬ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯
    Python ç‰ˆæœ¬ï¼‰ï¼›ä½ åº”è¯¥å‡è®¾ Pyret ä¸­ä¹Ÿæ˜¯è¿™æ ·ï¼Œé™¤äº†å¤§å°å†™ä¹‹å¤–ã€‚
- en: 'As a reminder, here are our initial definitions once again:'
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œä¸ºæé†’ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬æœ€åˆçš„å®šä¹‰å†æ¬¡ï¼š
- en: '[PRE134]'
  id: totrans-607
  prefs: []
  type: TYPE_PRE
  zh: '[PRE134]'
- en: Do Now!
  id: totrans-608
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ï¼
- en: ''
  id: totrans-609
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Review the following proposal for the directory contents after running the initial
    definitions. Is this what you expect to see?
  id: totrans-610
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åœ¨è¿è¡Œåˆå§‹å®šä¹‰åï¼Œå›é¡¾ä»¥ä¸‹ç›®å½•å†…å®¹çš„ææ¡ˆã€‚è¿™æ˜¯ä½ é¢„æœŸçš„ç»“æœå—ï¼Ÿ
- en: ''
  id: totrans-611
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: Directory
  id: totrans-612
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: ''
  id: totrans-613
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE135]'
  id: totrans-614
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE135]'
- en: ''
  id: totrans-615
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-616
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-617
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: â†’
  id: totrans-618
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: ''
  id: totrans-619
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-620
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-621
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE136]'
  id: totrans-622
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE136]'
- en: ''
  id: totrans-623
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-624
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE137]'
  id: totrans-625
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE137]'
- en: ''
  id: totrans-626
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-627
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-628
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: â†’
  id: totrans-629
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: ''
  id: totrans-630
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-631
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-632
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE138]'
  id: totrans-633
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE138]'
- en: ''
  id: totrans-634
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-635
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE139]'
  id: totrans-636
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE139]'
- en: ''
  id: totrans-637
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-638
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-639
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: â†’
  id: totrans-640
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: ''
  id: totrans-641
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-642
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-643
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE140]'
  id: totrans-644
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE140]'
- en: ''
  id: totrans-645
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-646
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE141]'
  id: totrans-647
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE141]'
- en: ''
  id: totrans-648
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-649
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-650
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: â†’
  id: totrans-651
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: ''
  id: totrans-652
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-653
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-654
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE142]'
  id: totrans-655
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE142]'
- en: 'Thereâ€™s a problem with this version, namely the use of `acct1` in the values
    associated with `elena` and `jorge`. Remember, the values in the directory canâ€™t
    refer to names in the directory: both Pyret and Python replace names with their
    values when evaluating expressions. Here is the corresponding version of the directory
    that uses the value of `acct1`:'
  id: totrans-656
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå³ä¸ `elena` å’Œ `jorge` ç›¸å…³çš„å€¼ä¸­ä½¿ç”¨äº† `acct1`ã€‚è®°ä½ï¼Œç›®å½•ä¸­çš„å€¼ä¸èƒ½å¼•ç”¨ç›®å½•ä¸­çš„åç§°ï¼šPyret å’Œ Python
    åœ¨è¯„ä¼°è¡¨è¾¾å¼æ—¶éƒ½ä¼šç”¨å®ƒä»¬çš„å€¼æ›¿æ¢åç§°ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ `acct1` å€¼çš„ç›®å½•çš„å¯¹åº”ç‰ˆæœ¬ï¼š
- en: Directory
  id: totrans-657
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE143]'
  id: totrans-658
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE143]'
- en: â†’
  id: totrans-659
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE144]'
  id: totrans-660
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE144]'
- en: '[PRE145]'
  id: totrans-661
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE145]'
- en: â†’
  id: totrans-662
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE146]'
  id: totrans-663
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE146]'
- en: '[PRE147]'
  id: totrans-664
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE147]'
- en: â†’
  id: totrans-665
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE148]'
  id: totrans-666
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE148]'
- en: '[PRE149]'
  id: totrans-667
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE149]'
- en: â†’
  id: totrans-668
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE150]'
  id: totrans-669
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE150]'
- en: Observe that this is also what you would see if you were to evaluate the corresponding
    variable names.
  id: totrans-670
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œå¦‚æœä½ è¯„ä¼°ç›¸åº”çš„å˜é‡åç§°ï¼Œä½ ä¹Ÿä¼šçœ‹åˆ°è¿™ä¸ªç»“æœã€‚
- en: 'Now, letâ€™s add funds to Elenaâ€™s account:'
  id: totrans-671
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»™ Elena çš„è´¦æˆ·å¢åŠ èµ„é‡‘ï¼š
- en: '| Python |  |'
  id: totrans-672
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-673
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE151]'
  id: totrans-674
  prefs: []
  type: TYPE_PRE
  zh: '[PRE151]'
- en: '|'
  id: totrans-675
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-676
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-677
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE152]'
  id: totrans-678
  prefs: []
  type: TYPE_PRE
  zh: '[PRE152]'
- en: '|'
  id: totrans-679
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: Do Now!
  id: totrans-680
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ï¼
- en: ''
  id: totrans-681
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Show how the directory changes if you run the above code.
  id: totrans-682
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å±•ç¤ºè¿è¡Œä¸Šè¿°ä»£ç åç›®å½•çš„å˜åŒ–ã€‚
- en: If we follow the code precisely, we might expect the following directory, in
    which only the balance in Elenaâ€™s version of the account changes.
  id: totrans-683
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬ä¸¥æ ¼æŒ‰ç…§ä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœŸæœ›ä»¥ä¸‹ç›®å½•ï¼Œå…¶ä¸­åªæœ‰ Elena ç‰ˆæœ¬çš„è´¦æˆ·ä½™é¢å‘ç”Ÿå˜åŒ–ã€‚
- en: Directory
  id: totrans-684
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE153]'
  id: totrans-685
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE153]'
- en: â†’
  id: totrans-686
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE154]'
  id: totrans-687
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE154]'
- en: '[PRE155]'
  id: totrans-688
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE155]'
- en: â†’
  id: totrans-689
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE156]'
  id: totrans-690
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE156]'
- en: '[PRE157]'
  id: totrans-691
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE157]'
- en: â†’
  id: totrans-692
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE158]'
  id: totrans-693
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE158]'
- en: '[PRE159]'
  id: totrans-694
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE159]'
- en: â†’
  id: totrans-695
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE160]'
  id: totrans-696
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE160]'
- en: We know from running the code, however, that the account is aliased, so that
    the balances accessible from each of `acct`, `elena.acct`, and `jorge.acct` all
    reflect the update. This suggests that the actual directory should look something
    like
  id: totrans-697
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œä»è¿è¡Œä»£ç æˆ‘ä»¬çŸ¥é“è´¦æˆ·æ˜¯åˆ«åçš„ï¼Œæ‰€ä»¥ä» `acct`ã€`elena.acct` å’Œ `jorge.acct` ä¸­å¯è®¿é—®çš„ä½™é¢éƒ½åæ˜ äº†æ›´æ–°ã€‚è¿™è¡¨æ˜å®é™…çš„ç›®å½•åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·
- en: Directory
  id: totrans-698
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE161]'
  id: totrans-699
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE161]'
- en: â†’
  id: totrans-700
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE162]'
  id: totrans-701
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE162]'
- en: '[PRE163]'
  id: totrans-702
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE163]'
- en: â†’
  id: totrans-703
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE164]'
  id: totrans-704
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE164]'
- en: '[PRE165]'
  id: totrans-705
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE165]'
- en: â†’
  id: totrans-706
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE166]'
  id: totrans-707
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE166]'
- en: '[PRE167]'
  id: totrans-708
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE167]'
- en: â†’
  id: totrans-709
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE168]'
  id: totrans-710
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE168]'
- en: But this is also weird. The directory represents the information that Pyret
    or Python maintain about your defined names and their values. What in the directory
    indicates that those three balances should change, but not the balance of `acct2`)?
    Put differently, what reflects the aliasing? Nothing!
  id: totrans-711
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†è¿™ä¹Ÿå¾ˆå¥‡æ€ªã€‚ç›®å½•ä»£è¡¨äº† Pyret æˆ– Python ç»´æŠ¤çš„å…³äºä½ å®šä¹‰çš„åç§°åŠå…¶å€¼çš„ä¿¡æ¯ã€‚ç›®å½•ä¸­æœ‰ä»€ä¹ˆè¡¨æ˜è¿™ä¸‰ä¸ªä½™é¢åº”è¯¥æ”¹å˜ï¼Œä½† `acct2` çš„ä½™é¢ä¸åº”è¯¥æ”¹å˜ï¼Ÿæ¢å¥è¯è¯´ï¼Œä»€ä¹ˆåæ˜ äº†åˆ«åï¼Ÿä»€ä¹ˆéƒ½æ²¡æœ‰ï¼
- en: The directory as we have used it up until now works fine for programs without
    mutation. But once we have both mutation and aliasing, this simple idea of mapping
    names to values breaks down because it doesnâ€™t capture the aliases. We need a
    refined representation of the connections between names and values that does capture
    aliasing.
  id: totrans-712
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è‡³ä»Šä½¿ç”¨çš„ç›®å½•å¯¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„ç¨‹åºæ¥è¯´å·¥ä½œå¾—å¾ˆå¥½ã€‚ä½†ä¸€æ—¦æˆ‘ä»¬æœ‰äº†å˜å¼‚å’Œåˆ«åï¼Œè¿™ç§å°†åç§°æ˜ å°„åˆ°å€¼çš„ç®€å•æƒ³æ³•å°±ä¼šå´©æºƒï¼Œå› ä¸ºå®ƒæ²¡æœ‰æ•æ‰åˆ°åˆ«åã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç²¾ç»†çš„è¡¨ç¤ºï¼Œå®ƒèƒ½å¤Ÿæ•æ‰åˆ°åç§°å’Œå€¼ä¹‹é—´çš„è¿æ¥ï¼ŒåŒ…æ‹¬åˆ«åã€‚
- en: 12.1.4.1Â Introducing the Heap[ğŸ”—](#(part._heap-intro) "Link to here")
  id: totrans-713
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 12.1.4.1Â ä»‹ç»å †[ğŸ”—](#(part._heap-intro) "é“¾æ¥åˆ°æ­¤å¤„")
- en: Our original presentation of the directory reflected the aliases that referred
    to a single `Account` through repeated use of the name `acct1`. We only lost that
    sharing when we replaced `acct1` with itâ€™s value while setting up the data for
    Elena and Jorge. The rule that names canâ€™t appear in the values is still important,
    especially in the presence of mutation (weâ€™ll return to this later in [Mutating
    Variables in Memory](mutating-variables.html#%28part._mutating-vars-memory%29)).
    But the idea of having a single term that can be reused to reflect sharing is
    a good one. Indeed, it reflects what happens inside your computer.
  id: totrans-714
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æœ€åˆå¯¹ç›®å½•çš„æè¿°åæ˜ äº†é€šè¿‡é‡å¤ä½¿ç”¨åç§°`acct1`æ¥å¼•ç”¨å•ä¸ª`Account`çš„åˆ«åã€‚å½“æˆ‘ä»¬è®¾ç½®Elenaå’ŒJorgeçš„æ•°æ®æ—¶ï¼Œç”¨å…¶å€¼æ›¿æ¢`acct1`ï¼Œæˆ‘ä»¬æ‰å¤±å»äº†è¿™ç§å…±äº«ã€‚åç§°ä¸èƒ½å‡ºç°åœ¨å€¼ä¸­çš„è§„åˆ™ä»ç„¶å¾ˆé‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å­˜åœ¨å˜å¼‚çš„æƒ…å†µä¸‹ï¼ˆæˆ‘ä»¬å°†åœ¨[å†…å­˜ä¸­çš„å˜å¼‚å˜é‡](mutating-variables.html#%28part._mutating-vars-memory%29)ä¸­ç¨åå›åˆ°è¿™ä¸€ç‚¹ï¼‰ã€‚ä½†æœ‰ä¸€ä¸ªå•ä¸€æœ¯è¯­å¯ä»¥é‡å¤ä½¿ç”¨æ¥åæ˜ å…±äº«çš„æƒ³æ³•æ˜¯å¥½çš„ã€‚å®é™…ä¸Šï¼Œå®ƒåæ˜ äº†ä½ è®¡ç®—æœºå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚
- en: 'Every time you use a constructor to create data, your programming environment
    stores it in the memory of your computer. Memory consists of a (large) number
    of slots. Your newly-created datum goes into one of these slots. Each slot is
    labeled with an address. Just as a street address refers to a specific building,
    a memory address refers to a specific slot where a datum is stored. Memory slots
    are physical entities, not conceptual ones. A computer with a 500GB hard drive
    has about 500 billion slots in which it can store data. Not all of that memory
    is available to your programming environment: your Web browser, applications,
    operating system, and so on all get stored in the memory. Your programming environment
    does get a portion of memory to use for storing its data. That portion is called
    the heap.'
  id: totrans-715
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯æ¬¡ä½ ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºæ•°æ®æ—¶ï¼Œä½ çš„ç¼–ç¨‹ç¯å¢ƒéƒ½ä¼šå°†å…¶å­˜å‚¨åœ¨ä½ çš„è®¡ç®—æœºå†…å­˜ä¸­ã€‚å†…å­˜ç”±è®¸å¤šæ§½ä½ç»„æˆã€‚ä½ æ–°åˆ›å»ºçš„æ•°æ®å°†è¿›å…¥è¿™äº›æ§½ä½ä¸­çš„ä¸€ä¸ªã€‚æ¯ä¸ªæ§½ä½éƒ½æœ‰ä¸€ä¸ªåœ°å€æ ‡ç­¾ã€‚å°±åƒè¡—é“åœ°å€æŒ‡å‘ç‰¹å®šçš„å»ºç­‘ä¸€æ ·ï¼Œå†…å­˜åœ°å€æŒ‡å‘å­˜å‚¨æ•°æ®çš„ç‰¹å®šæ§½ä½ã€‚å†…å­˜æ§½ä½æ˜¯ç‰©ç†å®ä½“ï¼Œè€Œä¸æ˜¯æ¦‚å¿µæ€§çš„ã€‚ä¸€ä¸ªæ‹¥æœ‰500GBç¡¬ç›˜çš„è®¡ç®—æœºå¤§çº¦æœ‰5000äº¿ä¸ªæ§½ä½å¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®ã€‚å¹¶éæ‰€æœ‰è¿™äº›å†…å­˜éƒ½å¯¹ä½ çš„ç¼–ç¨‹ç¯å¢ƒå¯ç”¨ï¼šä½ çš„ç½‘ç»œæµè§ˆå™¨ã€åº”ç”¨ç¨‹åºã€æ“ä½œç³»ç»Ÿç­‰ç­‰éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ä½ çš„ç¼–ç¨‹ç¯å¢ƒç¡®å®è·å¾—äº†ä¸€éƒ¨åˆ†å†…å­˜æ¥å­˜å‚¨å…¶æ•°æ®ã€‚è¿™éƒ¨åˆ†å†…å­˜è¢«ç§°ä¸ºå †ã€‚
- en: When you write a statement like
  id: totrans-716
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ä½ ç¼–å†™å¦‚ä¸‹è¯­å¥æ—¶
- en: '[PRE169]'
  id: totrans-717
  prefs: []
  type: TYPE_PRE
  zh: '[PRE169]'
- en: 'your programming environment puts the new `Account` into a physical slot in
    the heap, then associates the address of that slot with the variable name in the
    directory. The name in the directory doesnâ€™t map to the value itself, but rather
    to the address that holds the value. The address bridges between the physical
    storage location and the conceptual name you want to associate with the new datum.
    In other words, our directory really looks like:'
  id: totrans-718
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ çš„ç¼–ç¨‹ç¯å¢ƒä¼šå°†æ–°çš„`Account`æ”¾å…¥å †ä¸­çš„ä¸€ä¸ªç‰©ç†æ§½ä½ï¼Œç„¶åå°†è¯¥æ§½ä½çš„åœ°å€ä¸ç›®å½•ä¸­çš„å˜é‡åç§°å…³è”èµ·æ¥ã€‚ç›®å½•ä¸­çš„åç§°å¹¶ä¸æ˜ å°„åˆ°å€¼æœ¬èº«ï¼Œè€Œæ˜¯æ˜ å°„åˆ°æŒæœ‰å€¼çš„åœ°å€ã€‚åœ°å€åœ¨ç‰©ç†å­˜å‚¨ä½ç½®å’Œæƒ³è¦å…³è”çš„æ–°æ•°æ®çš„æ¦‚å¿µåç§°ä¹‹é—´æ¶èµ·æ¡¥æ¢ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬çš„ç›®å½•å®é™…ä¸Šçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š
- en: Directory
  id: totrans-719
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE170]'
  id: totrans-720
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE170]'
- en: â†’Â 1001
  id: totrans-721
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: Heap
  id: totrans-722
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-723
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 'Our revised version has two separate areas: the directory (mapping names to
    addresses) and the heap (showing the values stored at the addresses). We will
    use four-digit numbers for addresses, prefixed with an @ symbol (reserving numbers
    with fewer digits for data values). The specific number for the initial address
    (here 1001) is arbitrary. Subsequent storage of structured data values will use
    the addresses in order. Letâ€™s write out the directory and heap contents for our
    initial definitions of accounts in this new format, and see how it supports the
    aliasing that we intended.'
  id: totrans-724
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ä¿®è®¢çš„ç‰ˆæœ¬æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„åŒºåŸŸï¼šç›®å½•ï¼ˆå°†åç§°æ˜ å°„åˆ°åœ°å€ï¼‰å’Œå †ï¼ˆæ˜¾ç¤ºå­˜å‚¨åœ¨åœ°å€ä¸­çš„å€¼ï¼‰ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å››ä½æ•°å­—ä½œä¸ºåœ°å€ï¼Œå‰é¢åŠ ä¸Šä¸€ä¸ª@ç¬¦å·ï¼ˆä¸ºæ•°æ®å€¼ä¿ç•™æ›´å°‘æ•°å­—çš„æ•°å­—ï¼‰ã€‚åˆå§‹åœ°å€çš„ç‰¹å®šæ•°å­—ï¼ˆè¿™é‡Œä¸º1001ï¼‰æ˜¯ä»»æ„çš„ã€‚éšåçš„ç»“æ„åŒ–æ•°æ®å€¼å­˜å‚¨å°†æŒ‰é¡ºåºä½¿ç”¨åœ°å€ã€‚è®©æˆ‘ä»¬ä»¥è¿™ç§æ–°æ ¼å¼ç¼–å†™ç›®å½•å’Œå †çš„å†…å®¹ï¼Œå¹¶çœ‹çœ‹å®ƒå¦‚ä½•æ”¯æŒæˆ‘ä»¬æ‰“ç®—çš„åˆ«åã€‚
- en: First, we create both `acct1` and `acct2` in order as follows. Note that the
    `Account` associated with name `acct2` goes in address 1002.
  id: totrans-725
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬æŒ‰ç…§ä»¥ä¸‹é¡ºåºåˆ›å»º`acct1`å’Œ`acct2`ã€‚è¯·æ³¨æ„ï¼Œä¸åå­—`acct2`å…³è”çš„`Account`å­˜å‚¨åœ¨åœ°å€1002ã€‚
- en: Directory
  id: totrans-726
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE171]'
  id: totrans-727
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE171]'
- en: â†’Â 1001
  id: totrans-728
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE172]'
  id: totrans-729
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE172]'
- en: â†’Â 1002
  id: totrans-730
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1002
- en: Heap
  id: totrans-731
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-732
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 1002:Â `Account(8404, 500)`
  id: totrans-733
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `Account(8404, 500)`
- en: When we run
  id: totrans-734
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘ä»¬è¿è¡Œ
- en: '| Python | Pyret |'
  id: totrans-735
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-736
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE173]'
  id: totrans-737
  prefs: []
  type: TYPE_PRE
  zh: '[PRE173]'
- en: '|'
  id: totrans-738
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE174]'
  id: totrans-739
  prefs: []
  type: TYPE_PRE
  zh: '[PRE174]'
- en: '|'
  id: totrans-740
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'what happens? As before, we look up what the name `acct1` refers to in the
    directory and substitute the result for the name in the `Customer` data. Now,
    `acct1` evaluates to an address, 1001\. Therefore, the `Customer` value in the
    heap contains an address:'
  id: totrans-741
  prefs: []
  type: TYPE_NORMAL
  zh: å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨ç›®å½•ä¸­æŸ¥æ‰¾`acct1`è¿™ä¸ªåå­—æ‰€æŒ‡å‘çš„å†…å®¹ï¼Œå¹¶ç”¨ç»“æœæ›¿æ¢`Customer`æ•°æ®ä¸­çš„åå­—ã€‚ç°åœ¨ï¼Œ`acct1`è¯„ä¼°ä¸ºä¸€ä¸ªåœ°å€ï¼Œ1001ã€‚å› æ­¤ï¼Œå †ä¸­çš„`Customer`å€¼åŒ…å«ä¸€ä¸ªåœ°å€ï¼š
- en: Directory
  id: totrans-742
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE175]'
  id: totrans-743
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE175]'
- en: â†’Â 1001
  id: totrans-744
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE176]'
  id: totrans-745
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE176]'
- en: â†’Â 1002
  id: totrans-746
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1002
- en: Heap
  id: totrans-747
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-748
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 1002:Â `Customer("Elena", 1001)`
  id: totrans-749
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `Customer("Elena", 1001)`
- en: Similarly, when we run
  id: totrans-750
  prefs: []
  type: TYPE_NORMAL
  zh: ç±»ä¼¼åœ°ï¼Œå½“æˆ‘ä»¬è¿è¡Œ
- en: '| Python | Pyret |'
  id: totrans-751
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-752
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE177]'
  id: totrans-753
  prefs: []
  type: TYPE_PRE
  zh: '[PRE177]'
- en: '|'
  id: totrans-754
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE178]'
  id: totrans-755
  prefs: []
  type: TYPE_PRE
  zh: '[PRE178]'
- en: '|'
  id: totrans-756
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'the directory and heap look like this:'
  id: totrans-757
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•å’Œå †çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š
- en: Directory
  id: totrans-758
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE179]'
  id: totrans-759
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE179]'
- en: â†’Â 1001
  id: totrans-760
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE180]'
  id: totrans-761
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE180]'
- en: â†’Â 1002
  id: totrans-762
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1002
- en: '[PRE181]'
  id: totrans-763
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE181]'
- en: â†’Â 1003
  id: totrans-764
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1003
- en: '[PRE182]'
  id: totrans-765
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE182]'
- en: â†’Â 1004
  id: totrans-766
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1004
- en: Heap
  id: totrans-767
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-768
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 1002:Â `Account(8405, 3250)`
  id: totrans-769
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `Account(8405, 3250)`
- en: 1003:Â `Customer("Elena", 1001)`
  id: totrans-770
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1003:Â `Customer("Elena", 1001)`
- en: 1004:Â `Customer("Jorge", 1001)`
  id: totrans-771
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1004:Â `Customer("Jorge", 1001)`
- en: Do Now!
  id: totrans-772
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-773
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Fun fact in the Web version of the book: Did you try hovering over the addresses?
    Try it now!'
  id: totrans-774
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä¹¦çš„ç½‘é¡µç‰ˆæœ¬ä¸­çš„æœ‰è¶£äº‹å®ï¼šä½ å°è¯•å°†é¼ æ ‡æ‚¬åœåœ¨åœ°å€ä¸Šå—ï¼Ÿç°åœ¨è¯•è¯•ï¼
- en: 'With the heap articulated separately from the directory, we now see the relationship
    between the `acct` fields for the two customers and the name `acct1`: they refer
    to the same address, which in turn means they refer to the same value. In contrast,
    the name `acct2`, which was not aliased in the original code, refers to an address
    that is not referenced anywhere else. This is the heart of aliasing: thatâ€™s why
    changes made through one name also affect values viewed through another.'
  id: totrans-775
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºå †ä¸ç›®å½•åˆ†å¼€é˜è¿°ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå®¢æˆ·çš„`acct`å­—æ®µä¸åå­—`acct1`ä¹‹é—´çš„å…³ç³»ï¼šå®ƒä»¬æŒ‡å‘ç›¸åŒçš„åœ°å€ï¼Œè¿™åè¿‡æ¥åˆæ„å‘³ç€å®ƒä»¬æŒ‡å‘ç›¸åŒçš„å€¼ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåå­—`acct2`åœ¨åŸå§‹ä»£ç ä¸­æ²¡æœ‰åˆ«åï¼Œå®ƒæŒ‡å‘çš„åœ°å€åœ¨åˆ«å¤„æ²¡æœ‰å¼•ç”¨ã€‚è¿™å°±æ˜¯åˆ«åçš„å¿ƒè„ï¼šè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€šè¿‡ä¸€ä¸ªåå­—æ‰€åšçš„æ›´æ”¹ä¹Ÿä¼šå½±å“é€šè¿‡å¦ä¸€ä¸ªåå­—çœ‹åˆ°çš„å€¼ã€‚
- en: Do Now!
  id: totrans-776
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-777
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Write three distinct expressions each of which uses a different name in the
    directory to return the balance in account `acct1`.
  id: totrans-778
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç¼–å†™ä¸‰ä¸ªä¸åŒçš„è¡¨è¾¾å¼ï¼Œæ¯ä¸ªè¡¨è¾¾å¼ä½¿ç”¨ç›®å½•ä¸­çš„ä¸åŒåå­—æ¥è¿”å›è´¦æˆ·`acct1`çš„ä½™é¢ã€‚
- en: Do Now!
  id: totrans-779
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-780
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Would the following statement work to update the balance in Elena and Jorgeâ€™s
    shared account?
  id: totrans-781
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹è¯­å¥æ˜¯å¦å¯ä»¥ç”¨æ¥æ›´æ–°Elenaå’ŒJorgeå…±äº«è´¦æˆ·çš„ä½™é¢ï¼Ÿ
- en: ''
  id: totrans-782
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Python |  |'
  id: totrans-783
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-784
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE183]'
  id: totrans-785
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE183]'
- en: ''
  id: totrans-786
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-787
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-788
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-789
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE184]'
  id: totrans-790
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE184]'
- en: ''
  id: totrans-791
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-792
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: ''
  id: totrans-793
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: Does this seem like a good or bad way to do this computation? Why?
  id: totrans-794
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ç§å¥½æ–¹æ³•è¿˜æ˜¯åæ–¹æ³•æ¥åšè¿™ä¸ªè®¡ç®—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
- en: Do Now!
  id: totrans-795
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-796
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Extend the most recent directory and heap contents to reflect running the following
    statement:'
  id: totrans-797
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å°†æœ€æ–°çš„ç›®å½•å’Œå †å†…å®¹æ‰©å±•ä»¥åæ˜ è¿è¡Œä»¥ä¸‹è¯­å¥ï¼š
- en: ''
  id: totrans-798
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE185]'
  id: totrans-799
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE185]'
- en: ''
  id: totrans-800
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: Did you change the heap in the previous exercise? Should you have?
  id: totrans-801
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä½ åœ¨ä¹‹å‰çš„ç»ƒä¹ ä¸­æ”¹å˜äº†å †å—ï¼Ÿä½ åº”è¯¥æ”¹å˜å—ï¼Ÿ
- en: 'Three rules guide how the directory and heap are affected by running programs:'
  id: totrans-802
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‰ä¸ªè§„åˆ™æŒ‡å¯¼ç›®å½•å’Œå †å¦‚ä½•è¢«è¿è¡Œç¨‹åºæ‰€å½±å“ï¼š
- en: If the code construct a new piece of structured data, put the new piece of structured
    data at the next address in the heap.
  id: totrans-803
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¦‚æœä»£ç æ„å»ºä¸€ä¸ªæ–°çš„ç»“æ„åŒ–æ•°æ®å—ï¼Œå°†æ–°çš„ç»“æ„åŒ–æ•°æ®å—æ”¾åœ¨å †ä¸­çš„ä¸‹ä¸€ä¸ªåœ°å€ã€‚
- en: If the code associates a name with a piece of structured data, the directory
    should map the name to the address of the datum in the heap.
  id: totrans-804
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¦‚æœä»£ç å°†ä¸€ä¸ªåå­—ä¸ä¸€ä¸ªç»“æ„åŒ–æ•°æ®å—å…³è”èµ·æ¥ï¼Œç›®å½•åº”è¯¥å°†åå­—æ˜ å°„åˆ°å †ä¸­æ•°æ®çš„åœ°å€ã€‚
- en: If the code modifies a field within structured data, modify the data in the
    heap.
  id: totrans-805
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¦‚æœä»£ç ä¿®æ”¹ç»“æ„åŒ–æ•°æ®ä¸­çš„å­—æ®µï¼Œåˆ™ä¿®æ”¹å †ä¸­çš„æ•°æ®ã€‚
- en: In the example above, we did not alter the heap in any way; only the directory
    should be modified to reflect that `acct3` and `acct1` are now aliases.
  id: totrans-806
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä»¥ä»»ä½•æ–¹å¼æ”¹å˜å †ï¼›åªéœ€ä¿®æ”¹ç›®å½•ä»¥åæ˜ `acct3`å’Œ`acct1`ç°åœ¨æ˜¯åˆ«åã€‚
- en: 12.1.4.2Â Basic Data and the Heap[ğŸ”—](#(part._basic-data-heap) "Link to here")
  id: totrans-807
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 12.1.4.2Â åŸºæœ¬æ•°æ®å’Œå †[ğŸ”—](#(part._basic-data-heap) "é“¾æ¥è‡³æ­¤")
- en: The above rules donâ€™t indicate what happens when we have basic data, such as
    numbers or strings, associated with names in the directory. Do those values also
    get addresses in the heap?
  id: totrans-808
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸Šè¿°è§„åˆ™æ²¡æœ‰è¯´æ˜å½“æˆ‘ä»¬æœ‰åŸºæœ¬æ•°æ®ï¼Œå¦‚æ•°å­—æˆ–å­—ç¬¦ä¸²ï¼Œä¸ç›®å½•ä¸­çš„åå­—å…³è”æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è¿™äº›å€¼ä¹Ÿä¼šåœ¨å †ä¸­è·å¾—åœ°å€å—ï¼Ÿ
- en: 'They do not. As our example with shared accounts illustrated, we need the heap
    so that updates to fields of shared data affect all aliases (names that refer
    to) those data. Basic data donâ€™t have fields, so there is no need to put them
    in the heap. Hereâ€™s a concrete example:'
  id: totrans-809
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒä»¬å¹¶ä¸ã€‚æ­£å¦‚æˆ‘ä»¬é€šè¿‡å…±äº«è´¦æˆ·çš„ç¤ºä¾‹æ‰€å±•ç¤ºçš„ï¼Œæˆ‘ä»¬éœ€è¦å †ä»¥ä¾¿æ›´æ–°å…±äº«æ•°æ®çš„å­—æ®µä¼šå½±å“æ‰€æœ‰åˆ«åï¼ˆå¼•ç”¨è¿™äº›æ•°æ®çš„åç§°ï¼‰ã€‚åŸºæœ¬æ•°æ®æ²¡æœ‰å­—æ®µï¼Œå› æ­¤æ²¡æœ‰å¿…è¦å°†å®ƒä»¬æ”¾åœ¨å †ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š
- en: '[PRE186]'
  id: totrans-810
  prefs: []
  type: TYPE_PRE
  zh: '[PRE186]'
- en: 'The corresponding directory and heap contents would be as follows:'
  id: totrans-811
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹åº”çš„ç›®å½•å’Œå †å†…å®¹å¦‚ä¸‹ï¼š
- en: Directory
  id: totrans-812
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE187]'
  id: totrans-813
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE187]'
- en: â†’
  id: totrans-814
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE188]'
  id: totrans-815
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE188]'
- en: '[PRE189]'
  id: totrans-816
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE189]'
- en: â†’Â `"Dr. Kumar"`
  id: totrans-817
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’ `"Dr. Kumar"`
- en: 'Notice that this particular program puts nothing in the heap: according to
    our rules above, only structured data only go into the heap. Now assume our program
    also had a dataclass (Python) or datatype (Pyret) for `Office`s, with a professorâ€™s
    name and room number. Hereâ€™s another example showing a combination of basic and
    structured data:'
  id: totrans-818
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œè¿™ä¸ªç‰¹å®šçš„ç¨‹åºæ²¡æœ‰åœ¨å †ä¸­æ”¾ç½®ä»»ä½•å†…å®¹ï¼šæ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„è§„åˆ™ï¼Œåªæœ‰ç»“æ„åŒ–æ•°æ®æ‰ä¼šè¿›å…¥å †ã€‚ç°åœ¨å‡è®¾æˆ‘ä»¬çš„ç¨‹åºè¿˜æœ‰ä¸€ä¸ªç”¨äº`Office`çš„æ•°æ®ç±»ï¼ˆPythonï¼‰æˆ–æ•°æ®ç±»å‹ï¼ˆPyretï¼‰ï¼ŒåŒ…å«æ•™æˆçš„å§“åå’Œæˆ¿é—´å·ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå±•ç¤ºåŸºæœ¬æ•°æ®å’Œç»“æ„åŒ–æ•°æ®ç»„åˆçš„å¦ä¸€ä¸ªç¤ºä¾‹ï¼š
- en: '[PRE190]'
  id: totrans-819
  prefs: []
  type: TYPE_PRE
  zh: '[PRE190]'
- en: Directory
  id: totrans-820
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE191]'
  id: totrans-821
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE191]'
- en: â†’
  id: totrans-822
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE192]'
  id: totrans-823
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE192]'
- en: '[PRE193]'
  id: totrans-824
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE193]'
- en: â†’Â `"Dr. Kumar"`
  id: totrans-825
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’ `"Dr. Kumar"`
- en: '[PRE194]'
  id: totrans-826
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE194]'
- en: â†’Â 1005
  id: totrans-827
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’ 1005
- en: '[PRE195]'
  id: totrans-828
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE195]'
- en: â†’Â 1006
  id: totrans-829
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’ 1006
- en: Heap
  id: totrans-830
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1005:Â `Office("Dr. Lakshmi", 311)`
  id: totrans-831
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '1005: `Office("Dr. Lakshmi", 311)`'
- en: 1006:Â `Office("Dr. Kumar", 314)`
  id: totrans-832
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '1006: `Office("Dr. Kumar", 314)`'
- en: Though specific language implementations can vary, this shows that it is sufficient
    to think of basic data as residing in the directory, not the heap. The whole point
    of structured data is that they have both their own identity and multiple components.
    The heap gives access to both concepts. Basic data canâ€™t be broken down (by definition).
    As such, there is nothing lost by putting them only in the directory.
  id: totrans-833
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡å…·ä½“çš„è¯­è¨€å®ç°å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†è¿™è¡¨æ˜å°†åŸºæœ¬æ•°æ®è§†ä¸ºä½äºç›®å½•è€Œéå †ä¸­æ˜¯è¶³å¤Ÿçš„ã€‚ç»“æ„åŒ–æ•°æ®çš„å…¨éƒ¨æ„ä¹‰åœ¨äºå®ƒä»¬æ—¢æœ‰è‡ªå·±çš„æ ‡è¯†ç¬¦ï¼Œåˆæœ‰å¤šä¸ªç»„æˆéƒ¨åˆ†ã€‚å †æä¾›äº†è®¿é—®è¿™ä¸¤ä¸ªæ¦‚å¿µçš„èƒ½åŠ›ã€‚åŸºæœ¬æ•°æ®ä¸èƒ½è¢«åˆ†è§£ï¼ˆæŒ‰å®šä¹‰ï¼‰ã€‚å› æ­¤ï¼Œå°†å®ƒä»¬ä»…æ”¾åœ¨ç›®å½•ä¸­å¹¶ä¸ä¼šä¸¢å¤±ä»»ä½•ä¸œè¥¿ã€‚
- en: But what about strings? Weâ€™ve referred to them as basic data until now, but
    donâ€™t they have â€œcomponentsâ€, namely the characters that make up the string? Yes,
    that is technically accurate. However, we are treating strings as basic data because
    we arenâ€™t using operations that modify that sequence of characters. This is a
    subtle point, one that usually comes up later in computer science. This book will
    leave strings in the directory, but if you are writing programs that modify the
    internal characters, put them in the heap instead.
  id: totrans-834
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†å­—ç¬¦ä¸²æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬ä¸€ç›´å°†å®ƒä»¬è§†ä¸ºåŸºæœ¬æ•°æ®ï¼Œä½†å®ƒä»¬ä¸æ˜¯æœ‰â€œç»„ä»¶â€ï¼Œå³æ„æˆå­—ç¬¦ä¸²çš„å­—ç¬¦å—ï¼Ÿæ˜¯çš„ï¼Œè¿™åœ¨æŠ€æœ¯ä¸Šå‡†ç¡®ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å°†å­—ç¬¦ä¸²è§†ä¸ºåŸºæœ¬æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ä¿®æ”¹è¿™äº›å­—ç¬¦åºåˆ—çš„æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªå¾®å¦™çš„é—®é¢˜ï¼Œé€šå¸¸åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ç¨åå‡ºç°ã€‚è¿™æœ¬ä¹¦å°†å­—ç¬¦ä¸²ç•™åœ¨ç›®å½•ä¸­ï¼Œä½†å¦‚æœä½ æ­£åœ¨ç¼–å†™ä¿®æ”¹å†…éƒ¨å­—ç¬¦çš„ç¨‹åºï¼Œè¯·å°†å®ƒä»¬æ”¾åœ¨å †ä¸­ã€‚
- en: 12.1.4.1Â Introducing the Heap[ğŸ”—](#(part._heap-intro) "Link to here")
  id: totrans-835
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 12.1.4.1 ä»‹ç»å †[ğŸ”—](#(part._heap-intro) "é“¾æ¥è‡³æ­¤")
- en: Our original presentation of the directory reflected the aliases that referred
    to a single `Account` through repeated use of the name `acct1`. We only lost that
    sharing when we replaced `acct1` with itâ€™s value while setting up the data for
    Elena and Jorge. The rule that names canâ€™t appear in the values is still important,
    especially in the presence of mutation (weâ€™ll return to this later in [Mutating
    Variables in Memory](mutating-variables.html#%28part._mutating-vars-memory%29)).
    But the idea of having a single term that can be reused to reflect sharing is
    a good one. Indeed, it reflects what happens inside your computer.
  id: totrans-836
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æœ€åˆå¯¹ç›®å½•çš„å±•ç¤ºåæ˜ äº†é€šè¿‡é‡å¤ä½¿ç”¨åç§°`acct1`æ¥å¼•ç”¨å•ä¸ª`Account`çš„åˆ«åã€‚å½“æˆ‘ä»¬è®¾ç½®Elenaå’ŒJorgeçš„æ•°æ®æ—¶ï¼Œç”¨å…¶å€¼æ›¿æ¢`acct1`æ—¶ï¼Œæˆ‘ä»¬å¤±å»äº†è¿™ç§å…±äº«ã€‚åç§°ä¸èƒ½å‡ºç°åœ¨å€¼ä¸­çš„è§„åˆ™ä»ç„¶å¾ˆé‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å­˜åœ¨çªå˜çš„æƒ…å†µä¸‹ï¼ˆæˆ‘ä»¬å°†åœ¨[å†…å­˜ä¸­çš„çªå˜å˜é‡](mutating-variables.html#%28part._mutating-vars-memory%29)ä¸­ç¨åå›åˆ°è¿™ä¸€ç‚¹ï¼‰ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨æ¥åæ˜ å…±äº«çš„å•ä¸ªæœ¯è¯­çš„æƒ³æ³•æ˜¯å¥½çš„ã€‚ç¡®å®ï¼Œå®ƒåæ˜ äº†è®¡ç®—æœºå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚
- en: 'Every time you use a constructor to create data, your programming environment
    stores it in the memory of your computer. Memory consists of a (large) number
    of slots. Your newly-created datum goes into one of these slots. Each slot is
    labeled with an address. Just as a street address refers to a specific building,
    a memory address refers to a specific slot where a datum is stored. Memory slots
    are physical entities, not conceptual ones. A computer with a 500GB hard drive
    has about 500 billion slots in which it can store data. Not all of that memory
    is available to your programming environment: your Web browser, applications,
    operating system, and so on all get stored in the memory. Your programming environment
    does get a portion of memory to use for storing its data. That portion is called
    the heap.'
  id: totrans-837
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯æ¬¡ä½ ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºæ•°æ®æ—¶ï¼Œä½ çš„ç¼–ç¨‹ç¯å¢ƒéƒ½ä¼šå°†å…¶å­˜å‚¨åœ¨è®¡ç®—æœºçš„å†…å­˜ä¸­ã€‚å†…å­˜ç”±å¤§é‡æ§½ä½ç»„æˆã€‚ä½ æ–°åˆ›å»ºçš„æ•°æ®å°†æ”¾å…¥è¿™äº›æ§½ä½ä¸­çš„ä¸€ä¸ªã€‚æ¯ä¸ªæ§½ä½éƒ½æ ‡æœ‰åœ°å€ã€‚å°±åƒè¡—é“åœ°å€æŒ‡å‘ç‰¹å®šçš„å»ºç­‘ä¸€æ ·ï¼Œå†…å­˜åœ°å€æŒ‡å‘å­˜å‚¨æ•°æ®çš„ç‰¹å®šæ§½ä½ã€‚å†…å­˜æ§½ä½æ˜¯ç‰©ç†å®ä½“ï¼Œè€Œä¸æ˜¯æ¦‚å¿µæ€§çš„ã€‚å…·æœ‰
    500GB ç¡¬ç›˜çš„è®¡ç®—æœºå¤§çº¦æœ‰ 5000 äº¿ä¸ªæ§½ä½å¯ä»¥å­˜å‚¨æ•°æ®ã€‚å¹¶éæ‰€æœ‰è¿™äº›å†…å­˜éƒ½å¯¹ç¼–ç¨‹ç¯å¢ƒå¯ç”¨ï¼šä½ çš„ç½‘ç»œæµè§ˆå™¨ã€åº”ç”¨ç¨‹åºã€æ“ä½œç³»ç»Ÿç­‰éƒ½ä¼šå­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ç¼–ç¨‹ç¯å¢ƒç¡®å®è·å¾—äº†ä¸€éƒ¨åˆ†å†…å­˜æ¥å­˜å‚¨å…¶æ•°æ®ã€‚è¿™éƒ¨åˆ†ç§°ä¸ºå †ã€‚
- en: When you write a statement like
  id: totrans-838
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ä½ ç¼–å†™å¦‚ä¸‹è¯­å¥æ—¶
- en: '[PRE196]'
  id: totrans-839
  prefs: []
  type: TYPE_PRE
  zh: '[PRE196]'
- en: 'your programming environment puts the new `Account` into a physical slot in
    the heap, then associates the address of that slot with the variable name in the
    directory. The name in the directory doesnâ€™t map to the value itself, but rather
    to the address that holds the value. The address bridges between the physical
    storage location and the conceptual name you want to associate with the new datum.
    In other words, our directory really looks like:'
  id: totrans-840
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ çš„ç¼–ç¨‹ç¯å¢ƒå°†æ–°çš„ `Account` æ”¾å…¥å †ä¸­çš„ä¸€ä¸ªç‰©ç†æ§½ä½ï¼Œç„¶åå°†è¯¥æ§½ä½çš„åœ°å€ä¸ç›®å½•ä¸­çš„å˜é‡åç§°å…³è”èµ·æ¥ã€‚ç›®å½•ä¸­çš„åç§°å¹¶ä¸æ˜ å°„åˆ°å€¼æœ¬èº«ï¼Œè€Œæ˜¯æ˜ å°„åˆ°åŒ…å«å€¼çš„åœ°å€ã€‚åœ°å€åœ¨ç‰©ç†å­˜å‚¨ä½ç½®å’Œæƒ³è¦ä¸ä¹‹å…³è”çš„æ¦‚å¿µæ€§åç§°ä¹‹é—´æ¶èµ·æ¡¥æ¢ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬çš„ç›®å½•å®é™…ä¸Šçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š
- en: Directory
  id: totrans-841
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE197]'
  id: totrans-842
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE197]'
- en: â†’Â 1001
  id: totrans-843
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: Heap
  id: totrans-844
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-845
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 'Our revised version has two separate areas: the directory (mapping names to
    addresses) and the heap (showing the values stored at the addresses). We will
    use four-digit numbers for addresses, prefixed with an @ symbol (reserving numbers
    with fewer digits for data values). The specific number for the initial address
    (here 1001) is arbitrary. Subsequent storage of structured data values will use
    the addresses in order. Letâ€™s write out the directory and heap contents for our
    initial definitions of accounts in this new format, and see how it supports the
    aliasing that we intended.'
  id: totrans-846
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ä¿®æ”¹åçš„ç‰ˆæœ¬æœ‰ä¸¤ä¸ªç‹¬ç«‹åŒºåŸŸï¼šç›®å½•ï¼ˆå°†åç§°æ˜ å°„åˆ°åœ°å€ï¼‰å’Œå †ï¼ˆæ˜¾ç¤ºå­˜å‚¨åœ¨åœ°å€ä¸­çš„å€¼ï¼‰ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å¸¦å‰ç¼€ @ ç¬¦å·çš„å››ä½æ•°ä½œä¸ºåœ°å€ï¼ˆä¸ºæ•°æ®å€¼ä¿ç•™ä½æ•°è¾ƒå°‘çš„æ•°å­—ï¼‰ã€‚åˆå§‹åœ°å€çš„å…·ä½“æ•°å­—ï¼ˆè¿™é‡Œä¸º
    1001ï¼‰æ˜¯ä»»æ„çš„ã€‚åç»­å­˜å‚¨ç»“æ„åŒ–æ•°æ®å€¼å°†æŒ‰é¡ºåºä½¿ç”¨åœ°å€ã€‚è®©æˆ‘ä»¬ä»¥è¿™ç§æ–°æ ¼å¼ç¼–å†™ç›®å½•å’Œå †çš„å†…å®¹ï¼Œä»¥æŸ¥çœ‹å®ƒå¦‚ä½•æ”¯æŒæˆ‘ä»¬é¢„æœŸçš„åˆ«ååŠŸèƒ½ã€‚
- en: First, we create both `acct1` and `acct2` in order as follows. Note that the
    `Account` associated with name `acct2` goes in address 1002.
  id: totrans-847
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬æŒ‰å¦‚ä¸‹é¡ºåºåˆ›å»º `acct1` å’Œ `acct2`ã€‚æ³¨æ„ï¼Œä¸åç§° `acct2` å…³è”çš„ `Account` å­˜å‚¨åœ¨åœ°å€ 1002ã€‚
- en: Directory
  id: totrans-848
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE198]'
  id: totrans-849
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE198]'
- en: â†’Â 1001
  id: totrans-850
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE199]'
  id: totrans-851
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE199]'
- en: â†’Â 1002
  id: totrans-852
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1002
- en: Heap
  id: totrans-853
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-854
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 1002:Â `Account(8404, 500)`
  id: totrans-855
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `Account(8404, 500)`
- en: When we run
  id: totrans-856
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘ä»¬è¿è¡Œ
- en: '| Python | Pyret |'
  id: totrans-857
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-858
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE200]'
  id: totrans-859
  prefs: []
  type: TYPE_PRE
  zh: '[PRE200]'
- en: '|'
  id: totrans-860
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE201]'
  id: totrans-861
  prefs: []
  type: TYPE_PRE
  zh: '[PRE201]'
- en: '|'
  id: totrans-862
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'what happens? As before, we look up what the name `acct1` refers to in the
    directory and substitute the result for the name in the `Customer` data. Now,
    `acct1` evaluates to an address, 1001\. Therefore, the `Customer` value in the
    heap contains an address:'
  id: totrans-863
  prefs: []
  type: TYPE_NORMAL
  zh: å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨ç›®å½•ä¸­æŸ¥æ‰¾åç§° `acct1` æ‰€æŒ‡çš„å†…å®¹ï¼Œå¹¶ç”¨ç»“æœæ›¿æ¢ `Customer` æ•°æ®ä¸­çš„åç§°ã€‚ç°åœ¨ï¼Œ`acct1` è®¡ç®—ç»“æœä¸ºä¸€ä¸ªåœ°å€ï¼Œ1001\.
    å› æ­¤ï¼Œå †ä¸­çš„ `Customer` å€¼åŒ…å«ä¸€ä¸ªåœ°å€ï¼š
- en: Directory
  id: totrans-864
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE202]'
  id: totrans-865
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE202]'
- en: â†’Â 1001
  id: totrans-866
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE203]'
  id: totrans-867
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE203]'
- en: â†’Â 1002
  id: totrans-868
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1002
- en: Heap
  id: totrans-869
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-870
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 1002:Â `Customer("Elena", 1001)`
  id: totrans-871
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `Customer("Elena", 1001)`
- en: Similarly, when we run
  id: totrans-872
  prefs: []
  type: TYPE_NORMAL
  zh: ç±»ä¼¼åœ°ï¼Œå½“æˆ‘ä»¬è¿è¡Œ
- en: '| Python | Pyret |'
  id: totrans-873
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-874
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE204]'
  id: totrans-875
  prefs: []
  type: TYPE_PRE
  zh: '[PRE204]'
- en: '|'
  id: totrans-876
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE205]'
  id: totrans-877
  prefs: []
  type: TYPE_PRE
  zh: '[PRE205]'
- en: '|'
  id: totrans-878
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'the directory and heap look like this:'
  id: totrans-879
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•å’Œå †çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š
- en: Directory
  id: totrans-880
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE206]'
  id: totrans-881
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE206]'
- en: â†’Â 1001
  id: totrans-882
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE207]'
  id: totrans-883
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE207]'
- en: â†’Â 1002
  id: totrans-884
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1002
- en: '[PRE208]'
  id: totrans-885
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE208]'
- en: â†’Â 1003
  id: totrans-886
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1003
- en: '[PRE209]'
  id: totrans-887
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE209]'
- en: â†’Â 1004
  id: totrans-888
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1004
- en: Heap
  id: totrans-889
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `Account(8404, 500)`
  id: totrans-890
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `Account(8404, 500)`
- en: 1002:Â `Account(8405, 3250)`
  id: totrans-891
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `Account(8405, 3250)`
- en: 1003:Â `Customer("Elena", 1001)`
  id: totrans-892
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1003:Â `Customer("Elena", 1001)`
- en: 1004:Â `Customer("Jorge", 1001)`
  id: totrans-893
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1004:Â `Customer("Jorge", 1001)`
- en: Do Now!
  id: totrans-894
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-895
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Fun fact in the Web version of the book: Did you try hovering over the addresses?
    Try it now!'
  id: totrans-896
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä¹¦çš„ç½‘é¡µç‰ˆæœ¬ä¸­çš„æœ‰è¶£äº‹å®ï¼šä½ å°è¯•å°†é¼ æ ‡æ‚¬åœåœ¨åœ°å€ä¸Šå—ï¼Ÿç°åœ¨è¯•è¯•ï¼
- en: 'With the heap articulated separately from the directory, we now see the relationship
    between the `acct` fields for the two customers and the name `acct1`: they refer
    to the same address, which in turn means they refer to the same value. In contrast,
    the name `acct2`, which was not aliased in the original code, refers to an address
    that is not referenced anywhere else. This is the heart of aliasing: thatâ€™s why
    changes made through one name also affect values viewed through another.'
  id: totrans-897
  prefs: []
  type: TYPE_NORMAL
  zh: å°†å †ä¸ç›®å½•åˆ†å¼€è¡¨è¿°åï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå®¢æˆ·çš„`acct`å­—æ®µä¸åç§°`acct1`ä¹‹é—´çš„å…³ç³»ï¼šå®ƒä»¬æŒ‡å‘ç›¸åŒçš„åœ°å€ï¼Œè¿™åè¿‡æ¥åˆæ„å‘³ç€å®ƒä»¬æŒ‡å‘ç›¸åŒçš„å€¼ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåç§°`acct2`ï¼ˆåœ¨åŸå§‹ä»£ç ä¸­æ²¡æœ‰åˆ«åï¼‰ï¼ŒæŒ‡å‘ä¸€ä¸ªåœ¨å…¶ä»–åœ°æ–¹æ²¡æœ‰å¼•ç”¨çš„åœ°å€ã€‚è¿™å°±æ˜¯åˆ«åçš„å¿ƒè„ï¼šè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€šè¿‡ä¸€ä¸ªåç§°æ‰€åšçš„æ›´æ”¹ä¹Ÿä¼šå½±å“é€šè¿‡å¦ä¸€ä¸ªåç§°æŸ¥çœ‹çš„å€¼ã€‚
- en: Do Now!
  id: totrans-898
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-899
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Write three distinct expressions each of which uses a different name in the
    directory to return the balance in account `acct1`.
  id: totrans-900
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç¼–å†™ä¸‰ä¸ªä¸åŒçš„è¡¨è¾¾å¼ï¼Œæ¯ä¸ªè¡¨è¾¾å¼ä½¿ç”¨ç›®å½•ä¸­çš„ä¸åŒåç§°æ¥è¿”å›è´¦æˆ·`acct1`çš„ä½™é¢ã€‚
- en: Do Now!
  id: totrans-901
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-902
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Would the following statement work to update the balance in Elena and Jorgeâ€™s
    shared account?
  id: totrans-903
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹è¯­å¥æ˜¯å¦å¯ä»¥ç”¨æ¥æ›´æ–°Elenaå’ŒJorgeçš„å…±äº«è´¦æˆ·çš„ä½™é¢ï¼Ÿ
- en: ''
  id: totrans-904
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Python |  |'
  id: totrans-905
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-906
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE210]'
  id: totrans-907
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE210]'
- en: ''
  id: totrans-908
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-909
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-910
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-911
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE211]'
  id: totrans-912
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE211]'
- en: ''
  id: totrans-913
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  id: totrans-914
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '|'
- en: ''
  id: totrans-915
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: Does this seem like a good or bad way to do this computation? Why?
  id: totrans-916
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è¿™çœ‹èµ·æ¥æ˜¯ä¸€ç§å¥½æ–¹æ³•è¿˜æ˜¯åæ–¹æ³•æ¥åšè¿™ä¸ªè®¡ç®—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
- en: Do Now!
  id: totrans-917
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç°åœ¨è¡ŒåŠ¨ï¼
- en: ''
  id: totrans-918
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Extend the most recent directory and heap contents to reflect running the following
    statement:'
  id: totrans-919
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å°†æœ€æ–°çš„ç›®å½•å’Œå †å†…å®¹æ‰©å±•åˆ°åæ˜ è¿è¡Œä»¥ä¸‹è¯­å¥ï¼š
- en: ''
  id: totrans-920
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE212]'
  id: totrans-921
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE212]'
- en: ''
  id: totrans-922
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: Did you change the heap in the previous exercise? Should you have?
  id: totrans-923
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä½ åœ¨ä¹‹å‰çš„ç»ƒä¹ ä¸­æ›´æ”¹äº†å †å—ï¼Ÿä½ åº”è¯¥è¿™æ ·åšå—ï¼Ÿ
- en: 'Three rules guide how the directory and heap are affected by running programs:'
  id: totrans-924
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‰æ¡è§„åˆ™æŒ‡å¯¼ç›®å½•å’Œå †å¦‚ä½•å—åˆ°ç¨‹åºè¿è¡Œçš„å½±å“ï¼š
- en: If the code construct a new piece of structured data, put the new piece of structured
    data at the next address in the heap.
  id: totrans-925
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¦‚æœä»£ç æ„å»ºä¸€ä¸ªæ–°çš„ç»“æ„åŒ–æ•°æ®ï¼Œåˆ™åœ¨å †çš„ä¸‹ä¸€ä¸ªåœ°å€æ”¾ç½®æ–°çš„ç»“æ„åŒ–æ•°æ®ã€‚
- en: If the code associates a name with a piece of structured data, the directory
    should map the name to the address of the datum in the heap.
  id: totrans-926
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¦‚æœä»£ç å°†ä¸€ä¸ªåç§°ä¸ç»“æ„åŒ–æ•°æ®ç›¸å…³è”ï¼Œåˆ™ç›®å½•åº”å°†åç§°æ˜ å°„åˆ°å †ä¸­æ•°æ®çš„åœ°å€ã€‚
- en: If the code modifies a field within structured data, modify the data in the
    heap.
  id: totrans-927
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¦‚æœä»£ç ä¿®æ”¹äº†ç»“æ„åŒ–æ•°æ®ä¸­çš„å­—æ®µï¼Œåˆ™åº”åœ¨å †ä¸­ä¿®æ”¹æ•°æ®ã€‚
- en: In the example above, we did not alter the heap in any way; only the directory
    should be modified to reflect that `acct3` and `acct1` are now aliases.
  id: totrans-928
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä»¥ä»»ä½•æ–¹å¼ä¿®æ”¹å †ï¼›åªéœ€ä¿®æ”¹ç›®å½•ä»¥åæ˜ `acct3`å’Œ`acct1`ç°åœ¨æ˜¯åˆ«åã€‚
- en: 12.1.4.2Â Basic Data and the Heap[ğŸ”—](#(part._basic-data-heap) "Link to here")
  id: totrans-929
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 12.1.4.2Â åŸºæœ¬æ•°æ®å’Œå †[ğŸ”—](#(part._basic-data-heap) "é“¾æ¥åˆ°æ­¤å¤„")
- en: The above rules donâ€™t indicate what happens when we have basic data, such as
    numbers or strings, associated with names in the directory. Do those values also
    get addresses in the heap?
  id: totrans-930
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸Šè¿°è§„åˆ™æ²¡æœ‰è¯´æ˜å½“æˆ‘ä»¬æœ‰åŸºæœ¬æ•°æ®ï¼ˆå¦‚æ•°å­—æˆ–å­—ç¬¦ä¸²ï¼‰ä¸ç›®å½•ä¸­çš„åç§°ç›¸å…³è”æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è¿™äº›å€¼ä¹Ÿä¼šåœ¨å †ä¸­è·å¾—åœ°å€å—ï¼Ÿ
- en: 'They do not. As our example with shared accounts illustrated, we need the heap
    so that updates to fields of shared data affect all aliases (names that refer
    to) those data. Basic data donâ€™t have fields, so there is no need to put them
    in the heap. Hereâ€™s a concrete example:'
  id: totrans-931
  prefs: []
  type: TYPE_NORMAL
  zh: ä»–ä»¬å¹¶ä¸è¿™æ ·åšã€‚æ­£å¦‚æˆ‘ä»¬ç”¨å…±äº«è´¦æˆ·çš„ä¾‹å­æ‰€å±•ç¤ºçš„ï¼Œæˆ‘ä»¬éœ€è¦å †ä»¥ä¾¿æ›´æ–°å…±äº«æ•°æ®çš„å­—æ®µä¼šå½±å“æ‰€æœ‰åˆ«åï¼ˆæŒ‡é‚£äº›æ•°æ®çš„åç§°ï¼‰ã€‚åŸºæœ¬æ•°æ®æ²¡æœ‰å­—æ®µï¼Œå› æ­¤ä¸éœ€è¦å°†å®ƒä»¬æ”¾å…¥å †ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š
- en: '[PRE213]'
  id: totrans-932
  prefs: []
  type: TYPE_PRE
  zh: '[PRE213]'
- en: 'The corresponding directory and heap contents would be as follows:'
  id: totrans-933
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹åº”çš„ç›®å½•å’Œå †å†…å®¹å¦‚ä¸‹ï¼š
- en: Directory
  id: totrans-934
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE214]'
  id: totrans-935
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE214]'
- en: â†’
  id: totrans-936
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE215]'
  id: totrans-937
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE215]'
- en: '[PRE216]'
  id: totrans-938
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE216]'
- en: â†’Â `"Dr. Kumar"`
  id: totrans-939
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â `"Dr. Kumar"`
- en: 'Notice that this particular program puts nothing in the heap: according to
    our rules above, only structured data only go into the heap. Now assume our program
    also had a dataclass (Python) or datatype (Pyret) for `Office`s, with a professorâ€™s
    name and room number. Hereâ€™s another example showing a combination of basic and
    structured data:'
  id: totrans-940
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œè¿™ä¸ªç‰¹å®šçš„ç¨‹åºæ²¡æœ‰åœ¨å †ä¸­æ”¾ç½®ä»»ä½•å†…å®¹ï¼šæ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„è§„åˆ™ï¼Œåªæœ‰ç»“æ„åŒ–æ•°æ®æ‰ä¼šè¿›å…¥å †ã€‚ç°åœ¨å‡è®¾æˆ‘ä»¬çš„ç¨‹åºè¿˜æœ‰ä¸€ä¸ªç”¨äº`Office`sçš„æ•°æ®ç±»ï¼ˆPythonï¼‰æˆ–æ•°æ®ç±»å‹ï¼ˆPyretï¼‰ï¼ŒåŒ…å«æ•™æˆçš„å§“åå’Œæˆ¿é—´å·ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå±•ç¤ºåŸºæœ¬æ•°æ®å’Œç»“æ„åŒ–æ•°æ®ç»„åˆçš„ä¾‹å­ï¼š
- en: '[PRE217]'
  id: totrans-941
  prefs: []
  type: TYPE_PRE
  zh: '[PRE217]'
- en: Directory
  id: totrans-942
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE218]'
  id: totrans-943
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE218]'
- en: â†’
  id: totrans-944
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’
- en: '[PRE219]'
  id: totrans-945
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE219]'
- en: '[PRE220]'
  id: totrans-946
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE220]'
- en: â†’Â `"Dr. Kumar"`
  id: totrans-947
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â `"Dr. Kumar"`
- en: '[PRE221]'
  id: totrans-948
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE221]'
- en: â†’Â 1005
  id: totrans-949
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1005
- en: '[PRE222]'
  id: totrans-950
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE222]'
- en: â†’Â 1006
  id: totrans-951
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1006
- en: Heap
  id: totrans-952
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1005:Â `Office("Dr. Lakshmi", 311)`
  id: totrans-953
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1005:Â `Office("Dr. Lakshmi", 311)`
- en: 1006:Â `Office("Dr. Kumar", 314)`
  id: totrans-954
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1006:Â `Office("Dr. Kumar", 314)`
- en: Though specific language implementations can vary, this shows that it is sufficient
    to think of basic data as residing in the directory, not the heap. The whole point
    of structured data is that they have both their own identity and multiple components.
    The heap gives access to both concepts. Basic data canâ€™t be broken down (by definition).
    As such, there is nothing lost by putting them only in the directory.
  id: totrans-955
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶å…·ä½“è¯­è¨€å®ç°å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†è¿™è¡¨æ˜å°†åŸºæœ¬æ•°æ®è§†ä¸ºä½äºç›®å½•è€Œä¸æ˜¯å †ä¸­æ˜¯è¶³å¤Ÿçš„ã€‚ç»“æ„åŒ–æ•°æ®çš„æ ¸å¿ƒåœ¨äºå®ƒä»¬æ—¢æœ‰è‡ªå·±çš„èº«ä»½ï¼Œåˆæœ‰å¤šä¸ªç»„ä»¶ã€‚å †æä¾›äº†è®¿é—®è¿™ä¸¤ä¸ªæ¦‚å¿µçš„èƒ½åŠ›ã€‚åŸºæœ¬æ•°æ®ä¸èƒ½è¢«åˆ†è§£ï¼ˆæŒ‰å®šä¹‰ï¼‰ã€‚å› æ­¤ï¼Œå°†å®ƒä»¬ä»…æ”¾åœ¨ç›®å½•ä¸­å¹¶ä¸ä¼šä¸¢å¤±ä»»ä½•ä¸œè¥¿ã€‚
- en: But what about strings? Weâ€™ve referred to them as basic data until now, but
    donâ€™t they have â€œcomponentsâ€, namely the characters that make up the string? Yes,
    that is technically accurate. However, we are treating strings as basic data because
    we arenâ€™t using operations that modify that sequence of characters. This is a
    subtle point, one that usually comes up later in computer science. This book will
    leave strings in the directory, but if you are writing programs that modify the
    internal characters, put them in the heap instead.
  id: totrans-956
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†å­—ç¬¦ä¸²å‘¢ï¼Ÿæˆ‘ä»¬ä¹‹å‰ä¸€ç›´æŠŠå®ƒä»¬å½“ä½œåŸºæœ¬æ•°æ®ï¼Œä½†å®ƒä»¬ä¸æ˜¯ç”±â€œç»„ä»¶â€ç»„æˆçš„å—ï¼Ÿå³æ„æˆå­—ç¬¦ä¸²çš„å­—ç¬¦ï¼Ÿæ˜¯çš„ï¼Œä»æŠ€æœ¯ä¸Šè®²è¿™æ˜¯å‡†ç¡®çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å°†å­—ç¬¦ä¸²è§†ä¸ºåŸºæœ¬æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ä¿®æ”¹è¿™äº›å­—ç¬¦åºåˆ—çš„æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªå¾®å¦™çš„é—®é¢˜ï¼Œé€šå¸¸åœ¨è®¡ç®—æœºç§‘å­¦ä¸­å‡ºç°åœ¨è¾ƒæ™šçš„é˜¶æ®µã€‚è¿™æœ¬ä¹¦ä¼šå°†å­—ç¬¦ä¸²æ”¾åœ¨ç›®å½•ä¸­ï¼Œä½†å¦‚æœä½ æ­£åœ¨ç¼–å†™ä¿®æ”¹å†…éƒ¨å­—ç¬¦çš„ç¨‹åºï¼Œè¯·å°†å®ƒä»¬æ”¾åœ¨å †ä¸­ã€‚
