- en: DOF Elimination Method
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DOF 消除法
- en: 原文：[https://phys-sim-book.github.io/lec5.2-DOF_elimin.html](https://phys-sim-book.github.io/lec5.2-DOF_elimin.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://phys-sim-book.github.io/lec5.2-DOF_elimin.html](https://phys-sim-book.github.io/lec5.2-DOF_elimin.html)
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
- en: Considering the simplest sticky Dirichlet boundary condition as an example,
    its constraint Jacobian \( A \) acts as a selection matrix. Consequently, \( AA^T
    \) forms a \( m \times m \) identity matrix, and \( A^T A \) becomes a \( dn \times
    dn \) diagonal matrix. In this matrix, the entries corresponding to the BC nodes
    are one, and all other entries are zero.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 以最简单的粘性狄利克雷边界条件为例，其约束雅可比矩阵 \( A \) 起到选择矩阵的作用。因此，\( AA^T \) 形成一个 \( m \times
    m \) 的单位矩阵，而 \( A^T A \) 成为一个 \( dn \times dn \) 的对角矩阵。在这个矩阵中，对应于边界条件节点的项为 1，其余项为
    0。
- en: 'When we left-multiply \( A \) to the first block row of Equation [(5.1.3)](lec5.1-equality_constraints.html#eq:lec5:BC_KKT),
    the resulting equation is:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们将 \( A \) 左乘到方程 [(5.1.3)](lec5.1-equality_constraints.html#eq:lec5:BC_KKT)
    的第一行块时，得到的方程是：
- en: '[AHA​AAT​][Δxλ​]=[−Ag0​].'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[AHA^TA^TA][Δxλ^T]=[−Ag0^T].'
- en: 'This manipulation allows us to directly solve for \( \lambda \) as:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 这种操作使我们能够直接求解 \( \lambda \) 如下：
- en: λ=−AHΔx−Ag.(5.2.1)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: λ=−AHΔx−Ag.(5.2.1)
- en: 'By substituting Equation [(5.2.1)](#eq:lec5:BC_lambda) back into the first
    block row of Equation [(5.1.3)](lec5.1-equality_constraints.html#eq:lec5:BC_KKT),
    we derive the following equation:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将方程 [(5.2.1)](#eq:lec5:BC_lambda) 代回到方程 [(5.1.3)](lec5.1-equality_constraints.html#eq:lec5:BC_KKT)
    的第一行块中，我们得到以下方程：
- en: (I−ATA)HΔx=(I−ATA)(−g).(5.2.2)
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: (I−ATA)HΔx=(I−ATA)(−g).(5.2.2)
- en: 'Here, left-multiplying by \((I - A^T A)\) effectively zeroes out the rows corresponding
    to the BC nodes. Hence, Equation [(5.2.2)](#eq:lec5:BC_lambda_solved) represents
    an under-constrained system. However, the second block row of Equation [(5.1.3)](lec5.1-equality_constraints.html#eq:lec5:BC_KKT)
    actually provides us with the values of \(\Delta x\) at the BC nodes (so they
    are not really unknowns). By considering this information, we can rewrite Equation
    [(5.2.2)](#eq:lec5:BC_lambda_solved) into a Symmetric Positive Definite (SPD)
    system:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，左乘以 \((I - A^T A)\) 有效地消除了对应于边界条件节点的行。因此，方程 [(5.2.2)](#eq:lec5:BC_lambda_solved)
    表示一个欠约束系统。然而，方程 [(5.1.3)](lec5.1-equality_constraints.html#eq:lec5:BC_KKT) 的第二行块实际上为我们提供了边界条件节点处的
    \(\Delta x\) 值（因此它们实际上并不是未知数）。考虑到这一信息，我们可以将方程 [(5.2.2)](#eq:lec5:BC_lambda_solved)
    重写为一个对称正定（SPD）系统：
- en: HUB​ΔxB​+HUU​ΔxU​=−gU​,
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: HUBΔxB+HUUΔxU=−gU,
- en: 'where the matrices and vectors are partitioned as follows:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 其中矩阵和向量按以下方式划分：
- en: H=[HBB​HUB​​HBU​HUU​​],Δx=[ΔxB​ΔxU​​],g=[gB​gU​​],
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: H=[HBBHUBHBUHUU],Δx=[ΔxBΔxU],g=[gBgU],
- en: 'and the subscript \(B\) denotes the BC nodes. Knowing that \(\Delta x_B = 0\),
    the system simplifies to:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 其中下标 \( B \) 表示边界条件节点。知道 \(\Delta x_B = 0\)，系统简化为：
- en: HUU​ΔxU​=−gU​,(5.2.3)
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: HUUΔxU=−gU,(5.2.3)
- en: which represents a SPD system that excludes the BC nodes.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 这代表了一个排除边界条件节点的 SPD 系统。
- en: '[A More Practical Approach](#a-more-practical-approach)'
  id: totrans-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[更实用的方法](#a-more-practical-approach)'
- en: The method outlined above serves primarily for mathematical explanation. In
    practical applications, constructing Equation [(5.2.3)](#eq:lec5:BC_final_system)
    is often avoided. This is because it entails reordering degrees of freedom (DOFs)
    and separating the BC nodes from unconstrained nodes, a process that can be both
    tedious and inefficient, particularly when the set of Dirichlet nodes varies over
    time.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 上文概述的方法主要用于数学解释。在实际应用中，构建方程 [(5.2.3)](#eq:lec5:BC_final_system) 常常被避免。这是因为它涉及到重新排列自由度（DOFs）并将边界条件节点与无约束节点分离，这个过程既繁琐又低效，尤其是在狄利克雷节点集合随时间变化时。
- en: To circumvent the need to reorder DOFs, a direct modification of the original
    linear system can be made to align it with Equation [(5.2.3)](#eq:lec5:BC_final_system).
    This adjustment involves setting all entries in the rows corresponding to BC nodes
    in \( H \) and \( g \) to \( 0 \). Additionally, for the columns associated with
    BC nodes in \( H \), all off-diagonal entries are set to \( 0 \) while diagonal
    entries are assigned \( 1 \) or another positive real number to ensure the system
    remains well-conditioned. After solving this modified system, the resulting values
    of \( \Delta x_U \) are immediately aquired, and all \( \Delta x_B \) values are
    guaranteed to be \( 0 \).
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免重新排列自由度（DOFs）的需要，可以对原始线性系统进行直接修改，使其与方程 [(5.2.3)](#eq:lec5:BC_final_system)
    对齐。这种调整涉及将 \( H \) 和 \( g \) 中对应于边界条件节点的行的所有条目设置为 \( 0 \)。此外，对于与 \( H \) 中边界条件节点关联的列，所有非对角条目都设置为
    \( 0 \)，而对角条目被分配为 \( 1 \) 或另一个正实数，以确保系统保持良好的条件。在解这个修改后的系统后，\( \Delta x_U \) 的结果值立即获得，并且所有
    \( \Delta x_B \) 值都保证为 \( 0 \)。
- en: '**Example 5.2.1 (DOF Elimination).** For the problem defined in [Example 5.1.1](lec5.1-equality_constraints.html#exp:lec5:dbc)
    where the second node \((x_{21}, x_{22})\) is fixed at \((1,2)\) in a 2D two-node
    system, assuming in a certain iteration of a time step H=​4−1−1−1​−14−1−1​−1−14−1​−1−1−14​​,andg=​1234​​,
    we solve the system ​4−100​−1400​0010​0001​​​Δx11​Δx12​Δx21​Δx22​​​=​−1−200​​.(5.2.4)
    for search direction \(\Delta x\) so that \(\Delta x_{21} = \Delta x_{22} = 0\)
    and after line search we for sure know that \((x_{21}, x_{22}) = (1, 2)\) still
    holds since (x21​+αΔx21​,x22​+αΔx22​)=(x21​,x22​). Here [(5.2.4)](#eq:sec5:BC_projected_system)
    is essentially [HUU​​I​][ΔxU​ΔxB​​]=[−gU​0​]'
  id: totrans-20
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**示例 5.2.1（自由度消除）**。对于在 [示例 5.1.1](lec5.1-equality_constraints.html#exp:lec5:dbc)
    中定义的问题，其中第二个节点 \((x_{21}, x_{22})\) 在一个二维两节点系统中固定在 \((1,2)\)，假设在某个时间步的某次迭代中 \(
    H=4-1-1-1-1/4-1-1-1-1/4-1-1-1/4 \)，且 \( g=1,2,3,4 \)，我们解系统 \( 4-1\ 0\ 0\ 0\ -1\
    4\ 0\ 0\ 0\ 0\ 0\ 0\ 1\ 0\ 0\ 0\ 0\ 0\ 0\ 1 \) \(\Delta x_{11}\ \Delta x_{12}\
    \Delta x_{21}\ \Delta x_{22}\) \(=\ -1\ -2\ 0\ 0\ \) \(\) \((5.2.4)\) 对于搜索方向 \(\Delta
    x\)，使得 \(\Delta x_{21} = \Delta x_{22} = 0\)，并且在单行搜索之后，我们肯定知道 \((x_{21}, x_{22})
    = (1, 2)\) 仍然成立，因为 \((x_{21} + \alpha \Delta x_{21}, x_{22} + \alpha \Delta x_{22})
    = (x_{21}, x_{22})\)。这里 [(5.2.4)](#eq:sec5:BC_projected_system) 实质上是 \([HUU][\Delta
    x_U \Delta x_B] = [-g_U 0]\)。'
- en: '***Remark 5.2.1 (Limitations of DOF Elimination).*** The DOF elimination method
    described is effective when sticky BC nodes are established at the beginning of
    the time step. However, if this is not the case, and the constraint function in
    Equation [(5.1.3)](lec5.1-equality_constraints.html#eq:lec5:BC_KKT) has a non-zero
    right-hand side (rhs), the DOF elimination method becomes inapplicable. The issue
    here is not the inability to solve for \( \Delta x \) under constraints with a
    non-zero rhs. Rather, the concern is that the resulting \( \Delta x \) might not
    lead to a descent direction in the Incremental Potential. This can result in exceedingly
    small step sizes after a line search, potentially stalling the optimization process.'
  id: totrans-21
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***注 5.2.1（自由度消除方法的局限性）***。所描述的自由度消除方法在时间步开始时建立粘性边界条件节点时是有效的。然而，如果情况不是这样，并且方程
    [(5.1.3)](lec5.1-equality_constraints.html#eq:lec5:BC_KKT) 中的约束函数具有非零的右侧（rhs），则自由度消除方法就不再适用。这里的问题不是在具有非零
    rhs 的约束下无法求解 \( \Delta x \)。相反，关注的是，得到的 \( \Delta x \) 可能不会导致增量势中的下降方向。这可能导致单行搜索后步长极其小，从而可能使优化过程停滞。'
- en: ''
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Intuitively, if the direction of \( \Delta x_B \) is towards the prescribed
    BC coordinates, it could inadvertently increase the Incremental Potential, which
    is not adjusted to consider the BCs. Conversely, if \( \Delta x_B \) is simply
    \( 0 \) when the BCs are already satisfied, it effectively minimizes the Incremental
    Potential using a subset of variables, which remains a valid approach.
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 直观上，如果 \( \Delta x_B \) 的方向指向预定的边界条件（BC）坐标，它可能会无意中增加增量势，而这并没有考虑到边界条件。相反，如果 \(
    \Delta x_B \) 在边界条件已经满足时简单地为 \( 0 \)，它实际上使用变量子集最小化了增量势，这仍然是一个有效的方法。
- en: ''
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: One might then ask why not adjust the DOFs to meet the BCs before starting the
    optimization. However, this strategy could lead to infeasible configurations,
    such as those involving intersections. A viable alternative is to initially apply
    stiff spring forces to gradually 'drag' the BC nodes to their constrained positions
    during optimization. After this, switching to the DOF elimination method can enhance
    convergence. This technique is further discussed in the section [Moving Boundary
    Conditions*](lec11-mov_DBC.html).
  id: totrans-25
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 人们可能会问，为什么不在开始优化之前调整自由度以满足边界条件。然而，这种策略可能会导致不可行的配置，例如涉及交叉的情况。一个可行的替代方案是在优化过程中最初应用刚性的弹簧力，逐渐地将边界条件节点“拖动”到它们的约束位置。之后，切换到自由度消除方法可以增强收敛性。这一技术将在[移动边界条件*](lec11-mov_DBC.html)部分进一步讨论。
