- en: Chapter 13 Visualization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 13 章 可视化
- en: 原文：[https://randpythonbook.netlify.app/visualization](https://randpythonbook.netlify.app/visualization)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://randpythonbook.netlify.app/visualization](https://randpythonbook.netlify.app/visualization)
- en: I describe a few plotting paradigms in R and Python below. Note that these descriptions
    are brief. More details could easily turn any of these subsections into an entire
    textbook.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我在下面描述了 R 和 Python 中的几个绘图范例。请注意，这些描述是简短的。更多的细节可以很容易地将任何这些小节变成一本完整的教科书。
- en: 13.1 Base R Plotting
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.1 基础 R 绘图
- en: R comes with some built-in plotting functions such as `plot()`, `hist()` and
    `boxplot()`. Many of these reside in `package:graphics`, which comes pre-loaded
    into the search path. `plot()` on the other hand, is higher up the search path
    in `package:base`–it is a generic method whose methods can reside in many places
    (e.g. in `package:graphics` or some place else).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: R 随带一些内置的绘图函数，如 `plot()`、`hist()` 和 `boxplot()`。其中许多位于 `package:graphics` 中，该包预先加载到搜索路径中。另一方面，`plot()`
    在 `package:base` 的搜索路径中更高——它是一个通用方法，其方法可以位于许多地方（例如在 `package:graphics` 或其他地方）。
- en: Base plotting will usually cover most of your needs, so that is what we spend
    the most time learning about. However, there are a large number of third-party
    libraries for plotting that you might consider looking into if you want to use
    a certain aesthetic, or if you want plotting functionality that is specialized
    for certain cases (e.g. geospatial plots).
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 基础绘图通常可以满足大部分需求，因此这是我们花费最多时间学习的。然而，有许多第三方绘图库可以考虑，如果你想要使用某种美学，或者如果你想要针对特定情况（例如地理空间绘图）的特定绘图功能。
- en: Recall our Albemarle Real Estate data set (Albemarle County Geographic Data
    Services Office [2021](#ref-albemarle_county_gis_web)) (Ford [2016](#ref-clay_ford)).
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 回想一下我们的阿勒姆房地产数据集（阿勒姆县地理信息服务办公室 [2021](#ref-albemarle_county_gis_web)（福特 [2016](#ref-clay_ford)）。
- en: '[PRE0]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: If we wanted to get a general idea of how expensive homes were in Albemarle
    County, we could use a histogram. This helps us visualize a univariate numerical
    variable/column. Below I plot the (natural) logarithm of home prices.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要了解阿勒姆县豪宅的大致价格，我们可以使用直方图。这有助于我们可视化单变量数值变量/列。以下我绘制了房价的自然对数。
- en: '[PRE1]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![A Simple Histogram](../Images/362d8955c8588b70bbc930803c87dab5.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![一个简单的直方图](../Images/362d8955c8588b70bbc930803c87dab5.png)'
- en: 'Figure 13.1: A Simple Histogram'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.1：一个简单的直方图
- en: I specified the `xlab=` and `main=` arguments, but there are many more that
    could be tweaked. Make sure to skim the options in the documentation (`?hist`).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 我指定了 `xlab=` 和 `main=` 参数，但还有许多其他可以调整的参数。确保查阅文档中的选项（`?hist`）。
- en: '`plot()` is useful for plotting *two* univariate numerical variables. This
    can be done in time series plots (variable versus time) and scatter plots (one
    variable versus another).'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '`plot()` 对于绘制两个单变量数值变量很有用。这可以通过时间序列图（变量与时间）和散点图（一个变量与另一个变量）来完成。'
- en: '[PRE2]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![Some Scatterplots](../Images/d5e2b5acb1f9767219c34658dd03f57f.png)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![一些散点图](../Images/d5e2b5acb1f9767219c34658dd03f57f.png)'
- en: 'Figure 13.2: Some Scatterplots'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.2：一些散点图
- en: '[PRE3]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: I use some of the many arguments available (type `?plot`). `xlab=` and `ylab=`
    specify the x- and y-axis labels, respectively. `col=` is short for “color.” `pch=`
    is short for “point character.” Changing this will change the symbol shapes used
    for each point. `type=` is more general than that, but it is related. I typically
    use it to specify whether or not I want the points connected with lines.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 我使用了一些可用的许多论证之一（输入 `?plot`）。`xlab=` 和 `ylab=` 分别指定 x 轴和 y 轴的标签。`col=` 是“颜色”的缩写。`pch=`
    是“点字符”的缩写。更改此值将改变每个点使用的符号形状。`type=` 比这更通用，但它与之相关。我通常用它来指定是否想要用线连接点。
- en: I use a couple other functions in the above code. `abline()` is used to superimpose
    lines over the top of a plot. They can be `h`orizontal, `v`ertical, or you can
    specify them in slope-intercept form, or by providing a linear model object. I
    also used `par()` to set a graphical parameter. The graphical parameter `par()$mfrow`
    sets the layout of a multiple plot visualization. I then set it back to the standard
    \(1 \times 1\) layout afterwards.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我在上面的代码中使用了其他几个函数。`abline()` 用于在图表上方叠加线条。它们可以是水平的、垂直的，或者你可以用斜率-截距形式指定它们，或者通过提供线性模型对象来指定。我还使用了
    `par()` 来设置图形参数。图形参数 `par()$mfrow` 设置了多图可视化的布局。然后我将它设置回标准的 \(1 \times 1\) 布局。
- en: 13.2 Plotting with `ggplot2`
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.2 使用 `ggplot2` 绘图
- en: '[`ggplot2`](https://ggplot2.tidyverse.org/) is a popular third-party visualization
    package for R. There are also libraries in Python (e.g. [`plotnine`](https://plotnine.readthedocs.io/en/stable/#))
    that have a similar look and feel. This subsection provides a short tutorial on
    how to use `ggplot2` in R, and it is primarily based off of the material provided
    in (Wickham [2016](#ref-ggplot2)). Other excellent descriptions of `ggplot2` are
    (Kabacoff [2015](#ref-r_in_action)) and (Chang [2013](#ref-r_graphics_cookbook)).'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '[`ggplot2`](https://ggplot2.tidyverse.org/)是R的一个流行的第三方可视化包。Python（例如，[`plotnine`](https://plotnine.readthedocs.io/en/stable/#)）中也有类似的库。本节提供了一个关于如何在R中使用`ggplot2`的简要教程，它主要基于（Wickham
    [2016](#ref-ggplot2)）中提供的材料。关于`ggplot2`的其他优秀描述包括（Kabacoff [2015](#ref-r_in_action)）和（Chang
    [2013](#ref-r_graphics_cookbook)）。'
- en: '`ggplot2` code looks a lot different than the code in the above section[^(21)](#fn21).
    There, we would write a series of function calls, and each would change some state
    in the current figure. Here, we call different `ggplot2` functions that create
    S3 objects with special behavior (more information about S3 objects in subsection
    [14.2.2](/an-introduction-to-object-oriented-programming#using-s3-objects)), and
    then we “add” (i.e. we use the `+` operator) them together.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot2`的代码看起来与上面章节[^(21)](#fn21)中的代码大不相同。在那里，我们会编写一系列函数调用，每个调用都会改变当前图形的状态。在这里，我们调用不同的`ggplot2`函数来创建具有特殊行为的S3对象（关于S3对象的更多信息，请参阅子节[14.2.2](/an-introduction-to-object-oriented-programming#using-s3-objects)），然后我们将它们“添加”在一起（即使用`+`运算符）。'
- en: This new design is not to encourage you to think about S3 object-oriented systems.
    Rather, it is to get you thinking about making visualizations using the “grammar
    of graphics” (Wilkinson [2005](#ref-gog)). `ggplot2` makes use of its own specialized
    vocabulary that is taken from this book. As we get started, I will try to introduce
    some of this vocabulary slowly.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这个新设计的目的不是鼓励你思考S3面向对象系统，而是让你思考如何使用“图形语法”（Wilkinson [2005](#ref-gog)）进行可视化。`ggplot2`利用了从这本书中提取的专用词汇。在我们开始之前，我会尝试慢慢介绍一些这些词汇。
- en: The core function in this library is the [`ggplot()` function](https://www.rdocumentation.org/packages/ggplot2/versions/3.3.5/topics/ggplot).
    This function initializes figures; it is the function that will take in information
    about *which* data set you want to plot, and *how* you want to plot it. The raw
    data is provided in the first argument. The second argument, `mapping=`, is more
    confusing. The argument should be constructed with the `aes()` function. In the
    parlance of `ggplot2`, `aes()` constructs an **aesthetic mapping**. Think of the
    “aesthetic mapping” as stored information that can be used later on–it “maps”
    data to visual properties of a figure.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 该库的核心函数是`[`ggplot()`函数](https://www.rdocumentation.org/packages/ggplot2/versions/3.3.5/topics/ggplot)。此函数初始化图形；它是将关于*哪个*数据集你想绘制以及*如何*绘制它的信息接收进来的函数。原始数据由第一个参数提供。第二个参数`mapping=`更复杂。该参数应该使用`aes()`函数构建。在`ggplot2`的术语中，`aes()`构建一个**审美映射**。将“审美映射”想象为可以稍后使用的存储信息——它“映射”数据到图形的视觉属性。
- en: Consider this first example by typing the following into your own console.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 请考虑以下第一个示例，将以下内容输入到自己的控制台中。
- en: '[PRE4]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'You’ll notice a few things about the code and the result produced:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 你会注意到代码和结果中的一些事情：
- en: No geometric shapes show up!
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 没有几何形状出现！
- en: A Cartesian coordinate system is displayed, and the x-axis and y-axis were created
    based on aesthetic mapping provided (confirm this by typing `summary(mpg$displ)`
    and `summary(mpg$hwy)`).
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示了一个笛卡尔坐标系，x轴和y轴是基于提供的审美映射创建的（通过输入`summary(mpg$displ)`和`summary(mpg$hwy)`来确认这一点）。
- en: The axis labels are taken from the column names provided to `aes()`.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 轴标签是从提供给`aes()`的列名中提取的。
- en: 'To display geometric shapes (aka *geoms* in the parlance of `ggplot2`), we
    need to add [**layers**](https://ggplot2-book.org/toolbox.html#toolbox) to the
    figure. “Layers” is quite a broad term–it does not only apply to geometric objects.
    In fact, in `ggplot2`, a layer can be pretty much anything: raw data, summarized
    data, transformed data, annotations, etc. However, the functions that add geometric
    object layers usually start with the prefix `geom_`. In RStudio, after loading
    `ggplot2`, type `geom_`, and then press `<Tab>` (autocomplete) to see some of
    the options.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 要显示几何形状（在`ggplot2`的术语中称为*geoms*），我们需要向图中添加[**层**](https://ggplot2-book.org/toolbox.html#toolbox)。层是一个相当宽泛的术语——它不仅适用于几何对象。实际上，在`ggplot2`中，一个层几乎可以是任何东西：原始数据、汇总数据、转换数据、注释等。然而，添加几何对象层的函数通常以`geom_`前缀开头。在RStudio中，在加载`ggplot2`后，输入`geom_`，然后按`<Tab>`（自动完成）以查看一些选项。
- en: Consider the function [`geom_point()`](https://www.rdocumentation.org/packages/ggplot2/versions/3.3.5/topics/geom_point).
    It too returns an S3 instance that has specialized behavior. In the parlance of
    `ggplot2`, it adds a [scatterplot](https://ggplot2-book.org/getting-started.html#basic-use)
    layer to the figure.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑函数`[`geom_point()`](https://www.rdocumentation.org/packages/ggplot2/versions/3.3.5/topics/geom_point)。它同样返回一个具有特殊行为的S3实例。在`ggplot2`的术语中，它向图中添加了一个[散点图](https://ggplot2-book.org/getting-started.html#basic-use)层。
- en: '[PRE5]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![A Second Scatterplot](../Images/d3cf3b67f644b3cdceb572820881accf.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![第二个散点图](../Images/d3cf3b67f644b3cdceb572820881accf.png)'
- en: 'Figure 13.3: A Second Scatterplot'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.3：第二个散点图
- en: Notice that we did not need to provide any arguments to `geom_point()`–the aesthetic
    mappings were used by the new layer.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我们不需要为`geom_point()`提供任何参数——美学映射是由新层使用的。
- en: There are *many* types of layers that you can add, and you are not limited to
    any number of them in a given plot. For example, if we wanted to add a title,
    we could use the `ggtitle()` function to add a title layer. Unlike `geom_point()`,
    this function will need to take an argument because the desired title is not stored
    as an aesthetic mapping. Try running the following code on your own machine.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以添加许多类型的层，并且在一个给定的图表中，你不受层数数量的限制。例如，如果我们想添加一个标题，我们可以使用`ggtitle()`函数来添加一个标题层。与`geom_point()`不同，这个函数需要接受一个参数，因为期望的标题并不是存储为美学映射。尝试在你的机器上运行以下代码。
- en: '[PRE6]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Additionally, notice that the same layer will behave much differently if we
    change the aesthetic mapping.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，请注意，如果我们更改美学映射，相同的层将会有很大的不同表现。
- en: '[PRE7]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![Adding Some Color](../Images/c6f1cb8b5937df541e5d00312e9a7a22.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![添加一些颜色](../Images/c6f1cb8b5937df541e5d00312e9a7a22.png)'
- en: 'Figure 13.4: Adding Some Color'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.4：添加一些颜色
- en: If we want tighter control on the aesthetic mapping, we can use [**scales**](https://ggplot2-book.org/scales.html#scales).
    Syntactically, these are things we “add” (`+`) to the figure, just like layers.
    However, these scales are constructed with a different set of functions, many
    of which start with the prefix `scale_`. We can change attributes of the axes
    like this.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要对美学映射有更紧密的控制，我们可以使用[**刻度**](https://ggplot2-book.org/scales.html#scales)。在语法上，这些是我们“添加”到图中的东西（`+`），就像层一样。然而，这些刻度是由一组不同的函数构建的，其中许多以`scale_`前缀开头。我们可以这样更改轴的属性。
- en: '[PRE8]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![Changing Scales](../Images/63bd87feba98b8bc142609f495b21960.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![更改刻度](../Images/63bd87feba98b8bc142609f495b21960.png)'
- en: 'Figure 13.5: Changing Scales'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.5：更改刻度
- en: We can also change plot colors with scale layers. Let’s add an aesthetic called
    `fill=` so we can use colors to denote the value of a numerical (not categorical)
    column. This data set doesn’t have any more unused numerical columns, so let’s
    create a new one called `score`. We also use a new geom layer from a function
    called `geom_tile()`.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以使用刻度层来更改图表颜色。让我们添加一个名为`fill=`的美学，这样我们就可以使用颜色来表示数值（非分类）列的值。这个数据集没有更多未使用的数值列，所以让我们创建一个新的列名为`score`。我们还使用了一个名为`geom_tile()`的新几何层函数。
- en: '[PRE9]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![Changing the Fill](../Images/cd138860430c2e4d46edaaa5854e4c2f.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![更改填充](../Images/cd138860430c2e4d46edaaa5854e4c2f.png)'
- en: 'Figure 13.6: Changing the Fill'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.6：更改填充
- en: If we didn’t like these colors, we could change them with a scale layer. Personally,
    I like this one.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们不喜欢这些颜色，我们可以使用刻度层来更改它们。我个人喜欢这个。
- en: '[PRE10]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![Changing the Fill Again](../Images/0ee730b41fcb176481f738eb62bd4602.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![再次更改填充](../Images/0ee730b41fcb176481f738eb62bd4602.png)'
- en: 'Figure 13.7: Changing the Fill Again'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.7：再次更改填充
- en: There are many to choose from, though. Try to run the following code on your
    own to see what it produces.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然有很多选择，但尝试在自己的机器上运行以下代码，看看它会产生什么结果。
- en: '[PRE11]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 13.3 Plotting with Matplotlib
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.3 使用Matplotlib绘图
- en: Matplotlib (Hunter [2007](#ref-Hunter:2007)) is a third-party visualization
    library in Python. It is the oldest and most heavily-used, so it is the best way
    to start making graphics in Python, in my humble opinion. It also comes installed
    with Anaconda.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: Matplotlib（Hunter [2007](#ref-Hunter:2007)）是Python中的一个第三方可视化库。它是最古老且使用最广泛的，因此在我看来，它是开始使用Python制作图形的最佳方式。它也随Anaconda一起安装。
- en: This short introduction borrows heavily from the myriad of [tutorials](https://matplotlib.org/stable/tutorials/index.html)
    on Matplotlib’s website. I will start off making a simple plot, and commenting
    on each line of code. If you’re interested in learning more, (VanderPlas [2016](#ref-py_ds_handbook))
    and (McKinney [2017](#ref-pandas_guy)) are also terrific resources.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这篇简短介绍大量借鉴了Matplotlib网站上的众多[tutorials](https://matplotlib.org/stable/tutorials/index.html)。我将从一个简单的图表开始，并对每一行代码进行注释。如果你对学习更多感兴趣，(VanderPlas
    [2016](#ref-py_ds_handbook))和(McKinney [2017](#ref-pandas_guy))也是极好的资源。
- en: You can use either “pyplot-style” (e.g. `plt.plot()`) or “object-oriented-style”
    to make figures in Matplotlib. Even though using the first type is faster to make
    simple plots, I will only describe the second one. It is the recommended approach
    because it is more extensible. However, the first one resembles the syntax of
    MATLAB. If you’re familiar with MATLAB, you might consider learning a little about
    the first style, as well.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用“pyplot-style”（例如`plt.plot()`）或“面向对象-style”在Matplotlib中制作图表。尽管使用第一种类型制作简单图表更快，但我只会描述第二种。这是推荐的方法，因为它更易于扩展。然而，第一种类型与MATLAB的语法相似。如果你熟悉MATLAB，你可能也会考虑学习一点关于第一种风格的知识。
- en: '[PRE12]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![Another Simple Histogram](../Images/cda72ae653628ff6c60151e762733f74.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![另一个简单的直方图](../Images/cda72ae653628ff6c60151e762733f74.png)'
- en: 'Figure 13.8: Another Simple Histogram'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.8：另一个简单的直方图
- en: In the first line, we import the `pyplot` submodule of `matplotlib`. We rename
    it to `plt`, which is short, and will save us some typing. Calling it `plt` follows
    the most popular naming convention.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一行，我们导入`matplotlib`的`pyplot`子模块。我们将其重命名为`plt`，这很简洁，并且可以节省我们一些输入。将其命名为`plt`遵循最流行的命名约定。
- en: Second, we import Numpy in the same way we always have. Matplotlib is written
    to work with Numpy arrays. If you want to plot some data, and it isn’t in a Numpy
    array, you should convert it first.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 第二，我们以我们通常的方式导入Numpy。Matplotlib是为与Numpy数组一起使用而编写的。如果你想绘制一些数据，而这些数据不在Numpy数组中，你应该先将其转换。
- en: Third, we call the `subplots()` function, and use *sequence unpacking* to unpack
    the returned container into individual objects without storing the overall container.
    “Subplots” sounds like it will make many different plots all on one figure, but
    if you look at the [documentation](https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib-pyplot-subplots)
    the number of rows and columns defaults to one and one, respectively.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 第三，我们调用`subplots()`函数，并使用*序列解包*将返回的容器解包成单独的对象，而不存储整体容器。“Subplots”听起来像它将在一个图表上制作许多不同的图表，但如果你查看[文档](https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib-pyplot-subplots)，行数和列数默认分别为一和一。
- en: '`plt.subplots()` returns a [`tuple`](https://docs.python.org/3.3/library/stdtypes.html?highlight=tuple#tuple)[^(22)](#fn22)
    of two things: a `Figure` object, and one or more `Axes` object(s). These two
    classes will require some explanation.'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '`plt.subplots()`返回一个包含两个东西的[`tuple`](https://docs.python.org/3.3/library/stdtypes.html?highlight=tuple#tuple)[^(22)](#fn22)：一个`Figure`对象和一个或多个`Axes`对象。这两个类将需要一些解释。'
- en: A [`Figure` object](https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure)
    is the overall visualization object you’re making. It holds onto all of the plot
    elements. If you want to save all of your progress (e.g. with `fig.savefig('my_picture.png')`),
    you’re saving the overall `Figure` object.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个[`Figure`对象](https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure)是你正在创建的整体可视化对象。它保留了所有的绘图元素。如果你想保存所有的进度（例如，使用`fig.savefig('my_picture.png')`），你正在保存整体的`Figure`对象。
- en: One or more [`Axes` objects](https://matplotlib.org/stable/api/axes_api.html#the-axes-class)
    are contained in a `Figure` object. Each is “[what you think of as ‘a plot’](https://matplotlib.org/stable/tutorials/introductory/usage.html#axes).”
    They hold onto two `Axis` objects (in the case of 2-dimensional plots) or three
    (in the case of 3-dimensional arguments). We are usually calling the methods of
    these objects to effect changes on a plot.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个或多个 `Axes` 对象包含在一个 `Figure` 对象中。每个都是 “[你想象中的‘一个图表’](https://matplotlib.org/stable/tutorials/introductory/usage.html#axes)”。它们包含两个
    `Axis` 对象（对于二维图表）或三个（对于三维参数）。我们通常调用这些对象的方法来对图表进行更改。
- en: In line four, we call the [`hist()` method](https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.hist.html#matplotlib.axes.Axes.hist)
    of the `Axes` object called `ax`. We assign the output of `.hist()` to a variable
    `_`. This is done to suppress the printing of the method’s output, and because
    this variable name is a Python convention that signals the object is temporary
    and will not be used later in the program. There are many more plots available
    than plain histograms. Each one has its own method, and you can peruse the options
    in [the documentation](https://matplotlib.org/stable/api/axes_api.html#plotting).
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在第四行，我们调用名为 `ax` 的 `Axes` 对象的 `hist()` 方法。我们将 `.hist()` 的输出赋值给变量 `_`。这样做是为了抑制方法输出的打印，并且因为这个变量名是
    Python 的一个约定，表示该对象是临时的，在程序中不会再次使用。除了普通的直方图之外，还有很多其他类型的图表。每一种都有自己的方法，你可以在 [文档](https://matplotlib.org/stable/api/axes_api.html#plotting)
    中查看选项。
- en: If you want to make figures that are more elaborate, just keep calling different
    methods of `ax`. If you want to fit more subplots to the same figure, add more
    `Axes` objects. Here is an example using some code from [one of the official Matplotlib
    tutorials](https://matplotlib.org/stable/tutorials/introductory/usage.html#the-object-oriented-interface-and-the-pyplot-interface).
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要制作更复杂的图表，只需不断调用 `ax` 的不同方法。如果你想将更多的子图放入同一个图表中，添加更多的 `Axes` 对象。以下是一个使用来自
    [官方 Matplotlib 教程](https://matplotlib.org/stable/tutorials/introductory/usage.html#the-object-oriented-interface-and-the-pyplot-interface)
    的一些代码的示例。
- en: '[PRE13]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![Side-By-Side Line Plots in Matplotlib](../Images/0da9bf6addb001f8c89a75996921a096.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![Matplotlib 中的并排线图](../Images/0da9bf6addb001f8c89a75996921a096.png)'
- en: 'Figure 13.9: Side-By-Side Line Plots in Matplotlib'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.9：Matplotlib 中的并排线图
- en: 13.4 Plotting with Pandas
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.4 使用 Pandas 绘图
- en: Pandas provides several `DataFrame` and `Series` methods that perform plotting.
    These methods are mostly just wrapper functions around Matplotlib code. They are
    written for convenience, so generally speaking, plotting can be done more quickly
    with Pandas compared to Matplotlib. Here I describe a few options that are available,
    and [the documentation](https://pandas.pydata.org/docs/user_guide/visualization.html#chart-visualization)
    provides many more details for the curious reader.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas 提供了几个 `DataFrame` 和 `Series` 方法来执行绘图。这些方法主要是围绕 Matplotlib 代码的包装函数。它们是为了方便而编写的，所以一般来说，与
    Matplotlib 相比，使用 Pandas 绘图可以更快。这里我描述了一些可用的选项，并且 [文档](https://pandas.pydata.org/docs/user_guide/visualization.html#chart-visualization)
    为好奇的读者提供了更多细节。
- en: 'The [`.plot()`](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.plot.html)
    method is very all-encompassing because it allows you to choose between many different
    plot types: a line plot, horizontal and vertical bar plots, histograms, boxplots,
    density plots, area plots, pie charts, scatterplots and hexbin plots. If you only
    want to remember one function name for plotting in Pandas, this is it.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '`.plot()` 方法非常全面，因为它允许你选择许多不同的绘图类型：折线图、水平条形图和垂直条形图、直方图、箱线图、密度图、面积图、饼图、散点图和六边形图。如果你只想记住
    Pandas 中用于绘图的一个函数名，那就是它。'
- en: If you already have Pandas `import`ed, you can make good-looking plots in just
    one line of code. The default plot type for `.plot()` is a line plot, so there
    tends to be less typing if you’re working with time series data.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经导入了 Pandas `import`，你只需一行代码就能制作出漂亮的图表。`.plot()` 的默认绘图类型是折线图，所以如果你处理的是时间序列数据，通常输入会更少。
- en: '[PRE14]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Choosing among nondefault plot types can be done in a variety of ways. You can
    either use the `.plot` accessor data member of a `DataFrame`, or you can pass
    in different strings to `.plot()`’s `kind=` parameter. Third, some plot types
    (e.g. boxplots and histograms) have their own dedicated methods.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在非默认的绘图类型中进行选择可以有多种方式。你可以使用 `DataFrame` 的 `.plot` 访问器数据成员，或者你可以向 `.plot()` 的
    `kind=` 参数传递不同的字符串。第三，一些绘图类型（例如箱线图和直方图）有自己的专用方法。
- en: '[PRE15]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: There are also [several freestanding plotting functions](https://pandas.pydata.org/docs/user_guide/visualization.html#visualization-tools)
    (not methods) that take in `DataFrame`s and `Series` objects. Each of these functions
    is typically imported individually from the `pandas.plotting` submodule.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 还有几个独立的绘图函数（不是方法），它们接受 `DataFrame` 和 `Series` 对象。这些函数通常是从 `pandas.plotting`
    子模块单独导入的。
- en: The following code is an example of creating a “lag plot,” which is simply a
    scatterplot between a time series’ lagged and nonlagged values. The primary benefit
    of this function over `.plot()` is that this function does not require you to
    construct an additional column of lagged values, and it comes up with good default
    axis labels.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码是创建“滞后图”的示例，这只是一个时间序列滞后值和非滞后值之间的散点图。这个函数相较于 `.plot()` 的主要优点是，这个函数不需要你构建一个额外的滞后值列，并且它提供了好的默认轴标签。
- en: '[PRE16]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 13.5 Exercises
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.5 练习
- en: 13.5.1 R Questions
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.5.1 R 问题
- en: The density of a particular bivariate Gaussian distribution is
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 特定的双变量高斯分布的密度是
- en: '\[ f(x,y) = \frac{1}{2 \pi} \exp\left[ -\frac{x ^2 + y^2}{2} \right] \tag{1}.
    \] The random elements \(X\) and \(Y\), in this particular case, are independent,
    each have unit variance, and zero mean. In this case, the marginal for \(X\) is
    a mean \(0\), unit variance normal distribution:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: \[ f(x,y) = \frac{1}{2 \pi} \exp\left[ -\frac{x ^2 + y^2}{2} \right] \tag{1}.
    \] 在这个特定的情况下，随机元素 \(X\) 和 \(Y\) 是独立的，每个都有单位方差和零均值。在这种情况下，\(X\) 的边缘分布是一个均值为 \(0\)，单位方差的正态分布：
- en: \[ g(x) = \frac{1}{\sqrt{2\pi}} \exp\left[ -\frac{x ^2 }{2} \right] \tag{2}.
    \]
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: \[ g(x) = \frac{1}{\sqrt{2\pi}} \exp\left[ -\frac{x ^2 }{2} \right] \tag{2}.
    \]
- en: Generate two plots of the bivariate density. For one, use `persp()`. For the
    other, use `contour()`.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成两个双变量密度的图。对于其中一个，使用 `persp()`。对于另一个，使用 `contour()`。
- en: Generate a third plot of the univariate density.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成第三个单变量密度的图。
- en: Consider again the Militarized Interstate Disputes (v5.0) (Palmer et al.) data
    set from [The Correlates of War Project](https://correlatesofwar.org/). A description
    of this data was given in the previous chapter. Feel free to re-use the code you
    used in the related exercise.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 再次考虑来自 [The Correlates of War Project](https://correlatesofwar.org/) 的 Militarized
    Interstate Disputes (v5.0) (Palmer et al.) 数据集。上一章中给出了该数据集的描述。请随意重新使用你在相关练习中使用的代码。
- en: Use a scatterplot to display the relationship between the maximum duration and
    the end year. Plot each country as a different color.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用散点图来显示最大持续时间和结束年份之间的关系。每个国家用不同的颜色来绘制。
- en: 13.5.2 Python Questions
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.5.2 Python 问题
- en: Reproduce figure [15.1](/an-introduction-to-functional-programming#fig:spline-plot))
    in section [15.2.1.1](/an-introduction-to-functional-programming#map) that displays
    the simple “spline” function. Feel free to use any of the visible code in the
    text.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [15.2.1.1](/an-introduction-to-functional-programming#map) 节中重现 [15.1](/an-introduction-to-functional-programming#fig:spline-plot))
    图，该图显示了简单的“样条”函数。请随意使用文本中可见的任何代码。
- en: The “4 Cs of diamonds”–or the four most important factors that explain a diamond’s
    price–are cut, color, clarity and carat. How does the price of diamonds vary as
    these three factors vary?
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: “钻石的4C”——或者解释钻石价格的四个最重要的因素——是切割、颜色、清晰度和克拉。随着这三个因素的变化，钻石的价格是如何变化的？
- en: Consider the data set `diamonds.csv` from (Wickham [2016](#ref-ggplot2)) and
    plot the `price` against `carat`.
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 考虑来自 (Wickham [2016](#ref-ggplot2)) 的数据集 `diamonds.csv` 并绘制 `price` 与 `carat`
    的关系图。
- en: Visualize the other categorical factors simultaneously. Determine the most elegant
    way of visualizing all four factors at once and create a plot that does that.
    Determine the worst way to visualize all factors at once, and create that plot
    as well.
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同时可视化其他分类因素。确定同时可视化所有四个因素的最优雅方式，并创建一个实现这一点的图。确定同时可视化所有因素的最差方式，并创建该图。
- en: References
  id: totrans-99
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参考文献
- en: Albemarle County Geographic Data Services Office. 2021\. “Albemarle County GIS
    Web.” [https://www.albemarle.org/government/community-development/gis-mapping/gis-data](https://www.albemarle.org/government/community-development/gis-mapping/gis-data).
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: Albemarle County Geographic Data Services Office. 2021\. “Albemarle County GIS
    Web.” [https://www.albemarle.org/government/community-development/gis-mapping/gis-data](https://www.albemarle.org/government/community-development/gis-mapping/gis-data).
- en: Chang, Winston. 2013\. *R Graphics Cookbook*. O’Reilly Media, Inc.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: Chang, Winston. 2013\. *R Graphics Cookbook*. O’Reilly Media, Inc.
- en: 'Ford, Clay. 2016\. “ggplot: Files for UVA StatLab workshop, Fall 2016.” *GitHub
    Repository*. [https://github.com/clayford/ggplot2](https://github.com/clayford/ggplot2);
    GitHub.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 'Ford, Clay. 2016\. “ggplot: Files for UVA StatLab workshop, Fall 2016.” *GitHub
    Repository*. [https://github.com/clayford/ggplot2](https://github.com/clayford/ggplot2);
    GitHub.'
- en: 'Hunter, J. D. 2007\. “Matplotlib: A 2D Graphics Environment.” *Computing in
    Science & Engineering* 9 (3): 90–95\. [https://doi.org/10.1109/MCSE.2007.55](https://doi.org/10.1109/MCSE.2007.55).'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 'Hunter, J. D. 2007\. “Matplotlib: A 2D Graphics Environment.” *Computing in
    Science & Engineering* 9 (3): 90–95\. [https://doi.org/10.1109/MCSE.2007.55](https://doi.org/10.1109/MCSE.2007.55).'
- en: Kabacoff, Robert I. 2015\. *R in Action*. Second. Manning. [http://www.worldcat.org/isbn/9781617291388](http://www.worldcat.org/isbn/9781617291388).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: Kabacoff, Robert I. 2015\. *R in Action*. Second. Manning. [http://www.worldcat.org/isbn/9781617291388](http://www.worldcat.org/isbn/9781617291388).
- en: 'McKinney, Wes. 2017\. *Python for Data Analysis: Data Wrangling with Pandas,
    Numpy, and Ipython*. 2nd ed. O’Reilly Media, Inc.'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 'McKinney, Wes. 2017\. *Python for Data Analysis: Data Wrangling with Pandas,
    Numpy, and Ipython*. 2nd ed. O’Reilly Media, Inc.'
- en: 'Palmer, Glenn, Roseanne W McManus, Vito D’Orazio, Michael R Kenwick, Mikaela
    Karstens, Chase Bloch, Nick Dietrich, Kayla Kahn, Kellan Ritter, and Michael J
    Soules“The Mid5 Dataset, 2011–2014: Procedures, Coding Rules, and Description.”
    *Conflict Management and Peace Science* 0 (0): 0738894221995743\. [https://doi.org/10.1177/0738894221995743](https://doi.org/10.1177/0738894221995743).'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 'Palmer, Glenn, Roseanne W McManus, Vito D’Orazio, Michael R Kenwick, Mikaela
    Karstens, Chase Bloch, Nick Dietrich, Kayla Kahn, Kellan Ritter, and Michael J
    Soules“The Mid5 Dataset, 2011–2014: Procedures, Coding Rules, and Description.”
    *Conflict Management and Peace Science* 0 (0): 0738894221995743\. [https://doi.org/10.1177/0738894221995743](https://doi.org/10.1177/0738894221995743).'
- en: 'VanderPlas, Jake. 2016\. *Python Data Science Handbook: Essential Tools for
    Working with Data*. 1st ed. O’Reilly Media, Inc.'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 'VanderPlas, Jake. 2016\. *Python Data Science Handbook: Essential Tools for
    Working with Data*. 1st ed. O’Reilly Media, Inc.'
- en: 'Wickham, Hadley. 2016\. *Ggplot2: Elegant Graphics for Data Analysis*. Springer-Verlag
    New York. [https://ggplot2.tidyverse.org](https://ggplot2.tidyverse.org).'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 'Wickham, Hadley. 2016\. *Ggplot2: Elegant Graphics for Data Analysis*. Springer-Verlag
    New York. [https://ggplot2.tidyverse.org](https://ggplot2.tidyverse.org).'
- en: 'Wilkinson, Leland. 2005\. *The Grammar of Graphics (Statistics and Computing)*.
    Berlin, Heidelberg: Springer-Verlag.'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 'Wilkinson, Leland. 2005\. *The Grammar of Graphics (Statistics and Computing)*.
    Berlin, Heidelberg: Springer-Verlag.'
- en: '* * *'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Personally, I find its syntax more confusing, and so I tend to prefer base graphics.
    However, it is very popular, and so I do believe that it is important to mention
    it here in this text.[↩](/visualization#fnref21)
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 个人而言，我发现它的语法更令人困惑，因此我倾向于更喜欢基础图形。然而，它非常受欢迎，因此我相信在这里提到它是很重要的。[↩](/visualization#fnref21)
- en: 'We didn’t talk about `tuple`s in chapter 2, but you can think of them as being
    similar to `list`s. They are containers that can hold elements of different types.
    There are a few key differences, though: they are made with parentheses (e.g. `(''a'')`
    ) instead of square brackets, and they are immutable instead of mutable.[↩](/visualization#fnref22)'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们在第2章中没有讨论`元组`，但你可以把它们想象成与`列表`类似。它们是能够容纳不同类型元素的容器。尽管如此，它们之间有几个关键的区别：它们是用圆括号（例如`('a')`）而不是方括号创建的，并且它们是不可变的而不是可变的。[↩](/visualization#fnref22)
