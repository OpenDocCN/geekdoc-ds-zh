- en: Online Appendix G — Production
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在线附录 G — 生产
- en: 原文：[https://tellingstorieswithdata.com/26-deploy.html](https://tellingstorieswithdata.com/26-deploy.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://tellingstorieswithdata.com/26-deploy.html](https://tellingstorieswithdata.com/26-deploy.html)
- en: '[Appendices](./20-r_essentials.html)'
  id: totrans-2
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[附录](./20-r_essentials.html)'
- en: '[G  Production](./26-deploy.html)'
  id: totrans-3
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[G 生产](./26-deploy.html)'
- en: '**Prerequisites**'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '**先决条件**'
- en: Read *Science Storms the Cloud*, ([Gentemann et al. 2021](99-references.html#ref-Gentemann2021))
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 阅读文章 *科学风暴云* ([Gentemann 等人 2021](99-references.html#ref-Gentemann2021))
- en: Describes the importance of being able to compute using the cloud.
  id: totrans-6
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 描述了能够使用云进行计算的重要性。
- en: Read *Machine learning is going real-time*, ([Huyen 2020](99-references.html#ref-chiphuyenone))
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 阅读文章 *机器学习走向实时* ([Huyen 2020](99-references.html#ref-chiphuyenone))
- en: Discussion of the need to be able to make forecasts on the fly.
  id: totrans-8
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 讨论即时进行预测的需求。
- en: Watch *Democratizing R with Plumber APIs*, ([Blair 2019](99-references.html#ref-democratizingr))
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 观看 *使用 Plumber API 民主化 R* ([Blair 2019](99-references.html#ref-democratizingr))
- en: Overview of using `plumber` to make an API.
  id: totrans-10
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `plumber` 创建 API 的概述。
- en: 'Read *Operationalizing Machine Learning: An Interview Study*, ([Shankar et
    al. 2022](99-references.html#ref-mleinterviews)).'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 阅读文章 *将机器学习投入运营：一项访谈研究* ([Shankar 等人 2022](99-references.html#ref-mleinterviews))。
- en: Provides the results of interviews with machine learning engineers.
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供了对机器学习工程师的访谈结果。
- en: '**Key concepts and skills**'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念和技能**'
- en: Putting a model into production - i.e. using it in a real-world setting - requires
    an additional set of skills, including a familiarity with a cloud provider and
    the ability to create an API.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将模型投入生产 - 即在现实世界环境中使用 - 需要额外的技能集，包括熟悉云提供商和创建 API 的能力。
- en: '**Software and packages**'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '**软件和包**'
- en: '`analogsea` ([Chamberlain et al. 2022](99-references.html#ref-citeanalogsea))'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`analogsea` ([Chamberlain 等人 2022](99-references.html#ref-citeanalogsea))'
- en: '`plumber` ([Schloerke and Allen 2022](99-references.html#ref-plumber))'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`plumber` ([Schloerke 和 Allen 2022](99-references.html#ref-plumber))'
- en: '`plumberDeploy` ([Allen 2021](99-references.html#ref-plumberdeploy))'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`plumberDeploy` ([Allen 2021](99-references.html#ref-plumberdeploy))'
- en: '`remotes` ([Csárdi et al. 2021](99-references.html#ref-remotes))'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`remotes` ([Csárdi 等人 2021](99-references.html#ref-remotes))'
- en: '`ssh` ([Ooms 2022](99-references.html#ref-ssh))'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ssh` ([Ooms 2022](99-references.html#ref-ssh))'
- en: '`tidymodels` ([Kuhn and Wickham 2020](99-references.html#ref-citeTidymodels))'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`tidymodels` ([Kuhn 和 Wickham 2020](99-references.html#ref-citeTidymodels))'
- en: '`tidyverse` ([Wickham et al. 2019](99-references.html#ref-tidyverse))'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`tidyverse` ([Wickham 等人 2019](99-references.html#ref-tidyverse))'
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '*## G.1 Introduction'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '*## G.1 简介'
- en: 'Having done the work to develop a dataset and explore it with a model that
    we are confident can be used, we may wish to enable this to be used more widely
    than just our own computer. There are a variety of ways of doing this, including:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在开发数据集并使用我们确信可以使用的模型进行探索之后，我们可能希望使这一功能能够在我们自己的计算机之外更广泛地使用。有各种方法可以实现这一点，包括：
- en: using the cloud;
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用云；
- en: creating R packages;
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建 R 包；
- en: making `shiny` applications; and
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 制作 `shiny` 应用程序；以及
- en: using `plumber` to create an API.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `plumber` 创建 API。
- en: The general idea here is that we need to know, and allow others to come to trust,
    the whole workflow. That is what our approach to this point brings. After this,
    then we may like to use our model more broadly. Say we have been able to scrape
    some data from a website, bring some order to that chaos, make some charts, appropriately
    model it, and write this all up. In most academic settings that is more than enough.
    But in many industry settings we would like to use the model to do something.
    For instance, setting up a website that allows a model to be used to generate
    an insurance quote given several inputs.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的基本思想是我们需要了解，并允许他人信任整个工作流程。这正是我们到目前为止的方法。之后，我们可能希望更广泛地使用我们的模型。比如说，我们已经能够从网站上抓取一些数据，对混乱进行整理，制作一些图表，适当地建模，并将这一切写下来。在大多数学术环境中，这已经足够了。但在许多工业环境中，我们希望使用模型来完成某些事情。例如，建立一个网站，允许模型根据几个输入生成保险报价。
- en: In this chapter, we begin by moving our compute from our local computer to the
    cloud. We then describe the use of R packages and Shiny for sharing models. That
    works well, but in some settings other users may like to interact with our model
    in ways that we are not focused on. One way to allow this is to make our results
    available to other computers, and for that we will want to make an API. Hence,
    we introduce `plumber` ([Schloerke and Allen 2022](99-references.html#ref-plumber)),
    which is a way of creating APIs.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们首先将计算从本地计算机转移到云端。然后我们描述了使用R包和Shiny来共享模型的方法。这很好，但在某些设置中，其他用户可能希望以我们未关注的方式与我们模型互动。允许这样做的一种方式是让我们的结果可供其他计算机访问，为此我们将需要创建一个API。因此，我们介绍了`plumber`（[Schloerke和Allen
    2022](99-references.html#ref-plumber)），这是一种创建API的方法。
- en: G.2 Amazon Web Services
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: G.2 亚马逊网络服务
- en: 'Apocryphally the cloud is just another name for someone else’s computer. And
    while that is true to various degrees, for our purposes that is enough. Learning
    to use someone else’s computer can be great for a number of reasons including:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 据说，云端只是别人电脑的另一个名字。虽然这在各种程度上是正确的，但对我们来说已经足够了。学习使用别人的电脑可以有很多好处，包括：
- en: 'Scalability: It can be quite expensive to buy a new computer, especially if
    we only need it to run something every now and then, but by using the cloud, we
    can just rent for a few hours or days. This allows use to amortize this cost and
    work out what we actually need before committing to a purchase. It also allows
    us to easily increase or decrease the compute scale if we suddenly have a substantial
    increase in demand.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可扩展性：购买一台新电脑可能相当昂贵，尤其是如果我们只是偶尔需要它来运行某些东西，但通过使用云端，我们只需租用几个小时或几天。这允许我们分摊成本，并在做出购买决定之前确定我们实际需要什么。它还允许我们在需求突然大幅增加时轻松地增加或减少计算规模。
- en: 'Portability: If we can shift our analysis workflow from a local computer to
    the cloud, then that suggests that we are likely doing good things in terms of
    reproducibility and portability. At the very least, code can run both locally
    and on the cloud, which is a big step in terms of reproducibility.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可移植性：如果我们能将我们的分析工作流程从本地计算机转移到云端，那么这表明我们在可重复性和可移植性方面可能做得很好。至少，代码可以在本地和云端运行，这在可重复性方面是一个很大的进步。
- en: 'Set-and-forget: If we are doing something that will take a while, then it can
    be great to not have to worry about our own computer needing to run overnight.
    Additionally, on many cloud options, open-source statistical software, such as
    R and Python, is either already available, or relatively easy to set up.'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置后无需担心：如果我们正在做需要很长时间的事情，那么不必担心自己的电脑需要整夜运行是非常好的。此外，在许多云选项中，开源统计软件，如R和Python，要么已经可用，要么相对容易设置。
- en: 'That said, there are downsides, including:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，也有缺点，包括：
- en: 'Cost: While most cloud options are cheap, they are rarely free. To provide
    an idea of cost, using a well-featured AWS instance for a few days may end up
    being a few dollars. It is also easy to accidentally forget about something, and
    generate unexpectedly large bills, especially initially.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 成本：虽然大多数云选项都很便宜，但它们很少是免费的。为了提供一个成本的概念，使用具有良好功能的AWS实例几天可能需要几美元。也很容易忘记某些事情，并产生意外的大额账单，尤其是在最初。
- en: 'Public: It can be easy to make mistakes and accidentally make everything public.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公开性：很容易犯错，不小心把所有东西都公开。
- en: 'Time: It takes time to get set up and comfortable on the cloud.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间：在云端设置和适应需要时间。
- en: When we use the cloud, we are typically running code on a “virtual machine”
    (VM). This is an allocation that is part of a larger collection of computers that
    has been designed to act like a computer with specific features. For instance,
    we may specify that our virtual machine has, say, 8GB RAM, 128GB storage, and
    4 CPUs. The VM would then act like a computer with those specifications. The cost
    to use cloud options increases based on the VM specifications.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们使用云端时，我们通常是在一个“虚拟机”（VM）上运行代码。这是一个属于更大计算机集合的分配，它被设计成具有特定功能的计算机。例如，我们可能指定我们的虚拟机有8GB
    RAM、128GB存储和4个CPU。那么这个虚拟机就会像一台具有这些规格的计算机一样运行。使用云选项的成本会根据虚拟机的规格而增加。
- en: 'In a sense, we started with a cloud option, through our initial recommendation
    in [Chapter 2](02-drinking_from_a_fire_hose.html) of using Posit Cloud, before
    we moved to our local computer in [Appendix A](20-r_essentials.html). That cloud
    option was specifically designed for beginners. We will now introduce a more general
    cloud option: Amazon Web Services (AWS). Often a particular business will use
    a particular cloud option, such as Google, AWS, or Azure, but developing familiarity
    with one will make the use of the others easier.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在某种意义上，我们最初是通过在[第二章](02-drinking_from_a_fire_hose.html)中推荐使用Posit Cloud来选择云选项的，然后我们才转向[附录A](20-r_essentials.html)中的本地计算机。那个云选项是专门为初学者设计的。现在，我们将介绍一个更通用的云选项：亚马逊网络服务（AWS）。通常，特定的企业会使用特定的云选项，例如谷歌、AWS或Azure，但熟悉其中一个将使使用其他选项更容易。
- en: Amazon Web Services is a cloud service from Amazon. To get started we need to
    create an AWS Developer account [here](https://aws.amazon.com/developer/) ([Figure G.1
    (a)](#fig-awsone)).
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 亚马逊网络服务是亚马逊的云服务。要开始，我们需要在[这里](https://aws.amazon.com/developer/)创建一个AWS开发者账户（[图G.1(a)](#fig-awsone)）。
- en: '![](../Images/1a470b19cfb9f355b38aa5dbd5da243d.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/1a470b19cfb9f355b38aa5dbd5da243d.png)'
- en: (a) AWS Developer website
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: (a) AWS开发者网站
- en: '![](../Images/781084a20214ccc56fd89fc97cc8fa8a.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/781084a20214ccc56fd89fc97cc8fa8a.png)'
- en: (b) AWS Developer console
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: (b) AWS开发者控制台
- en: '![](../Images/0c9a0b7700c2eefdb47ea94e74a2cebd.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/0c9a0b7700c2eefdb47ea94e74a2cebd.png)'
- en: (c) Launching an AWSinstance
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: (c) 启动AWS实例
- en: '![](../Images/7cf68348d3b75c375301163ca90b04b9.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/7cf68348d3b75c375301163ca90b04b9.png)'
- en: (d) Establishing a key pair
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: (d) 建立密钥对
- en: 'Figure G.1: Overview of getting Amazon AWS set up'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图G.1：设置亚马逊AWS的概述
- en: After we have created an account, we need to select a region where the computer
    that we will access is located. After this, we want to “Launch a virtual machine”
    with EC2 ([Figure G.1 (b)](#fig-awstwo)).
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们创建账户后，我们需要选择一个计算机所在的位置。之后，我们想要“启动虚拟机”使用EC2（[图G.1(b)](#fig-awstwo)）。
- en: The first step is to choose an Amazon Machine Image (AMI). This provides the
    details of the computer that you will be using. For instance, a local computer
    may be a MacBook running Monterey. Louis Aslett provides AMIs that are already
    set up with RStudio and much else [here](http://www.louisaslett.com/RStudio_AMI/).
    We can either search for the AMI of the region that we registered for, or click
    on the relevant link on Aslett’s website. For instance, to use the AMI set-up
    for the Canadian central region we search for “ami-0bdd24fd36f07b638”. The benefit
    of using these AMIs is that they are set up specifically for RStudio, but the
    trade-off is that they are a little outdated, as they were compiled in August
    2020.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是选择一个亚马逊机器镜像（AMI）。这提供了你将使用的计算机的详细信息。例如，一台本地计算机可能是一台运行Monterey的MacBook。Louis
    Aslett提供了已经设置好RStudio和其他许多功能的AMI，[这里](http://www.louisaslett.com/RStudio_AMI/)。我们可以搜索我们注册区域的AMI，或者点击Aslett网站上的相关链接。例如，要使用加拿大中央地区的AMI设置，我们搜索“ami-0bdd24fd36f07b638”。使用这些AMI的好处是它们专门为RStudio设置，但缺点是它们有点过时，因为它们是在2020年8月编译的。
- en: In the next step we can choose how powerful the computer will be. The free tier
    is a basic computer, but we can choose better ones when we need them. At this
    point we can pretty much just launch the instance ([Figure G.1 (c)](#fig-awsthree)).
    If we start using AWS more seriously, then we could go back and select different
    options, especially around the security of the account. AWS relies on key pairs.
    And so, we will need to create a Privacy Enhanced Mail (PEM) and save it locally
    ([Figure G.1 (d)](#fig-awsfive)). We can then launch the instance.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一步中，我们可以选择计算机的强大程度。免费层是一个基本的计算机，但当我们需要时，我们可以选择更好的。在这个时候，我们几乎可以立即启动实例（[图G.1(c)](#fig-awsthree)）。如果我们更认真地使用AWS，那么我们可以回过头来选择不同的选项，特别是在账户的安全性方面。AWS依赖于密钥对。因此，我们需要创建一个隐私增强邮件（PEM）并将其保存在本地（[图G.1(d)](#fig-awsfive)）。然后我们可以启动实例。
- en: After a few minutes, the instance will be running. We can use it by pasting
    the “public DNS” into a browser. The username is “rstudio” and the password is
    the instance ID.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 几分钟后，实例将启动。我们可以通过将“公共DNS”粘贴到浏览器中来使用它。用户名是“rstudio”，密码是实例ID。
- en: We should have RStudio running, which is exciting. The first thing to do is
    probably to change the default password using the instructions in the instance.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该有RStudio正在运行，这很令人兴奋。首先要做的事情可能是使用实例中的说明更改默认密码。
- en: We do not need to install, say, the `tidyverse`, instead we can just call the
    library and keep going. This is because this AMI comes with many packages already
    installed. We can see the list of packages that are installed with `installed.packages()`.
    For instance, `rstan` is already installed, and we could set up an instance with
    GPUs if we needed.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不需要安装，比如说，`tidyverse`，我们只需调用库并继续即可。这是因为这个 AMI 已经预装了许多包。我们可以通过 `installed.packages()`
    查看已安装的包列表。例如，`rstan` 已经安装，如果我们需要，我们可以设置一个带有 GPU 的实例。
- en: Perhaps as important as being able to start a AWS instance is being able to
    stop it (so that we do not get billed). The free tier is useful, but we do need
    to turn it off. To stop an instance, in the AWS instances page, select it, then
    “Actions -> Instance State -> Terminate”.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 能够启动 AWS 实例也许和能够停止它（以免产生费用）一样重要。免费层很有用，但我们确实需要将其关闭。要停止实例，在 AWS 实例页面中选择它，然后选择“操作
    -> 实例状态 -> 终止”。
- en: G.3 Plumber and model APIs
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: G.3 Plumber 和模型 API
- en: The general idea behind the `plumber` package ([Schloerke and Allen 2022](99-references.html#ref-plumber))
    is that we can train a model and make it available via an API that we can call
    when we want a forecast. Recall in [Chapter 7](07-gather.html) that we informally
    defined an API in the context of data gathering as a website that was set-up for
    another computer to access it, rather than a person. Here, we broaden that to
    enable data to encompass a model.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '`plumber` 包背后的基本思想是（Schloerke 和 Allen 2022）（[99-references.html#ref-plumber]），我们可以训练一个模型并通过一个
    API 提供它，当我们需要预测时可以调用它。回想一下在[第 7 章](07-gather.html)中，我们非正式地将 API 定义为数据收集的上下文中的网站，它是为另一台计算机访问而设置的，而不是为人类。在这里，我们将其扩展到使数据包括模型。'
- en: Just to get something working, let us make a function that returns “Hello Toronto”
    regardless of the output. Open a new R file, add the following, and then save
    it as “plumber.R” (you may need to install the `plumber` package if you have not
    done that yet).
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 为了让事情运转起来，让我们创建一个函数，无论输出如何都返回“Hello Toronto”。打开一个新的 R 文件，添加以下内容，然后将其保存为“plumber.R”（如果您还没有这样做，可能需要安装
    `plumber` 包）。
- en: '[PRE1]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '*After that is saved, in the top right of the editor you should get a button
    to “Run API”. Click that, and your API should load. It will be a “Swagger” application,
    which provides a GUI around our API. Expand the GET method, and then click “Try
    it out” and “Execute”. In the response body, you should get “Hello Toronto”.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '*保存之后，在编辑器的右上角，您应该会看到一个“运行 API”按钮。点击它，您的 API 应该会加载。它将是一个“Swagger”应用程序，它为我们提供了
    API 的图形用户界面。展开 GET 方法，然后点击“尝试”和“执行”。在响应体中，您应该得到“Hello Toronto”。'
- en: To more closely reflect the fact that this is an API designed for computers,
    you can copy/paste the “Request URL” into a browser and it should return “Hello
    Toronto”.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更紧密地反映这是一个为计算机设计的 API，您可以将“请求 URL”复制/粘贴到浏览器中，它应该返回“Hello Toronto”。
- en: G.3.0.1 Local model
  id: totrans-66
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: G.3.0.1 本地模型
- en: Now, we are going to update the API so that it serves a model output, given
    some input. This follows Buhr ([2017](99-references.html#ref-buhrplumber)).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将更新 API，使其能够根据一些输入提供模型输出。这遵循 Buhr ([2017](99-references.html#ref-buhrplumber))。
- en: At this point, we should start a new R Project. To get started, let us simulate
    some data and then train a model on it. In this case we are interested in forecasting
    how long a baby may sleep overnight, given we know how long they slept during
    their afternoon nap.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段，我们应该开始一个新的 R 项目。为了开始，让我们模拟一些数据，然后在上面训练一个模型。在这种情况下，我们感兴趣的是预测一个婴儿在夜间可能睡多久，前提是我们知道他们在下午小憩时睡了多少时间。
- en: '[PRE2]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '*![](../Images/7db611f3ff1e56e8f8e8b849905978e6.png)*  *Let us now use `tidymodels`
    to quickly make a model.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '*![](../Images/7db611f3ff1e56e8f8e8b849905978e6.png)*  *现在让我们使用 `tidymodels`
    快速构建一个模型。'
- en: '[PRE3]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '*At this point, we have a model. One difference from what you might be used
    to is that we have saved the model as an “.rds” file. We are going to read that
    in.'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '*在这个阶段，我们已经有一个模型。与您可能习惯的不同之处在于，我们将模型保存为“ .rds”文件。我们将读取该文件。'
- en: 'Now that we have our model we want to put that into a file that we will use
    the API to access, again called “plumber.R”. And we also want a file that sets
    up the API, called “server.R”. Make an R script called “server.R” and add the
    following content:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了我们的模型，我们希望将其放入一个文件中，我们将使用 API 来访问它，再次命名为“plumber.R”。我们还希望有一个设置 API 的文件，命名为“server.R”。创建一个名为“server.R”的
    R 脚本，并添加以下内容：
- en: '[PRE4]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '*Then in “plumber.R” add the following content:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '*然后在“plumber.R”中添加以下内容：'
- en: '[PRE5]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '*Again, after we save the “plumber.R” file we should have an option to “Run
    API”. Click that and you can try out the API locally in the same way as before.
    In this case, click “Try It Out” and then input an afternoon nap length in minutes.
    The response body will contain the prediction based on the data and model we set
    up.****  ***#### G.3.0.2 Cloud model'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '*同样，在我们保存“plumber.R”文件后，我们应该有一个“运行API”的选项。点击它，你可以在本地以与之前相同的方式尝试API。在这种情况下，点击“尝试一下”，然后输入分钟数的午睡长度。响应体将包含基于我们设置的数据和模型的预测。****  ***####
    G.3.0.2 云模型'
- en: To this point, we have got an API working on our own machine, but what we really
    want to do is to get it working on a computer such that the API can be accessed
    by anyone. To do this we are going to use [DigitalOcean](https://www.digitalocean.com).
    It is a charged service, but when you create an account, it will come with $200
    in credit, which will be enough to get started.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们在自己的机器上已经有一个API在运行，但我们真正想要做的是让API在任何电脑上都能访问。为此，我们将使用[DigitalOcean](https://www.digitalocean.com)。这是一个收费服务，但当你创建账户时，会附带200美元的信用额度，这足以开始使用。
- en: 'This set-up process will take some time, but we only need to do it once. Two
    additional packages that will assist here are `plumberDeploy` ([Allen 2021](99-references.html#ref-plumberdeploy))
    and `analogsea` ([Chamberlain et al. 2022](99-references.html#ref-citeanalogsea))
    (which will need to be installed from GitHub: `install_github("sckott/analogsea")`).'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 这个设置过程将花费一些时间，但我们只需要做一次。两个将在这里提供帮助的额外包是`plumberDeploy` ([Allen 2021](99-references.html#ref-plumberdeploy))和`analogsea`
    ([Chamberlain et al. 2022](99-references.html#ref-citeanalogsea))（需要从GitHub安装：`install_github("sckott/analogsea")`）。
- en: Now we need to connect the local computer with the DigitalOcean account.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们需要将本地电脑与DigitalOcean账户连接起来。
- en: '[PRE6]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '*Now we need to authenticate the connection, and this is done using a SSH public
    key.'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '*现在我们需要验证连接，这通过SSH公钥来完成。'
- en: '[PRE7]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '*What you want is to have a “.pub” file on our computer. Then copy the public
    key aspect in that file, and add it to the SSH keys section in the account security
    settings. When we have the key on our local computer, then we can check this using
    `ssh`.'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '*你需要在我们的电脑上有一个“.pub”文件。然后复制该文件中的公钥部分，并将其添加到账户安全设置中的SSH密钥部分。当我们在本地电脑上有了这个密钥，我们就可以使用`ssh`来检查。'
- en: '[PRE8]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '*Again, this will all take a while to validate. DigitalOcean calls every computer
    that we start a “droplet”. If we start three computers, then we will have started
    three droplets. We can check the droplets that are running.'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '*同样，这需要一段时间来验证。DigitalOcean将我们启动的每一台电脑称为“droplet”。如果我们启动三台电脑，那么我们将启动三个droplets。我们可以检查正在运行的droplets。'
- en: '[PRE9]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '*If everything is set up properly, then this will print the information about
    all droplets that you have associated with the account (which at this point, is
    probably none). We must first create a droplet.'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '*如果一切设置正确，这将打印出与账户关联的所有droplets的信息（目前可能没有）。我们首先必须创建一个droplet。'
- en: '[PRE10]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '*Then we get asked for the SSH passphrase and then it will set up a bunch of
    things. After this we are going to need to install a whole bunch of things onto
    our droplet.'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '*然后我们会要求输入SSH密码短语，然后它会设置一堆东西。之后，我们将在我们的droplet上安装很多东西。'
- en: '[PRE11]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '*And then when that is finally set up (it will take 30 minutes or so) we can
    deploy our API.'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '*一旦最终设置完成（大约需要30分钟），我们就可以部署我们的API。'
- en: '[PRE12]**********  ***## G.4 Exercises'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE12]**********  ***## G.4 练习'
- en: Scales
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 规模
- en: '*(Plan)*'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*(计划)*'
- en: '*(Simulate)*'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*(模拟)*'
- en: '*(Acquire)*'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*(获取)*'
- en: '*(Explore)*'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*(探索)*'
- en: '*(Communicate)*'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*(沟通)*'
- en: Questions
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 问题
- en: Tutorial
  id: totrans-101
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 指南
- en: 'Allen, Jeff. 2021\. *plumberDeploy: Plumber Deployment*. [https://CRAN.R-project.org/package=plumberDeploy](https://CRAN.R-project.org/package=plumberDeploy).Blair,
    James. 2019\. *Democratizing R with Plumber APIs*. [https://posit.co/resources/videos/democratizing-r-with-plumber-apis/](https://posit.co/resources/videos/democratizing-r-with-plumber-apis/).Buhr,
    Ray. 2017\. *Using R as a Production Machine Learning Language (Part I)*. [https://raybuhr.github.io/blog/posts/making-predictions-over-http/](https://raybuhr.github.io/blog/posts/making-predictions-over-http/).Chamberlain,
    Scott, Hadley Wickham, Winston Chang, and Mauricio Vargas. 2022\. *Analogsea:
    Interface to “Digital Ocean”*. [https://CRAN.R-project.org/package=analogsea](https://CRAN.R-project.org/package=analogsea).Csárdi,
    Gábor, Jim Hester, Hadley Wickham, Winston Chang, Martin Morgan, and Dan Tenenbaum.
    2021\. *remotes: R Package Installation from Remote Repositories, Including “GitHub”*.
    [https://CRAN.R-project.org/package=remotes](https://CRAN.R-project.org/package=remotes).Gentemann,
    Chelle Leigh, Chris Holdgraf, Ryan Abernathey, Daniel Crichton, James Colliander,
    Edward Joseph Kearns, Yuvi Panda, and Richard Signell. 2021\. “Science Storms
    the Cloud.” *AGU Advances* 2 (2). [https://doi.org/10.1029/2020av000354](https://doi.org/10.1029/2020av000354).Huyen,
    Chip. 2020\. “Machine Learning Is Going Real-Time,” December. [https://huyenchip.com/2020/12/27/real-time-machine-learning.html](https://huyenchip.com/2020/12/27/real-time-machine-learning.html).Kuhn,
    Max, and Hadley Wickham. 2020\. *tidymodels: a collection of packages for modeling
    and machine learning using tidyverse principles*. [https://www.tidymodels.org](https://www.tidymodels.org).Ooms,
    Jeroen. 2022\. *ssh: Secure Shell (SSH) Client for R*. [https://CRAN.R-project.org/package=ssh](https://CRAN.R-project.org/package=ssh).Schloerke,
    Barret, and Jeff Allen. 2022\. *plumber: An API Generator for R*. [https://CRAN.R-project.org/package=plumber](https://CRAN.R-project.org/package=plumber).Shankar,
    Shreya, Rolando Garcia, Joseph Hellerstein, and Aditya Parameswaran. 2022\. “Operationalizing
    Machine Learning: An Interview Study.” arXiv. [https://doi.org/10.48550/ARXIV.2209.09125](https://doi.org/10.48550/ARXIV.2209.09125).Wickham,
    Hadley, Mara Averick, Jenny Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain
    François, Garrett Grolemund, et al. 2019\. “Welcome to the Tidyverse.” *Journal
    of Open Source Software* 4 (43): 1686\. [https://doi.org/10.21105/joss.01686](https://doi.org/10.21105/joss.01686).****'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
