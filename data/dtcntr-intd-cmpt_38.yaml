- en: 12.3Â Arrays and Lists in MemoryğŸ”—
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 12.3Â å†…å­˜ä¸­çš„æ•°ç»„å’Œåˆ—è¡¨ğŸ”—
- en: åŸæ–‡ï¼š[https://dcic-world.org/2025-08-27/unified-lists-memory.html](https://dcic-world.org/2025-08-27/unified-lists-memory.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://dcic-world.org/2025-08-27/unified-lists-memory.html](https://dcic-world.org/2025-08-27/unified-lists-memory.html)
- en: '|  |'
  id: totrans-2
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'In [Understanding Equality](unified-equality.html), we drew memory diagrams
    to show how values appear in the heap. At that time, we looked only at structured
    data. Now we will look at aggregate data: lists in Python and arrays in Pyret.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨[ç†è§£ç›¸ç­‰æ€§](unified-equality.html)ä¸­ï¼Œæˆ‘ä»¬ç»˜åˆ¶äº†å†…å­˜å›¾æ¥å±•ç¤ºå€¼å¦‚ä½•åœ¨å †ä¸­æ˜¾ç¤ºã€‚å½“æ—¶ï¼Œæˆ‘ä»¬åªçœ‹äº†ç»“æ„åŒ–æ•°æ®ã€‚ç°åœ¨æˆ‘ä»¬å°†æŸ¥çœ‹èšåˆæ•°æ®ï¼šPython
    ä¸­çš„åˆ—è¡¨å’Œ Pyret ä¸­çš„æ•°ç»„ã€‚
- en: 'Both Python lists and Pyret arrays are stored in memory with a starting value
    that indicates how many values there are, followed by the actual elements in subsequent
    addresses. For instance, suppose we write the following value:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Python åˆ—è¡¨å’Œ Pyret æ•°ç»„éƒ½æ˜¯ä»¥èµ·å§‹å€¼å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¯¥èµ·å§‹å€¼æŒ‡ç¤ºæœ‰å¤šå°‘ä¸ªå€¼ï¼Œç„¶åæ˜¯åç»­åœ°å€ä¸­çš„å®é™…å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬å†™å…¥ä»¥ä¸‹å€¼ï¼š
- en: '| Python |  |'
  id: totrans-5
  prefs: []
  type: TYPE_TB
  zh: '| Python |  |'
- en: '|  |'
  id: totrans-6
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE0]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '|'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Pyret |  |'
  id: totrans-9
  prefs: []
  type: TYPE_TB
  zh: '| Pyret |  |'
- en: '|  |'
  id: totrans-10
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[PRE1]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '|'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Hereâ€™s what memory might look like:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæ˜¯å†…å­˜å¯èƒ½çš„æ ·å­ï¼š
- en: Directory
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE2]'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE2]'
- en: â†’Â 1001
  id: totrans-16
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: Heap
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `(length:3)`
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `(é•¿åº¦:3)`
- en: 1002:Â `"bread"`
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `"bread"`
- en: 1003:Â `"coffee"`
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1003:Â `"coffee"`
- en: 1004:Â `"eggs"`
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1004:Â `"eggs"`
- en: 'If these terms mean anything to you: Pythonâ€™s default list implementation is
    array-based, not a linked list. So at 1001 thereâ€™s an indication of how many entries
    follow, and the next memory locations have those values. There are no directory
    entries for the individual elements, but they can be reached by referring to `sl`
    followed by an offset: for instance,'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœè¿™äº›æœ¯è¯­å¯¹æ‚¨æ¥è¯´æœ‰ä»»ä½•æ„ä¹‰ï¼šPython çš„é»˜è®¤åˆ—è¡¨å®ç°æ˜¯åŸºäºæ•°ç»„çš„ï¼Œè€Œä¸æ˜¯é“¾è¡¨ã€‚æ‰€ä»¥ 1001 å¤„æœ‰ä¸€ä¸ªæŒ‡ç¤ºåç»­æœ‰å¤šå°‘ä¸ªæ¡ç›®çš„æŒ‡ç¤ºï¼Œä¸‹ä¸€ä¸ªå†…å­˜ä½ç½®æœ‰é‚£äº›å€¼ã€‚æ²¡æœ‰ä¸ºå•ä¸ªå…ƒç´ åˆ›å»ºç›®å½•æ¡ç›®ï¼Œä½†å¯ä»¥é€šè¿‡å¼•ç”¨
    `sl` åè·Ÿåç§»é‡æ¥è®¿é—®å®ƒä»¬ï¼šä¾‹å¦‚ï¼Œ
- en: '| Python | Pyret |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE3]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '|'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE4]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '|'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Internally, this turns into: â€œobtain the address of `sl`, then add 1 and the
    offset `2` to itâ€. This produces the address 1001 + 1 + 2 = 1004\. Looking up
    the value stored at address 1004, in both languages, produces `''eggs''`.You may
    find it odd that the offsets begin at 0\. While it is indeed confusingâ€”<wbr>the
    â€œfirstâ€ value is at offset `0`, the â€œthirdâ€ value at offset `2`, and so onâ€”<wbr>this
    is a convention both Python and Pyret chose to be consistent with most other programming
    languages.'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: å†…éƒ¨ï¼Œè¿™å˜æˆäº†ï¼šâ€œè·å– `sl` çš„åœ°å€ï¼Œç„¶åå‘å…¶æ·»åŠ  1 å’Œåç§»é‡ `2`â€ã€‚è¿™äº§ç”Ÿäº†åœ°å€ 1001 + 1 + 2 = 1004ã€‚åœ¨ä¸¤ç§è¯­è¨€ä¸­ï¼ŒæŸ¥æ‰¾åœ°å€
    1004 å­˜å‚¨çš„å€¼éƒ½ä¼šäº§ç”Ÿ `'eggs'`ã€‚æ‚¨å¯èƒ½ä¼šè§‰å¾—åç§»é‡ä» 0 å¼€å§‹å¾ˆå¥‡æ€ªã€‚è™½ç„¶è¿™ç¡®å®ä»¤äººå›°æƒ‘â€”â€”â€œç¬¬ä¸€ä¸ªâ€å€¼åœ¨åç§»é‡ `0`ï¼Œè€Œâ€œç¬¬ä¸‰ä¸ªâ€å€¼åœ¨åç§»é‡
    `2`ï¼Œä¾æ­¤ç±»æ¨â€”â€”ä½†è¿™æ˜¯ä¸€ç§ Python å’Œ Pyret éƒ½é€‰æ‹©ä¸å¤§å¤šæ•°å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¿æŒä¸€è‡´çš„ä¼ ç»Ÿã€‚
- en: 'Similarly, suppose we try to change the shopping listâ€™s content to replace
    the second value with `''tea''`. Recall that the second value is at offset `1`:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: ç±»ä¼¼åœ°ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•æ›´æ”¹è´­ç‰©æ¸…å•çš„å†…å®¹ï¼Œç”¨ `'tea'` æ›¿æ¢ç¬¬äºŒä¸ªå€¼ã€‚å›æƒ³ä¸€ä¸‹ï¼Œç¬¬äºŒä¸ªå€¼åœ¨åç§»é‡ `1`ï¼š
- en: '| Python | Pyret |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE5]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '|'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE6]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '|'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Again, we obtain the address of `sl`, which is 1001; add 1 and the offset (`1`)
    to it; this gives us the address 1003\. Now, we modify the value at 1003 to be
    the new value:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: å†æ¬¡ï¼Œæˆ‘ä»¬è·å– `sl` çš„åœ°å€ï¼Œå®ƒæ˜¯ 1001ï¼›å‘å…¶æ·»åŠ  1 å’Œåç§»é‡ï¼ˆ`1`ï¼‰ï¼›è¿™ç»™äº†æˆ‘ä»¬åœ°å€ 1003ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ°å€ 1003 çš„å€¼ä¿®æ”¹ä¸ºæ–°å€¼ï¼š
- en: Directory
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE7]'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE7]'
- en: â†’Â 1001
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: Heap
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `(length:3)`
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `(é•¿åº¦:3)`
- en: 1002:Â `"bread"`
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `"bread"`
- en: 1003:Â `"tea"`
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1003:Â `"tea"`
- en: 1004:Â `"eggs"`
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1004:Â `"eggs"`
- en: 'If we now ask the language for the list as a whole, we see the change: in Python,'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬ç°åœ¨è¦æ±‚è¯­è¨€æä¾›æ•´ä¸ªåˆ—è¡¨ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å˜åŒ–ï¼šåœ¨ Python ä¸­ï¼Œ
- en: '|'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '&#124;'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;'
- en: '[PRE8]'
  id: totrans-49
  prefs:
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '&#124;'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;'
- en: '|'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '|'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE9]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '|'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: and in Pyret,
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Pyret ä¸­ï¼Œ
- en: '|'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '&#124;'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;'
- en: '[PRE10]'
  id: totrans-58
  prefs:
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '&#124;'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;'
- en: '|'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '|'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE11]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '|'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Observe that what we have learned about aliasing applies here, too. Suppose
    Shaunae and Jonella share a shopping list, where `sl` is Shaunaeâ€™s and Jonella
    writes:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œæˆ‘ä»¬å­¦åˆ°çš„å…³äºåˆ«åçš„å†…å®¹ä¹Ÿé€‚ç”¨äºè¿™é‡Œã€‚å‡è®¾ Shaunae å’Œ Jonella å…±äº«ä¸€ä¸ªè´­ç‰©æ¸…å•ï¼Œå…¶ä¸­ `sl` æ˜¯ Shaunae çš„ï¼Œè€Œ Jonella
    å†™é“ï¼š
- en: '| Python | Pyret |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE12]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '|'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE13]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '|'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Now `jl` and `sl` are aliases for the same data in the heap:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ `jl` å’Œ `sl` æ˜¯å †ä¸­ç›¸åŒæ•°æ®çš„åˆ«åï¼š
- en: Directory
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE14]'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE14]'
- en: â†’Â 1001
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE15]'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE15]'
- en: â†’Â 1001
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: Heap
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `(length:3)`
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `(é•¿åº¦:3)`
- en: 1002:Â `"bread"`
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `"bread"`
- en: 1003:Â `"tea"`
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1003:Â `"tea"`
- en: 1004:Â `"eggs"`
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1004:Â `"eggs"`
- en: 'Thus, modifying the list `jl` has the same impact as modifying it via `sl`:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: å› æ­¤ï¼Œä¿®æ”¹åˆ—è¡¨ `jl` å¯¹å…¶çš„å½±å“ä¸é€šè¿‡ `sl` ä¿®æ”¹å®ƒçš„å½±å“ç›¸åŒï¼š
- en: '| Python | Pyret |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| Python | Pyret |'
- en: '|'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE16]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '|'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE17]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '|'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: means the memory looks like
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: è¡¨ç¤ºå†…å­˜çœ‹èµ·æ¥åƒ
- en: Directory
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[PRE18]'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE18]'
- en: â†’Â 1001
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: '[PRE19]'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_PRE
  zh: '[PRE19]'
- en: â†’Â 1001
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: â†’Â 1001
- en: Heap
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: å †
- en: 1001:Â `(length:3)`
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1001:Â `(é•¿åº¦:3)`
- en: 1002:Â `"butter"`
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1002:Â `"butter"`
- en: 1003:Â `"tea"`
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1003:Â `"tea"`
- en: 1004:Â `"eggs"`
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1004:Â `"eggs"`
- en: 'Thus, if we ask for the value of `sl`, we will see in Python:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è¦æ±‚ `sl` çš„å€¼ï¼Œåœ¨ Python ä¸­æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼š
- en: '|'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '&#124;'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;'
- en: '[PRE20]'
  id: totrans-103
  prefs:
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '&#124;'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;'
- en: '|'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '|'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE21]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '|'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'and in Pyret:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Pyret ä¸­ï¼š
- en: '|'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '&#124;'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;'
- en: '[PRE22]'
  id: totrans-112
  prefs:
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '&#124;'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;'
- en: '|'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '|'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '[PRE23]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '|'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: even though we did not make a modification through the name `sl`.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: å³ä½¿æˆ‘ä»¬æ²¡æœ‰é€šè¿‡åç§° `sl` è¿›è¡Œä¿®æ”¹
