- en: 'Position-Based Fluids: Density and Surface Constraints'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 位置基流体：密度和表面约束
- en: 原文：[https://phys-sim-book.github.io/lec32.4-position_based_fluids.html](https://phys-sim-book.github.io/lec32.4-position_based_fluids.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://phys-sim-book.github.io/lec32.4-position_based_fluids.html](https://phys-sim-book.github.io/lec32.4-position_based_fluids.html)
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
- en: The Position-Based Dynamics framework can be elegantly extended from solids
    to simulate incompressible fluids. The resulting method, known as Position-Based
    Fluids (PBF) [[Macklin & Muller 2013]](bibliography.html#macklin2013position),
    replaces the complex pressure solves of traditional Smoothed Particle Hydrodynamics
    (SPH) [[Koschier et al. 2020]](bibliography.html#koschier2020smoothed) with a
    set of geometric constraints. This approach inherits the stability and efficiency
    of PBD, allowing for large time steps suitable for real-time applications, while
    effectively enforcing the constant-density condition that characterizes incompressible
    flow.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 位置基动力学框架可以从固体优雅地扩展到模拟不可压缩流体。这种方法被称为位置基流体（PBF）[[Macklin & Muller 2013]](bibliography.html#macklin2013position)，它用一组几何约束替换了传统光滑粒子流体动力学（SPH）[[Koschier
    et al. 2020]](bibliography.html#koschier2020smoothed)中的复杂压力求解。这种方法继承了 PBD 的稳定性和效率，允许使用适合实时应用的大时间步长，同时有效地执行表征不可压缩流的恒定密度条件。
- en: '[The Per-Particle Density Constraint](#the-per-particle-density-constraint)'
  id: totrans-4
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[每个粒子的密度约束](#the-per-particle-density-constraint)'
- en: The fundamental principle of PBF is to ensure that the density around each fluid
    particle remains constant. The density at a given particle's location is estimated
    using a kernel-based summation over its neighbors.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: PBF 的基本原理是确保每个流体粒子周围的密度保持恒定。给定粒子位置的密度是通过对其邻居的基于核的求和来估计的。
- en: 'The density ρi​ for a particle i at position pi​ is estimated as: ρi​=j∑​mj​W(pi​−pj​,h)(33.4.1)
    where the sum is over all neighboring particles j, mj​ is the mass of particle
    j, h is the smoothing kernel radius, and W is a radially symmetric smoothing kernel
    function. For simplicity, we can assume all particles have equal mass and absorb
    it into the density calculation.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 对于位于位置 pi​ 的粒子 i 的密度 ρi​，其估计值为：ρi​=j∑​mj​W(pi​−pj​,h)(33.4.1)，其中求和是对所有邻近粒子 j
    进行的，mj​ 是粒子 j 的质量，h 是平滑核半径，W 是径向对称的平滑核函数。为了简化，我们可以假设所有粒子具有相等的质量，并将其吸收到密度计算中。
- en: The goal is to enforce that this estimated density ρi​ matches a user-defined
    rest density ρ0​. This is formulated as a per-particle constraint function Ci​.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 目标是确保这个估计密度 ρi​ 与用户定义的静止密度 ρ0​ 匹配。这被表述为每个粒子的约束函数 Ci​。
- en: '****Definition 33.4.1 (PBF Density Constraint).**** For each particle i, the
    density constraint Ci​ is defined as the scaled deviation from the rest density
    ρ0​: Ci​(p1​,...,pN​)=ρ0​ρi​​−1(33.4.2) The constraint is satisfied when Ci​=0.'
  id: totrans-8
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '****定义 33.4.1 (PBF 密度约束).**** 对于每个粒子 i，密度约束 Ci​ 被定义为从静止密度 ρ0​ 的缩放偏差：Ci​(p1​,...,pN​)=ρ0​ρi​​−1(33.4.2)。当
    Ci​=0 时，约束得到满足。'
- en: 'To solve this system of constraints, PBF computes a position correction Δpi​
    for each particle. Following the PBD methodology, we first compute the gradient
    of Ci​ with respect to the position of a particle k: ∇pk​​Ci​=ρ0​1​j∑​mj​∇pk​​W(pi​−pj​,h)={ρ0​1​∑j​mj​∇W(pi​−pj​,h)−ρ0​mk​​∇W(pi​−pk​,h)​if k=iif k=i​(33.4.3)
    The standard PBD solver computes a single Lagrange multiplier λi​ for each constraint
    Ci​ using the formula λi​=−Ci​/(∑k​∥∇pk​​Ci​∥2). The position correction for a
    particle Δpi​ is then derived from the influence of its own constraint and the
    constraints of its neighbors. Due to the symmetry of the kernel gradient (∇pi​​W(pi​−pj​,h)=−∇pj​​W(pi​−pj​,h)),
    this results in a simple and efficient final update rule for the position correction
    of particle i: Δpi​=ρ0​1​j∑​(λi​+λj​)∇W(pi​−pj​,h)(33.4.4) Here, a different kernel,
    the Spiky kernel, is typically used for its non-vanishing gradient, which prevents
    particle clustering.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决这个约束系统，PBF 为每个粒子计算一个位置校正 Δpi​。遵循 PBD 方法，我们首先计算 Ci​ 关于粒子 k 位置的梯度：∇pk​​Ci​=ρ0​1​j∑​mj​∇pk​​W(pi​−pj​,h)={ρ0​1​∑j​mj​∇W(pi​−pj​,h)−ρ0​mk​​∇W(pi​−pk​,h)​if k=iif k=i​(33.4.3)
    标准的 PBD 求解器使用公式 λi​=−Ci​/(∑k​∥∇pk​​Ci​∥2) 对每个约束 Ci​ 计算一个单 Lagrange 乘子 λi​。然后，从其自身约束和邻居约束的影响中推导出粒子的位置校正
    Δpi​。由于核梯度（∇pi​​W(pi​−pj​,h)=−∇pj​​W(pi​−pj​,h)）的对称性，这导致粒子 i 的位置校正更新规则简单且高效：Δpi​=ρ0​1​j∑​(λi​+λj​)∇W(pi​−pj​,h)(33.4.4)。在这里，通常使用具有非零梯度的尖锐核，以防止粒子聚集。
- en: '***Remark 33.4.1 (Robustness and Constraint Softening).*** A practical issue
    arises when a particle has few neighbors, as the denominator ∑k​∥∇pk​​Ci​∥2 can
    approach zero, leading to large, unstable position corrections. To prevent this,
    a small relaxation parameter ε is added to the denominator, softening the constraint.
    This is known as Constraint Force Mixing (CFM) [[Smith & others 2005]](bibliography.html#smith2005open).
    Then: λi​=−∑k​∥∇pk​​Ci​∥2+εCi​(p1​,...,pN​)​(33.4.5)'
  id: totrans-10
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***备注33.4.1（鲁棒性和约束软化）*** 当一个粒子附近邻居很少时，会出现一个实际问题，因为分母∑k∥∇pkCi∥2可能接近零，导致大的、不稳定的位置修正。为了防止这种情况，向分母添加了一个小的松弛参数ε，软化了约束。这被称为约束力混合（CFM）[[Smith等人2005]](bibliography.html#smith2005open)。然后：λi
    = -∑k∥∇pkCi∥2 + εCi(p1,...,pN) (33.4.5)'
- en: '[Correcting for Tensile Instability](#correcting-for-tensile-instability)'
  id: totrans-11
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[校正拉伸不稳定性](#correcting-for-tensile-instability)'
- en: A well-known artifact in SPH-based fluid simulations is the "tensile instability,"
    where particles near a free surface clump together due to an inability to satisfy
    the rest density. PBF offers a direct solution by incorporating an artificial
    pressure term.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在基于SPH的流体模拟中，一个众所周知的问题是“拉伸不稳定性”，其中由于无法满足静止密度，靠近自由表面的粒子会聚集在一起。PBF通过结合一个人工压力项提供了一个直接的解决方案。
- en: 'Specifically, an artificial pressure term, scorr​, is introduced to create
    a short-range repulsive force between nearby particles. This term is a function
    of W: scorr​=−k(W(Δq,h)W(pi​−pj​,h)​)n(33.4.6) where k and n are small positive
    constants (e.g., k=0.1,n=4), and Δq is a vector representing a small distance
    within the kernel radius (e.g., ∥Δq∥=0.3h). This term is only applied to push
    particles apart and is incorporated directly into the position correction calculation
    from Equation [(33.4.4)](#eq:pbf:position_correction): Δpi​=ρ0​1​j∑​(λi​+λj​+scorr​)∇W(pi​−pj​,h)(33.4.7)
    This prevents clumping, and implicitly creates a surface tension-like effect at
    the fluid''s boundary.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 具体来说，引入了一个人工压力项scorr，以在附近的粒子之间创建短程排斥力。这个项是W的函数：scorr = -k(W(Δq, h)W(pi - pj,
    h))n (33.4.6)，其中k和n是小的正常数（例如，k=0.1,n=4），Δq是一个表示内核半径内的小距离的向量（例如，∥Δq∥=0.3h）。这个项仅用于推开粒子，并直接纳入从方程[(33.4.4)](#eq:pbf:position_correction)的位置修正计算：Δpi
    = ρ0^1/2j∑(λi + λj + scorr)∇W(pi - pj, h) (33.4.7)。这防止了聚集，并在流体边界上隐式地创建了一种类似表面张力的效果。
- en: '[Velocity-Level Corrections: Viscosity and Vorticity](#velocity-level-corrections-viscosity-and-vorticity)'
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[速度级修正：粘度和涡量](#velocity-level-corrections-viscosity-and-vorticity)'
- en: While the primary constraints in PBF operate on positions, velocity-level updates
    are still necessary to model phenomena like viscosity and to reintroduce lost
    energy. These are applied as a post-process after the main PBD solver loop has
    updated positions and velocities.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然PBF中的主要约束操作在位置上，但速度级更新仍然是必要的，以模拟粘度等现象并重新引入失去的能量。这些作为后处理应用于主PBD求解器循环更新位置和速度之后。
- en: '**XSPH Viscosity:** To impart a more coherent, liquid-like motion and reduce
    particle intermixing, XSPH viscosity is applied. It adjusts each particle''s velocity
    to be closer to the average velocity of its neighbors: vinew​=vi​+cj∑​(vj​−vi​)W(pi​−pj​,h)(33.4.8)
    where c is a positive viscosity coefficient, typically a small value like 0.01.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '**XSPH粘度:** 为了赋予更连贯、类似液体的运动，并减少粒子混合，应用了XSPH粘度。它调整每个粒子的速度，使其更接近其邻居的平均速度：vinew
    = vi + cj∑(vj - vi)W(pi - pj, h) (33.4.8)，其中c是一个正的粘度系数，通常是一个很小的值，如0.01。'
- en: '**Vorticity Confinement:** The iterative nature of PBD can introduce numerical
    damping, causing the fluid to lose rotational energy and appear overly viscous.
    Vorticity confinement can be used to counteract this by calculating the vorticity
    (curl of the velocity field) ωi​=∇×vi​ at each particle and applying a corrective
    force fvorticity​=ε(N×ωi​) to reintroduce small-scale rotational details. This
    force is then integrated to update particle velocities.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '**涡量约束:** PBD的迭代性质可能会引入数值阻尼，导致流体失去旋转能量，看起来过于粘稠。可以通过在每个粒子处计算涡量（速度场的旋度）ωi = ∇×vi
    并应用校正力fvorticity = ε(N×ωi)来重新引入小尺度的旋转细节来使用涡量约束来对抗这种情况。然后，将这个力积分以更新粒子速度。'
