- en: Penalty Method
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 惩罚法
- en: 原文：[https://phys-sim-book.github.io/lec11.1-penalty_method.html](https://phys-sim-book.github.io/lec11.1-penalty_method.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://phys-sim-book.github.io/lec11.1-penalty_method.html](https://phys-sim-book.github.io/lec11.1-penalty_method.html)
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
- en: 'At the beginning of each time step towards time n+1, we evaluate nodal position
    x^kn+1​ for each BC node k based on their prescribed motions. During each Newton
    iteration i, for the iterate xi, we define a velocity residual to assess how close
    each BC node is to meeting its target: rBC,ki​=h1​∥xki​−x^kn+1​∥. When rBC,ki​
    falls below a specific tolerance ϵ for any BC node k, we can fix the node at its
    current location xki​≈x^kn+1​ and apply the [DOF elimination method](lec5.2-DOF_elimin.html)
    in the subsequent iterations. This is particularly straightforward in scenes with
    only static BCs, where the DOF elimination method is directly applied.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个时间步长向时间n+1开始时，我们根据每个BC节点k的预定运动评估每个BC节点的节点位置x^kn+1。在每次牛顿迭代i中，对于迭代xi，我们定义一个速度残差来评估每个BC节点接近其目标的情况：rBC,ki=h1∥xki−x^kn+1∥。当rBC,ki对于任何BC节点k低于特定的容差ϵ时，我们可以将节点固定在其当前位置xki≈x^kn+1，并在后续迭代中应用[自由度消除法](lec5.2-DOF_elimin.html)。这在只有静态BC的场景中尤其简单，其中直接应用自由度消除法。
- en: 'For other BC nodes k that are far from their target locations, we introduce
    new penalty terms to the Incremental Potential for each of these nodes: 2κM​​mk​∥xk​−x^kn+1​∥2.(11.1.1)
    Here, mk​ represents the nodal mass, allowing for intuitive setting of the penalty
    stiffness κM​, as the Hessian of the penalty term with respect to BC nodes is
    simply κM​ times that of the inertia term.'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 对于远离其目标位置的BC节点k，我们为每个这些节点引入新的惩罚项到增量势中：2κMmk∥xk−x^kn+1∥2。(11.1.1) 这里，mk代表节点质量，允许直观地设置惩罚刚度κM，因为与BC节点相关的惩罚项的Hessian矩阵仅仅是惯性项的κM倍。
- en: '***Remark 11.1.1.*** For collision obstacles (CO), precisely calculating node
    masses is challenging due to unknown factors like density. A practical approach
    is to assume a density similar to that of the simulated solids in the scene. This
    assumption makes the diagonal entries on the Hessian of the penalty terms roughly
    κM​ times that of the inertia term.'
  id: totrans-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***备注 11.1.1.*** 对于碰撞障碍物（CO），由于密度等未知因素的影响，精确计算节点质量具有挑战性。一种实用的方法是假设密度与场景中模拟固体的密度相似。这个假设使得惩罚项的Hessian矩阵的对角线元素大约是惯性项的κM倍。'
- en: ''
  id: totrans-6
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: For codimensional COs such as shells, rods, and particles, the key is to consider
    a reasonably large thickness when calculating their volumes. This helps in ensuring
    that their physical properties align more closely with those of the main simulation
    bodies.
  id: totrans-7
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 对于如壳体、杆和粒子这样的超维CO，关键是计算它们的体积时要考虑一个合理的较大厚度。这有助于确保它们的物理属性与主要模拟体的物理属性更加接近。
- en: Setting the penalty stiffness κM​ appropriately can be challenging. If κM​ is
    set too low, it may not effectively move the BC node towards its target. Conversely,
    a too high κM​ can lead to numerical issues. Thus, we initially set κM​ to a reasonably
    large value and adaptively increase it as necessary.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 适当地设置惩罚刚度κM可能具有挑战性。如果κM设置得太低，可能无法有效地将BC节点移动到其目标位置。相反，过高的κM可能导致数值问题。因此，我们最初将κM设置为一个合理的较大值，并在必要时自适应地增加它。
- en: During the Newton solve, if there are BC nodes k where rBC,ki​≥ϵ at the point
    of Newton convergence, we double the penalty stiffness κM​ to 2× its current value
    and continue the Newton solve. This process is repeated until all BCs are satisfactorily
    met at convergence.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在牛顿求解过程中，如果在牛顿收敛点的BC节点k处有rBC,ki≥ϵ，我们将惩罚刚度κM加倍到其当前值的2倍，并继续牛顿求解。这个过程会重复进行，直到所有BC在收敛时都得到满意地满足。
- en: '***Remark 11.1.2.*** In practice, with double precision floating-point numbers,
    initializing κM​ below 106 is typically sufficient, given that the Hessian of
    the stiff penalty terms is purely diagonal. However, if certain BCs remain unsatisfied
    even when κM​ is increased to above 1010, the optimization process may stall due
    to severe numerical errors. This stalling occurs because extremely stiff penalty
    terms are in conflict with the contact barriers. However, such a scenario would
    likely only occur under a rare CO/BC setting in a manner far more extreme than
    what is tested in [Figure 2.3.1](lec2.3-contact.html#fig:lec2:contact_and_friction).'
  id: totrans-10
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***备注 11.1.2.*** 在实践中，使用双精度浮点数时，只要κM的初始值低于106，通常就足够了，因为严格惩罚项的Hessian矩阵是纯对角矩阵。然而，如果即使将κM增加到超过1010，某些边界条件（BCs）仍然无法满足，优化过程可能会由于严重的数值错误而停滞。这种停滞发生是因为极端严格的惩罚项与接触屏障相冲突。然而，这种情况可能只会在非常罕见的CO/BC设置下发生，其程度远超过[图2.3.1](lec2.3-contact.html#fig:lec2:contact_and_friction)中测试的情况。'
