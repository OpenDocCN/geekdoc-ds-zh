- en: Particle-Grid Transfers
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 粒子-网格转移
- en: 原文：[https://phys-sim-book.github.io/lec26.3-euler_lag_transfers.html](https://phys-sim-book.github.io/lec26.3-euler_lag_transfers.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://phys-sim-book.github.io/lec26.3-euler_lag_transfers.html](https://phys-sim-book.github.io/lec26.3-euler_lag_transfers.html)
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '`<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">`'
- en: In MPM, the material state is stored on **Lagrangian particles**, while the
    [Governing Equations](./lec16-strong_and_weak_forms.html) (e.g., conservation
    of momentum) are solved on a temporary **Eulerian grid**. Therefore, we must transfer
    information between particles and grid nodes at each time step.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在MPM中，材料状态存储在 **拉格朗日粒子**上，而 [控制方程](./lec16-strong_and_weak_forms.html)（例如，动量守恒）在临时的
    **欧拉网格**上求解。因此，我们必须在每个时间步之间在粒子和网格节点之间传递信息。
- en: This section discusses how **mass**, **momentum**, and **internal forces (stress)**
    are transferred from particles to grid (P2G), and how updated velocities are transferred
    back from grid to particles (G2P).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本节讨论了如何将 **质量**、**动量**和**内部力（应力）**从粒子转移到网格（P2G），以及如何将更新后的速度从网格转移到粒子（G2P）。
- en: '[Particle-to-Grid (P2G) Transfers](#particle-to-grid-p2g-transfers)'
  id: totrans-5
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[粒子到网格 (P2G) 转换](#particle-to-grid-p2g-transfers)'
- en: '**Mass Transfer**: Let mp​ be the mass of particle p, and wip​=Ni​(xp​) be
    the [interpolation weight](./lec26.2-interpolating_functions.html) between grid
    node i and particle p. We transfer mass to grid node i by taking a weighted sum:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '**质量转移**：设 mp 为粒子 p 的质量，wip = Ni(xp) 为网格节点 i 和粒子 p 之间的 [插值权重](./lec26.2-interpolating_functions.html)。我们通过取加权平均将质量转移到网格节点
    i：'
- en: mi​=p∑​wip​mp​.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: mi = p∑wipmp.
- en: '**Momentum Transfer**: Similarly, particle velocity vp​ is used to compute
    nodal momentum:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '**动量转移**：类似地，粒子速度 vp 用于计算节点动量：'
- en: (mv)i​=p∑​wip​mp​vp​.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: (mv)i = p∑wipmpvp.
- en: 'Then, the **nodal velocity** of each grid node is:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，每个网格节点的 **节点速度**为：
- en: vi​=mi​(mv)i​​.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: vi = mi(mv)i.
- en: '**Internal Force (Stress) Transfer**: In MPM, forces are evaluated on grid
    nodes where [Newton’s second law](./lec1.2-newton_2nd_law.html) is applied. For
    hyperelastic materials, the internal elastic force can be derived either from
    the [Weak Form](./lec16.3-weak_form.html) of the momentum equation or from the
    gradient of the [Strain Energy](./lec13-strain_energy.html). The latter is often
    preferred when a well-defined energy density function is available.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '**内部力（应力）转移**：在MPM中，力在应用牛顿第二定律的网格节点上评估。对于超弹性材料，内部弹性力可以来自动量方程的 [弱形式](./lec16.3-weak_form.html)
    或来自应变能的梯度。当有明确的能量密度函数时，后者通常更受欢迎。'
- en: 'Assuming a deformation-gradient-based hyperelastic energy density Ψp​(Fp​)
    at each particle p, the total potential energy of the system is:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 假设每个粒子 p 有基于变形梯度的超弹性能量密度 Ψp(Fp)，系统的总势能为：
- en: E=p∑​Vp0​Ψp​(Fp​),
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: E = p∑Vp0Ψp(Fp),
- en: 'where Vp0​ is the rest volume of particle p. The elastic force acting on grid
    node i is then computed as the negative gradient of the total energy with respect
    to the nodal position xi​:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 Vp0 是粒子 p 的静止体积。然后，网格节点 i 上作用的弹性力被计算为总能量相对于节点位置 xi 的负梯度：
- en: fi​(x)=−∂xi​∂E​=−p∑​Vp0​∂F∂Ψp​​(Fp​(x))FpT​∇wip​.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: fi(x) = −∂xi/∂E = −p∑Vp0∂F/∂Ψp(Fp(x))FpT∇wip.
- en: 'In the case of explicit time integration such as Symplectic Euler, the force
    is evaluated at the current time step n:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在显式时间积分的情况下，如辛普利克特欧拉法，力在当前时间步 n 被评估：
- en: fin​=−p∑​Vp0​∂F∂Ψp​​(Fpn​)(Fpn​)T∇wipn​.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: fin = −p∑Vp0∂F∂Ψp(Fpn)(Fpn)T∇wipn.
- en: This formulation expresses the force on grid node i due to the elastic stress
    contributions from nearby particles. It depends entirely on known particle attributes
    and interpolation weights at the current time step.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 这个公式表示了网格节点 i 由于附近粒子引起的弹性应力贡献而产生的力。它完全取决于当前时间步中已知的粒子属性和插值权重。
- en: '[Grid Update](#grid-update)'
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[网格更新](#grid-update)'
- en: 'After collecting information from the particles, time integration is then performed
    on the grid, where 1st-order schemes are usually used:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在收集来自粒子的信息后，然后在网格上执行时间积分，通常使用一阶方案：
- en: v^in+1​=vin​+mi​Δt​(fi​+fiext​). Here, we use v^in+1​ to represent velocity
    after grid update, so that it differs from the grid velocity after P2G transfer
    in the next time step, which is written as vin+1​.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: v^in+1 = vin + miΔt(fi + fiext). 这里，我们使用 v^in+1 来表示网格更新后的速度，因此它与下一个时间步P2G转换后的网格速度不同，后者表示为
    vin+1。
- en: '[Boundary treatments](./lec28-mpm_bc.html) are also enforced during this stage
    and will be discussed in later lectures.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '[边界处理](./lec28-mpm_bc.html) 也在此阶段实施，将在后续课程中讨论。'
- en: '[Grid-to-Particle (G2P) Transfers](#grid-to-particle-g2p-transfers)'
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[网格到粒子 (G2P) 传输](#grid-to-particle-g2p-transfers)'
- en: Once the grid velocity v^in+1​ is updated, we need to transfer information back
    to the particles. The main quantity to update during the G2P transfer is the particle
    velocity vpn+1​, which will be used in the [advection](src/lec26.4-particle_state_update.html)
    step.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦网格速度 v^in+1 更新，我们需要将信息传回粒子。在 G2P 传输过程中需要更新的主要量是粒子速度 vpn+1，它将在 [对流](src/lec26.4-particle_state_update.html)
    步骤中使用。
- en: 'The simplest approach is to interpolate velocity directly from the grid:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 最简单的方法是直接从网格插值速度：
- en: vpn+1​=i∑​wip​v^in+1​.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: vpn+1 = i∑wipv^in+1.
- en: This straightforward scheme is part of the **Particle-In-Cell (PIC)** [[Harlow
    1962]](bibliography.html#harlow1962particle) method, but it is highly dissipative.
    In practice, we often adopt improved transfer schemes to better preserve velocity
    modes and conserve angular momentum.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 这种直接的方法是 **粒子-网格 (PIC**) [[Harlow 1962]](bibliography.html#harlow1962particle)
    方法的一部分，但它具有高度耗散性。在实践中，我们通常采用改进的传输方案以更好地保留速度模式并守恒角动量。
- en: '[Different Transfer Schemes](#different-transfer-schemes)'
  id: totrans-29
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[不同的传输方案](#different-transfer-schemes)'
- en: Transfer schemes define how **P2G** and **G2P** collaborate, balancing numerical
    stability, energy conservation, and physical realism in different ways.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 传输方案定义了 **P2G** 和 **G2P** 如何协作，以不同的方式平衡数值稳定性、能量守恒和物理现实性。
- en: '**Example 27.3.1 (PIC, Particle-In-Cell).** **P2G**: Particle velocity vp​
    is transferred to the grid using: (mv)i​=p∑​wip​mp​vp​. **G2P**: Particle velocity
    is interpolated directly from the grid: vpn+1​=i∑​wip​v^in+1​. PIC is very stable
    and conserves linear momentum, but suffers from high numerical dissipation, loss
    of fine-scale motion, and does not conserve angular momentum.'
  id: totrans-31
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**示例 27.3.1 (PIC, 粒子-网格).** **P2G**: 粒子速度 vp 是通过以下方式传递到网格上的：(mv)i = p∑wipmpvp.
    **G2P**: 粒子速度直接从网格插值得到：vpn+1 = i∑wipv^in+1. PIC 非常稳定且守恒线性动量，但存在高数值耗散、细尺度运动损失，并且不守恒角动量。'
- en: '**Example 27.3.2 (FLIP, Fluid-Implicit-Particle).** **P2G**: Same as PIC. **G2P**:
    In FLIP, the particle velocity is updated by blending the newly interpolated velocity
    and the change in velocity between time steps: vpn+1​=i∑​wip​v^in+1​+α(vpn​−i∑​wip​vin​),
    where α∈[0,1] is the **FLIP-PIC blending factor** (with α=1 recovering full FLIP
    and α=0.99 often used). Since FLIP only interpolate the velocity change, numerical
    dissipation is effectively mitigated. However, note that to ensure the embedding
    relation between the particle and grid, particle positions still need to be updated
    using PIC''s velocity: xpn+1​=xpn​+Δti∑​wip​v^in+1​. FLIP can preserve system
    energy and fine-scale motion over long time scales, making it well-suited for
    simulating fluids with detailed local features. However, due to its lack of inherent
    smoothing, it can introduce noise, penetration, or even instability in solid simulations.'
  id: totrans-32
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**示例 27.3.2 (FLIP, 流体隐式粒子).** **P2G**: 与 PIC 相同。**G2P**: 在 FLIP 中，粒子速度通过混合新插值速度和时间步之间的速度变化来更新：vpn+1
    = i∑wipv^in+1 + α(vpn - i∑wipvin)，其中 α∈[0,1] 是 **FLIP-PIC 混合因子**（α=1 恢复完整的 FLIP，α=0.99
    常被使用）。由于 FLIP 只插值速度变化，数值耗散得到了有效缓解。然而，请注意，为了确保粒子与网格之间的嵌入关系，粒子位置仍然需要使用 PIC 的速度进行更新：xpn+1
    = xpn + Δti∑wipv^in+1. FLIP 可以在长时间尺度上保持系统能量和细尺度运动，使其非常适合模拟具有详细局部特征的流体。然而，由于其缺乏内在平滑，它可能会在固体模拟中引入噪声、穿透甚至不稳定性。'
- en: '**Example 27.3.3 (APIC, Affine Particle-in-Cell).** [[Jiang et al. 2015]](bibliography.html#jiang2015affine)
    introduces **affine velocity fields** to more accurately model local particle
    motion and preserve angular momentum. Each particle stores an affine velocity
    matrix Cp​ in addition to its velocity vp​. The particle velocity field is written
    as: vp​(x)=vp​+Cp​(x−xp​). **P2G**: The momentum transfer includes affine motion:
    (mv)i​=p∑​wip​mp​(vp​+Cp​(xi​−xp​)). This enables particles to transfer both linear
    and angular momentum to the grid. **G2P**: After the grid update, particle velocity
    and affine matrix are reconstructed from grid values: vpn+1​=i∑​wip​v^in+1​, Bpn+1​=Dp−1​i∑​wip​v^in+1​(xi​−xp​)T.
    Here, Dp​ is a second moment matrix defined as: Dp​=i∑​wip​(xi​−xp​)(xi​−xp​)T.
    For common B-spline interpolation kernels (quadratic and cubic), Dp​ has a constant
    value: **Quadratic B-spline**: Dp​=41​Δx2I. **Cubic B-spline**: Dp​=31​Δx2I. Thus,
    Dp−1​ is simply a constant scaling factor and need not be recomputed per particle.
    APIC significantly reduces dissipation compared to PIC by capturing local rotational
    and shear effects through affine velocity fields, while also preserving angular
    momentum. Although it requires storing an additional local matrix Cp​ per particle
    and computing particle-to-grid moment contributions, the cost is modest in practice.'
  id: totrans-33
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**示例 27.3.3 (APIC, Affine Particle-in-Cell)**. [[江等，2015]](bibliography.html#jiang2015affine)
    引入了**仿射速度场**以更精确地模拟局部粒子运动并保持角动量。每个粒子除了存储其速度vp​外，还存储一个仿射速度矩阵Cp​。粒子速度场表示为：vp​(x)=vp​+Cp​(x−xp​)。**P2G**：动量传递包括仿射运动：(mv)i​=p∑wipmp​(vp​+Cp​(xi​−xp​))。这使得粒子能够将线性和角动量传递到网格上。**G2P**：在网格更新后，从网格值重建粒子速度和仿射矩阵：vpn+1​=i∑wipv^in+1​,
    Bpn+1​=Dp−1​i∑wipv^in+1​(xi​−xp​)T。在这里，Dp​是一个定义为：Dp​=i∑wip(xi​−xp​)(xi​−xp​)T的二阶矩矩阵。对于常见的B样条插值核（二次和三次），Dp​具有一个常数值：**二次B样条**：Dp​=41Δx2I。**三次B样条**：Dp​=31Δx2I。因此，Dp−1​只是一个常数缩放因子，不需要为每个粒子重新计算。APIC通过仿射速度场捕捉局部旋转和剪切效应，与PIC相比显著减少了耗散，同时保持角动量。尽管它需要为每个粒子存储额外的局部矩阵Cp​并计算粒子到网格的动量贡献，但在实际应用中的成本是适中的。'
