- en: Simulator with Visualization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 带有可视化的模拟器
- en: 原文：[https://phys-sim-book.github.io/lec4.5-sim_with_vis.html](https://phys-sim-book.github.io/lec4.5-sim_with_vis.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '[https://phys-sim-book.github.io/lec4.5-sim_with_vis.html](https://phys-sim-book.github.io/lec4.5-sim_with_vis.html)'
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
- en: Having gathered all necessary elements for our 2D mass-spring simulator, the
    next step is to implement the simulator. This implementation will operate in a
    step-by-step manner and include visualization capabilities to enhance understanding
    and engagement.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在收集了所有必要的2D质量-弹簧模拟器元素后，下一步是实现模拟器。此实现将以逐步方式进行，并包括可视化功能以增强理解和参与。
- en: '**Implementation 4.5.1 (simulator.py).**'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '**实现4.5.1（simulator.py）。**'
- en: '[PRE0]'
  id: totrans-5
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: For 2D visualization in our simulator, we utilize the [Pygame library](https://www.pygame.org/).
    The simulation is initiated with a scene featuring a single square, which is initially
    elongated horizontally. During the simulation, the square begins to revert to
    its original horizontal dimensions. Subsequently, due to inertia, it will start
    to stretch vertically, oscillating back and forth until it eventually stabilizes
    at its rest shape, as illustrated in ([Figure 4.5.1](#fig:lec4:stretched_square_sim)).
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的模拟器中进行2D可视化时，我们使用[Pygame库](https://www.pygame.org/)。模拟以一个场景开始，场景中有一个单方形，最初是水平拉伸的。在模拟过程中，正方形开始恢复其原始的水平尺寸。随后，由于惯性，它将开始垂直拉伸，来回振荡，直到最终稳定在其静止形状，如图([图4.5.1](#fig:lec4:stretched_square_sim))所示。
- en: '![](../Images/c703ef7eb4276b11b516a718717d7f93.png)'
  id: totrans-7
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/c703ef7eb4276b11b516a718717d7f93.png)'
- en: '**Figure 4.5.1.** From left to right: initial, intermediate, and final static
    frame of the initially stretched square simulation.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '**图4.5.1**。从左到右：初始、中间和最终静态帧的初始拉伸正方形模拟。'
- en: 'In addition to storing node positions `x` and edges `e`, our simulation also
    requires allocating memory for several other key variables:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 除了存储节点位置`x`和边`e`外，我们的模拟还需要为几个其他关键变量分配内存：
- en: '**Node Velocities (`v`)**: To track the movement of each node over time.'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**节点速度（`v`）**：用于跟踪每个节点随时间的变化。'
- en: '**Masses (`m`)**: Node masses are calculated by uniformly distributing the
    total mass of the square across each node. This is a preliminary approach; more
    detailed methods for calculating nodal mass in Finite Element Method (FEM) or
    Material Point Method (MPM) will be explored in future chapters.'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**质量（`m`）**：节点质量通过将正方形的总质量均匀分布在每个节点上计算得出。这是一个初步方法；在未来的章节中，将探讨在有限元方法（FEM）或材料点方法（MPM）中计算节点质量的更详细方法。'
- en: '**Squared Rest Length of Edges (`l2`)**: Important for calculating the potential
    energy in the mass-spring system.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**边长平方（`l2`）**：在质量-弹簧系统中计算势能时非常重要。'
- en: '**Spring Stiffnesses (`k`)**: A crucial parameter influencing the dynamics
    of the springs.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**弹簧刚度（`k`）**：一个影响弹簧动态的关键参数。'
- en: For visualization purposes beyond our simulator, we enable the export of the
    mesh data into `.obj` files. This is achieved by calling the `write_to_file()`
    function at the start and at each frame of the simulation. This feature facilitates
    the use of alternative visualization software to analyze and present the simulation
    results.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 为了超出我们模拟器的可视化目的，我们启用了将网格数据导出为`.obj`文件的功能。这是通过在模拟的开始和每个帧调用`write_to_file()`函数来实现的。此功能便于使用其他可视化软件来分析和展示模拟结果。
- en: '**Implementation 4.5.2 (Output Square Mesh, square_mesh.py).**'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '**实现4.5.2（输出正方形网格，square_mesh.py）。**'
- en: '[PRE1]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'With all components properly set up, the next phase involves initiating the
    simulation loop. This loop advances the time integration and visualizes the results
    at each time step. To execute the simulation program, the following command is
    used in the terminal:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有组件正确设置后，下一阶段涉及启动模拟循环。此循环推进时间积分并在每个时间步长可视化结果。要在终端中执行模拟程序，请使用以下命令：
- en: '[PRE2]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '***Remark 4.5.1 (Practical Considerations).*** With our simulator implementation
    in place, it provides us with the flexibility to experiment with various configurations
    of the optimization time integration scheme. Such testing is invaluable for gaining
    deeper insights into the roles and impacts of each essential component.'
  id: totrans-19
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***备注4.5.1（实际考虑）。*** 在我们的模拟器实现到位后，它为我们提供了实验各种优化时间积分方案配置的灵活性。此类测试对于深入了解每个基本组件的作用和影响至关重要。'
- en: ''
  id: totrans-20
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Consider an example: if we opt not to project the mass-spring Hessian to a
    Symmetric Positive Definite (SPD) form, peculiar behaviors may emerge under certain
    conditions. For instance, running the simulation with a frame-rate time step size
    of `h=0.02` and an `initial_stretch` of `0.5` could lead to line search failures.
    This, in turn, results in very small step sizes, hampering the optimization process
    and preventing significant progress.'
  id: totrans-21
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 考虑一个例子：如果我们选择不将质量-弹簧海森矩阵投影到对称正定（SPD）形式，在特定条件下可能会出现奇特的行为。例如，以帧率时间步长`h=0.02`和`initial_stretch`为`0.5`运行模拟可能会导致线搜索失败。这反过来又会导致非常小的步长，阻碍优化过程并阻止取得显著进展。
- en: ''
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: While line search might seem superfluous in this simplistic 2D example, its
    necessity becomes apparent in more complex 3D elastodynamics simulations, especially
    those involving large deformations. Here, line search is crucial to ensure the
    convergence of the simulation.
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 虽然在这个简单的二维例子中，线搜索可能看起来是多余的，但在更复杂的3D弹性动力学模拟中，尤其是在涉及大变形的模拟中，其必要性变得明显。在这里，线搜索对于确保模拟的收敛至关重要。
- en: ''
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Another point of interest is the stopping criteria applied in traditional solids
    simulators. Many such simulators forego a dynamic stopping criterion and instead
    terminate the optimization process after a predetermined number of iterations.
    This approach, while straightforward, can lead to numerical instabilities or 'explosions'
    in more challenging scenarios. This underscores the importance of carefully considering
    the integration scheme and its parameters to ensure stable and accurate simulations.
  id: totrans-25
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 另一个值得关注的点是传统固体模拟器中应用的停止标准。许多这样的模拟器放弃了动态停止标准，而是在预定次数的迭代后终止优化过程。这种方法虽然简单直接，但在更具挑战性的场景中可能导致数值不稳定性或“爆炸”。这强调了仔细考虑积分方案及其参数以确保稳定和准确模拟的重要性。
