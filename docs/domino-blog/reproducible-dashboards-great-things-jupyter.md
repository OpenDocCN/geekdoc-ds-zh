# Jupyter 的可复制仪表板和其他重要功能

> 原文：<https://www.dominodatalab.com/blog/reproducible-dashboards-great-things-jupyter>

在最近的 [Domino 数据科学弹出窗口](https://popup.dominodatalab.com/?utm_source=blog&utm_medium=post&utm_campaign=reproducible-dashboards-great-things-jupyter)上，Domino 的研究工程师 Mac Rogers 展示了创建 Jupyter 仪表板的最佳实践。

## 会话摘要

在这个数据科学的弹出式会议中，Domino 的研究工程师 Mac Rogers 深入探讨了在 Jupyter 中创建可再现仪表板的技巧和最佳实践。数据科学家使用 Jupyter 来探索数据、测试想法、编写代码和共享工作。然而，创建交互式仪表盘或快速总结研究结果的方法，使数据科学家、数据科学经理和利益相关者能够进一步了解他们所做的工作及其结果。Mac 认为，有了真正可复制的仪表板，如果“你实际上已经证明了一些关于世界如何运转的东西……那个结论是任何人都可以得到的，不管他们采取什么途径。”

本次会议的几个重要亮点包括

*   Jupyter 仪表盘概述及其在数据科学生命周期中的作用
*   再现性的不同定义和应用
*   用 Jupyter 的魔法命令打开可能性
*   r 使用 rpy2(一个开源包)嵌入在 Python 中运行
*   在您的笔记本上渲染 HTML，等等

如欲了解更多关于本次会议的见解，请观看视频或通读文字记录。

![Reproducible Dashboards and Other Great Things to do with Jupyter](img/bb646663852bce7b56f8f342fed3e30d.png)

## 演示文稿的视频记录

谢谢你加入我们。我要开始了，所以我不会逗留太久。

我们将讨论使用 Jupyter 的可复制仪表板。我们将对 Jupyter 做一个简单的概述，以防有人不熟悉。

一点我自己的背景。我叫麦克·罗杰斯。我在多米诺工作。我有化学工程的背景，然后在对冲基金做定量研究，现在在多米诺工作。

开始之前，我们跳得太远，所以我想涵盖的第一件事是“什么是仪表板？就数据科学生命周期和数据科学家的工作而言，它们到底有什么用处？”

我没有意识到，格雷格是一个伟大的数据可视化专家，也是一个制图师。因此，不幸的是，我的演示中有一个地图示例，你们可能会因此对我做出判断。接下来我们要讨论的是，“什么是再现性？那么，为什么这在数据科学和数据科学生命周期的背景下很重要呢？”最后，我们将介绍一些使用 Jupyter 做更多事情的技巧和诀窍。我们会看到你对朱庇特有多熟悉。

这是一个很好的继续。"你们中有多少人知道 Jupyter 是什么或者以前用过 Jupyter？"好的，很好。“你们中有多少人认为自己是高级 Jupyter power 用户，每天都在工作中使用它？”好的，很好。几个月前，我在 JupyterCon 给了这个演讲一个味道，它是一个非常不同的动态。希望这对你有用，而不是多余的。

但是我首先想讨论的主要问题是，“什么是仪表板？”所以你可以把仪表板想象成一种综合信息的方式。它不仅仅是单一的数据可视化。它是一个数据可视化的集合，给你一些你想要讲述的故事的想法，或者你希望你的观众或你的观众从你所做的任何分析中获得的信息，或者你正在进行的任何项目的最终目标。

我从加州大学圣地亚哥分校的 Philip Guo 那里偷来了这个数据科学生命周期。郭在他的博士论文期间，在数据科学成为事物之前，意识到他创建了数据科学生命周期，作为他对定量分析和定量分析如何工作的元分析的研究的一部分。这里的想法是，“仪表板在这个数据科学生命周期中处于什么位置？”。它可以有一个完整的其他话题，就像数据科学研究或定量研究生命周期中经历的所有各种事情一样。但是，作为一名数据科学家、定量研究人员或定量研究人员团队的经理，当您需要了解他们在做什么时，仪表板才真正发挥作用。并了解他们所做的工作以及他们所做工作的结果。

这就涉及到传播部分，不仅仅是写一份书面报告，更是一种快速总结你所有发现的方式；对你的业务的某一部分的长期的、持续的看法；你的学术工作；或者你试图解释的世界的一部分。

Jupyter 笔记本很有趣，因为它们涵盖了所有这些东西。从数据采集到清理，一直到实际分析本身。该分析的迭代以及实际生产你一直在做的东西。

在学术环境中，你要写一篇论文，并把一些结果提交给期刊。但在企业界，你必须证明你的成果是有价值的，然后帮助企业利用这些成果。这不仅仅是一些非常好的见解，而是通过你所做的工作来改变业务运营的方式。仪表板适合这个周期的后期，你把你的工作成果传播给其他人。这就是我们在这个生命周期中所处位置的一些背景。

Jupyter 笔记本的价值不可思议，但我们只关注最后一件。关于再现性方面的第二个问题是“再现性在可视化或仪表板的上下文中意味着什么，或者甚至像任何数据科学工作一样？”不仅仅是“其他人能运行这个代码吗？”因为你可能认为有能力以一种其他人也可以消费的方式传播你的成果。“但他们能得出同样的结论吗？”这不仅仅是他们可以像你执行代码一样执行代码。“他们能接触到您使用过的相同数据吗？但是他们能像你一样经历探索、分析、实验和总结的过程吗？”这对不同的行业有不同的意义。

当我在金融服务领域工作时，有一种想法是“我开发的这种交易策略，当它实际上在市场中时，与在我的模拟中相比，会产生钱吗？”这是一个结果的再现性，“这实际上增加了我认为它会增加的价值吗？”这当然不仅仅适用于金融领域。金融界还有另一个可复制性的方面，“当我开发的这个系统化的交易策略出现在证券交易委员会面前时，它会在哪里产生同样的系统化的结果？”

因此，在生产中使用它与在审计中使用它时，能够出于相同的原因实际生成相同的结果。这也适用于保险业，你必须证明你建立的模型没有任何偏见或歧视，而且它们每次都以相同的方式分析相同的数据。

有趣的一点是，学术界也有这种可重复性的想法，有一个非常流行的统计数据，比如“有多少百分比的学术研究是可重复的？”这是一个非常低的数字，人们实际上可以去另一个实验室，复制，做同样的结果，得到同样的实验。从我高中的化学课开始，或者像那些教科书一样，可复制性，重复性和再现性之间是有区别的？

这真的很有趣，在过去的三四年里，在计算机科学领域和更传统的化学或生物学领域，对于这些术语的含义有一些分歧。我不会说太多。我不会就哪一个意味着哪一个表明立场，但我的想法是，基于相同的计算，使用相同的数据，使用相同的信息，简单地得到相同的结果是有区别的。有点像你虚张声势，你在论文中得出的结论，实际上是可以用同样的信息得到的。

您可以采取更进一步的措施，我认为这在数据科学领域更为重要。这不仅仅是我可以执行相同的代码，相同的方式，就像它今天会以六个月前的方式运行吗？

但是给同一个问题一个新的解释，“我能达到同样的目标吗？”因此，这可能是设计一个新的实验，在一个新的数据集上，使用新的方法或材料，“根据我选择的路线，结果会是一样的吗？”这更多的是在整体可再现性的领域，我得到了相同的结论，就像测试我的无效假设给我带来了相同的结果。

不管我使用的是哪种数据集，也不管我在什么环境下工作，这就像圣杯一样。这并不是说你已经完成了一系列的指令，并能证明这些指令得出了相同的结论。但是如果你真的证明了这个世界是如何运转的……这个结论是任何人都可以得到的，不管他们采取什么途径。

为了做到这一点，你要做的不仅仅是简单地写一份清单，让其他人遵循。你必须从头到尾解释整个过程。这是我努力实现的目标。这些是我前进道路上的障碍。这些是我认为我将要克服的障碍。这就是我将要围绕这些来设计我的实验的方式，这样我得出的结论是全球适用的，而不是非常狭隘的。这是一个关于可复制性的大讨论。有一个宾夕法尼亚大学的教授，他有一个关于语言学和语义学的博客，他有一篇关于这三者区别的文章，如果你想看的话，非常有趣。

最后一块进入木星本身。我想在这里花一点时间谈谈 Jupyter 如何适应这个生命周期。第一，听起来很多人都知道朱庇特。一个基于网络的应用程序，让你运行代码，添加评论，添加描述，可视化，它真的很强大。如果我们回到数据科学的生命周期，它通常是数据科学家或研究人员使用的工具。他们编辑脚本或执行代码，检查输出，这对于让我测试这个东西的迭代周期来说真的很棒。“让我看看结果。让我展示一下利益相关者。让我把它带回来。”

我们看到 Jupyter 在这个生命周期中如此有价值的一个方面，不仅仅是这个狭窄的部分，是许多数据科学家或研究人员知道当他们从一个环境到学术环境，或者从一个更重研究的环境到企业环境时，他们喜欢使用什么工具，在那里你必须证明你正在增加的价值，或者展示你正在工作的结果。事实上，学习一门全新的语言，或者全新的系统是一件非常痛苦的事情，这是为了让它可视化。或者以一种其他人可以利用的方式来做，这些人不是程序员、数据科学家，或者不懂 Python、不懂 r。

Jupyter 如此有价值的原因之一是你可以在一个罩下结合许多不同的工具和技术。在某种程度上，让你能够很容易地将你产生的结果传递给组织的其他成员。从 Greg 在我面前展示的内容来看，这些是一些非常酷的强大地图，我不知道是否有任何数据科学家能够在项目结束后拼凑出这些地图。我当然不能，但是不要相信我的话。Jupyter 在这种情况下变得如此有价值的原因是，你可以对你工作的基础平台做一些非常小的改变。您进行数据清理、数据脚本编写、基本图表、模型训练以及为 TensorFlow 引入 GPU 的地方。同样的环境可以用来产生结果和分发你一直在工作和发展的分析…在某种程度上降低了数据科学家或研究人员以其他人可以发现有价值的方式分发他们的成果的门槛。

你不必去学习如何编写 JavaScript 或非常复杂的可视化工具。你可以使用你已经在使用的东西，如果你有记录你正在做的事情的严谨性，并以一种直观的方式展示给其他人利用。现在，如果你组织得当，你可以让一个三到五人的团队使用一个工具。

接下来我想讲几个例子。我将跳到一个 Jupyter 笔记本，里面有一些提示和技巧。在 JupyterCon 上，这无疑是最有趣的部分，因为每个人都想要所有的代码。希望有一部分观众对逐行代码不太感兴趣，但是我会展示给你们看以证明它是有效的。

使用 Jupyter 最酷的部分之一就是这些神奇的命令。魔法指令背后的想法是他们能够打开 Jupyter 罩下的可能世界。在幕后，Jupyter 只是根据你的工作运行许多不同的内核。我将跳进这个 Python 3 笔记本。太好了。所以这个神奇的命令揭开了幕后可能发生的事情。所有这些不同的命令，如果你熟悉 Jupyter，你们会知道它是什么。对于 Python 2、Python 3、R、Scala、Julia，每个单元都在跨单元的共享内核中运行一个内核。在这种情况下，我们运行的是 Python 3。

所以当我点击这个 LS 魔法命令时，它会显示所有这些魔法命令的列表。我不打算一一列举它们的功能，但我会列举几个真正强大的功能。它将帮助我们制作一个非常酷的仪表板，只要你不是制图师。所以简单的一个只是感叹号。你实际上可以像在终端一样运行。你可以列出这个项目中的所有文件。这对于直接从 Jupyter 内部安装包来说很常见，不需要打开终端，执行你的东西，来回切换。同样的原则也适用，所以如果我只想运行一行，我可以用感叹号运行我的 bash 命令。

如果我想让整个单元执行，作为一个 bash 单元，只需执行% % bash，现在我正在做一些事情，比如检查我正在运行的 Pandas 的版本。这并不仅仅局限于 bash。在这个例子中，我只说我使用的 Python 版本，Python 3。因为 Pythonistas 就在上面，你很快就会意识到这是行不通的，因为这不是 Python 3 的语法。这是 Python 2 语法。我不知道是否有人曾试图在一个团队中工作，这个团队总是在争论我们应该使用哪个版本的 Python。但是有了像 Jupyter 这样的东西，你就可以绕过它了。你不必让每个人改变他们的语法或者重写他们所有的代码。使用 Python 2 的魔力，你可以在 Jupyter 笔记本上运行 Python 3 中的 Python 2 代码。所以我们执行这个，现在在 Python 3 笔记本内部，我们在 Python 2 内核内部执行 Python 2。不需要安装不同的笔记本，不需要使用 Anaconda 来管理全新的环境。就在那里。

好吧，但还有更多。有一个开源包叫做 rpy2。“观众中有 R 用户吗？”好的，很好。所以你会喜欢这个而不是 JupyterCon。所以现在，我们可以简单地开始在这个 Jupyter 笔记本里面使用 R。当然，Jupyter 的用户会意识到，你可以用 Python 2 做诱饵。同样的原则也适用。您可以在 Jupyter 笔记本下运行 R 内核，但是您也可以在 Python 3 笔记本内运行 R 内核，而不必将它写成传递给 Python 函数的字符串。所以现在，我们用的是 R 3.2，这是它真正酷的地方。

我们将回到运行 Python 的普通单元。我们要去获取虹膜数据集，因为花需要更多的分析。我们实际上可以传递这个 Python 数据框。这是一个 Python 熊猫数据框。我们将把它传递到 R 内核中，因为我喜欢 dplyr 和 ggplot，所以我将在我的 Python 3 笔记本中使用 R 来绘制它。如果你有一个同事更喜欢 dplyr，喜欢管道函数，觉得它们更直观，就像我一样，你实际上可以使用这些 R 命令来分析你的 Python 数据帧。你可以来回传递它们。对于这个问题或那个问题来说，这变得非常容易，我将致力于我最擅长的任何工具，无论什么时候我知道得最多…我会为那种语言切换到这种语言，并根据需要切换回另一种语言。

这变得非常容易，只需挑选你最喜欢的工作。作为社区，这些数据真的很有价值，因为这不是大家都同意的事情。你如何做数据科学工作没有标准。Python 2 正在慢慢地被弃用，虽然很慢，但是很确定，但是人们仍然在使用它。Python 3 开始变得越来越流行。它本身仍然是一种完全不同的动物，把这两者结合起来真的很难。Jupyter 让你很容易团结地作为一个团队工作，而不是像如果你想和这个团队一起工作，你必须去下载 R Studio。如果你想在这个队里工作，你就得施展你的个人魅力。它给了你一个工作的环境，这很好。

所以现在我们只是在讨论一些其他的事情，比如如果你在学术领域做得更多，你可以用 LaTeX 或者任何你想用 LaTeX 做的事情来渲染非常酷的方程。可以用 HTML，真的很甜。我们将在仪表板中使用它。所以只要使用 HTML 的魔力，你现在就可以在你的笔记本里呈现 HTML。这使得交互式图表和可视化变得非常容易。这更多的是技术方面，但也很酷，因为 Jupyter 只是一些内核的 HTML 覆盖。你可以把手伸到引擎盖下摆弄它，这可能很危险，但有一些简单的预设示例。

如果你熟悉 head 函数，它会抓取最上面的几行。它会做一些基本的事情。但是，如果您曾经试图一次查看多个数据框，您必须单独打印它们。这可能是一个小烦恼，但也很容易改变。我们设置了一个 IPython 变量。现在，我们可以在一个调用中渲染头部、尾部、描述它，而不用打印它，超级简单。还有一些非常有用的计时工具，比如评估一个函数完成需要多长时间。您可以使用 timeit 函数。它会运行你的代码一百万次，然后看看平均计算时间是多少。所以我们只是做一个简单的循环，它将运行一百万次循环，并计算出它的速度。如果你在 Jupyter 中评估代码的性能，这真的很简单。

最后是交互式图表、可视化和绘图。所以我们在这个例子中使用 seaborn，他们的基本 pairplot。你们可能熟悉 Matplotlib inline，它可以显示可视化效果。他们最近推出了 Matplotlib Notebook，这使得这些可视化成为交互式的，而不是静态的。比如说我想——pair plots 总是铺天盖地而来——但是我想放大这个特定的片段。我可以对所有相关的视觉化图像都这样做。你可以直接进入，现在它就像一个互动的东西，在我的 Jupyter 笔记本里面。真的很简单。

好了，为了节省提问的时间，我将直接进入最后一个环节，也就是把所有这些结合起来。所以现在，我们可以在细胞之间，细胞内核之间传递信息。这样我就可以写剧本了。我可以把它传递给我的 Python 函数。我可以把它传回 R，反之亦然。我可以呈现 HTML。我可以渲染互动图像。我会一直讲到最后，说我有这个笔记本。我做了一些分析。我希望我的组织中的其他人使用它，看到它，看看它。如果我把这个发给他们，他们就会关机。就像，“这是代码。我不喜欢它。我不要。”

但是，Jupyter 的超级可扩展。我有这个 HTML 的小脚本，你可以在 Stack Overflow 上找到。没什么特别的，只是给了我这个按钮。我可以切换这个代码，所以现在所有可怕的代码都消失了。最后，我得到了我的地图，按照制图师的标准，它看起来可能很糟糕，但根据美国地质服务中心的数据，它显示了美国的地震。我可以看到水力压裂在俄克拉荷马州没有引起任何问题。我可以看到西北地区什么也没发生。真的很棒。所以现在，这是一个非常简单的方法，我可以有一个其他人可以跟随的仪表板。他们可以打开代码，看看我在做什么。他们可以看到我在使用什么库。他们可以看到我的数据源是什么，我在做什么操作，我如何构建可视化。无需重新编写一个全新的应用程序，我就可以像只做迭代分析一样可视化数据，然后与他人分享使用。我没有额外的工作。我已经粘贴了一些很容易在网上获得的片段，现在我有了一个其他人可以使用的仪表板，其他人可以跟随。其他不是程序员的人实际上可以利用并融入他们产生的任何见解。

不幸的是，我没有谈到这张幻灯片，但这是一个将它带回来的好机会。在数据科学项目或定量研究中，您可以生成一些光谱分析，您可以有一个特别的报告，如地震图，它只是显示“嘿，在这个时间点，这是发生的事情。”显然，你可以走极端，就像机器和有 API 的机器对话一样。

可复制的仪表板，甚至像可共享和可用的托管仪表板，真的很有价值，因为它们位于这个区域，这里是人类消费者的更高级的终端。我们正在构建一些没有用的东西，只是想通知一个单独的决定。但是它可以用来告诉你整个思考过程，比如“我如何管理这个团队？或者我该如何处理这一业务？”到“我如何驱动我的公司？，我如何从一个定性的、轶事驱动的组织变成一个一致的、定量的、数据驱动的机构。”这就是这类事情的由来，从“嘿，给我这张我们在该地区的销售图表，到我们基于这些东西的预计收入……以及我如何每天都能看到它？，以及它是如何变化的？”所以这就是仪表板有价值的原因。

Domino 编辑注意:为了可读性，这篇文字经过了轻微的编辑。