# 风暴为按需计算带来的雪花和激流

> 原文：<https://www.dominodatalab.com/blog/snowflake-and-rapids-for-on-demand-computing-by-a-storm>

随着数据被称为 21 世纪^(的[石油](https://www.wired.com/insights/2014/07/data-new-oil-digital-economy/))世纪以及数据科学被贴上本世纪最性感工作的标签，我们看到数据科学和机器学习应用在每个领域都出现了大幅增长。在 IT、金融和商业领域，预测分析正在颠覆每个行业。 

然而，随着数据量的持续增长，数据科学家和 ML 工程师面临的最大挑战之一是如何高效地存储和处理如此大量的数据。当他们需要执行计算量很大的任务(如特征工程)时，问题会变得更糟。简单地说，基础设施目前是 ML 世界的限制因素。

因此，在今天的文章中，我们将探讨如何使用雪花和 NVIDIA 的 RAPIDS 解决大规模计算问题。而且，达斯克在这一切中也起着至关重要的作用。

## 一点背景

几年前，对于大多数企业来说，采用现场计算是显而易见的。然而，考虑到计算和存储需求的动态变化，这种模式不再适用。当他们需要扩展、进行数据备份以及同时使用多种数据格式时，会遇到一些问题。

为了应对这些问题，一些企业更进一步，建立了本地数据仓库。每当他们想要完成计算开销大的任务，如模型训练、特征工程等等，他们就将所有需要的数据转移到进行计算的地方。但这不仅非常慢且昂贵，而且对大多数人来说还存在各种安全问题。

然而，我们将在本文中讨论的架构通过将数据和计算这两个领域的精华结合起来解决了所有这些问题。

## 雪花+激流——为什么组合这么好？

先说雪花。[雪花数据云](https://www.snowflake.com/)是一个众所周知的云架构，完美地满足了用户的所有存储需求。传统上，现场存储解决方案面临着诸如**数据扩展、安全性、治理**等问题。然而，雪花没有遭受任何这些。您不仅可以方便地扩大容量，而且也不局限于存储任何特定类型的数据，可以存储您想存储的任何数据。

接下来，我们有 NVIDIA，它多年来因在重型计算的硬件和软件领域的持续卓越而闻名。在其各种成功的项目中，一个这样的项目是[RAPIDS](https://developer.nvidia.com/rapids)——一个**开源、** [**GPU 支持的**](https://www.nvidia.com/en-us/deep-learning-ai/software/rapids/) 平台，数据工程师可以在实现高达 100 倍加速的同时完成处理广泛的任务。

RAPIDS 的一大优点是它提供了所有常用的 API，如 pandas 和 scikit-learn，因此工程师可以专注于他们的用例，而不是担心实现。

当用于训练需要大量计算的端到端机器学习模型时，雪花和急流的这种组合在速度方面完全使传统方法相形见绌。然而，完整的集成还需要一个工具——Dask。在本文的后面，我们将看到 DASK 如何帮助我们实现这种端到端架构。

## 【Dask 在哪里发挥作用？

想知道我们为什么需要 Dask 吗？嗯， [Dask](https://www.dask.org/) 是数据科学社区中最著名的[并行计算框架](https://www.dominodatalab.com/blog/spark-dask-ray-choosing-the-right-framework)之一。它通过以分布式方式处理任务来帮助加速任务。幸运的是，Dask 支持数据科学家需要的大多数 API，比如 Pandas、sklearn，甚至本例中的 RAPIDS。

下面是我们如何使用 Dask-Snowflake 包将您的所有数据从 Snowflake 无缝导入 Dask dataframes。

```py
from dask_snowflake import read_snowflake

query = "Select * from SAMPLE_DATA LIMIT 100"

df = read_snowflake(query= query,

                    connection_kwargs=DB_CREDS)

```

## 查询从达斯克&急流下推至雪花

当用户从 Dask 客户端向 Snowflake 发送一个查询进行处理时，流程开始。一旦查询被发送并在 Snowflake 中处理，客户机就会以响应的形式接收所有 [SQL 结果集](https://sqlstudies.com/2016/01/14/what-is-result-sets/)的元数据。

这里需要注意的是，通常客户端一次只能处理结果集的一部分。然而，多亏了雪花使用的 [Apache Arrow](https://arrow.apache.org/) ，多个结果集可以作为独立的工作器发送，并且可以并行计算。

接下来，Dask 客户端接收到的元数据用于初始化从雪花中并行读取结果集，从而实现高速数据检索。这里值得一提的是，您可以在 Python 环境中完成所有这些工作，这是该架构的一个重要亮点，对于数据科学家来说非常有用。

最后，一旦以 Dask 数据帧的形式获得结果集，您就可以使用 RAPIDS 处理它们，同时利用 GPU 以闪电般的速度著称。这样，我们就完成了端到端的机器学习过程——无论是培训、验证还是功能工程。

## 分布式按需计算的一些优势

对于企业来说，转向分布式按需云计算不仅省事，而且相对经济高效。虽然如果公司规模较大，本地基础架构在成本方面可能会稍好一些，但它需要大量的前期资本，更不用说设置所需的时间了。

然而，这还不是全部。您可能不知道分布式云计算的许多其他方面。我们来过一遍:

### 1.无限存储

不管你怎么想，从长远来看，现场计算的存储总会有问题。即使你不是一个渴求数据的组织，这种情况现在很少发生，但总会有空间不足的时候。当这种情况发生时，与云计算相比，获得额外的存储空间肯定不是一件容易的事情，在云计算中，你几乎可以享受无限的存储空间。

### 2.快速部署

云服务提供商夜以继日地为您的部署提供无缝支持。即使你也有现场计算的专家，你也不可能与像亚马逊和微软这样的云计算巨头竞争，对吗？

因此，一旦你注册了云计算，不言而喻，部署将变得像点击一样简单。这节省了大量人力资源，增加了云系统的成本效益。

### 3.加强安全&治理

当您进行现场计算时，数据治理和安全性始终是一个大问题。亚马逊和微软等云供应商付出了额外的努力，以确保你不会面临任何这方面的问题。

然而，我要说的是，过去最著名的云计算供应商也出现过[安全漏洞](https://firewalltimes.com/amazon-web-services-data-breach-timeline/)。但就个人而言，与现场相比，它们还是少了很多。