# 设计一流的 MLOps 管道

> 原文：<https://www.dominodatalab.com/blog/designing-a-best-in-class-mlops-pipeline>

如今，数据科学家面临的最大挑战之一是以高效且可重复的方式将模型从开发阶段转化为生产阶段。通过这种方式，机器学习(ML)管道寻求识别该过程中涉及的步骤。一旦定义了这些步骤，就可以对其进行自动化和编排，从而简化数据科学的生命周期。

简而言之，机器学习操作( [MLOps](/resources/a-guide-to-enterprise-mlops) )管道将 ML 工作流的每个部分抽象为可操作的模块，这反过来允许数据科学生命周期自动化。这有助于更快地开发、培训、验证和部署生产模型。

在本文中，您将了解典型的 ML 管道的结构，以及在设计一流的 MLOps 管道时要考虑的最佳实践和技巧。

## MLOps 管道看起来像什么

在目前可用的许多机器学习文献中，以及在许多数据科学平台的文档中，您会发现如下所示的 ML 管道图:

![Typical ML pipeline courtesy of Damaso Sanoja](img/1b0d112ad03665e1791bd5362e36a548.png)

如您所见，在传统的 ML 管道中有六个明确定义的阶段:

*   **数据收集:** 数据收集由与数据摄取相关的过程组成，包括将来自不同来源的原始数据传输到其存储位置，通常是数据库。从那里，团队成员可以访问它进行准确性和质量验证。
*   **数据验证:** 在此阶段，对数据的准确性和质量进行验证。
*   **数据预处理:** 准备好之前验证过的原始数据，以便能够被不同的 ML 工具处理。这包括将原始数据转换成适合使用的特征。
*   **模型训练:** 这是数据科学家通过[训练和调优](https://blog.dominodatalab.com/what-is-machine-learning-model-training)多个模型，然后选择最佳模型进行实验的地方。
*   **模型分析和验证:** 在此阶段，在将经过训练的模型部署到生产环境之前，将对其性能指标进行验证。
*   **模型部署:** 这个阶段包括注册一个模型，并准备好供业务使用。

对于 MLOps 管道有一种不同的思考方式，它考虑了整个 ML 模型生命周期，从项目启动的那一刻开始，直到在 projection 中对其进行监控(包括最终的再培训):

![Domino's MLOps pipeline courtesy of Damaso Sanoja](img/c22a851695b34e9b5a9a5e683ece8ea4.png)

在本文的其余部分，您将了解在设计一流的 MLOps 管道时需要考虑的事项。

## 设计一流 MLOps 管道的最佳实践

设计同类最佳 MLOps 管道的目的是最大限度地减少模型生命周期中的摩擦。这可以通过自动化来完成；然而，说起来容易做起来难。

正如您在上一节中看到的，MLOps 管道由许多移动部分组成，因此实现它们之间的协同是复杂的，更不用说自动化了。幸运的是，随后列出的技巧和最佳实践可以帮助您的团队完成这项工作。

### 分而治之

因为设计 MLOps 管道可能是一项艰巨的任务，所以将它分成更小、更易于管理的步骤被认为是一种最佳实践。这里的关键是彻底定义每个过程，以便于优化和后续的自动化。

例如，在开发阶段，管道中易于优化的一个过程是为您的团队提供一个或多个 ML 框架或过程来执行实验。尽管乍一看似乎很简单，但这一步有其自身的挑战，例如软件版本之间的依赖冲突，以及确定工具所需的资源。因此，另一个有用的技巧是限制每个管道步骤的范围，以避免使其过于复杂。

理想结果的参考可以在  [Domino 的自动化环境创建](https://www.dominodatalab.com/product/self-service-infrastructure-portal)中找到，它允许科学家使用各种分布式计算框架和 ide，这些框架和 ide 在  [Docker](https://www.docker.com/) 映像中自动提供，并链接到您的文件和数据源。

### 编制 MLOps 管道时保持简单

一旦您有了明确定义的步骤，您就应该着手编排 MLOps 管道。换句话说，确定数据将如何被设计，以及当它从一个步骤移动到下一个步骤时将遵循什么方向和顺序。一个好的技巧是避免不必要的复杂性，使用 ML 编排工具来促进这项任务。然而，请记住，大多数 ML 编排系统的学习曲线往往是陡峭的，所以提到的时间节省假设您的团队已经克服了这个障碍。

如果您正在寻找这一悖论的最有效解决方案，答案就在  [达美乐的](https://www.dominodatalab.com/product/domino-enterprise-mlops-platform) 数据科学平台，这是唯一一个提供数据科学生命周期端到端编排的平台。

### 不要忘记记录所有的变化

设计 MLOps 流水线消耗相当多的资源。出于这个原因，记录您对管道所做的所有更改是一个最佳实践。这有助于重用或重新规划管道，从而加快新模型的开发。

另外，类似的原理也适用于你的实验。跟踪实验和模型便于复制。Domino Experiment Manager 最有价值的特性之一是它能够跟踪所有结果以及代码、数据、Docker 图像、参数和重现它们所需的其他内容。此外，Domino 的实验管理器版本自动允许您的团队对每次运行进行标记和评论，以便更好地跟踪结果并确定哪个配置得分最高。

### 自动化，但不忽略大局

最终，MLOps pipelines 的目标是加快交付可操作的结果，从而做出更好的业务决策。换句话说，在设计 MLOps 管道时，您的团队可能必须在功能方面做出让步，以促进自动化和流程编排。

在灵活性和复杂性之间找到理想的平衡并不容易，因为涉及到许多移动部件，而且一些设计决策会影响整个管道。正因为如此，数据科学家的核心职能技能不是为了解决 it 基础架构的技术方面和限制而设计的，这也于事无补。例如，将经过训练的模型转换成适合消费的格式。模型的容器化不同于创建一个现成的 API。DevOps 工程师，而不是数据科学家，通常处理这些任务，因此模型格式的变化可能是一个主要的不便。

幸运的是，Domino 平台允许数据科学家根据需要将模型作为 API、Docker 容器或应用程序自行发布——这一切都得益于其强大的 UI，并且不需要编写任何代码。

### 避免供应商锁定

在这一点上，一个及时的建议是不惜一切代价避免使用专有技术的诱惑，希望享受来自单个供应商的各种功能，而不需要您进行编排。这是一个错误，你的组织最终将为此付出代价。

这是避免供应商锁定的最佳实践，在这方面，没有什么比 Domino 更好的了——它是唯一开放的工具和语言无关的 MLOps 平台，经得起未来的考验。

### 请记住，模型监控不是可选的

你会发现有些管道一旦投产就忽略了[监控模型](/blogs/model-monitoring-best-practices-maintaining-data-science-at-scale)的重要性。这与 ML 管道以模型部署结束的错误信念有关，这是一个违背最佳实践的严重错误，因为监控对于确保模型预测保持准确至关重要。此外，由于模型会随着时间的推移而退化，重新训练它们的需求是不可避免的。

建议记住，MLOps 管道从一开始就是循环的；一旦部署了一个模型，就必须不断地监控它的性能，以确定跳回到初始阶段的正确时机。

在 Domino，监控的重要性得到了强调，这就是为什么他们的平台会自动监控数据和模型质量漂移，以便在生产数据不再与用于培训的数据兼容时发出警报，这样数据科学家就可以及时重新培训和重新发布这些模型。

### 不要低估协作的力量

设计 MLOps 管道的最后一个技巧是不要低估协作的力量。如前所述，Domino 相信一流的 MLOps 管道是一个跨越整个数据科学生命周期的管道。不同的团队有时在不知道的情况下处理类似的问题，这有什么意义呢？综合所有数据科学家的知识和经验不是更有效率吗？

Domino 提供了一个集中式平台，可以自助访问工具和基础设施，数据科学家可以在这里发现、重用、复制工作，并最终节省时间和资源。

[![The Complete Guide to  Enterprise MLOps Principles  Learn the key to becoming a model-driven business Read the Guide](img/9c077285252ec960ecf5eff9b9d6c5dc.png)](https://cta-redirect.hubspot.com/cta/redirect/6816846/4670a0fa-8832-4636-93d7-a77ea2f9611c)