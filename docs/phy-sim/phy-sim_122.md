# 障碍和距离

> 原文：[`phys-sim-book.github.io/lec24.1-barrier_and_dist.html`](https://phys-sim-book.github.io/lec24.1-barrier_and_dist.html)

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">

使用三角形网格离散化，连续设置中的势垒势（方程(18.3.5)）可以近似为 ≈==∫ΓC21b(X2∈ΓC−N(X)min∥x(X,t)−x(X2,t)∥,d^)ds(X)∫ΓC21b(e∈T−I(X)minX2∈emin∥x(X,t)−x(X2,t)∥,d^)ds(X)∫ΓC21b(e∈T−I(X)mindPT(x(X,t),e),d^)ds(X)∫ΓC21e∈T−I(X)maxb(dPT(x(X,t),e),d^)ds(X)，(24.1.1) 其中 T 是所有表面三角形的集合，I(X)是包含点 X 的所有表面三角形的集合，dPT 是点-三角形距离。进一步用求和来近似最大运算符，并使用网格表面节点 a^作为求积点，我们有 ≈≈∫ΓC21e∈T−I(X)maxb(dPT(x(X,t),e),d^)ds(X)∫ΓC21e∈T−I(X)∑b(dPT(x(X,t),e),d^)ds(X)a^∑21wa^e∈T−I(Xa^)∑b(dPT(xa^,e),d^)，(24.1.2) 其中 wa^=d³¹∑j∈I(Xa^)Aj 是积分权重，Aj 是节点 a^的入射表面三角形 j 的面积。

现在，回到方程式(24.1.1)的第二行，如果我们只使用边上的点来近似最小距离，我们得到 ≈=∫ΓC21b(X2∈ΓC−N(X)min∥x(X,t)−x(X2,t)∥,d^)ds(X)∫ΓC21b(e∈E−I(X)minX2∈emin∥x(X,t)−x(X2,t)∥,d^)ds(X)∫ΓC21e∈E−I(X)maxb(X2∈emin∥x(X,t)−x(X2,t)∥,d^)ds(X). 然后，如果我们为每个表面边 e1 选择一个特殊的求积点 Xe1，并用求和来近似最大运算符，我们得到 ≈∫ΓC21e∈E−I(X)maxb(X2∈emin∥x(Xe1,t)−x(X2,t)∥,d^)ds(X)e1∈E∑21we1e∈E−I(Xe1)∑b(X2∈emin∥x(Xe1,t)−x(X2,t)∥,d^)，其中 we1=d³¹∑j∈I(e1)Aj 是积分权重，Aj 是 e1 的入射表面三角形 j 的面积。接下来，如果我们始终选择 Xe1 作为 e1 上最接近 X2 的点，我们将得到 ≈=e1∈E∑21we1e∈E−I(Xe1)∑b(X2∈emin∥x(Xe1,t)−x(X2,t)∥,d^)e1∈E∑21we1e∈E−N(e1)∑b(X2∈e,X∈e1min∥x(X,t)−x(X2,t)∥,d^)e1∈E∑21we1e∈E−N(e1)∑b(dEE(e,e1),d^)，(24.1.3) 其中 N(e1)是 e1 的所有表面边邻居的集合加上它自己。对于方程(24.1.3)中所有表面边的求和，如果我们只考虑(e1,e)中 e1<e 或相反的情况，那么系数 1/2 可以省略。

现在我们有三种 3D 势垒势能的离散化方法。为了在实际中同时使用它们，我们可以利用它们的线性组合，并且系数通常可以设置为 1/2。

对于点-三角形和边-边距离，它们也都是具有解析解的小优化问题，可以表示为分段光滑函数，如方程 (21.2.1) 中的 2D 点-边距离。例如，在点-三角形的情况下，可以通过检查点在三角形平面上的投影位于哪个区域来确定表达式。

> **定义 24.1.1 (3D 点-三角形距离).** 点 xp 与顶点为 xt1, xt2, xt3 的三角形之间的距离可以定义为 argβ1,β2 min ∥xp − (xt1 + β1(xt2 − xt1) + β2(xt3 − xt1))∥，其中 β1,β2 ≥ 0, β1 + β2 ≤ 1
> 
> **定义 24.1.2 (3D 边-边距离).** 具有端点 xe1a 和 xe1b 的边与具有端点 xe2a 和 xe2b 的边之间的距离可以定义为 argβ1,β2 min ∥xe1a + β1(xe1b − xe1a) − (xe2a + β2(xe2b − xe2a))∥，其中 β1,β2 ∈ [0,1]
> 
> ***备注 24.1.1 (3D 距离函数的平滑性).*** 注意到点-三角形距离在所有地方至少是 C1 连续的。这意味着即使投影点位于分段函数的边界上，距离梯度仍然存在且是连续的。然而，对于边-边距离，当边平行时，距离函数仅是 C0 连续的，因为相邻区域表达式的梯度不一致。为了解决这个问题，IPC [[Li 等人 2020]](bibliography.html#li2020incremental) 提出将一个磨光器乘以边-边障碍能密度函数，以使势能在所有地方都是 C1 连续的。当边平行时，这个磨光器平滑地减小到零。这确保了基于梯度的优化方法仍然可以有效地应用于解决问题。
