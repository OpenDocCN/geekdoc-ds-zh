# DOF 消除法

> 原文：[`phys-sim-book.github.io/lec5.2-DOF_elimin.html`](https://phys-sim-book.github.io/lec5.2-DOF_elimin.html)



以最简单的粘性狄利克雷边界条件为例，其约束雅可比矩阵 $  A  $ 起到选择矩阵的作用。因此，$  AA^T  $ 形成一个 $  m \times m  $ 的单位矩阵，而 $  A^T A  $ 成为一个 $  dn \times dn  $ 的对角矩阵。在这个矩阵中，对应于边界条件节点的项为 1，其余项为 0。

当我们将 $  A  $ 左乘到方程 (5.1.3) 的第一行块时，得到的方程是：

[AHA^TA^TA][Δxλ^T]=[−Ag0^T].

这种操作使我们能够直接求解 $  \lambda  $ 如下：

λ=−AHΔx−Ag.(5.2.1)

通过将方程 (5.2.1) 代回到方程 (5.1.3) 的第一行块中，我们得到以下方程：

(I−ATA)HΔx=(I−ATA)(−g).(5.2.2)

这里，左乘以 $ (I - A^T A) $ 有效地消除了对应于边界条件节点的行。因此，方程 (5.2.2) 表示一个欠约束系统。然而，方程 (5.1.3) 的第二行块实际上为我们提供了边界条件节点处的 $ \Delta x $ 值（因此它们实际上并不是未知数）。考虑到这一信息，我们可以将方程 (5.2.2) 重写为一个对称正定（SPD）系统：

HUBΔxB+HUUΔxU=−gU,

其中矩阵和向量按以下方式划分：

H=[HBBHUBHBUHUU],Δx=[ΔxBΔxU],g=[gBgU],

其中下标 $  B  $ 表示边界条件节点。知道 $ \Delta x_B = 0 $，系统简化为：

HUUΔxU=−gU,(5.2.3)

这代表了一个排除边界条件节点的 SPD 系统。

### 更实用的方法

上文概述的方法主要用于数学解释。在实际应用中，构建方程 (5.2.3) 常常被避免。这是因为它涉及到重新排列自由度（DOFs）并将边界条件节点与无约束节点分离，这个过程既繁琐又低效，尤其是在狄利克雷节点集合随时间变化时。

为了避免重新排列自由度（DOFs）的需要，可以对原始线性系统进行直接修改，使其与方程 (5.2.3) 对齐。这种调整涉及将 $  H  $ 和 $  g  $ 中对应于边界条件节点的行的所有条目设置为 $  0  $。此外，对于与 $  H  $ 中边界条件节点关联的列，所有非对角条目都设置为 $  0  $，而对角条目被分配为 $  1  $ 或另一个正实数，以确保系统保持良好的条件。在解这个修改后的系统后，$  \Delta x_U  $ 的结果值立即获得，并且所有 $  \Delta x_B  $ 值都保证为 $  0  $。

> **示例 5.2.1（自由度消除）**。对于在 示例 5.1.1 中定义的问题，其中第二个节点 $ (x_{21}, x_{22}) $ 在一个二维两节点系统中固定在 $ (1,2) $，假设在某个时间步的某次迭代中 $  H=4-1-1-1-1/4-1-1-1-1/4-1-1-1/4  $，且 $  g=1,2,3,4  $，我们解系统 $  4-1\ 0\ 0\ 0\ -1\ 4\ 0\ 0\ 0\ 0\ 0\ 0\ 1\ 0\ 0\ 0\ 0\ 0\ 0\ 1  $ $ \Delta x_{11}\ \Delta x_{12}\ \Delta x_{21}\ \Delta x_{22} $ $ =\ -1\ -2\ 0\ 0\  $ $ \) \((5.2.4) $ 对于搜索方向 $ \Delta x $，使得 $ \Delta x_{21} = \Delta x_{22} = 0 $，并且在单行搜索之后，我们肯定知道 $ (x_{21}, x_{22}) = (1, 2) $ 仍然成立，因为 $ (x_{21} + \alpha \Delta x_{21}, x_{22} + \alpha \Delta x_{22}) = (x_{21}, x_{22}) $。这里 (5.2.4) 实质上是 $ [HUU][\Delta x_U \Delta x_B] = [-g_U 0] $。
> 
> ***注 5.2.1（自由度消除方法的局限性）***。所描述的自由度消除方法在时间步开始时建立粘性边界条件节点时是有效的。然而，如果情况不是这样，并且方程 (5.1.3) 中的约束函数具有非零的右侧（rhs），则自由度消除方法就不再适用。这里的问题不是在具有非零 rhs 的约束下无法求解 $  \Delta x  $。相反，关注的是，得到的 $  \Delta x  $ 可能不会导致增量势中的下降方向。这可能导致单行搜索后步长极其小，从而可能使优化过程停滞。
> 
> 直观上，如果 $  \Delta x_B  $ 的方向指向预定的边界条件（BC）坐标，它可能会无意中增加增量势，而这并没有考虑到边界条件。相反，如果 $  \Delta x_B  $ 在边界条件已经满足时简单地为 $  0  $，它实际上使用变量子集最小化了增量势，这仍然是一个有效的方法。
> 
> 人们可能会问，为什么不在开始优化之前调整自由度以满足边界条件。然而，这种策略可能会导致不可行的配置，例如涉及交叉的情况。一个可行的替代方案是在优化过程中最初应用刚性的弹簧力，逐渐地将边界条件节点“拖动”到它们的约束位置。之后，切换到自由度消除方法可以增强收敛性。这一技术将在移动边界条件*部分进一步讨论。
