# 半隐式离散化

> 原文：[`phys-sim-book.github.io/lec9.2-semi_imp_fric.html`](https://phys-sim-book.github.io/lec9.2-semi_imp_fric.html)

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">

然而，将摩擦力纳入优化时间积分中仍然存在挑战。一个主要问题是摩擦力不是一个守恒力，没有定义良好的势能，使得取其梯度的相反数可以得到摩擦力。换句话说，隐式摩擦力是不可积的。没有势能，就无法进行回溯线搜索，因此优化稳定性和收敛性的保证将被破坏。

实际上，一个力是否具有定义良好的势能确实取决于时间离散化。例如，在显式时间积分中，任何力 f 在时间步长内是恒定的，并且具有势能−fTx。受到这种灵感的启发，我们可以通过更智能的时间离散化使摩擦力可积。使摩擦力在时间步长内保持恒定无疑会限制时间步长的大小以获得高质量的结果。因此，我们显式地离散化部分摩擦力，并制定了一个可积的半隐式摩擦力。

遵循 IPC，我们在非线性优化期间将法向力大小λ（仅用于计算摩擦力）和切向算子 T 固定为最后一个时间步 n 的值：λn=λ(xn)，Tn=T(xn)，这使得摩擦力与势能 Pf(x)=k∑μλknf0(∥vˉk∥),(9.2.1)可积，其中 vˉk=(Tkn)Tv, h^I=(∂v/∂x)−1, 和 f0(y)={−3ϵv2h²y3+ϵvh^y2+3ϵvh^​,y,​y∈0,ϵvh^)y≥ϵvh^,​(9.2.2) 以便 f0′(y)=f1(y/h^)。这里 h^是时间步长 h 的常数倍，对于大多数线性（多步）时间积分方法，包括隐式欧拉和高阶后差公式等。然后，对方程[(9.2.1)关于 x 求梯度，我们得到 −∇Pf(x)=−k∑μλknTknf1(∥vˉk∥)s(vˉk),(9.2.3)，这是我们的光滑摩擦力的半隐式离散化，具有显式项λkn 和 Tkn。Pf 的 Hessian 可以计算为 =∇2Pf(x)k∑μλknTkn(∥vˉk∥3f1′(∥vˉk∥)∥vˉk∥−f1(∥vˉk∥)∥vˉk∥vˉkT+∥vˉk∥f1(∥vˉk∥)I3)TknT∂x∂v.​(9.2.4)

> ***注 9.2.1.*** 在摩擦梯度和 Hessian 的表达式（方程(9.2.3)和方程(9.2.4)）中，分母中有∥vk∥，当接触点没有相对滑动运动时，这可能是 0。为了避免计算过程中的除以 0，对于摩擦梯度，我们可以推导出∥vˉk∥f1(∥vˉk∥)={−ϵv2∥vˉk∥+ϵv2,1/∥vˉk∥，∥vˉk∥∈[0,ϵv)∥vˉk∥≥ϵv，(9.2.5)这在任何地方都是良好定义的，因此我们得到−∇Pf,k(x)=−μλknTkn∥vˉk∥f1(∥vˉk∥)vˉk=0 当∥vˉk∥=0。对于摩擦 Hessian，我们可以推导出∥vˉk∥2f1′(∥vˉk∥)∥vˉk∥−f1(∥vˉk∥)={−1/ϵv2，−1/∥vˉk∥2，∥vˉk∥∈[0,ϵv)∥vˉk∥≥ϵv，(9.2.6)这同样在任何地方都是良好定义的，并且由于当∥vˉk∥=0 时，vˉkvˉkT/∥vˉk∥=0，我们知道当∥vˉk∥=0 时，∇2Pf,k(x)=μλknTkn(∥vˉk∥f1(∥vˉk∥)I3)TknT∂x∂v。
> 
> ***注 9.2.2.*** 本讲座中摩擦公式的介绍与原始的 IPC [[Li et al. 2020]](bibliography.html#li2020incremental)在两个地方略有不同：
> 
> 1.  我们直接使用相对滑动速度 vk 而不是相对滑动位移 uk=h^vk，如 IPC 中所述，作为 mollifier f1()的输入，因此我们的 f1()在分母中的 h^与 IPC 中的不同。当应用除了隐式 Euler 以外的时积分规则（因此 xn+1−xn≠h^vn+1）时，将 uk 称为相对滑动位移是不恰当的，并可能引起混淆。
> 1.  
> 1.  我们没有引入切线基来表示切线空间中的相对滑动速度，因为在计算摩擦能、梯度和 Hessian 时这不是必要的。
