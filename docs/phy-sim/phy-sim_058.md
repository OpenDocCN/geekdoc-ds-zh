# 惩罚法

> 原文：[`phys-sim-book.github.io/lec11.1-penalty_method.html`](https://phys-sim-book.github.io/lec11.1-penalty_method.html)



在每个时间步长向时间 n+1 开始时，我们根据每个 BC 节点 k 的预定运动评估每个 BC 节点的节点位置 x^kn+1。在每次牛顿迭代 i 中，对于迭代 xi，我们定义一个速度残差来评估每个 BC 节点接近其目标的情况：rBC,ki=h1∥xki−x^kn+1∥。当 rBC,ki 对于任何 BC 节点 k 低于特定的容差ϵ时，我们可以将节点固定在其当前位置 xki≈x^kn+1，并在后续迭代中应用自由度消除法。这在只有静态 BC 的场景中尤其简单，其中直接应用自由度消除法。

对于远离其目标位置的 BC 节点 k，我们为每个这些节点引入新的惩罚项到增量势中：2κMmk∥xk−x^kn+1∥2。(11.1.1) 这里，mk 代表节点质量，允许直观地设置惩罚刚度κM，因为与 BC 节点相关的惩罚项的 Hessian 矩阵仅仅是惯性项的κM 倍。

> ***备注 11.1.1.*** 对于碰撞障碍物（CO），由于密度等未知因素的影响，精确计算节点质量具有挑战性。一种实用的方法是假设密度与场景中模拟固体的密度相似。这个假设使得惩罚项的 Hessian 矩阵的对角线元素大约是惯性项的κM 倍。
> 
> 对于如壳体、杆和粒子这样的超维 CO，关键是计算它们的体积时要考虑一个合理的较大厚度。这有助于确保它们的物理属性与主要模拟体的物理属性更加接近。

适当地设置惩罚刚度κM 可能具有挑战性。如果κM 设置得太低，可能无法有效地将 BC 节点移动到其目标位置。相反，过高的κM 可能导致数值问题。因此，我们最初将κM 设置为一个合理的较大值，并在必要时自适应地增加它。

在牛顿求解过程中，如果在牛顿收敛点的 BC 节点 k 处有 rBC,ki≥ϵ，我们将惩罚刚度κM 加倍到其当前值的 2 倍，并继续牛顿求解。这个过程会重复进行，直到所有 BC 在收敛时都得到满意地满足。

> ***备注 11.1.2.*** 在实践中，使用双精度浮点数时，只要κM 的初始值低于 106，通常就足够了，因为严格惩罚项的 Hessian 矩阵是纯对角矩阵。然而，如果即使将κM 增加到超过 1010，某些边界条件（BCs）仍然无法满足，优化过程可能会由于严重的数值错误而停滞。这种停滞发生是因为极端严格的惩罚项与接触屏障相冲突。然而，这种情况可能只会在非常罕见的 CO/BC 设置下发生，其程度远超过图 2.3.1 中测试的情况。
