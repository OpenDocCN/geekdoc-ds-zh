# 体积守恒约束

> 原文：[`phys-sim-book.github.io/lec32.3-pbd_volume_constraints.html`](https://phys-sim-book.github.io/lec32.3-pbd_volume_constraints.html)

`<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">`

在计算机图形学的许多应用中，不可压缩或近似不可压缩材料的模拟至关重要。在一个基于力的框架中，不可压缩性通常需要求解一个复杂的泊松方程来求解压力。PBD 通过通过几何约束强制执行体积或密度守恒提供了一种更直接且通常更简单的方法。本节将探讨几种此类约束，从定义在离散网格元素（如四面体）上的约束开始，扩展到封闭表面的全局体积约束。

### 四面体体积和三角形面积约束

对于离散成四面体网格的体积对象，可以通过限制每个单个四面体的体积保持在其静止体积来近似不可压缩性。

> ****定义 33.3.1（四面体体积约束）.**** 给定一个由四个顶点 p1、p2、p3、p4 定义的四面体，其静止体积为 V0，体积约束函数 C 定义为：C(p1, p2, p3, p4) = 61((p2−p1)×(p3−p1))⋅(p4−p1)−V0 (33.3.1) 当 C=0 时，约束得到满足。此函数关于四个顶点位置的梯度是：∇p1C∇p2C∇p3C∇p4C = 61((p3−p2)×(p4−p2)) = 61((p4−p3)×(p1−p3)) = 61((p1−p4)×(p2−p4)) = 61((p2−p1)×(p3−p1)) 这些梯度——与对立面的面积成比例的向量——用于计算四个顶点的位置修正。对于 2D 或 3D 模拟中的三角形面积，可以定义一个类似的约束。

### 封闭网格的全局体积

对于由封闭、密封的三角形网格（如可充气角色）表示的对象，通常希望控制封闭的总体积。这可以通过对网格的所有顶点施加单个全局约束来实现。封闭网格的总体积 V 可以使用散度定理计算，该定理离散化为一个所有三角形的和。每个三角形 i（顶点为 pt1i、pt2i、pt3i）的贡献体积是由三角形和原点形成的四面体的有向体积：

V=i∑N_triangles61(pt1i×pt2i)⋅pt3i

然后将全局体积约束公式化为保持此体积在目标值，该目标值通常是静止体积 V0 乘以压力因子 kpressure：C(p1,...,pN) = (i∑61(pt1i×pt2i)⋅pt3i)−kpressureV0 (33.3.2) 此约束关于顶点位置 pj 的梯度是所有与该顶点相邻的三角形的梯度的和。这导致一个校正，在整个表面上重新分配体积误差。
