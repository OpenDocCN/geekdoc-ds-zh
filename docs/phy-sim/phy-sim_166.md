# 约束求解中的刚度和阻尼

> 原文：[`phys-sim-book.github.io/lec31.5-stiffness_damping.html`](https://phys-sim-book.github.io/lec31.5-stiffness_damping.html)



### 刚度

材料刚度由参数 k∈[0,1]控制，该参数控制约束施加的强度。将刚度纳入的最直接方法是将计算出的校正量乘以 k：Δpi​←k⋅Δpi​。然而，这使得有效刚度依赖于求解器迭代次数 ns​。如果一个约束被投影 ns 次，投影后的剩余误差将与(1−k)ns 成正比。一个更稳健的公式，将刚度与迭代计数解耦是：k′=1−(1−k)1/ns（32.5.1）。通过将校正量乘以 k′而不是 k，ns 次迭代后的剩余误差变为(1−k′)ns=1−k，这与 ns 无关。这使得艺术家可以调整材料刚度 k，而不用担心使用了多少求解器迭代。

### 阻尼

虽然 PBD 方法通常稳定，但模拟可能会表现出过度的振荡或动能增加，尤其是在刚性约束的情况下。通过引入适当的阻尼方案，通常可以提高动态模拟的质量。它可以通过减少物体点位置的时间抖动来提高稳定性。它还允许使用更大的时间步长，从而提高动态模拟的性能。

对所有速度进行简单的阻尼可能会不希望地影响物体的全局运动，减慢其整体平移和旋转。更复杂的方法是仅阻尼粒子的相对运动，同时保持系统的总线性和角动量。

> ****方法 32.5.1（动量守恒阻尼）****
> 
> 1.  **计算质心和速度：** pcm​=∑i​mi​∑i​mi​pi​​, vcm​=∑i​mi​∑i​mi​vi​​
> 1.  
> 1.  **计算角动量和惯性张量：** 令 ri​=xi​−pcm​.
> 1.  
>     L=∑i​ri​×(mi​vi​)
>     
>     I=∑i​mi​((ri​⋅ri​)Id−ri​⊗ri​)
>     
> 1.  **计算角速度：** ω=I−1L
> 1.  
> 1.  **应用阻尼：** 对于每个粒子 i：
> 1.  
>     a. 计算刚体运动的速度偏差：Δvi​=(vcm​+ω×ri​)−vi​
>     
>     b. 将阻尼应用于偏差：vi​←vi​+kdamping​Δvi​

此方法有效地隔离了运动中的非刚性组件，并仅对它们进行阻尼。在极端情况下，当 kdamping​=1 时，所有相对运动都被消除，物体表现为完美的刚性体。

### 扩展位置基于动力学（XPBD）

虽然方程式 (32.5.1) 中的刚度公式将有效刚度与求解器的迭代次数解耦，但标准 PBD 仍然存在一个基本限制：得到的材料刚度仍然依赖于模拟时间步 Δt。一种称为**扩展位置基动力学（XPBD）**的扩展方法解决了这个问题，实现了真正的参数无关刚度。

XPBD 是从合规性约束公式推导出来的，并引入了合规性作为刚度的倒数这一概念。

> ****定义 32.5.1（合规性）**** 合规性，α≥0，是材料刚度 k 的倒数，α=1/k。它描述了材料在载荷下的变形倾向。在 XPBD 中，合规性 α=0 对应于无限刚硬或硬约束。

XPBD 的核心思想是将拉格朗日乘子 λ 不视为每次迭代重新计算的临时值，而视为一个表示累积冲量的物理量，该冲量是增量更新的。在每个求解器迭代中，我们计算一个冲量增量 Δλ，并将其添加到该约束的总冲量 λ。这个增量公式的修改如下：Δλ=∑j​wj​∣∇pj​​C(p)∣2+α^−C(p)−α^λ​(32.5.2)。在这里，λ 是当前时间步内之前迭代中约束的总累积拉格朗日乘子。α^ 是时间步缩放后的合规性，定义为：α^=(Δt)2α。这种缩放确保了合规性参数 α 在动力学系统内具有物理上一致的单位。计算 Δλ 后，求解器会更新该约束的粒子位置和累积拉格朗日乘子：Δpi​=−Δλwi​∇pi​​C(p)和λ←λ+Δλ

> ***备注 32.5.1（XPBD 的解释）***。方程式 (32.5.2) 分母中的 +α^ 项旨在限制校正冲量 Δλ 的大小。随着合规性 α 的增加（即材料变得更柔软），α^ 增加，从而减少了每次迭代应用的冲量。在零合规性（α=0）的情况下，α^ 项消失，Δλ 的公式简化为方程式 (32.4.3) 中的标准 PBD 公式。

XPBD 的主要优势**不是更快地收敛，而是收敛到一个物理上一致的状态，正确地反映了用户定义的合规性 α**，与时间步或迭代次数无关。如果求解器提前终止，系统仍然会表现出一定程度上的所需柔软性，而不是人工的、不受控制的合规性。这使得材料行为更加可预测和稳健。
