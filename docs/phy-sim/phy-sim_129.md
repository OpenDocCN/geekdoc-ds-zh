# 拓扑刚体动力学

> 原文：[`phys-sim-book.github.io/lec25.3-affine_body_dynamics.html`](https://phys-sim-book.github.io/lec25.3-affine_body_dynamics.html)

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">

之前，我们回顾了刚体动力学，并使用显式积分实现了一个简单的求解器。

当处理许多刚体——特别是具有复杂几何和密集接触时——自然地会尝试 IPC 进行接触求解。然而，用位置 x 和旋转 q 来表示刚体会带来挑战：由于四元数更新的非线性，牛顿法中的步长滤波在 α 上变得非线性。

设刚体的状态为 y=(x,q)，其中 x 是质心，q 是表示方向的单位四元数。在牛顿迭代过程中，设更新方向为 p=(px​,pq​)，步长为 α，则更新后的状态为 y~​=y+αp。初始位于 xv(0)​ 的顶点位置随后转换为：

xv​=q​(xv(0)​−x(0))q​−1+x

展开这个表达式，可以看出 x~v​ 在 α 上是非线性的：

xv​=(q+αpq​)(xv(0)​−x(0))(q+αpq​)−1+x+αpx​，由于 q​ 非线性地依赖于 α，因此 x~v​ 也是。因此，线性 CCD 可能无法保证无交错的运动。

我们可以将刚体建模为非常刚性的软体（例如，质量-弹簧或超弹性），但这既不高效也抵消了自由度减少的好处。

拓扑刚体动力学（ABD）[[Lan et al. 2022]](bibliography.html#lan2022affine) 解决了这个问题：我们不是严格地要求刚性，而是允许每个刚体顶点 x 有微小的仿射变形 xˉ↦x=Ax+b，其中 xˉ 表示静止位置。刚体状态为 y=(bT,a1T​,a2T​,a3T​)，其中 A=(a1​,a2​,a3​)T，因此顶点位置 x 变为：

x=Jy​

其中 J=(I3×3​,I3×3​⊗xˉT)，其中 ⊗ 表示克罗内克积。

这一线性特性使得 x 线性依赖于优化步长 α，从而实现了鲁棒的线性 CCD。

设 E(x) 为扩展的 IPC 能量。原始 IPC 求解：∇x​E(x)=0​

ABD 在一个降维子空间中求解：

∇y​E(Jy)=0​

使用链式法则：

∇y​E(Jy)Dy2​E(Jy)​=JT∇x​E(x)=JTDx2​E(x)J​(25.3.1) ，我们可以通过求解线性系统 JTDx2​E(x)J=−JT∇x​E(x) 来求解牛顿优化方向。

使用这些方法，我们可以通过隐式欧拉积分实现简单的二维 ABD。

在实现之前，考虑以下几何视图：在二维中，仿射变换由 3 个点确定。为每个刚体选择一个三角形，我们可以通过重心坐标插值所有顶点。三角形驱动模拟；原始网格用于碰撞。这产生了一个降维的自由度系统，其中三角形控制运动——这正是 ABD 所做的事情。
