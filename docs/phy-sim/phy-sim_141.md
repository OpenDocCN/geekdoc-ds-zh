# 粒子-网格转移

> 原文：[`phys-sim-book.github.io/lec26.3-euler_lag_transfers.html`](https://phys-sim-book.github.io/lec26.3-euler_lag_transfers.html)

`<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">`

在 MPM 中，材料状态存储在 **拉格朗日粒子**上，而 控制方程（例如，动量守恒）在临时的 **欧拉网格**上求解。因此，我们必须在每个时间步之间在粒子和网格节点之间传递信息。

本节讨论了如何将 **质量**、**动量**和**内部力（应力）**从粒子转移到网格（P2G），以及如何将更新后的速度从网格转移到粒子（G2P）。

### 粒子到网格 (P2G) 转换

**质量转移**：设 mp 为粒子 p 的质量，wip = Ni(xp) 为网格节点 i 和粒子 p 之间的 插值权重。我们通过取加权平均将质量转移到网格节点 i：

mi = p∑wipmp.

**动量转移**：类似地，粒子速度 vp 用于计算节点动量：

(mv)i = p∑wipmpvp.

然后，每个网格节点的 **节点速度**为：

vi = mi(mv)i.

**内部力（应力）转移**：在 MPM 中，力在应用牛顿第二定律的网格节点上评估。对于超弹性材料，内部弹性力可以来自动量方程的 弱形式 或来自应变能的梯度。当有明确的能量密度函数时，后者通常更受欢迎。

假设每个粒子 p 有基于变形梯度的超弹性能量密度 Ψp(Fp)，系统的总势能为：

E = p∑Vp0Ψp(Fp),

其中 Vp0 是粒子 p 的静止体积。然后，网格节点 i 上作用的弹性力被计算为总能量相对于节点位置 xi 的负梯度：

fi(x) = −∂xi/∂E = −p∑Vp0∂F/∂Ψp(Fp(x))FpT∇wip.

在显式时间积分的情况下，如辛普利克特欧拉法，力在当前时间步 n 被评估：

fin = −p∑Vp0∂F∂Ψp(Fpn)(Fpn)T∇wipn.

这个公式表示了网格节点 i 由于附近粒子引起的弹性应力贡献而产生的力。它完全取决于当前时间步中已知的粒子属性和插值权重。

### 网格更新

在收集来自粒子的信息后，然后在网格上执行时间积分，通常使用一阶方案：

v^in+1 = vin + miΔt(fi + fiext). 这里，我们使用 v^in+1 来表示网格更新后的速度，因此它与下一个时间步 P2G 转换后的网格速度不同，后者表示为 vin+1。

边界处理 也在此阶段实施，将在后续课程中讨论。

### 网格到粒子 (G2P) 传输

一旦网格速度 v^in+1 更新，我们需要将信息传回粒子。在 G2P 传输过程中需要更新的主要量是粒子速度 vpn+1，它将在 对流 步骤中使用。

最简单的方法是直接从网格插值速度：

vpn+1 = i∑wipv^in+1.

这种直接的方法是 **粒子-网格 (PIC**) [[Harlow 1962]](bibliography.html#harlow1962particle) 方法的一部分，但它具有高度耗散性。在实践中，我们通常采用改进的传输方案以更好地保留速度模式并守恒角动量。

### 不同的传输方案

传输方案定义了 **P2G** 和 **G2P** 如何协作，以不同的方式平衡数值稳定性、能量守恒和物理现实性。

> **示例 27.3.1 (PIC, 粒子-网格).** **P2G**: 粒子速度 vp 是通过以下方式传递到网格上的：(mv)i = p∑wipmpvp. **G2P**: 粒子速度直接从网格插值得到：vpn+1 = i∑wipv^in+1. PIC 非常稳定且守恒线性动量，但存在高数值耗散、细尺度运动损失，并且不守恒角动量。
> 
> **示例 27.3.2 (FLIP, 流体隐式粒子).** **P2G**: 与 PIC 相同。**G2P**: 在 FLIP 中，粒子速度通过混合新插值速度和时间步之间的速度变化来更新：vpn+1 = i∑wipv^in+1 + α(vpn - i∑wipvin)，其中 α∈[0,1] 是 **FLIP-PIC 混合因子**（α=1 恢复完整的 FLIP，α=0.99 常被使用）。由于 FLIP 只插值速度变化，数值耗散得到了有效缓解。然而，请注意，为了确保粒子与网格之间的嵌入关系，粒子位置仍然需要使用 PIC 的速度进行更新：xpn+1 = xpn + Δti∑wipv^in+1. FLIP 可以在长时间尺度上保持系统能量和细尺度运动，使其非常适合模拟具有详细局部特征的流体。然而，由于其缺乏内在平滑，它可能会在固体模拟中引入噪声、穿透甚至不稳定性。
> 
> **示例 27.3.3 (APIC, Affine Particle-in-Cell)**. [[江等，2015]](bibliography.html#jiang2015affine) 引入了**仿射速度场**以更精确地模拟局部粒子运动并保持角动量。每个粒子除了存储其速度 vp​外，还存储一个仿射速度矩阵 Cp​。粒子速度场表示为：vp​(x)=vp​+Cp​(x−xp​)。**P2G**：动量传递包括仿射运动：(mv)i​=p∑wipmp​(vp​+Cp​(xi​−xp​))。这使得粒子能够将线性和角动量传递到网格上。**G2P**：在网格更新后，从网格值重建粒子速度和仿射矩阵：vpn+1​=i∑wipv^in+1​, Bpn+1​=Dp−1​i∑wipv^in+1​(xi​−xp​)T。在这里，Dp​是一个定义为：Dp​=i∑wip(xi​−xp​)(xi​−xp​)T 的二阶矩矩阵。对于常见的 B 样条插值核（二次和三次），Dp​具有一个常数值：**二次 B 样条**：Dp​=41Δx2I。**三次 B 样条**：Dp​=31Δx2I。因此，Dp−1​只是一个常数缩放因子，不需要为每个粒子重新计算。APIC 通过仿射速度场捕捉局部旋转和剪切效应，与 PIC 相比显著减少了耗散，同时保持角动量。尽管它需要为每个粒子存储额外的局部矩阵 Cp​并计算粒子到网格的动量贡献，但在实际应用中的成本是适中的。
