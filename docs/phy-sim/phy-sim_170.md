# 碰撞约束

> 原文：[`phys-sim-book.github.io/lec32.2-pbd_collisions_constraints.html`](https://phys-sim-book.github.io/lec32.2-pbd_collisions_constraints.html)



在任何物理模拟中，防止物体相互穿透是获得合理结果的关键。基于位置的动力学提供了一种统一的解决方案来应对这一挑战。碰撞不是作为一个涉及冲量或惩罚力的单独后处理步骤来处理；相反，它们被表述为单边不等式约束，就像 IPC [[Li et al. 2020]](bibliography.html#li2020incremental) 一样，并直接集成到核心 PBD 求解器循环中。

### 三角形自碰撞

对于像布料或其他可变形表面这样的薄壳对象，一个主要挑战是处理自碰撞，其中对象折叠并与其自身相互作用。最常见的情况是一个顶点从网格的另一部分穿透三角形。这种相互作用通过涉及所有四个参与粒子的单边约束来建模。

考虑一个位置为 q 的顶点和一个由顶点 p1、p2、p3 组成的三角形。可以通过定义一个最小分离距离，或厚度 h，从三角形平面来表述碰撞约束。单边约束函数是：C(q,p1,p2,p3)=(q−p1)⋅n−h≥0(33.2.1)，其中 n=(p2,1×p3,1)/∥p2,1×p3,1∥是三角形的单位法线。如果 C<0，所有四个粒子(q,p1,p2,p3)都参与其中，并且它们的位姿会根据各自的逆质量进行校正，以解决穿透问题同时保持动量。在应用校正之前，检查顶点在三角形平面上的重心坐标也是至关重要的，以确保接触点位于三角形的边界内。

### 粒子-环境碰撞

最简单的碰撞场景涉及一个动态粒子与一个静态、不可移动的几何体相互作用，例如地板平面或凸容器。这个几何体作为模拟域的边界。对于一个位于位置 p 的粒子与一个静态平面相互作用，非穿透条件可以表述为粒子与平面之间有符号距离的约束。

让平面定义为，对于它上面的任何点 p，有 nTp−drest​=0，其中 n 是单位法线，drest 是一个偏移量。一个粒子 p 的非穿透约束可以写成不等式：C(p)=nTp−drest​≥0(33.2.2)。当一个粒子违反这个约束（即，C(p)<0）时，PBD 求解器将其位置投影回表面。由于只有一个粒子是动态的，与静态几何相比，其逆质量实际上是无限的，因此它接收满足 C(p)=0 所需的全部位置校正。校正简单地沿着平面法线 n 移动粒子以解决穿透。你可以想象这如何简单地扩展到更复杂的形状。

### 粒子-粒子碰撞

对于由离散元素组成的系统（如颗粒材料）的模拟，我们必须考虑直接的粒子-粒子碰撞。这个约束防止任何两个粒子重叠。

对于位于位置 pi 和 pj 的两个粒子，它们对应的半径为 ri 和 rj，非穿透约束是一个基于它们中心到中心距离的简单不等式：C(pi​,pj​)=∥pi​−pj​∥−(ri​+rj​)≥0(33.2.3)。与线性平面约束不同，这个函数是非线性的。这可以通过与上一节中考虑的拉伸约束类似的方法来解决。求解器计算一个校正，将两个粒子沿连接它们中心的向量推开，根据它们的逆质量分布校正，以保持线性动量守恒。

### 位置级别的摩擦效应

摩擦是一种耗散接触力，它反对表面之间的相对切向运动。为了更稳健，我们可以将摩擦直接纳入位置级约束求解。这种方法是在两个粒子 i 和 j 之间的穿透约束被解决之后应用的。

让 pi 和 pj 分别是时间步长开始时的粒子位置。让 p∗i 和 p∗j 是当前的候选位置，这些位置已经校正以解决穿透。核心思想是计算一个摩擦位置校正，该校正反对粒子在时间步长内相对位移的切向分量。

首先，我们确定时间步长内的相对位移向量 Δprel：Δprel=(p∗i​−pi​)−(p∗j​−pj​)。接下来，我们通过将其投影到由接触法线 n 定义的接触平面上来找到这个位移的切向分量 Δpt：Δpt=Δprel−(Δprel⋅n)n(33.2.4)。摩擦模型根据切向位移 ∥Δpt∥ 与静摩擦阈值之间的比较来确定校正的幅度，静摩擦阈值与穿透深度 d 和静摩擦系数 μs 成正比。

一个位置校正向量，Δpfriction，被计算出来以对抗Δpt。这个校正随后在两个粒子之间分配。粒子 i 的校正由以下公式给出：Δpi=−wi+wjwi×{ΔptΔptmin(∥Δpt∥μk​d​,1)if ∥Δpt∥≤μs​dotherwise}(Static Friction)(Kinetic Friction)(33.2.5) 其中 wi=1/mi 是质量的倒数，μk 是动摩擦系数。负号是至关重要的，因为摩擦必须对抗切向位移。在静态情况下，校正完全抵消了相对切向运动。在动态情况下，校正受到动摩擦力（库仑定律）的限制。
