# 约束表述

> 原文：[`phys-sim-book.github.io/lec31.3-formulation.html`](https://phys-sim-book.github.io/lec31.3-formulation.html)



前一章中描述的主循环依赖于解算器来纠正预测的粒子位置 p，使其满足所有定义的约束。我们首先将问题表述为一个大型非线性方程和不等式系统。然后，我们将推导出解决这个系统的核心数学工具，这涉及到线性化约束函数并应用 Gauss-Seidel 类型的迭代方案。推导将展示如何在考虑粒子质量的同时计算单个约束的位置修正。

### 问题表述

解算器的核心任务是找到一个位置修正集Δpi，将预测位置 pi 移动到新的状态 pi+Δpi，使得所有 M 个约束都得到满足。如果我们把所有粒子位置连接成一个单一的状态向量 p=[p1T,...,pNT]T∈R3N，那么问题就是求解以下混合等式和不等式系统：C1(p)C2(p)⋮CM(p)≻0≻0≻0(32.3.1)

其中每个 Cj(p)可能代表一个等式(=0)或一个不等式(≥0)。这个系统提出了一个重大挑战。问题包括一组 M 个方程，对应于 3N 个未知的位置分量。如果 M≥3N，那么系统是超定的；如果 M≤3N，那么系统是欠定的。此外，系统通常是非线性的，因为约束函数通常涉及距离或角度。对于实时应用来说，全局和同时解决这样的系统在计算上是不可行的。

PBD 通过采用局部和迭代的方法来规避这种复杂性。它不是一次性解决整个系统，而是逐个顺序处理一个约束，类似于求解线性系统的 Gauss-Seidel 方法。每个约束都是独立解决的，并且位置更新立即应用，影响同一迭代中后续约束的解。我们反复迭代所有约束，并将粒子投影到仅相对于给定约束的有效位置。
