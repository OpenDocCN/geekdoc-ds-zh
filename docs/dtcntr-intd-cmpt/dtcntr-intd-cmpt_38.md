# 12.3 内存中的数组和列表

> 原文：[`dcic-world.org/2025-08-27/unified-lists-memory.html`](https://dcic-world.org/2025-08-27/unified-lists-memory.html)

|  |
| --- |

在理解相等性中，我们绘制了内存图来展示值如何在堆中显示。当时，我们只看了结构化数据。现在我们将查看聚合数据：Python 中的列表和 Pyret 中的数组。

Python 列表和 Pyret 数组都是以起始值存储在内存中，该起始值指示有多少个值，然后是后续地址中的实际元素。例如，假设我们写入以下值：

| Python |  |
| --- | --- |
|  |

```py
sl = ['bread', 'coffee', 'eggs']
```



| Pyret |  |
| --- | --- |
|  |

```py
sl = [array: 'bread', 'coffee', 'eggs']
```



这里是内存可能的样子：

目录

+   ```py
    sl
    ```

    → 1001

堆

+   1001: `(长度:3)`

+   1002: `"bread"`

+   1003: `"coffee"`

+   1004: `"eggs"`

如果这些术语对您来说有任何意义：Python 的默认列表实现是基于数组的，而不是链表。所以 1001 处有一个指示后续有多少个条目的指示，下一个内存位置有那些值。没有为单个元素创建目录条目，但可以通过引用 `sl` 后跟偏移量来访问它们：例如，

| Python | Pyret |
| --- | --- |



```py
sl[2]
```



```py
sl.get-now(2)
```



内部，这变成了：“获取 `sl` 的地址，然后向其添加 1 和偏移量 `2`”。这产生了地址 1001 + 1 + 2 = 1004。在两种语言中，查找地址 1004 存储的值都会产生 `'eggs'`。您可能会觉得偏移量从 0 开始很奇怪。虽然这确实令人困惑——“第一个”值在偏移量 `0`，而“第三个”值在偏移量 `2`，依此类推——但这是一种 Python 和 Pyret 都选择与大多数其他编程语言保持一致的传统。

类似地，如果我们尝试更改购物清单的内容，用 `'tea'` 替换第二个值。回想一下，第二个值在偏移量 `1`：

| Python | Pyret |
| --- | --- |



```py
sl[1] = 'tea'
```



```py
sl.set-now(1, 'tea')
```



再次，我们获取 `sl` 的地址，它是 1001；向其添加 1 和偏移量（`1`）；这给了我们地址 1003。现在，我们将地址 1003 的值修改为新值：

目录

+   ```py
    sl
    ```

    → 1001

堆

+   1001: `(长度:3)`

+   1002: `"bread"`

+   1003: `"tea"`

+   1004: `"eggs"`

如果我们现在要求语言提供整个列表，我们会看到变化：在 Python 中，





> ```py
> sl
> ```







```py
['bread', 'tea', 'eggs']
```



在 Pyret 中，





> ```py
> sl
> ```







```py
[array: "bread", "tea", "eggs"]
```



注意，我们学到的关于别名的内容也适用于这里。假设 Shaunae 和 Jonella 共享一个购物清单，其中 `sl` 是 Shaunae 的，而 Jonella 写道：

| Python | Pyret |
| --- | --- |



```py
jl = sl
```



```py
jl = sl
```



现在 `jl` 和 `sl` 是堆中相同数据的别名：

目录

+   ```py
    sl
    ```

    → 1001

+   ```py
    jl
    ```

    → 1001

堆

+   1001: `(长度:3)`

+   1002: `"bread"`

+   1003: `"tea"`

+   1004: `"eggs"`

因此，修改列表 `jl` 对其的影响与通过 `sl` 修改它的影响相同：

| Python | Pyret |
| --- | --- |



```py
jl[0] = 'butter'
```



```py
jl.set-now(0, 'butter')
```



表示内存看起来像

目录

+   ```py
    sl
    ```

    → 1001

+   ```py
    jl
    ```

    → 1001

堆

+   1001: `(长度:3)`

+   1002: `"butter"`

+   1003: `"tea"`

+   1004: `"eggs"`

因此，如果我们要求 `sl` 的值，在 Python 中我们会看到：





> ```py
> sl
> ```







```py
['butter', 'tea', 'eggs']
```



在 Pyret 中：





> ```py
> sl
> ```







```py
[array: "butter", "tea", "eggs"]
```



即使我们没有通过名称 `sl` 进行修改
