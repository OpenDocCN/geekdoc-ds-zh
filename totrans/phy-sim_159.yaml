- en: Affine Particle-In-Cell Transfer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://phys-sim-book.github.io/lec30.3-apic_transfer.html](https://phys-sim-book.github.io/lec30.3-apic_transfer.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  prefs: []
  type: TYPE_NORMAL
- en: 'We defined the material point data following [Simulation Setup](./lec29.1-simulation_setup.html),
    extending it with two additional terms: the affine velocity field Cp​ used in
    the APIC transfer scheme and the scalar `log_J_diff` used for volume correction
    as described in [Drucker-Prager Elastoplasticity](./lec30.1-drucker_prager.html).'
  prefs: []
  type: TYPE_NORMAL
- en: 'During the particle-to-grid (P2G) transfer, we adopt the **APIC formulation**
    for momentum exchange. Instead of directly transferring particle velocity, we
    include the local affine velocity field Cp​. Specifically, momentum is transferred
    using the form:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Implementation 31.3.1 (Affine Transfer in APIC Particle-to-Grid (P2G), simulator.py).**'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Here, `dpos` is the offset from the particle to the grid node.
  prefs: []
  type: TYPE_NORMAL
- en: During the grid-to-particle (G2P) transfer, we gather both the updated velocity
    and the **affine velocity matrix Cp​** from the background grid. The affine matrix
    is computed from the weighted outer product of grid velocities and position offsets.
    This allows each particle to retain local velocity variation, significantly reducing
    numerical dissipation compared to PIC.
  prefs: []
  type: TYPE_NORMAL
- en: '**Implementation 31.3.2 (Affine Transfer in APIC Grid-to-Particle (G2P), simulator.py).**'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Here, D is a constant factor when using the Quadratic B-spline interpolation
    function:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Implementation 31.3.3 (Constant D for Quadratic B-spline used for APIC, simulator.py).**'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/59983679509afb8a49f1db1670113e62.png)'
  prefs: []
  type: TYPE_IMG
- en: '**Figure 31.3.1.** Time sequence of a 2D sand block falling onto a static red
    sphere collider. The sand undergoes irreversible deformation and splashing upon
    impact, demonstrating granular flow and frictional boundary response.'
  prefs: []
  type: TYPE_NORMAL
