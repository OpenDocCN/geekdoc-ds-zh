- en: Penalty Method
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://phys-sim-book.github.io/lec11.1-penalty_method.html](https://phys-sim-book.github.io/lec11.1-penalty_method.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  prefs: []
  type: TYPE_NORMAL
- en: 'At the beginning of each time step towards time n+1, we evaluate nodal position
    x^kn+1​ for each BC node k based on their prescribed motions. During each Newton
    iteration i, for the iterate xi, we define a velocity residual to assess how close
    each BC node is to meeting its target: rBC,ki​=h1​∥xki​−x^kn+1​∥. When rBC,ki​
    falls below a specific tolerance ϵ for any BC node k, we can fix the node at its
    current location xki​≈x^kn+1​ and apply the [DOF elimination method](lec5.2-DOF_elimin.html)
    in the subsequent iterations. This is particularly straightforward in scenes with
    only static BCs, where the DOF elimination method is directly applied.'
  prefs: []
  type: TYPE_NORMAL
- en: 'For other BC nodes k that are far from their target locations, we introduce
    new penalty terms to the Incremental Potential for each of these nodes: 2κM​​mk​∥xk​−x^kn+1​∥2.(11.1.1)
    Here, mk​ represents the nodal mass, allowing for intuitive setting of the penalty
    stiffness κM​, as the Hessian of the penalty term with respect to BC nodes is
    simply κM​ times that of the inertia term.'
  prefs: []
  type: TYPE_NORMAL
- en: '***Remark 11.1.1.*** For collision obstacles (CO), precisely calculating node
    masses is challenging due to unknown factors like density. A practical approach
    is to assume a density similar to that of the simulated solids in the scene. This
    assumption makes the diagonal entries on the Hessian of the penalty terms roughly
    κM​ times that of the inertia term.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: For codimensional COs such as shells, rods, and particles, the key is to consider
    a reasonably large thickness when calculating their volumes. This helps in ensuring
    that their physical properties align more closely with those of the main simulation
    bodies.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Setting the penalty stiffness κM​ appropriately can be challenging. If κM​ is
    set too low, it may not effectively move the BC node towards its target. Conversely,
    a too high κM​ can lead to numerical issues. Thus, we initially set κM​ to a reasonably
    large value and adaptively increase it as necessary.
  prefs: []
  type: TYPE_NORMAL
- en: During the Newton solve, if there are BC nodes k where rBC,ki​≥ϵ at the point
    of Newton convergence, we double the penalty stiffness κM​ to 2× its current value
    and continue the Newton solve. This process is repeated until all BCs are satisfactorily
    met at convergence.
  prefs: []
  type: TYPE_NORMAL
- en: '***Remark 11.1.2.*** In practice, with double precision floating-point numbers,
    initializing κM​ below 106 is typically sufficient, given that the Hessian of
    the stiff penalty terms is purely diagonal. However, if certain BCs remain unsatisfied
    even when κM​ is increased to above 1010, the optimization process may stall due
    to severe numerical errors. This stalling occurs because extremely stiff penalty
    terms are in conflict with the contact barriers. However, such a scenario would
    likely only occur under a rare CO/BC setting in a manner far more extreme than
    what is tested in [Figure 2.3.1](lec2.3-contact.html#fig:lec2:contact_and_friction).'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
