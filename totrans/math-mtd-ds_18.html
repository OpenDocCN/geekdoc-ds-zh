<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>3.1. Motivating example: analyzing customer satisfaction#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>3.1. Motivating example: analyzing customer satisfaction#</h1>
<blockquote>原文：<a href="https://mmids-textbook.github.io/chap03_opt/01_motiv/roch-mmids-opt-motiv.html">https://mmids-textbook.github.io/chap03_opt/01_motiv/roch-mmids-opt-motiv.html</a></blockquote>

<p><strong>Figure:</strong> Helpful map of ML by scitkit-learn (<a class="reference external" href="https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">Source</a>)</p>
<p><img alt="ml-cheat-sheet" src="../Images/19ac9e49b2f297976e40fee63e1c4ba0.png" data-original-src="https://scikit-learn.org/1.4/_static/ml_map.png"/></p>
<p><span class="math notranslate nohighlight">\(\bowtie\)</span></p>
<p>We now turn to classification<span class="math notranslate nohighlight">\(\idx{classification}\xdi\)</span>.</p>
<p>Quoting <a class="reference external" href="https://en.wikipedia.org/wiki/Statistical_classification">Wikipedia</a>:</p>
<blockquote>
<div><p>In machine learning and statistics, classification is the problem of identifying to which of a set of categories (sub-populations) a new observation belongs, on the basis of a training set of data containing observations (or instances) whose category membership is known. Examples are assigning a given email to the “spam” or “non-spam” class, and assigning a diagnosis to a given patient based on observed characteristics of the patient (sex, blood pressure, presence or absence of certain symptoms, etc.). Classification is an example of pattern recognition. In the terminology of machine learning, classification is considered an instance of supervised learning, i.e., learning where a training set of correctly identified observations is available.</p>
</div></blockquote>
<p>We will illustrate this problem on an <a class="reference external" href="https://www.kaggle.com/datasets/sjleshrac/airlines-customer-satisfaction">airline customer satisfaction</a> dataset available on <a class="reference external" href="https://www.kaggle.com">Kaggle</a>, an excellent source of data and community contributed analyses. The background is the following:</p>
<blockquote>
<div><p>The dataset consists of the details of customers who have already flown with them. The feedback of the customers on various context and their flight data has been consolidated. The main purpose of this dataset is to predict whether a future customer would be satisfied with their service given the details of the other parameters values.</p>
</div></blockquote>
<p>We first load the data and convert it to an appropriate matrix representation. We (or, more precisely, ChatGPT) pre-processed the original file to remove rows with missing data or 0 ratings, convert categorical variables into one-hot encodings, and keep only a subset of the rows and columns. You can see the details of the pre-processing in this <a class="reference external" href="https://chatgpt.com/share/c5070b9c-f33f-4a37-a793-fde0d7cb7b06">chat history</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'customer_airline_satisfaction.csv'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is a large dataset. Here are the first five rows and first 6 colums.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>   Satisfied  Age  Class_Business  Class_Eco  Class_Eco Plus  Business travel
0          0   63               1          0               0                1
1          0   34               1          0               0                1
2          0   52               0          1               0                0
3          0   40               0          1               0                1
4          1   46               0          1               0                1
</pre></div>
</div>
</div>
</div>
<p>It has 100,000 rows and 24 columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>(100000, 24)
</pre></div>
</div>
</div>
</div>
<p>The column names are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>['Satisfied', 'Age', 'Class_Business', 'Class_Eco', 'Class_Eco Plus', 'Business travel', 'Loyal customer', 'Flight Distance', 'Departure Delay in Minutes', 'Arrival Delay in Minutes', 'Seat comfort', 'Departure/Arrival time convenient', 'Food and drink', 'Gate location', 'Inflight wifi service', 'Inflight entertainment', 'Online support', 'Ease of Online booking', 'On-board service', 'Leg room service', 'Baggage handling', 'Checkin service', 'Cleanliness', 'Online boarding']
</pre></div>
</div>
</div>
</div>
<p>The first column indicates whether a customer was satisfied (with <code class="docutils literal notranslate"><span class="pre">1</span></code> meaning satisfied). The next 6 columns give some information about the customers, e.g., their age or whether they are members of a loyalty program with the airline. The following three columns give information about the flight, with names that should be self-explanatory: <code class="docutils literal notranslate"><span class="pre">Flight</span> <span class="pre">Distance</span></code>, <code class="docutils literal notranslate"><span class="pre">Departure</span> <span class="pre">Delay</span> <span class="pre">in</span> <span class="pre">Minutes</span></code>, and <code class="docutils literal notranslate"><span class="pre">Arrival</span> <span class="pre">Delay</span> <span class="pre">in</span> <span class="pre">Minutes</span></code>. The remaining columns give the customers’ ratings, between <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">5</span></code>, of various feature, e.g., <code class="docutils literal notranslate"><span class="pre">Baggage</span> <span class="pre">handling</span></code>, <code class="docutils literal notranslate"><span class="pre">Checkin</span> <span class="pre">service</span></code>.</p>
<p>Our goal will be to predict the first column, <code class="docutils literal notranslate"><span class="pre">Satisfied</span></code>, from the rest of the columns. For this, we transform our data into NumPy arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'Satisfied'</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'Satisfied'</span><span class="p">])</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>[0 0 0 ... 0 1 0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>[[63  1  0 ...  3  3  4]
 [34  1  0 ...  2  3  4]
 [52  0  1 ...  4  3  4]
 ...
 [39  0  1 ...  4  1  1]
 [25  0  0 ...  5  3  1]
 [44  1  0 ...  1  2  2]]
</pre></div>
</div>
</div>
</div>
<p>Some features may affect satisfication more than others. Let us look at age for instance. The following code extracts the <code class="docutils literal notranslate"><span class="pre">Age</span></code> column from <code class="docutils literal notranslate"><span class="pre">X</span></code> (i.e., column <span class="math notranslate nohighlight">\(0\)</span>) and computes the fraction of satisfied customers in several age bins.</p>
<p>Explanation by ChatGPT (who wrote the code):</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.digitize.html"><code class="docutils literal notranslate"><span class="pre">numpy.digitize</span></code></a> bins the age data into the specified age bins. The <code class="docutils literal notranslate"><span class="pre">-1</span></code> adjustment is to match zero-based indexing.</p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.bincount.html"><code class="docutils literal notranslate"><span class="pre">numpy.bincount</span></code></a> counts the occurrences of each bin index. The <code class="docutils literal notranslate"><span class="pre">minlength</span></code> parameter ensures that the resulting array length matches the number of age bins (<code class="docutils literal notranslate"><span class="pre">age_labels</span></code>). This is important if some bins have zero counts, ensuring the counts array covers all bins.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">freq_satisfied</span> <span class="pre">=</span> <span class="pre">counts_satisfied</span> <span class="pre">/</span> <span class="pre">counts_all</span></code> calculates the satisfaction frequency for each age group by dividing the counts of satisfied customers by the total counts in each age group.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">age_col_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">age_data</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">age_col_index</span><span class="p">]</span>
<span class="n">age_bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">age_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'0-17'</span><span class="p">,</span> <span class="s1">'18-24'</span><span class="p">,</span> <span class="s1">'25-34'</span><span class="p">,</span> <span class="s1">'35-44'</span><span class="p">,</span> <span class="s1">'45-54'</span><span class="p">,</span> <span class="s1">'55-64'</span><span class="p">,</span> <span class="s1">'65+'</span><span class="p">]</span>
<span class="n">age_bin_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">age_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">age_bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">counts_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">age_bin_indices</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">age_labels</span><span class="p">))</span>
<span class="n">counts_satisfied</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">age_bin_indices</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="n">minlength</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">age_labels</span><span class="p">))</span>
<span class="n">freq_satisfied</span> <span class="o">=</span> <span class="n">counts_satisfied</span> <span class="o">/</span> <span class="n">counts_all</span>
<span class="n">age_group_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">age_labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The results are plotted using matplotlib’s <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.bar.html"><code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.bar</span></code></a> function. We see in particular that younger people tend to be more dissatisfied. Of course, this might be because they cannot afford the most expensive services.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">age_group_labels</span><span class="p">,</span> <span class="n">freq_satisfied</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'lightblue'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Age Group'</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency of Satisfied Customers'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/67ecfc3b63a5bad3ac48daf7707938436d621202289556c52f6b1fd57d71f323.png" src="../Images/d5cb3f8cc065e1efab42d21f968d71b5.png" data-original-src="https://mmids-textbook.github.io/_images/67ecfc3b63a5bad3ac48daf7707938436d621202289556c52f6b1fd57d71f323.png"/>
</div>
</div>
<p>The input data is now of the form <span class="math notranslate nohighlight">\(\{(\mathbf{x}_i, y_i) : i=1,\ldots, n\}\)</span> where <span class="math notranslate nohighlight">\(\mathbf{x}_i \in \mathbb{R}^d\)</span> are the features and <span class="math notranslate nohighlight">\(y_i \in \{0,1\}\)</span> is the label. Above we use the matrix representation <span class="math notranslate nohighlight">\(X \in \mathbb{R}^{n \times d}\)</span> with rows <span class="math notranslate nohighlight">\(\mathbf{x}_i^T\)</span>, <span class="math notranslate nohighlight">\(i = 1,\ldots, n\)</span> and <span class="math notranslate nohighlight">\(\mathbf{y} = (y_1, \ldots, y_n) \in \{0,1\}^n\)</span>.</p>
<p>Our goal:</p>
<blockquote>
<div><p>learn a classifier from the examples <span class="math notranslate nohighlight">\(\{(\mathbf{x}_i, y_i) : i=1,\ldots, n\}\)</span>, that is, a function <span class="math notranslate nohighlight">\(\hat{f} : \mathbb{R}^d \to \mathbb{R}\)</span> such that <span class="math notranslate nohighlight">\(\hat{f}(\mathbf{x}_i) \approx y_i\)</span>.</p>
</div></blockquote>
<p>We may want to enforce that the output is in <span class="math notranslate nohighlight">\(\{0,1\}\)</span> as well. This problem is referred to as <a class="reference external" href="https://en.wikipedia.org/wiki/Binary_classification">binary classification</a>.</p>
<p>A natural approach to this type of <a class="reference external" href="https://en.wikipedia.org/wiki/Supervised_learning">supervised learning</a><span class="math notranslate nohighlight">\(\idx{supervised learning}\xdi\)</span> problem is to define two objects:</p>
<ol class="arabic simple">
<li><p><strong>Family of classifiers:</strong> A class <span class="math notranslate nohighlight">\(\widehat{\mathcal{F}}\)</span> of classifiers from which to pick <span class="math notranslate nohighlight">\(\hat{f}\)</span>.</p></li>
<li><p><strong>Loss function:</strong> A loss function <span class="math notranslate nohighlight">\(\ell(\hat{f}, (\mathbf{x},y))\)</span> which quantifies how good of a fit <span class="math notranslate nohighlight">\(\hat{f}(\mathbf{x})\)</span> is to <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
</ol>
<p>Our goal is then to solve</p>
<div class="math notranslate nohighlight">
\[
\min_{\hat{f} \in \widehat{\mathcal{F}}} \frac{1}{n} \sum_{i=1}^n \ell(\hat{f}, (\mathbf{x}_i, y_i)),
\]</div>
<p>that is, we seek to find a classifier among <span class="math notranslate nohighlight">\(\widehat{\mathcal{F}}\)</span> that minimizes the average loss over the examples.</p>
<p>For instance, in <a class="reference external" href="https://en.wikipedia.org/wiki/Logistic_regression">logistic regression</a>, we consider linear classifiers of the form</p>
<div class="math notranslate nohighlight">
\[
\hat{f}(\mathbf{x})
= \sigma(\mathbf{x}^T \boldsymbol{\theta})
\qquad
\text{with}
\qquad
\sigma(t) = \frac{1}{1 + e^{-t}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{\theta} \in \mathbb{R}^d\)</span> is a parameter vector. And we use the <a class="reference external" href="https://en.wikipedia.org/wiki/Cross_entropy#Cross-entropy_loss_function_and_logistic_regression">cross-entropy loss</a></p>
<div class="math notranslate nohighlight">
\[
\ell(\hat{f}, (\mathbf{x}, y))
= -  y \log(\sigma(\mathbf{x}^T \boldsymbol{\theta}))
- (1-y) \log(1- \sigma(\mathbf{x}^T \boldsymbol{\theta})).
\]</div>
<p>In parametric form, the problem boils down to</p>
<div class="math notranslate nohighlight">
\[
\min_{\boldsymbol{\theta} \in \mathbb{R}^d}
- \frac{1}{n} \sum_{i=1}^n y_i \log(\sigma(\mathbf{x}_i^T \boldsymbol{\theta}))
- \frac{1}{n} \sum_{i=1}^n (1-y_i) \log(1- \sigma(\mathbf{x}_i^T \boldsymbol{\theta})).
\]</div>
<p>To obtain a prediction in <span class="math notranslate nohighlight">\(\{0,1\}\)</span> here, we could cutoff <span class="math notranslate nohighlight">\(\hat{f}(\mathbf{x})\)</span> at a threshold <span class="math notranslate nohighlight">\(\tau \in [0,1]\)</span>, that is, return <span class="math notranslate nohighlight">\(\mathbf{1}\{\hat{f}(\mathbf{x}) &gt; \tau\}\)</span>.</p>
<p>We will explain in a later chapter where this choice comes from.</p>
<p>The purpose of this chapter is to develop some of the mathematical theory and algorithms needed to solve this type of optimization formulation.</p>
<p><strong>CHAT &amp; LEARN</strong> Ask your favorite AI chatbot to help you explore the following hypothesis about this dataset:</p>
<blockquote>
<div><p>Younger people tend to be more dissatisfied because they cannot afford the best services.</p>
</div></blockquote>
<p>For example, consider the relationship between age, satisfaction, and class (e.g., economy, business, etc.). Specifically:</p>
<ol class="arabic simple">
<li><p>Compare the distribution of class types among different age groups.</p></li>
<li><p>Compare the satisfaction levels within each class type for different age groups.</p></li>
</ol>
<p>(<a class="reference external" href="https://colab.research.google.com/github/MMiDS-textbook/MMiDS-textbook.github.io/blob/main/just_the_code/roch_mmids_chap_opt_notebook.ipynb">Open In Colab</a>) <span class="math notranslate nohighlight">\(\ddagger\)</span></p>
    
</body>
</html>