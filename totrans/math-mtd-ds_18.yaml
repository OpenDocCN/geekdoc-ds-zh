- en: '3.1\. Motivating example: analyzing customer satisfaction#'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3.1. 激励示例：分析客户满意度#
- en: 原文：[https://mmids-textbook.github.io/chap03_opt/01_motiv/roch-mmids-opt-motiv.html](https://mmids-textbook.github.io/chap03_opt/01_motiv/roch-mmids-opt-motiv.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://mmids-textbook.github.io/chap03_opt/01_motiv/roch-mmids-opt-motiv.html](https://mmids-textbook.github.io/chap03_opt/01_motiv/roch-mmids-opt-motiv.html)
- en: '**Figure:** Helpful map of ML by scitkit-learn ([Source](https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html))'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '**图示：scikit-learn提供的ML有帮助的地图（来源：[scikit-learn.org/stable/tutorial/machine_learning_map/index.html](https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html)**'
- en: '![ml-cheat-sheet](../Images/19ac9e49b2f297976e40fee63e1c4ba0.png)'
  id: totrans-3
  prefs: []
  type: TYPE_IMG
  zh: '![ml-cheat-sheet](../Images/19ac9e49b2f297976e40fee63e1c4ba0.png)'
- en: \(\bowtie\)
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: \(\bowtie\)
- en: We now turn to classification\(\idx{classification}\xdi\).
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在转向分类（\(idx{classification}\xdi\)）。
- en: 'Quoting [Wikipedia](https://en.wikipedia.org/wiki/Statistical_classification):'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 引用[维基百科](https://en.wikipedia.org/wiki/Statistical_classification)：
- en: In machine learning and statistics, classification is the problem of identifying
    to which of a set of categories (sub-populations) a new observation belongs, on
    the basis of a training set of data containing observations (or instances) whose
    category membership is known. Examples are assigning a given email to the “spam”
    or “non-spam” class, and assigning a diagnosis to a given patient based on observed
    characteristics of the patient (sex, blood pressure, presence or absence of certain
    symptoms, etc.). Classification is an example of pattern recognition. In the terminology
    of machine learning, classification is considered an instance of supervised learning,
    i.e., learning where a training set of correctly identified observations is available.
  id: totrans-7
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在机器学习和统计学中，分类是根据包含已知类别成员资格的观察（或实例）的训练数据集，确定新观察属于一组类别（子群体）中的哪一个的问题。例如，将给定的电子邮件分配到“垃圾邮件”或“非垃圾邮件”类别，以及根据患者的观察特征（性别、血压、某些症状的有无等）对给定的患者进行诊断。分类是模式识别的一个例子。在机器学习的术语中，分类被认为是监督学习的一个实例，即存在一个包含正确识别观察的训练集的学习。
- en: 'We will illustrate this problem on an [airline customer satisfaction](https://www.kaggle.com/datasets/sjleshrac/airlines-customer-satisfaction)
    dataset available on [Kaggle](https://www.kaggle.com), an excellent source of
    data and community contributed analyses. The background is the following:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在[Kaggle](https://www.kaggle.com)上可用的[航空公司客户满意度](https://www.kaggle.com/datasets/sjleshrac/airlines-customer-satisfaction)数据集上说明这个问题，Kaggle是一个优秀的数据来源和社区贡献的分析平台。背景如下：
- en: The dataset consists of the details of customers who have already flown with
    them. The feedback of the customers on various context and their flight data has
    been consolidated. The main purpose of this dataset is to predict whether a future
    customer would be satisfied with their service given the details of the other
    parameters values.
  id: totrans-9
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 该数据集包含已经与他们一起飞行的客户的详细信息。客户对各种情境的反馈以及他们的飞行数据已经汇总。该数据集的主要目的是根据其他参数值的详细信息预测未来客户是否会对其服务感到满意。
- en: We first load the data and convert it to an appropriate matrix representation.
    We (or, more precisely, ChatGPT) pre-processed the original file to remove rows
    with missing data or 0 ratings, convert categorical variables into one-hot encodings,
    and keep only a subset of the rows and columns. You can see the details of the
    pre-processing in this [chat history](https://chatgpt.com/share/c5070b9c-f33f-4a37-a793-fde0d7cb7b06).
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先加载数据并将其转换为适当的矩阵表示。我们（或者更准确地说，ChatGPT）预处理了原始文件，以删除包含缺失数据或0评分的行，将分类变量转换为one-hot编码，并仅保留行和列的子集。您可以在本[聊天记录](https://chatgpt.com/share/c5070b9c-f33f-4a37-a793-fde0d7cb7b06)中查看预处理的详细信息。
- en: '[PRE0]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This is a large dataset. Here are the first five rows and first 6 colums.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个大型数据集。以下是前五行和前六列。
- en: '[PRE1]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[PRE2]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: It has 100,000 rows and 24 columns.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 它有100,000行和24列。
- en: '[PRE3]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[PRE4]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The column names are:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 列名如下：
- en: '[PRE5]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The first column indicates whether a customer was satisfied (with `1` meaning
    satisfied). The next 6 columns give some information about the customers, e.g.,
    their age or whether they are members of a loyalty program with the airline. The
    following three columns give information about the flight, with names that should
    be self-explanatory: `Flight Distance`, `Departure Delay in Minutes`, and `Arrival
    Delay in Minutes`. The remaining columns give the customers’ ratings, between
    `1` and `5`, of various feature, e.g., `Baggage handling`, `Checkin service`.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 第一列表示客户是否满意（`1`表示满意）。接下来的6列提供有关客户的一些信息，例如他们的年龄或他们是否是航空公司的忠诚度计划成员。接下来的三列提供有关航班的信息，名称应该是自解释的：`Flight
    Distance`（航班距离）、`Departure Delay in Minutes`（出发延误分钟）和`Arrival Delay in Minutes`（到达延误分钟）。剩余的列提供客户对各种特征的评分，评分在`1`到`5`之间，例如`Baggage
    handling`（行李处理）、`Checkin service`（登机服务）。
- en: Our goal will be to predict the first column, `Satisfied`, from the rest of
    the columns. For this, we transform our data into NumPy arrays.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的目标将是预测第一列，`Satisfied`，从其余的列中。为此，我们将数据转换为NumPy数组。
- en: '[PRE7]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '[PRE9]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Some features may affect satisfication more than others. Let us look at age
    for instance. The following code extracts the `Age` column from `X` (i.e., column
    \(0\)) and computes the fraction of satisfied customers in several age bins.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 一些特征可能比其他特征对满意度的影响更大。以年龄为例，以下代码从`X`（即列\(0\)）中提取`Age`列，并计算几个年龄区间的满意客户比例。
- en: 'Explanation by ChatGPT (who wrote the code):'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: ChatGPT（编写了代码）的解释：
- en: '[`numpy.digitize`](https://numpy.org/doc/stable/reference/generated/numpy.digitize.html)
    bins the age data into the specified age bins. The `-1` adjustment is to match
    zero-based indexing.'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[`numpy.digitize`](https://numpy.org/doc/stable/reference/generated/numpy.digitize.html)
    将年龄数据划分到指定的年龄区间。`-1`调整是为了匹配零基索引。'
- en: '[`numpy.bincount`](https://numpy.org/doc/stable/reference/generated/numpy.bincount.html)
    counts the occurrences of each bin index. The `minlength` parameter ensures that
    the resulting array length matches the number of age bins (`age_labels`). This
    is important if some bins have zero counts, ensuring the counts array covers all
    bins.'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[`numpy.bincount`](https://numpy.org/doc/stable/reference/generated/numpy.bincount.html)
    计算每个区间的出现次数。`minlength`参数确保结果数组的长度与年龄区间的数量（`age_labels`）相匹配。如果某些区间计数为零，这确保计数数组覆盖所有区间。'
- en: '`freq_satisfied = counts_satisfied / counts_all` calculates the satisfaction
    frequency for each age group by dividing the counts of satisfied customers by
    the total counts in each age group.'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`freq_satisfied = counts_satisfied / counts_all` 通过将满意客户的计数除以每个年龄组的总计数来计算每个年龄组的满意度频率。'
- en: '[PRE11]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The results are plotted using matplotlib’s [`matplotlib.pyplot.bar`](https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.bar.html)
    function. We see in particular that younger people tend to be more dissatisfied.
    Of course, this might be because they cannot afford the most expensive services.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 结果使用matplotlib的`matplotlib.pyplot.bar`函数绘制。我们特别看到，年轻人往往更容易不满意。当然，这可能是因为他们负担不起最昂贵的服务。
- en: '[PRE12]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![../../_images/67ecfc3b63a5bad3ac48daf7707938436d621202289556c52f6b1fd57d71f323.png](../Images/d5cb3f8cc065e1efab42d21f968d71b5.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![../../_images/67ecfc3b63a5bad3ac48daf7707938436d621202289556c52f6b1fd57d71f323.png](../Images/d5cb3f8cc065e1efab42d21f968d71b5.png)'
- en: 'The input data is now of the form \(\{(\mathbf{x}_i, y_i) : i=1,\ldots, n\}\)
    where \(\mathbf{x}_i \in \mathbb{R}^d\) are the features and \(y_i \in \{0,1\}\)
    is the label. Above we use the matrix representation \(X \in \mathbb{R}^{n \times
    d}\) with rows \(\mathbf{x}_i^T\), \(i = 1,\ldots, n\) and \(\mathbf{y} = (y_1,
    \ldots, y_n) \in \{0,1\}^n\).'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '输入数据现在具有以下形式 \(\{(\mathbf{x}_i, y_i) : i=1,\ldots, n\}\)，其中 \(\mathbf{x}_i
    \in \mathbb{R}^d\) 是特征，\(y_i \in \{0,1\}\) 是标签。上面我们使用矩阵表示 \(X \in \mathbb{R}^{n
    \times d}\)，其中行 \(\mathbf{x}_i^T\)，\(i = 1,\ldots, n\)，以及 \(\mathbf{y} = (y_1,
    \ldots, y_n) \in \{0,1\}^n\)。'
- en: 'Our goal:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的目标：
- en: 'learn a classifier from the examples \(\{(\mathbf{x}_i, y_i) : i=1,\ldots,
    n\}\), that is, a function \(\hat{f} : \mathbb{R}^d \to \mathbb{R}\) such that
    \(\hat{f}(\mathbf{x}_i) \approx y_i\).'
  id: totrans-38
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '从示例 \(\{(\mathbf{x}_i, y_i) : i=1,\ldots, n\}\) 中学习一个分类器，即一个函数 \(\hat{f} :
    \mathbb{R}^d \to \mathbb{R}\)，使得 \(\hat{f}(\mathbf{x}_i) \approx y_i\)。'
- en: We may want to enforce that the output is in \(\{0,1\}\) as well. This problem
    is referred to as [binary classification](https://en.wikipedia.org/wiki/Binary_classification).
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可能希望强制输出也在 \(\{0,1\}\) 中。这个问题被称为[二元分类](https://en.wikipedia.org/wiki/Binary_classification)。
- en: 'A natural approach to this type of [supervised learning](https://en.wikipedia.org/wiki/Supervised_learning)\(\idx{supervised
    learning}\xdi\) problem is to define two objects:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这种[监督学习](https://en.wikipedia.org/wiki/Supervised_learning)\(\idx{supervised
    learning}\xdi\)问题的一个自然方法是定义两个对象：
- en: '**Family of classifiers:** A class \(\widehat{\mathcal{F}}\) of classifiers
    from which to pick \(\hat{f}\).'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**分类器族：** 从中选择 \(\hat{f}\) 的一个分类器类 \(\widehat{\mathcal{F}}\)。'
- en: '**Loss function:** A loss function \(\ell(\hat{f}, (\mathbf{x},y))\) which
    quantifies how good of a fit \(\hat{f}(\mathbf{x})\) is to \(y\).'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**损失函数：** 一个损失函数 \(\ell(\hat{f}, (\mathbf{x},y))\)，它量化了 \(\hat{f}(\mathbf{x})\)
    与 \(y\) 的拟合程度。'
- en: Our goal is then to solve
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们的目标是解决
- en: \[ \min_{\hat{f} \in \widehat{\mathcal{F}}} \frac{1}{n} \sum_{i=1}^n \ell(\hat{f},
    (\mathbf{x}_i, y_i)), \]
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: \[ \min_{\hat{f} \in \widehat{\mathcal{F}}} \frac{1}{n} \sum_{i=1}^n \ell(\hat{f},
    (\mathbf{x}_i, y_i)), \]
- en: that is, we seek to find a classifier among \(\widehat{\mathcal{F}}\) that minimizes
    the average loss over the examples.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 即，我们寻求在 \(\widehat{\mathcal{F}}\) 中找到一个分类器，以最小化示例的平均损失。
- en: For instance, in [logistic regression](https://en.wikipedia.org/wiki/Logistic_regression),
    we consider linear classifiers of the form
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在[逻辑回归](https://en.wikipedia.org/wiki/Logistic_regression)中，我们考虑形式为线性分类器
- en: \[ \hat{f}(\mathbf{x}) = \sigma(\mathbf{x}^T \boldsymbol{\theta}) \qquad \text{with}
    \qquad \sigma(t) = \frac{1}{1 + e^{-t}} \]
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: \[ \hat{f}(\mathbf{x}) = \sigma(\mathbf{x}^T \boldsymbol{\theta}) \qquad \text{with}
    \qquad \sigma(t) = \frac{1}{1 + e^{-t}} \]
- en: where \(\boldsymbol{\theta} \in \mathbb{R}^d\) is a parameter vector. And we
    use the [cross-entropy loss](https://en.wikipedia.org/wiki/Cross_entropy#Cross-entropy_loss_function_and_logistic_regression)
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 \(\boldsymbol{\theta} \in \mathbb{R}^d\) 是一个参数向量。我们使用[交叉熵损失](https://en.wikipedia.org/wiki/Cross_entropy#Cross-entropy_loss_function_and_logistic_regression)。
- en: \[ \ell(\hat{f}, (\mathbf{x}, y)) = - y \log(\sigma(\mathbf{x}^T \boldsymbol{\theta}))
    - (1-y) \log(1- \sigma(\mathbf{x}^T \boldsymbol{\theta})). \]
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: \[ \ell(\hat{f}, (\mathbf{x}, y)) = - y \log(\sigma(\mathbf{x}^T \boldsymbol{\theta}))
    - (1-y) \log(1- \sigma(\mathbf{x}^T \boldsymbol{\theta})). \]
- en: In parametric form, the problem boils down to
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在参数形式下，问题简化为
- en: \[ \min_{\boldsymbol{\theta} \in \mathbb{R}^d} - \frac{1}{n} \sum_{i=1}^n y_i
    \log(\sigma(\mathbf{x}_i^T \boldsymbol{\theta})) - \frac{1}{n} \sum_{i=1}^n (1-y_i)
    \log(1- \sigma(\mathbf{x}_i^T \boldsymbol{\theta})). \]
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: \[ \min_{\boldsymbol{\theta} \in \mathbb{R}^d} - \frac{1}{n} \sum_{i=1}^n y_i
    \log(\sigma(\mathbf{x}_i^T \boldsymbol{\theta})) - \frac{1}{n} \sum_{i=1}^n (1-y_i)
    \log(1- \sigma(\mathbf{x}_i^T \boldsymbol{\theta})). \]
- en: To obtain a prediction in \(\{0,1\}\) here, we could cutoff \(\hat{f}(\mathbf{x})\)
    at a threshold \(\tau \in [0,1]\), that is, return \(\mathbf{1}\{\hat{f}(\mathbf{x})
    > \tau\}\).
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在这里获得 \(\{0,1\}\) 的预测，我们可以在阈值 \(\tau \in [0,1]\) 处截断 \(\hat{f}(\mathbf{x})\)，即返回
    \(\mathbf{1}\{\hat{f}(\mathbf{x}) > \tau\}\)。
- en: We will explain in a later chapter where this choice comes from.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在后面的章节中解释这个选择从何而来。
- en: The purpose of this chapter is to develop some of the mathematical theory and
    algorithms needed to solve this type of optimization formulation.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的目的是发展一些解决此类优化公式的数学理论和算法。
- en: '**CHAT & LEARN** Ask your favorite AI chatbot to help you explore the following
    hypothesis about this dataset:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**CHAT & LEARN** 请您最喜欢的AI聊天机器人帮助您探索关于此数据集的以下假设：'
- en: Younger people tend to be more dissatisfied because they cannot afford the best
    services.
  id: totrans-56
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 年轻人往往更不满意，因为他们负担不起最好的服务。
- en: 'For example, consider the relationship between age, satisfaction, and class
    (e.g., economy, business, etc.). Specifically:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，考虑年龄、满意度和类别（例如，经济、商业等）之间的关系。具体来说：
- en: Compare the distribution of class types among different age groups.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 比较不同年龄组中类别类型的分布。
- en: Compare the satisfaction levels within each class type for different age groups.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 比较不同年龄组中每个类别类型的满意度水平。
- en: ([Open In Colab](https://colab.research.google.com/github/MMiDS-textbook/MMiDS-textbook.github.io/blob/main/just_the_code/roch_mmids_chap_opt_notebook.ipynb))
    \(\ddagger\)
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: ([在Colab中打开](https://colab.research.google.com/github/MMiDS-textbook/MMiDS-textbook.github.io/blob/main/just_the_code/roch_mmids_chap_opt_notebook.ipynb))
    \(\ddagger\)
