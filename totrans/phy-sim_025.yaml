- en: Simulator with Visualization
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://phys-sim-book.github.io/lec4.5-sim_with_vis.html](https://phys-sim-book.github.io/lec4.5-sim_with_vis.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  prefs: []
  type: TYPE_NORMAL
- en: Having gathered all necessary elements for our 2D mass-spring simulator, the
    next step is to implement the simulator. This implementation will operate in a
    step-by-step manner and include visualization capabilities to enhance understanding
    and engagement.
  prefs: []
  type: TYPE_NORMAL
- en: '**Implementation 4.5.1 (simulator.py).**'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: For 2D visualization in our simulator, we utilize the [Pygame library](https://www.pygame.org/).
    The simulation is initiated with a scene featuring a single square, which is initially
    elongated horizontally. During the simulation, the square begins to revert to
    its original horizontal dimensions. Subsequently, due to inertia, it will start
    to stretch vertically, oscillating back and forth until it eventually stabilizes
    at its rest shape, as illustrated in ([Figure 4.5.1](#fig:lec4:stretched_square_sim)).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c703ef7eb4276b11b516a718717d7f93.png)'
  prefs: []
  type: TYPE_IMG
- en: '**Figure 4.5.1.** From left to right: initial, intermediate, and final static
    frame of the initially stretched square simulation.'
  prefs: []
  type: TYPE_NORMAL
- en: 'In addition to storing node positions `x` and edges `e`, our simulation also
    requires allocating memory for several other key variables:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Node Velocities (`v`)**: To track the movement of each node over time.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Masses (`m`)**: Node masses are calculated by uniformly distributing the
    total mass of the square across each node. This is a preliminary approach; more
    detailed methods for calculating nodal mass in Finite Element Method (FEM) or
    Material Point Method (MPM) will be explored in future chapters.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Squared Rest Length of Edges (`l2`)**: Important for calculating the potential
    energy in the mass-spring system.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Spring Stiffnesses (`k`)**: A crucial parameter influencing the dynamics
    of the springs.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For visualization purposes beyond our simulator, we enable the export of the
    mesh data into `.obj` files. This is achieved by calling the `write_to_file()`
    function at the start and at each frame of the simulation. This feature facilitates
    the use of alternative visualization software to analyze and present the simulation
    results.
  prefs: []
  type: TYPE_NORMAL
- en: '**Implementation 4.5.2 (Output Square Mesh, square_mesh.py).**'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'With all components properly set up, the next phase involves initiating the
    simulation loop. This loop advances the time integration and visualizes the results
    at each time step. To execute the simulation program, the following command is
    used in the terminal:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '***Remark 4.5.1 (Practical Considerations).*** With our simulator implementation
    in place, it provides us with the flexibility to experiment with various configurations
    of the optimization time integration scheme. Such testing is invaluable for gaining
    deeper insights into the roles and impacts of each essential component.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Consider an example: if we opt not to project the mass-spring Hessian to a
    Symmetric Positive Definite (SPD) form, peculiar behaviors may emerge under certain
    conditions. For instance, running the simulation with a frame-rate time step size
    of `h=0.02` and an `initial_stretch` of `0.5` could lead to line search failures.
    This, in turn, results in very small step sizes, hampering the optimization process
    and preventing significant progress.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: While line search might seem superfluous in this simplistic 2D example, its
    necessity becomes apparent in more complex 3D elastodynamics simulations, especially
    those involving large deformations. Here, line search is crucial to ensure the
    convergence of the simulation.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Another point of interest is the stopping criteria applied in traditional solids
    simulators. Many such simulators forego a dynamic stopping criterion and instead
    terminate the optimization process after a predetermined number of iterations.
    This approach, while straightforward, can lead to numerical instabilities or 'explosions'
    in more challenging scenarios. This underscores the importance of carefully considering
    the integration scheme and its parameters to ensure stable and accurate simulations.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
