<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Chapter 12 Reshaping and Combining Data Sets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Chapter 12 Reshaping and Combining Data Sets</h1>
<blockquote>原文：<a href="https://randpythonbook.netlify.app/reshaping-and-combining-data-sets">https://randpythonbook.netlify.app/reshaping-and-combining-data-sets</a></blockquote>
<div id="reshaping-and-combining-data-sets" class="section level1 hasAnchor">

<div id="ordering-and-sorting-data" class="section level2 hasAnchor">
<h2><span class="header-section-number">12.1</span> Ordering and Sorting Data<a aria-label="Anchor link to header" class="anchor-section" href="/reshaping-and-combining-data-sets#ordering-and-sorting-data"/></h2>
<p>Sorting a data set, in ascending order, say, is a common task. You might need to do it because</p>
<ol style="list-style-type: decimal">
<li>ordering and ranking is commonly done in <em>nonparametric statistics</em>,</li>
<li>you want to inspect the most “extreme” observations in a data set,</li>
<li>it’s a pre-processing step before generating visualizations.</li>
</ol>
<p>In R, it all starts with <code>vector</code>s. There are two common functions you should know: <code>sort()</code> and <code>order()</code>. <code>sort()</code> returns the sorted <em>data</em>, while <code>order()</code> returns the <em>order indexes</em>.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" title="1">sillyData &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb189-2" title="2"><span class="kw">print</span>(sillyData)</a>
<a class="sourceLine" id="cb189-3" title="3"><span class="co">## [1]  0.3903776  0.5796584  1.4929115  0.3704896 -1.3450719</span></a>
<a class="sourceLine" id="cb189-4" title="4"><span class="kw">sort</span>(sillyData)</a>
<a class="sourceLine" id="cb189-5" title="5"><span class="co">## [1] -1.3450719  0.3704896  0.3903776  0.5796584  1.4929115</span></a>
<a class="sourceLine" id="cb189-6" title="6"><span class="kw">order</span>(sillyData)</a>
<a class="sourceLine" id="cb189-7" title="7"><span class="co">## [1] 5 4 1 2 3</span></a></code></pre></div>
<p><code>order()</code> is useful if you’re sorting a data frame by a particularly column. Below, we inspect the top 5 most expensive cars in an example data set <span class="citation">(“SAS<sup/> Viya<sup/> Example Data Sets” <a href="#ref-sas_cars">2021</a>)</span>. Notice that we need to clean up the <code>MSRP</code> (a <code>character</code> vector) a little first. We use the function <code>gsub()</code> to find patterns in the text, and replace them with the empty string.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" title="1">carData &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"data/cars.csv"</span>)</a>
<a class="sourceLine" id="cb190-2" title="2">noDollarSignMSRP &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">"$"</span>, <span class="st">""</span>, carData<span class="op">$</span>MSRP, <span class="dt">fixed =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb190-3" title="3">carData<span class="op">$</span>cleanMSRP &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">","</span>, <span class="st">""</span>, noDollarSignMSRP, </a>
<a class="sourceLine" id="cb190-4" title="4">                                     <span class="dt">fixed =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb190-5" title="5">rowIndices &lt;-<span class="st"> </span><span class="kw">order</span>(carData<span class="op">$</span>cleanMSRP, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb190-6" title="6">carData[rowIndices,<span class="kw">c</span>(<span class="st">"Make"</span>, <span class="st">"Model"</span>, <span class="st">"MSRP"</span>, <span class="st">"cleanMSRP"</span>)]</a></code></pre></div>
<pre><code>##              Make                 Model     MSRP cleanMSRP
## 335       Porsche           911 GT2 2dr $192,465    192465
## 263 Mercedes-Benz             CL600 2dr $128,420    128420
## 272 Mercedes-Benz SL600 convertible 2dr $126,670    126670
## 271 Mercedes-Benz          SL55 AMG 2dr $121,770    121770
## 262 Mercedes-Benz             CL500 2dr  $94,820     94820</code></pre>
<p>In Python, Numpy has <a href="https://numpy.org/doc/stable/reference/generated/numpy.argsort.html"><code>np.argsort()</code></a> and <a href="https://numpy.org/doc/stable/reference/generated/numpy.sort.html"><code>np.sort()</code></a>.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb192-1" title="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb192-2" title="2">silly_data <span class="op">=</span> np.random.normal(size<span class="op">=</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb192-3" title="3"><span class="bu">print</span>(silly_data)</a>
<a class="sourceLine" id="cb192-4" title="4"><span class="co">## [-0.52817175 -1.07296862  0.86540763 -2.3015387   1.74481176]</span></a>
<a class="sourceLine" id="cb192-5" title="5"><span class="bu">print</span>( np.sort(silly_data) )</a>
<a class="sourceLine" id="cb192-6" title="6"><span class="co">## [-2.3015387  -1.07296862 -0.52817175  0.86540763  1.74481176]</span></a>
<a class="sourceLine" id="cb192-7" title="7">np.argsort(silly_data)</a>
<a class="sourceLine" id="cb192-8" title="8"><span class="co">## array([3, 1, 0, 2, 4])</span></a></code></pre></div>
<p>For Pandas’ <code>DataFrame</code>s, most of the functions I find useful are methods attached to the <code>DataFrame</code> class. That means that, as long as something is inside a <code>DataFrame</code>, you can use dot notation.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb193-1" title="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb193-2" title="2">car_data <span class="op">=</span> pd.read_csv(<span class="st">"data/cars.csv"</span>)</a>
<a class="sourceLine" id="cb193-3" title="3">car_data[<span class="st">'no_dlr_msrp'</span>] <span class="op">=</span> car_data[<span class="st">'MSRP'</span>].<span class="bu">str</span>.replace(<span class="st">"$"</span>, <span class="st">""</span>, </a>
<a class="sourceLine" id="cb193-4" title="4">                                                       regex <span class="op">=</span> <span class="va">False</span>)</a>
<a class="sourceLine" id="cb193-5" title="5">no_commas <span class="op">=</span> car_data[<span class="st">'no_dlr_msrp'</span>].<span class="bu">str</span>.replace(<span class="st">","</span>,<span class="st">""</span>)                                                       </a>
<a class="sourceLine" id="cb193-6" title="6">car_data[<span class="st">'clean_MSRP'</span>] <span class="op">=</span> no_commas.astype(<span class="bu">float</span>)</a>
<a class="sourceLine" id="cb193-7" title="7">car_data <span class="op">=</span> car_data.sort_values(by<span class="op">=</span><span class="st">'clean_MSRP'</span>, ascending <span class="op">=</span> <span class="va">False</span>)</a>
<a class="sourceLine" id="cb193-8" title="8">car_data[[<span class="st">"Make"</span>, <span class="st">"Model"</span>, <span class="st">"MSRP"</span>, <span class="st">"clean_MSRP"</span>]].head(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb193-9" title="9"><span class="co">##               Make                  Model      MSRP  clean_MSRP</span></a>
<a class="sourceLine" id="cb193-10" title="10"><span class="co">## 334        Porsche            911 GT2 2dr  $192,465    192465.0</span></a>
<a class="sourceLine" id="cb193-11" title="11"><span class="co">## 262  Mercedes-Benz              CL600 2dr  $128,420    128420.0</span></a>
<a class="sourceLine" id="cb193-12" title="12"><span class="co">## 271  Mercedes-Benz  SL600 convertible 2dr  $126,670    126670.0</span></a>
<a class="sourceLine" id="cb193-13" title="13"><span class="co">## 270  Mercedes-Benz           SL55 AMG 2dr  $121,770    121770.0</span></a>
<a class="sourceLine" id="cb193-14" title="14"><span class="co">## 261  Mercedes-Benz              CL500 2dr   $94,820     94820.0</span></a></code></pre></div>
<p>Pandas’ <code>DataFrame</code>s and <code>Series</code> have a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.replace.html"><code>.replace()</code></a> method. We use this to remove dollar signs and commas from the MSRP column. Note that we had to access the <code>.str</code> attribute of the <code>Series</code> column before we used it. After the string was processed, we converted it to a <code>Series</code> of <code>float</code>s with the <code>astype()</code> method.</p>
<p>Finally, sorting the overall data frame could have been done with the same approach as the code we used in R (i.e. raw subsetting by row indexes), but there is a built-in method called <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.sort_values.html"><code>sort_values()</code></a> that will do it for us.</p>
</div>
<div id="stacking-data-sets-and-placing-them-shoulder-to-shoulder" class="section level2 hasAnchor">
<h2><span class="header-section-number">12.2</span> Stacking Data Sets and Placing Them Shoulder to Shoulder<a aria-label="Anchor link to header" class="anchor-section" href="/reshaping-and-combining-data-sets#stacking-data-sets-and-placing-them-shoulder-to-shoulder"/></h2>
<p>Stacking data sets on top of each other is a common task. You might need to do it if</p>
<ol style="list-style-type: decimal">
<li>you need to add a new row (or many rows) to a data frame,</li>
<li>you need to recombine data sets (e.g. recombine a train/test split), or</li>
<li>you’re creating a matrix in a step-by-step way.</li>
</ol>
<p>In R, this can be done with <code>rbind()</code> (short for “row bind”). Consider the following example that makes use of GIS data queried from <span class="citation">(Albemarle County Geographic Data Services Office <a href="#ref-albemarle_county_gis_web">2021</a>)</span> and cleaned with code from <span class="citation">(Ford <a href="#ref-clay_ford">2016</a>)</span>.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" title="1">realEstate &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"data/albemarle_real_estate.csv"</span>)</a>
<a class="sourceLine" id="cb194-2" title="2">train &lt;-<span class="st"> </span>realEstate[<span class="op">-</span><span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb194-3" title="3">test &lt;-<span class="st"> </span>realEstate[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb194-4" title="4"><span class="kw">str</span>(<span class="kw">rbind</span>(test, train), <span class="dt">strict.width =</span> <span class="st">"cut"</span>)</a>
<a class="sourceLine" id="cb194-5" title="5"><span class="co">## 'data.frame':    30381 obs. of  12 variables:</span></a>
<a class="sourceLine" id="cb194-6" title="6"><span class="co">##  $ YearBuilt    : int  1769 1818 2004 2006 2004 1995 1900 1960 ..</span></a>
<a class="sourceLine" id="cb194-7" title="7"><span class="co">##  $ YearRemodeled: int  1988 1991 NA NA NA NA NA NA NA NA ...</span></a>
<a class="sourceLine" id="cb194-8" title="8"><span class="co">##  $ Condition    : chr  "Average" "Average" "Average" "Average" ..</span></a>
<a class="sourceLine" id="cb194-9" title="9"><span class="co">##  $ NumStories   : num  1.7 2 1 1 1.5 2.3 2 1 1 1 ...</span></a>
<a class="sourceLine" id="cb194-10" title="10"><span class="co">##  $ FinSqFt      : int  5216 5160 1512 2019 1950 2579 1530 800 9..</span></a>
<a class="sourceLine" id="cb194-11" title="11"><span class="co">##  $ Bedroom      : int  4 6 3 3 3 3 4 2 2 2 ...</span></a>
<a class="sourceLine" id="cb194-12" title="12"><span class="co">##  $ FullBath     : int  3 4 2 3 3 2 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb194-13" title="13"><span class="co">##  $ HalfBath     : int  0 1 1 0 0 1 0 0 0 0 ...</span></a>
<a class="sourceLine" id="cb194-14" title="14"><span class="co">##  $ TotalRooms   : int  8 11 9 10 8 8 6 4 4 4 ...</span></a>
<a class="sourceLine" id="cb194-15" title="15"><span class="co">##  $ LotSize      : num  5.1 453.9 42.6 5 5.5 ...</span></a>
<a class="sourceLine" id="cb194-16" title="16"><span class="co">##  $ TotalValue   : num  1096600 2978600 677800 453200 389200 ...</span></a>
<a class="sourceLine" id="cb194-17" title="17"><span class="co">##  $ City         : chr  "CROZET" "CROZET" "CROZET" "CROZET" ...</span></a>
<a class="sourceLine" id="cb194-18" title="18"><span class="kw">sum</span>(<span class="kw">rbind</span>(test, train) <span class="op">!=</span><span class="st"> </span>realEstate)</a>
<a class="sourceLine" id="cb194-19" title="19"><span class="co">## [1] NA</span></a></code></pre></div>
<p>The above example was with <code>data.frame</code>s. This example of <code>rbind()</code> is with <code>matrix</code> objects.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" title="1"><span class="kw">rbind</span>(<span class="kw">matrix</span>(<span class="dv">1</span>,<span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">3</span>), </a>
<a class="sourceLine" id="cb195-2" title="2">      <span class="kw">matrix</span>(<span class="dv">2</span>,<span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb195-3" title="3"><span class="co">##      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb195-4" title="4"><span class="co">## [1,]    1    1    1</span></a>
<a class="sourceLine" id="cb195-5" title="5"><span class="co">## [2,]    1    1    1</span></a>
<a class="sourceLine" id="cb195-6" title="6"><span class="co">## [3,]    2    2    2</span></a>
<a class="sourceLine" id="cb195-7" title="7"><span class="co">## [4,]    2    2    2</span></a></code></pre></div>
<p>In Python, you can stack data frames with <a href="https://www.google.com/search?client=safari&amp;rls=en&amp;q=pandas+concat&amp;ie=UTF-8&amp;oe=UTF-8"><code>pd.concat()</code></a>. It has a lot of options, so feel free to peruse them. You can also replace the call to <code>pd.concat()</code> below with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.append.html"><code>test.append(train)</code></a>. Consider the example below that uses the Albemarle County real estate data <span class="citation">(Albemarle County Geographic Data Services Office <a href="#ref-albemarle_county_gis_web">2021</a>)</span> <span class="citation">(Ford <a href="#ref-clay_ford">2016</a>)</span>.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb196-1" title="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb196-2" title="2">real_estate <span class="op">=</span> pd.read_csv(<span class="st">"data/albemarle_real_estate.csv"</span>)</a>
<a class="sourceLine" id="cb196-3" title="3">train <span class="op">=</span> real_estate.iloc[<span class="dv">1</span>:,]</a>
<a class="sourceLine" id="cb196-4" title="4">test <span class="op">=</span> real_estate.iloc[[<span class="dv">0</span>],] <span class="co"># need the extra brackets!</span></a>
<a class="sourceLine" id="cb196-5" title="5">stacked <span class="op">=</span> pd.concat([test,train], axis<span class="op">=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb196-6" title="6">stacked.iloc[:<span class="dv">3</span>,:<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb196-7" title="7"><span class="co">##    YearBuilt  YearRemodeled Condition</span></a>
<a class="sourceLine" id="cb196-8" title="8"><span class="co">## 0       1769         1988.0   Average</span></a>
<a class="sourceLine" id="cb196-9" title="9"><span class="co">## 1       1818         1991.0   Average</span></a>
<a class="sourceLine" id="cb196-10" title="10"><span class="co">## 2       2004            NaN   Average</span></a>
<a class="sourceLine" id="cb196-11" title="11">(stacked <span class="op">!=</span> real_estate).<span class="bu">sum</span>().<span class="bu">sum</span>()</a>
<a class="sourceLine" id="cb196-12" title="12"><span class="co">## 28251</span></a></code></pre></div>
<p>Take note of the extra square brackets when we create <code>test</code>. If you use <code>real_estate.iloc[0,]</code> instead, it will return a <code>Series</code> with all the elements coerced to the same type, and this won’t <code>pd.concat()</code> properly with the rest of the data!</p>
</div>
<div id="merging-or-joining-data-sets" class="section level2 hasAnchor">
<h2><span class="header-section-number">12.3</span> Merging or Joining Data Sets<a aria-label="Anchor link to header" class="anchor-section" href="/reshaping-and-combining-data-sets#merging-or-joining-data-sets"/></h2>
<p>If you have two different data sets that provide information about the same experimental units, you can put the two data sets together using a <strong><code>merge</code></strong> (aka <strong><code>join</code></strong>) operation. In R, you can use the <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/merge"><code>merge()</code> function</a>. In Python, you can use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html#pandas-dataframe-merge"><code>.merge()</code> method</a>.</p>
<p>Merging (or joining) data sets is not the same as placing them shoulder to shoulder. Placing data sets shoulder to shoulder will not reorder the rows of your data and the operation requires that both input data sets have the same number of rows to start off with. On the other hand, merging data takes care to match rows together in an intelligent way, and it can handle situations of missing or duplicate matches. In both cases, the resulting data set is wider, but with merging, the output might end contain either more or fewer rows.</p>
<p>Here’s a clarifying example. Suppose you have to sets of supposedly anonymized data about individual accounts on some online platforms.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" title="1"><span class="co"># in R</span></a>
<a class="sourceLine" id="cb197-2" title="2">baby1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"data/baby1.csv"</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb197-3" title="3">baby2 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"data/baby2.csv"</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb197-4" title="4"><span class="kw">head</span>(baby1)</a>
<a class="sourceLine" id="cb197-5" title="5"><span class="co">##   idnum height.inches.          email_address</span></a>
<a class="sourceLine" id="cb197-6" title="6"><span class="co">## 1     1             74 fakeemail123@gmail.com</span></a>
<a class="sourceLine" id="cb197-7" title="7"><span class="co">## 2     3             66  anotherfake@gmail.com</span></a>
<a class="sourceLine" id="cb197-8" title="8"><span class="co">## 3     4             62      notreal@gmail.com</span></a>
<a class="sourceLine" id="cb197-9" title="9"><span class="co">## 4    23             62      notreal@gmail.com</span></a>
<a class="sourceLine" id="cb197-10" title="10"><span class="kw">head</span>(baby2)</a>
<a class="sourceLine" id="cb197-11" title="11"><span class="co">##     idnum      phone                   email</span></a>
<a class="sourceLine" id="cb197-12" title="12"><span class="co">## 1 3901283 5051234567       notreal@gmail.com</span></a>
<a class="sourceLine" id="cb197-13" title="13"><span class="co">## 2   41823 5051234568 notrealeither@gmail.com</span></a>
<a class="sourceLine" id="cb197-14" title="14"><span class="co">## 3 7198273 5051234568   anotherfake@gmail.com</span></a></code></pre></div>
<p>The first thing you need to ask yourself is <em>“which column is the unique identifier that is shared between these two data sets?”</em> In our case, they both have an “identification number” column. However, these two data sets are coming from different online platforms, and these two places use different schemes to number their users.</p>
<p>In this case, it is better to merge on the email addresses. Users might be using different email addresses on these two platforms, but there’s a stronger guarantee that matched email addresses means that you’re matching the right accounts. The columns are named differently in each data set, so we must specify them by name.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" title="1"><span class="co"># in R</span></a>
<a class="sourceLine" id="cb198-2" title="2"><span class="kw">merge</span>(baby1, baby2, <span class="dt">by.x =</span> <span class="st">"email_address"</span>, <span class="dt">by.y =</span> <span class="st">"email"</span>)</a>
<a class="sourceLine" id="cb198-3" title="3"><span class="co">##           email_address idnum.x height.inches. idnum.y      phone</span></a>
<a class="sourceLine" id="cb198-4" title="4"><span class="co">## 1 anotherfake@gmail.com       3             66 7198273 5051234568</span></a>
<a class="sourceLine" id="cb198-5" title="5"><span class="co">## 2     notreal@gmail.com       4             62 3901283 5051234567</span></a>
<a class="sourceLine" id="cb198-6" title="6"><span class="co">## 3     notreal@gmail.com      23             62 3901283 5051234567</span></a></code></pre></div>
<p>In Python, <code>merge()</code> is a method attached to each <code>DataFrame</code> instance.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb199-1" title="1"><span class="co"># in Python</span></a>
<a class="sourceLine" id="cb199-2" title="2">baby1.merge(baby2, left_on <span class="op">=</span> <span class="st">"email_address"</span>, right_on <span class="op">=</span> <span class="st">"email"</span>)</a>
<a class="sourceLine" id="cb199-3" title="3"><span class="co">##    idnum_x  height(inches)  ...       phone                  email</span></a>
<a class="sourceLine" id="cb199-4" title="4"><span class="co">## 0        3              66  ...  5051234568  anotherfake@gmail.com</span></a>
<a class="sourceLine" id="cb199-5" title="5"><span class="co">## 1        4              62  ...  5051234567      notreal@gmail.com</span></a>
<a class="sourceLine" id="cb199-6" title="6"><span class="co">## 2       23              62  ...  5051234567      notreal@gmail.com</span></a>
<a class="sourceLine" id="cb199-7" title="7"><span class="co">## </span></a>
<a class="sourceLine" id="cb199-8" title="8"><span class="co">## [3 rows x 6 columns]</span></a></code></pre></div>
<p>The email addresses <code>anotherfake@gmail.com</code> and <code>notreal@gmail.com</code> exist in both data sets, so each of these email addresses will end up in the result data frame. The rows in the result data set are wider and have more attributes for each individual.</p>
<p>Notice the duplicate email address, too. In this case, either the user signed up for two accounts using the same email, or one person signed up for an account with another person’s email address. In the case of duplicates, both rows will match with the same rows in the other data frame.</p>
<p>Also, in this case, all email addresses that weren’t found in both data sets were thrown away. This does not necessarily need to be the intended behavior. For instance, if we wanted to make sure no rows were thrown away, that would be possible. In this case, though, for email addresses that weren’t found in both data sets, some information will be missing. Recall that Python and R handle missing data differently (see <a href="/r-vectors-versus-numpy-arrays-and-pandas-series#how-r-and-python-handle-missing-values">3.8.2</a>).</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" title="1"><span class="co"># in R</span></a>
<a class="sourceLine" id="cb200-2" title="2"><span class="kw">merge</span>(baby1, baby2, </a>
<a class="sourceLine" id="cb200-3" title="3">      <span class="dt">by.x =</span> <span class="st">"email_address"</span>, <span class="dt">by.y =</span> <span class="st">"email"</span>, </a>
<a class="sourceLine" id="cb200-4" title="4">      <span class="dt">all.x =</span> <span class="ot">TRUE</span>, <span class="dt">all.y =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb200-5" title="5"><span class="co">##             email_address idnum.x height.inches. idnum.y      phone</span></a>
<a class="sourceLine" id="cb200-6" title="6"><span class="co">## 1   anotherfake@gmail.com       3             66 7198273 5051234568</span></a>
<a class="sourceLine" id="cb200-7" title="7"><span class="co">## 2  fakeemail123@gmail.com       1             74      NA         NA</span></a>
<a class="sourceLine" id="cb200-8" title="8"><span class="co">## 3       notreal@gmail.com       4             62 3901283 5051234567</span></a>
<a class="sourceLine" id="cb200-9" title="9"><span class="co">## 4       notreal@gmail.com      23             62 3901283 5051234567</span></a>
<a class="sourceLine" id="cb200-10" title="10"><span class="co">## 5 notrealeither@gmail.com      NA             NA   41823 5051234568</span></a></code></pre></div>
<div class="sourceCode" id="cb201"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb201-1" title="1"><span class="co"># in Python</span></a>
<a class="sourceLine" id="cb201-2" title="2">le_merge <span class="op">=</span> baby1.merge(baby2, </a>
<a class="sourceLine" id="cb201-3" title="3">                       left_on <span class="op">=</span> <span class="st">"email_address"</span>, right_on <span class="op">=</span> <span class="st">"email"</span>, </a>
<a class="sourceLine" id="cb201-4" title="4">                       how <span class="op">=</span> <span class="st">"outer"</span>)</a>
<a class="sourceLine" id="cb201-5" title="5">le_merge.iloc[:<span class="dv">5</span>,<span class="dv">3</span>:]</a>
<a class="sourceLine" id="cb201-6" title="6"><span class="co">##      idnum_y         phone                    email</span></a>
<a class="sourceLine" id="cb201-7" title="7"><span class="co">## 0        NaN           NaN                      NaN</span></a>
<a class="sourceLine" id="cb201-8" title="8"><span class="co">## 1  7198273.0  5.051235e+09    anotherfake@gmail.com</span></a>
<a class="sourceLine" id="cb201-9" title="9"><span class="co">## 2  3901283.0  5.051235e+09        notreal@gmail.com</span></a>
<a class="sourceLine" id="cb201-10" title="10"><span class="co">## 3  3901283.0  5.051235e+09        notreal@gmail.com</span></a>
<a class="sourceLine" id="cb201-11" title="11"><span class="co">## 4    41823.0  5.051235e+09  notrealeither@gmail.com</span></a></code></pre></div>
<p>You can see it’s slightly more concise in Python. If you are familiar with SQL, you might have heard of inner and outer joins. This is where Pandas <a href="https://pandas.pydata.org/pandas-docs/version/0.15/merging.html#database-style-dataframe-joining-merging">takes some of its argument names from</a>.</p>
<p>Finally, if both data sets have multiple values in the column you’re joining on, the result can have more rows than either table. This is because <em>every possible match</em> shows up.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" title="1"><span class="co"># in R</span></a>
<a class="sourceLine" id="cb202-2" title="2">first &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">category =</span> <span class="kw">c</span>(<span class="st">'a'</span>,<span class="st">'a'</span>), <span class="dt">measurement =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb202-3" title="3"><span class="kw">merge</span>(first, first, <span class="dt">by.x =</span> <span class="st">"category"</span>, <span class="dt">by.y =</span> <span class="st">"category"</span>)</a>
<a class="sourceLine" id="cb202-4" title="4"><span class="co">##   category measurement.x measurement.y</span></a>
<a class="sourceLine" id="cb202-5" title="5"><span class="co">## 1        a             1             1</span></a>
<a class="sourceLine" id="cb202-6" title="6"><span class="co">## 2        a             1             2</span></a>
<a class="sourceLine" id="cb202-7" title="7"><span class="co">## 3        a             2             1</span></a>
<a class="sourceLine" id="cb202-8" title="8"><span class="co">## 4        a             2             2</span></a></code></pre></div>
<div class="sourceCode" id="cb203"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb203-1" title="1"><span class="co"># in Python</span></a>
<a class="sourceLine" id="cb203-2" title="2">first <span class="op">=</span> pd.DataFrame({<span class="st">'category'</span> : [<span class="st">'a'</span>,<span class="st">'a'</span>], <span class="st">'measurement'</span> : [<span class="dv">1</span>,<span class="dv">2</span>]})</a>
<a class="sourceLine" id="cb203-3" title="3">first.merge(first, left_on <span class="op">=</span> <span class="st">"category"</span>, right_on <span class="op">=</span> <span class="st">"category"</span>)</a>
<a class="sourceLine" id="cb203-4" title="4"><span class="co">##   category  measurement_x  measurement_y</span></a>
<a class="sourceLine" id="cb203-5" title="5"><span class="co">## 0        a              1              1</span></a>
<a class="sourceLine" id="cb203-6" title="6"><span class="co">## 1        a              1              2</span></a>
<a class="sourceLine" id="cb203-7" title="7"><span class="co">## 2        a              2              1</span></a>
<a class="sourceLine" id="cb203-8" title="8"><span class="co">## 3        a              2              2</span></a></code></pre></div>
</div>
<div id="long-versus-wide-data" class="section level2 hasAnchor">
<h2><span class="header-section-number">12.4</span> Long Versus Wide Data<a aria-label="Anchor link to header" class="anchor-section" href="/reshaping-and-combining-data-sets#long-versus-wide-data"/></h2>
<div id="long-versus-wide-in-r" class="section level3 hasAnchor">
<h3><span class="header-section-number">12.4.1</span> Long Versus Wide in R<a aria-label="Anchor link to header" class="anchor-section" href="/reshaping-and-combining-data-sets#long-versus-wide-in-r"/></h3>
<p>Many types of data can be stored in either a <strong>wide</strong> or <strong>long</strong> format.</p>
<p>The classical example is data from a <em>longitudinal study.</em> If an experimental unit (in the example below this is a person) is repeatedly measured over time, each row would correspond to an experimental unit <em>and</em> an observation time in a data set in a long form.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" title="1">peopleNames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Taylor"</span>,<span class="st">"Taylor"</span>,<span class="st">"Charlie"</span>,<span class="st">"Charlie"</span>)</a>
<a class="sourceLine" id="cb204-2" title="2">fakeLongData1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">person =</span> peopleNames, </a>
<a class="sourceLine" id="cb204-3" title="3">                             <span class="dt">timeObserved =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb204-4" title="4">                             <span class="dt">nums =</span> <span class="kw">c</span>(<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">300</span>,<span class="dv">301</span>))</a>
<a class="sourceLine" id="cb204-5" title="5">fakeLongData1</a>
<a class="sourceLine" id="cb204-6" title="6"><span class="co">##    person timeObserved nums</span></a>
<a class="sourceLine" id="cb204-7" title="7"><span class="co">## 1  Taylor            1  100</span></a>
<a class="sourceLine" id="cb204-8" title="8"><span class="co">## 2  Taylor            2  101</span></a>
<a class="sourceLine" id="cb204-9" title="9"><span class="co">## 3 Charlie            1  300</span></a>
<a class="sourceLine" id="cb204-10" title="10"><span class="co">## 4 Charlie            2  301</span></a></code></pre></div>
<p>A long format can also be used if you have multiple observations (at a single time point) on an experimental unit. Here is another example.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" title="1">myAttrs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"attrA"</span>,<span class="st">"attrB"</span>,<span class="st">"attrA"</span>,<span class="st">"attrB"</span>)</a>
<a class="sourceLine" id="cb205-2" title="2">fakeLongData2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">person =</span> peopleNames, </a>
<a class="sourceLine" id="cb205-3" title="3">                             <span class="dt">attributeName =</span> myAttrs,</a>
<a class="sourceLine" id="cb205-4" title="4">                             <span class="dt">nums =</span> <span class="kw">c</span>(<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">300</span>,<span class="dv">301</span>))</a>
<a class="sourceLine" id="cb205-5" title="5">fakeLongData2</a>
<a class="sourceLine" id="cb205-6" title="6"><span class="co">##    person attributeName nums</span></a>
<a class="sourceLine" id="cb205-7" title="7"><span class="co">## 1  Taylor         attrA  100</span></a>
<a class="sourceLine" id="cb205-8" title="8"><span class="co">## 2  Taylor         attrB  101</span></a>
<a class="sourceLine" id="cb205-9" title="9"><span class="co">## 3 Charlie         attrA  300</span></a>
<a class="sourceLine" id="cb205-10" title="10"><span class="co">## 4 Charlie         attrB  301</span></a></code></pre></div>
<p>If you would like to reshape the long data sets into a wide format, you can use the <code>reshape()</code> function. You will need to specify which columns correspond with the experimental unit, and which column is the “factor” variable.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1">fakeWideData1 &lt;-<span class="st"> </span><span class="kw">reshape</span>(fakeLongData1, </a>
<a class="sourceLine" id="cb206-2" title="2">                           <span class="dt">direction =</span> <span class="st">"wide"</span>, </a>
<a class="sourceLine" id="cb206-3" title="3">                           <span class="dt">timevar =</span> <span class="st">"timeObserved"</span>, </a>
<a class="sourceLine" id="cb206-4" title="4">                           <span class="dt">idvar =</span> <span class="st">"person"</span>, </a>
<a class="sourceLine" id="cb206-5" title="5">                           <span class="dt">varying =</span> <span class="kw">c</span>(<span class="st">"before"</span>,<span class="st">"after"</span>)) </a>
<a class="sourceLine" id="cb206-6" title="6"><span class="co"># ^ varying= arg becomes col names in new data set</span></a>
<a class="sourceLine" id="cb206-7" title="7">fakeLongData1</a>
<a class="sourceLine" id="cb206-8" title="8"><span class="co">##    person timeObserved nums</span></a>
<a class="sourceLine" id="cb206-9" title="9"><span class="co">## 1  Taylor            1  100</span></a>
<a class="sourceLine" id="cb206-10" title="10"><span class="co">## 2  Taylor            2  101</span></a>
<a class="sourceLine" id="cb206-11" title="11"><span class="co">## 3 Charlie            1  300</span></a>
<a class="sourceLine" id="cb206-12" title="12"><span class="co">## 4 Charlie            2  301</span></a>
<a class="sourceLine" id="cb206-13" title="13">fakeWideData1</a>
<a class="sourceLine" id="cb206-14" title="14"><span class="co">##    person before after</span></a>
<a class="sourceLine" id="cb206-15" title="15"><span class="co">## 1  Taylor    100   101</span></a>
<a class="sourceLine" id="cb206-16" title="16"><span class="co">## 3 Charlie    300   301</span></a></code></pre></div>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" title="1"><span class="co"># timevar= is a misnomer here</span></a>
<a class="sourceLine" id="cb207-2" title="2">fakeWideData2 &lt;-<span class="st"> </span><span class="kw">reshape</span>(fakeLongData2, </a>
<a class="sourceLine" id="cb207-3" title="3">                           <span class="dt">direction =</span> <span class="st">"wide"</span>, </a>
<a class="sourceLine" id="cb207-4" title="4">                           <span class="dt">timevar =</span> <span class="st">"attributeName"</span>, </a>
<a class="sourceLine" id="cb207-5" title="5">                           <span class="dt">idvar =</span> <span class="st">"person"</span>, </a>
<a class="sourceLine" id="cb207-6" title="6">                           <span class="dt">varying =</span> <span class="kw">c</span>(<span class="st">"attribute A"</span>,<span class="st">"attribute B"</span>)) </a>
<a class="sourceLine" id="cb207-7" title="7">fakeLongData2</a>
<a class="sourceLine" id="cb207-8" title="8"><span class="co">##    person attributeName nums</span></a>
<a class="sourceLine" id="cb207-9" title="9"><span class="co">## 1  Taylor         attrA  100</span></a>
<a class="sourceLine" id="cb207-10" title="10"><span class="co">## 2  Taylor         attrB  101</span></a>
<a class="sourceLine" id="cb207-11" title="11"><span class="co">## 3 Charlie         attrA  300</span></a>
<a class="sourceLine" id="cb207-12" title="12"><span class="co">## 4 Charlie         attrB  301</span></a>
<a class="sourceLine" id="cb207-13" title="13">fakeWideData2</a>
<a class="sourceLine" id="cb207-14" title="14"><span class="co">##    person attribute A attribute B</span></a>
<a class="sourceLine" id="cb207-15" title="15"><span class="co">## 1  Taylor         100         101</span></a>
<a class="sourceLine" id="cb207-16" title="16"><span class="co">## 3 Charlie         300         301</span></a></code></pre></div>
<p><code>reshape()</code> will also go in the other direction: it can take wide data and convert it into long data</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1"><span class="kw">reshape</span>(fakeWideData1, </a>
<a class="sourceLine" id="cb208-2" title="2">        <span class="dt">direction =</span> <span class="st">"long"</span>,</a>
<a class="sourceLine" id="cb208-3" title="3">        <span class="dt">idvar =</span> <span class="st">"person"</span>, </a>
<a class="sourceLine" id="cb208-4" title="4">        <span class="dt">varying =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="st">"before"</span>,<span class="st">"after"</span>)),</a>
<a class="sourceLine" id="cb208-5" title="5">        <span class="dt">v.names =</span> <span class="st">"nums"</span>)</a>
<a class="sourceLine" id="cb208-6" title="6"><span class="co">##            person time nums</span></a>
<a class="sourceLine" id="cb208-7" title="7"><span class="co">## Taylor.1   Taylor    1  100</span></a>
<a class="sourceLine" id="cb208-8" title="8"><span class="co">## Charlie.1 Charlie    1  300</span></a>
<a class="sourceLine" id="cb208-9" title="9"><span class="co">## Taylor.2   Taylor    2  101</span></a>
<a class="sourceLine" id="cb208-10" title="10"><span class="co">## Charlie.2 Charlie    2  301</span></a>
<a class="sourceLine" id="cb208-11" title="11">fakeLongData1</a>
<a class="sourceLine" id="cb208-12" title="12"><span class="co">##    person timeObserved nums</span></a>
<a class="sourceLine" id="cb208-13" title="13"><span class="co">## 1  Taylor            1  100</span></a>
<a class="sourceLine" id="cb208-14" title="14"><span class="co">## 2  Taylor            2  101</span></a>
<a class="sourceLine" id="cb208-15" title="15"><span class="co">## 3 Charlie            1  300</span></a>
<a class="sourceLine" id="cb208-16" title="16"><span class="co">## 4 Charlie            2  301</span></a>
<a class="sourceLine" id="cb208-17" title="17"><span class="kw">reshape</span>(fakeWideData2, </a>
<a class="sourceLine" id="cb208-18" title="18">        <span class="dt">direction =</span> <span class="st">"long"</span>,</a>
<a class="sourceLine" id="cb208-19" title="19">        <span class="dt">idvar =</span> <span class="st">"person"</span>, </a>
<a class="sourceLine" id="cb208-20" title="20">        <span class="dt">varying =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="st">"attribute A"</span>,<span class="st">"attribute B"</span>)),</a>
<a class="sourceLine" id="cb208-21" title="21">        <span class="dt">v.names =</span> <span class="st">"nums"</span>)</a>
<a class="sourceLine" id="cb208-22" title="22"><span class="co">##            person time nums</span></a>
<a class="sourceLine" id="cb208-23" title="23"><span class="co">## Taylor.1   Taylor    1  100</span></a>
<a class="sourceLine" id="cb208-24" title="24"><span class="co">## Charlie.1 Charlie    1  300</span></a>
<a class="sourceLine" id="cb208-25" title="25"><span class="co">## Taylor.2   Taylor    2  101</span></a>
<a class="sourceLine" id="cb208-26" title="26"><span class="co">## Charlie.2 Charlie    2  301</span></a>
<a class="sourceLine" id="cb208-27" title="27">fakeLongData2</a>
<a class="sourceLine" id="cb208-28" title="28"><span class="co">##    person attributeName nums</span></a>
<a class="sourceLine" id="cb208-29" title="29"><span class="co">## 1  Taylor         attrA  100</span></a>
<a class="sourceLine" id="cb208-30" title="30"><span class="co">## 2  Taylor         attrB  101</span></a>
<a class="sourceLine" id="cb208-31" title="31"><span class="co">## 3 Charlie         attrA  300</span></a>
<a class="sourceLine" id="cb208-32" title="32"><span class="co">## 4 Charlie         attrB  301</span></a></code></pre></div>
</div>
<div id="long-versus-wide-in-python" class="section level3 hasAnchor">
<h3><span class="header-section-number">12.4.2</span> Long Versus Wide in Python<a aria-label="Anchor link to header" class="anchor-section" href="/reshaping-and-combining-data-sets#long-versus-wide-in-python"/></h3>
<p>With Pandas, we can take make long data wide with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot.html#"><code>pd.DataFrame.pivot()</code></a>, and we can go in the other direction with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.melt.html?highlight=melt"><code>pd.DataFrame.melt()</code></a>.</p>
<p>When going from long to wide, make sure to use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reset_index.html#"><code>pd.DataFrame.reset_index()</code></a> method afterwards to reshape the data and remove the index. Here is an example similar to the one above.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb209-1" title="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb209-2" title="2">fake_long_data1 <span class="op">=</span> pd.DataFrame(</a>
<a class="sourceLine" id="cb209-3" title="3">  {<span class="st">'person'</span> : [<span class="st">"Taylor"</span>,<span class="st">"Taylor"</span>,<span class="st">"Charlie"</span>,<span class="st">"Charlie"</span>], </a>
<a class="sourceLine" id="cb209-4" title="4">  <span class="st">'time_observed'</span> : [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb209-5" title="5">  <span class="st">'nums'</span> : [<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">300</span>,<span class="dv">301</span>]})</a>
<a class="sourceLine" id="cb209-6" title="6">fake_long_data1</a>
<a class="sourceLine" id="cb209-7" title="7"><span class="co">##     person  time_observed  nums</span></a>
<a class="sourceLine" id="cb209-8" title="8"><span class="co">## 0   Taylor              1   100</span></a>
<a class="sourceLine" id="cb209-9" title="9"><span class="co">## 1   Taylor              2   101</span></a>
<a class="sourceLine" id="cb209-10" title="10"><span class="co">## 2  Charlie              1   300</span></a>
<a class="sourceLine" id="cb209-11" title="11"><span class="co">## 3  Charlie              2   301</span></a>
<a class="sourceLine" id="cb209-12" title="12">pivot_data1 <span class="op">=</span> fake_long_data1.pivot(index<span class="op">=</span><span class="st">'person'</span>, </a>
<a class="sourceLine" id="cb209-13" title="13">                                    columns<span class="op">=</span><span class="st">'time_observed'</span>, </a>
<a class="sourceLine" id="cb209-14" title="14">                                    values<span class="op">=</span><span class="st">'nums'</span>)</a>
<a class="sourceLine" id="cb209-15" title="15">fake_wide_data1 <span class="op">=</span> pivot_data1.reset_index()</a>
<a class="sourceLine" id="cb209-16" title="16">fake_wide_data1</a>
<a class="sourceLine" id="cb209-17" title="17"><span class="co">## time_observed   person    1    2</span></a>
<a class="sourceLine" id="cb209-18" title="18"><span class="co">## 0              Charlie  300  301</span></a>
<a class="sourceLine" id="cb209-19" title="19"><span class="co">## 1               Taylor  100  101</span></a></code></pre></div>
<p>Here’s one more example showing the same functionality–going from long to wide format.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb210-1" title="1">people_names <span class="op">=</span> [<span class="st">"Taylor"</span>,<span class="st">"Taylor"</span>,<span class="st">"Charlie"</span>,<span class="st">"Charlie"</span>]</a>
<a class="sourceLine" id="cb210-2" title="2">attribute_list <span class="op">=</span> [<span class="st">'attrA'</span>, <span class="st">'attrB'</span>, <span class="st">'attrA'</span>, <span class="st">'attrB'</span>]</a>
<a class="sourceLine" id="cb210-3" title="3">fake_long_data2 <span class="op">=</span> pd.DataFrame({<span class="st">'person'</span> : people_names, </a>
<a class="sourceLine" id="cb210-4" title="4">                               <span class="st">'attribute_name'</span> : attribute_list,</a>
<a class="sourceLine" id="cb210-5" title="5">                               <span class="st">'nums'</span> : [<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">300</span>,<span class="dv">301</span>]})</a>
<a class="sourceLine" id="cb210-6" title="6">fake_wide_data2 <span class="op">=</span> fake_long_data2.pivot(index<span class="op">=</span><span class="st">'person'</span>, </a>
<a class="sourceLine" id="cb210-7" title="7">                                        columns<span class="op">=</span><span class="st">'attribute_name'</span>, </a>
<a class="sourceLine" id="cb210-8" title="8">                                        values<span class="op">=</span><span class="st">'nums'</span>).reset_index()</a>
<a class="sourceLine" id="cb210-9" title="9">fake_wide_data2</a>
<a class="sourceLine" id="cb210-10" title="10"><span class="co">## attribute_name   person  attrA  attrB</span></a>
<a class="sourceLine" id="cb210-11" title="11"><span class="co">## 0               Charlie    300    301</span></a>
<a class="sourceLine" id="cb210-12" title="12"><span class="co">## 1                Taylor    100    101</span></a></code></pre></div>
<p>Here are some examples of going in the other direction: from wide to long with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.melt.html?highlight=melt"><code>pd.DataFrame.melt()</code></a>. The first example specifies value columns by integers.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb211-1" title="1">fake_wide_data1</a>
<a class="sourceLine" id="cb211-2" title="2"><span class="co">## time_observed   person    1    2</span></a>
<a class="sourceLine" id="cb211-3" title="3"><span class="co">## 0              Charlie  300  301</span></a>
<a class="sourceLine" id="cb211-4" title="4"><span class="co">## 1               Taylor  100  101</span></a>
<a class="sourceLine" id="cb211-5" title="5">fake_wide_data1.melt(id_vars <span class="op">=</span> <span class="st">"person"</span>, value_vars <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb211-6" title="6"><span class="co">##     person time_observed  value</span></a>
<a class="sourceLine" id="cb211-7" title="7"><span class="co">## 0  Charlie             1    300</span></a>
<a class="sourceLine" id="cb211-8" title="8"><span class="co">## 1   Taylor             1    100</span></a>
<a class="sourceLine" id="cb211-9" title="9"><span class="co">## 2  Charlie             2    301</span></a>
<a class="sourceLine" id="cb211-10" title="10"><span class="co">## 3   Taylor             2    101</span></a></code></pre></div>
<p>The second example uses strings to specify value columns.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb212-1" title="1">fake_wide_data2</a>
<a class="sourceLine" id="cb212-2" title="2"><span class="co">## attribute_name   person  attrA  attrB</span></a>
<a class="sourceLine" id="cb212-3" title="3"><span class="co">## 0               Charlie    300    301</span></a>
<a class="sourceLine" id="cb212-4" title="4"><span class="co">## 1                Taylor    100    101</span></a>
<a class="sourceLine" id="cb212-5" title="5">fake_wide_data2.melt(id_vars <span class="op">=</span> <span class="st">"person"</span>, </a>
<a class="sourceLine" id="cb212-6" title="6">                     value_vars <span class="op">=</span> [<span class="st">'attrA'</span>,<span class="st">'attrB'</span>])</a>
<a class="sourceLine" id="cb212-7" title="7"><span class="co">##     person attribute_name  value</span></a>
<a class="sourceLine" id="cb212-8" title="8"><span class="co">## 0  Charlie          attrA    300</span></a>
<a class="sourceLine" id="cb212-9" title="9"><span class="co">## 1   Taylor          attrA    100</span></a>
<a class="sourceLine" id="cb212-10" title="10"><span class="co">## 2  Charlie          attrB    301</span></a>
<a class="sourceLine" id="cb212-11" title="11"><span class="co">## 3   Taylor          attrB    101</span></a></code></pre></div>
</div>
</div>
<div id="exercises-10" class="section level2 hasAnchor">
<h2><span class="header-section-number">12.5</span> Exercises<a aria-label="Anchor link to header" class="anchor-section" href="/reshaping-and-combining-data-sets#exercises-10"/></h2>
<div id="r-questions-9" class="section level3 hasAnchor">
<h3><span class="header-section-number">12.5.1</span> R Questions<a aria-label="Anchor link to header" class="anchor-section" href="/reshaping-and-combining-data-sets#r-questions-9"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>Recall the <code>car.data</code> data set <span class="citation">(“Car Evaluation” <a href="#ref-misc_car_evaluation_19">1997</a>)</span>, which is hosted by <span class="citation">(Dua and Graff <a href="#ref-uci_data">2017</a>)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data set as <code>carData</code>.</li>
<li>Convert the third and fourth columns to <em>ordered</em> <code>factor</code>s.</li>
<li>Order the data by the third and then the fourth column (simultaneously). Do not change the data in place. Instead store it under the name <code>ordCarData1</code></li>
<li>Order the data by the fourth and then the third column (simultaneously). Do not change the data in place. Instead store it under the name <code>ordCarData2</code></li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" title="1">day1Data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">idNum =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb213-2" title="2">                       <span class="dt">measure =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb213-3" title="3">day2Data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">idNum =</span> <span class="dv">11</span><span class="op">:</span><span class="dv">20</span>, </a>
<a class="sourceLine" id="cb213-4" title="4">                       <span class="dt">measure =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>))</a></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Pretend <code>day1Data</code> and <code>day2Data</code> are two separate data sets that possess the same type of measures but on different experimental units. Stack <code>day1Data</code> on top of <code>day2Data</code> and call the result <code>stackedData</code>.</li>
<li>Pretend <code>day1Data</code> and <code>day2Data</code> are different measurements on the same experimental units. Place them shoulder to shoulder and call the result <code>sideBySide</code>. Put <code>day1Data</code> first, and <code>day2Data</code> second.</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li/>
</ol>
<p>If you are dealing with random matrices, you might need to <strong>vectorize</strong> a matrix object. This is not the same as “vectorization” in programming. Instead, it means you write the matrix as a big column vector by stacking the columns on top of each other. Specifically, if you have a <span class="math inline">\(n \times p\)</span> real-valued matrix <span class="math inline">\(\mathbf{X}\)</span>, then</p>
<p><span class="math display">\[\begin{equation} 
\text{vec}(\mathbf{X}) =\begin{bmatrix} \mathbf{X}_1 \\ \vdots \\ \mathbf{X}_p \end{bmatrix} 
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\mathbf{X}_i\)</span> is the <span class="math inline">\(i\)</span>th column as an <span class="math inline">\(n \times 1\)</span> column vector. There is another operator that we will use, the <strong>Kronecker product:</strong></p>
<p><span class="math display">\[\begin{equation} 
\mathbf{A} \otimes \mathbf{B} = 
\begin{bmatrix}
a_{11} \mathbf{B} &amp; \cdots &amp; a_{1n} \mathbf{B} \\
\vdots &amp; \ddots &amp; \vdots \\
a_{m1} \mathbf{B} &amp; \cdots &amp; a_{mn} \mathbf{B} \\
\end{bmatrix}.
\end{equation}\]</span></p>
<p>If <span class="math inline">\(\mathbf{A}\)</span> is <span class="math inline">\(m \times n\)</span> and <span class="math inline">\(\mathbf{B}\)</span> is <span class="math inline">\(p \times q\)</span>, then <span class="math inline">\(\mathbf{A} \otimes \mathbf{B}\)</span> is <span class="math inline">\(pm \times qn\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>Write a function called <code>vec(myMatrix)</code>. Its input should be one <code>matrix</code> object. It’s output should be a <code>vector</code>. Hint: <code>matrix</code> objects are stored in column-major order.</li>
<li>Write a function called <code>unVec(myVector, nRows)</code> that takes in the vectorized matrix as a <code>vector</code>, splits that into elements with <code>nRows</code> elements, and then places them together shoulder-to-shoulder as a <code>matrix</code>.</li>
<li>Write a function called <code>stackUp(m, BMat)</code> that returns <span class="math inline">\(\mathbf{1}_m \otimes \mathbf{B}\)</span> where <span class="math inline">\(\mathbf{1}_m\)</span> is a length <span class="math inline">\(m\)</span> column vector of ones. You may check your work with <code>%x%</code>, but do not use this in your function.</li>
<li>Write a function called <code>shoulderToShoulder(n, BMat)</code> that returns <span class="math inline">\(\mathbf{1}^\intercal_n \otimes \mathbf{B}\)</span> where <span class="math inline">\(\mathbf{1}_n^\intercal\)</span> is a length <span class="math inline">\(n\)</span> row vector of ones. You may check your work with <code>%x%</code>, but do not use this in your function.</li>
</ol>
<ol start="4" style="list-style-type: decimal">
<li/>
</ol>
<p>This problem uses the Militarized Interstate Disputes (v5.0) <span class="citation">(Palmer et al.<a href="#ref-mid5"/>)</span> data set from <a href="https://correlatesofwar.org/">The Correlates of War Project</a>. There are four <code>.csv</code> files we use for this problem. <code>MIDA 5.0.csv</code> contains the essential attributes of each militarized interstate dispute from 1/1/1816 through 12/31/2014. <code>MIDB 5.0.csv</code> describes the participants in each of those disputes. <code>MIDI 5.0.csv</code> contains the essential elements of each militarized interstate incident, and <code>MIDIP 5.0.csv</code> describes the participants in each of those incidents.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the four data sets and give them the names <code>mida</code>, <code>midb</code>, <code>midi</code>, and <code>midp</code>. Take care to convert all instances of <code>-9</code> to <code>NA</code>.</li>
<li>Examine all rows of <code>midb</code> where its <code>dispnum</code> column equals <code>2</code>. Do not change <code>midb</code> permanently. Are these two rows corresponding to the same conflict? If so, assign <code>TRUE</code> to <code>sameConflict</code>. Otherwise, assign <code>FALSE</code>.</li>
<li>Join the first two data sets together on the dispute number column (<code>dispnum</code>). Call the resulting <code>data.frame</code> <code>join1</code>. Do not address any concerns about duplicate columns.</li>
<li>Is there any difference between doing an inner join and an outer join in the previous question? If there was a difference, assign <code>TRUE</code> to <code>theyAreNotTheSame</code>. Otherwise, assign <code>FALSE</code> to it.</li>
<li>Join the last two data sets together by <code>incidnum</code> and call the result <code>join2</code>. Is there any difference between an inner and an outer join for this problem? Why or why not? Do not address any concerns about duplicate columns.</li>
<li>The codebook mentions that the last two data sets don’t go as far back in time as the first two. Suppose then that we only care about the events in <code>join2</code>. Merge <code>join2</code> and <code>join1</code> in a way where all undesired rows from <code>join1</code> are discarded, and all rows from <code>join2</code> are kept. Call the resulting <code>data.frame</code> <code>midData</code>. Do not address any concerns about duplicate columns.</li>
<li>Use a scatterplot to display the relationship between the maximum duration and the end year. Plot each country as a different color.</li>
<li>Create a <code>data.frame</code> called <code>longData</code> that has the following three columns from <code>midp</code>: <code>incidnum</code> (incident identification number) <code>stabb</code> (state abbreviation of participant) and <code>fatalpre</code> (precise number of fatalities). Convert this to “wide” format. Make the new table called <code>wideData</code>. Use the incident number row as a unique row-identifying variable.</li>
<li>Bonus Question: identify all column pairs that contain duplicate information in <code>midData</code>, remove all but one of the columns, and change the column name back to its original name.</li>
</ol>
</div>
<div id="python-questions-9" class="section level3 hasAnchor">
<h3><span class="header-section-number">12.5.2</span> Python Questions<a aria-label="Anchor link to header" class="anchor-section" href="/reshaping-and-combining-data-sets#python-questions-9"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>Once again, recall the <code>"car.data"</code> data set <span class="citation">(“Car Evaluation” <a href="#ref-misc_car_evaluation_19">1997</a>)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data set as <code>car_data</code>.</li>
<li>Order the data by the third and then the fourth column. Do not change the data in place. Instead store it under the name <code>ord_car_data1</code></li>
<li>Order the data by the fourth and then the third column. Do not change the data in place. Instead store it under the name <code>ord_car_data2</code></li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<p>Consider the following random data set.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb214-1" title="1">indexes  <span class="op">=</span> np.random.choice(np.arange(<span class="dv">20</span>),size<span class="op">=</span><span class="dv">20</span>,replace<span class="op">=</span><span class="va">False</span>)</a>
<a class="sourceLine" id="cb214-2" title="2">d1 <span class="op">=</span> pd.DataFrame({<span class="st">'a'</span> : indexes, </a>
<a class="sourceLine" id="cb214-3" title="3">                   <span class="st">'b'</span> : np.random.normal(size<span class="op">=</span><span class="dv">20</span>)})</a>
<a class="sourceLine" id="cb214-4" title="4">d2 <span class="op">=</span> pd.DataFrame({<span class="st">'a'</span> : indexes <span class="op">+</span> <span class="dv">20</span>, </a>
<a class="sourceLine" id="cb214-5" title="5">                   <span class="st">'b'</span> : np.random.normal(size<span class="op">=</span><span class="dv">20</span>)})</a></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Pretend <code>d1</code> and <code>d2</code> are two separate data sets that possess the same type of measures but on different experimental units. Stack <code>d1</code> on top of <code>d2</code> and call the result <code>stacked_data_sets</code>. Make sure the <code>index</code> of the result is the numbers <span class="math inline">\(0\)</span> through <span class="math inline">\(39\)</span></li>
<li>Pretend <code>d1</code> and <code>d2</code> are different measurements on the same experimental units. Place them shoulder to shoulder and call the result <code>side_by_side_data_sets</code>. Put <code>d1</code> first, and <code>d2</code> second.</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li/>
</ol>
<p>Consider the following two data sets:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb215-1" title="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb215-2" title="2"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb215-3" title="3">dog_names1 <span class="op">=</span> [<span class="st">'Charlie'</span>,<span class="st">'Gus'</span>, <span class="st">'Stubby'</span>, <span class="st">'Toni'</span>,<span class="st">'Pearl'</span>]</a>
<a class="sourceLine" id="cb215-4" title="4">dog_names2 <span class="op">=</span> [<span class="st">'Charlie'</span>,<span class="st">'Gus'</span>, <span class="st">'Toni'</span>,<span class="st">'Arya'</span>,<span class="st">'Shelby'</span>]</a>
<a class="sourceLine" id="cb215-5" title="5">nicknames <span class="op">=</span> [<span class="st">'Charles'</span>,<span class="st">'Gus The Bus'</span>,np.nan,<span class="st">'Toni Bologna'</span>,<span class="st">'Porl'</span>]</a>
<a class="sourceLine" id="cb215-6" title="6">breed_names <span class="op">=</span> [<span class="st">'Black Lab'</span>,<span class="st">'Beagle'</span>,<span class="st">'Golden Retriever'</span>,<span class="st">'Husky'</span>,np.nan]</a>
<a class="sourceLine" id="cb215-7" title="7">dataset1 <span class="op">=</span> pd.DataFrame({<span class="st">'dog'</span>: dog_names1,</a>
<a class="sourceLine" id="cb215-8" title="8">                        <span class="st">'nickname'</span>: nicknames})</a>
<a class="sourceLine" id="cb215-9" title="9">dataset2 <span class="op">=</span> pd.DataFrame({<span class="st">'dog'</span>:dog_names2,</a>
<a class="sourceLine" id="cb215-10" title="10">                        <span class="st">'breed'</span>:breed_names})</a></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Join/merge the two data sets together in such a way that there is a row for every dog, whether or not both tables have information for that dog. Call the result <code>merged1</code>.</li>
<li>Join/merge the two data sets together in such a way that there are only rows for every dog in <code>dataset1</code>, whether or not there is information about these dogs’ breeds. Call the result <code>merged2</code>.</li>
<li>Join/merge the two data sets together in such a way that there are only rows for every dog in <code>dataset2</code>, whether or not there is information about the dogs’ nicknames. Call the result <code>merged3</code>.</li>
<li>Join/merge the two data sets together in such a way that all rows possess complete information. Call the result <code>merged4</code>.</li>
</ol>
<ol start="4" style="list-style-type: decimal">
<li/>
</ol>
<p>Let’s consider Fisher’s “Iris” data set <span class="citation">(Fisher <a href="#ref-misc_iris_53">1988</a>)</span> again.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in <code>iris.csv</code> and store the <code>DataFrame</code> with the name <code>iris</code>. Let it have the column names <code>'a'</code>,<code>'b'</code>,<code>'c'</code>, <code>'d'</code> and <code>'e'</code>.</li>
<li>Create a <code>DataFrame</code> called <code>name_key</code> that stores correspondences between long names and short names. It should have three rows and two columns. The long names are the unique values of column five of <code>iris</code>. The short names are either <code>'s'</code>, <code>'vers'</code> or <code>'virg'</code>. Use the column names <code>'long name'</code> and <code>'short name'</code>.</li>
<li>Merge/join the two data sets together to give <code>iris</code> a new column with information about short names. Do not overwrite <code>iris</code>. Rather, give the <code>DataFrame</code> a new name: <code>iris_with_short_names</code>. Remove any columns with duplicate information.</li>
<li>Change the first four column names of <code>iris_with_short_names</code> to <code>s_len</code>, <code>s_wid</code>, <code>p_len</code>, and <code>p_wid</code>. Use Matplotlib to create a figure with 4 subplots arranged into a <span class="math inline">\(2 \times 2\)</span> grid. On each subplot, plot a histogram of these four columns. Make sure to use x-axis labels so viewers can tell which column is being plotted in each subplot.</li>
<li>Let’s go back to <code>iris</code>. Change that to long format. Store it as a <code>DataFrame</code> called <code>long_iris</code>. Make the column names <code>row</code>, <code>variable</code> and <code>value</code>, in that order. Last, make sure it is sorted (simultaneously/once) by <code>row</code> and then <code>variable</code>.</li>
</ol>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-albemarle_county_gis_web">
<p>Albemarle County Geographic Data Services Office. 2021. “Albemarle County GIS Web.” <a href="https://www.albemarle.org/government/community-development/gis-mapping/gis-data">https://www.albemarle.org/government/community-development/gis-mapping/gis-data</a>.</p>
</div>
<div id="ref-misc_car_evaluation_19">
<p>“Car Evaluation.” 1997. UCI Machine Learning Repository.</p>
</div>
<div id="ref-uci_data">
<p>Dua, Dheeru, and Casey Graff. 2017. “UCI Machine Learning Repository.” University of California, Irvine, School of Information; Computer Sciences. <a href="http://archive.ics.uci.edu/ml">http://archive.ics.uci.edu/ml</a>.</p>
</div>
<div id="ref-misc_iris_53">
<p>Fisher, Test, R.A. &amp; Creator. 1988. “Iris.” UCI Machine Learning Repository.</p>
</div>
<div id="ref-clay_ford">
<p>Ford, Clay. 2016. “ggplot: Files for UVA StatLab workshop, Fall 2016.” <em>GitHub Repository</em>. <a href="https://github.com/clayford/ggplot2">https://github.com/clayford/ggplot2</a>; GitHub.</p>
</div>
<div id="ref-mid5">
<p>Palmer, Glenn, Roseanne W McManus, Vito D’Orazio, Michael R Kenwick, Mikaela Karstens, Chase Bloch, Nick Dietrich, Kayla Kahn, Kellan Ritter, and Michael J Soules“The Mid5 Dataset, 2011–2014: Procedures, Coding Rules, and Description.” <em>Conflict Management and Peace Science</em> 0 (0): 0738894221995743. <a href="https://doi.org/10.1177/0738894221995743">https://doi.org/10.1177/0738894221995743</a>.</p>
</div>
<div id="ref-sas_cars">
<p>“SAS<sup/> Viya<sup/> Example Data Sets.” 2021. <a href="https://support.sas.com/documentation/onlinedoc/viya/examples.htm">https://support.sas.com/documentation/onlinedoc/viya/examples.htm</a>.</p>
</div>
</div>
                
</body>
</html>