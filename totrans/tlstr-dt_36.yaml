- en: Online Appendix B — Python essentials
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在线附录 B — Python 精要
- en: 原文：[https://tellingstorieswithdata.com/21-python_essentials.html](https://tellingstorieswithdata.com/21-python_essentials.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://tellingstorieswithdata.com/21-python_essentials.html](https://tellingstorieswithdata.com/21-python_essentials.html)
- en: '[Appendices](./20-r_essentials.html)'
  id: totrans-2
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[附录](./20-r_essentials.html)'
- en: '[B  Python essentials](./21-python_essentials.html)'
  id: totrans-3
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[B Python 精要](./21-python_essentials.html)'
- en: '**Prerequisites**'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '**先决条件**'
- en: '**Key concepts and skills**'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念和技能**'
- en: '**Software and packages**'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '**软件和包**'
- en: '`Python` ([Python Software Foundation 2024](99-references.html#ref-python))'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Python` ([Python 软件基金会 2024](99-references.html#ref-python))'
- en: '`datetime>=5.5`'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`datetime>=5.5`'
- en: '`uv`'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`uv`'
- en: '`polars`'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`polars`'
- en: B.1 Introduction
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.1 简介
- en: '`Python` is a general-purpose programming language created by Guido van Rossum.
    `Python` version 0.9.0 was released in February 1991, and the current version,
    3.13, was released in October 2024\. It was named `Python` after *Monty Python’s
    Flying Circus*.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '`Python` 是由吉多·范罗苏姆（Guido van Rossum）创建的一种通用编程语言。`Python` 版本 0.9.0 于 1991 年
    2 月发布，当前版本 3.13 于 2024 年 10 月发布。它是以 *蒙提·派森飞行马戏团* 命名的。'
- en: '`Python` is a popular language in machine learning, but it was designed, and
    is more commonly used, for more general software applications. This means that
    we will especially rely on packages when we use Python for data science. This
    use of `Python` in this book is focused on data science, rather than the other,
    more general, uses for which it was developed.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '`Python` 是机器学习中的流行语言，但它最初是为更通用的软件应用而设计的，并且更常用于此类应用。这意味着当我们使用 Python 进行数据科学时，我们将特别依赖包。本书中
    `Python` 的使用主要关注数据科学，而不是它所开发的更通用的其他用途。'
- en: Knowing `R` will allow you to pick up `Python` for data science quickly. The
    main data science packages share the need to solve the same underlying problems.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 了解 `R` 将使您能够快速掌握 `Python` 进行数据科学。主要的数据科学包都需要解决相同的基本问题。
- en: B.2 Python, VS Code, and uv
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.2 Python、VS Code 和 uv
- en: We could use `Python` within RStudio, but another option is to use what is used
    by the community more broadly, which is VS Code. You can download VS Code for
    free [here](https://code.visualstudio.com) and then install it. If you have difficulties
    with this, then in the same way we started with Posit Cloud and the shifted to
    our local machine, you could initially use Google Colab [here](https://colab.google).
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在 RStudio 中使用 `Python`，但另一个选择是使用社区更广泛使用的 VS Code。您可以从 [这里](https://code.visualstudio.com)
    免费下载 VS Code 并安装它。如果您遇到困难，那么就像我们从 Posit Cloud 开始，然后转移到我们的本地机器一样，您最初可以使用 Google
    Colab [这里](https://colab.google)。
- en: 'Open VS Code ([Figure B.1 (a)](#fig-vscodesetup-a)), and open a new Terminal:
    Terminal -> New Terminal ([Figure B.1 (b)](#fig-vscodesetup-b)). We can then install
    `uv`, which is a Python package manager, by putting `curl -LsSf https://astral.sh/uv/install.sh
    | sh` into the Terminal and pressing “return/enter” afterwards ([Figure B.1 (c)](#fig-vscodesetup-c)).
    Finally, to install Python we can use `uv` by putting `uv python install` into
    that Terminal and pressing “return/enter” afterwards ([Figure B.1 (d)](#fig-vscodesetup-d)).'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 打开 VS Code ([图 B.1 (a)](#fig-vscodesetup-a))，然后打开一个新的终端：终端 -> 新终端 ([图 B.1 (b)](#fig-vscodesetup-b))。然后我们可以通过在终端中输入
    `curl -LsSf https://astral.sh/uv/install.sh | sh` 并按“回车/Enter”来安装 `uv`，这是一个 Python
    包管理器 ([图 B.1 (c)](#fig-vscodesetup-c))。最后，要安装 Python，我们可以在该终端中输入 `uv python install`
    并按“回车/Enter”来安装 ([图 B.1 (d)](#fig-vscodesetup-d))。
- en: '![](../Images/8578396621a2311c740d7972064240a2.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/8578396621a2311c740d7972064240a2.png)'
- en: (a) Opening VS Code
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: (a) 打开 VS Code
- en: '![](../Images/1c02b9d1b87599897cd93909488cb35f.png)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1c02b9d1b87599897cd93909488cb35f.png)'
- en: (b) Opening a Terminal in VS Code
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: (b) 在 VS Code 中打开终端
- en: '![](../Images/7df187607f972b0ef3bb6cd315991a1c.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7df187607f972b0ef3bb6cd315991a1c.png)'
- en: (c) Install uv
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: (c) 安装 uv
- en: '![](../Images/a4566e2734bf2eebe9e3359f77e94b7e.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a4566e2734bf2eebe9e3359f77e94b7e.png)'
- en: (d) Install Python
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: (d) 安装 Python
- en: 'Figure B.1: Opening VS Code and a new terminal and then installing uv and Python'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图 B.1：打开 VS Code 和新终端，然后安装 uv 和 Python
- en: B.3 Getting started
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.3 入门
- en: B.3.1 Project set-up
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.3.1 项目设置
- en: We are going to get started with an example that downloads some data from Open
    Data Toronto. To start, we need to create a project, which will allow all our
    code to be self-contained.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过一个示例开始，该示例从 Open Data Toronto 下载一些数据。首先，我们需要创建一个项目，这将使所有代码都包含在项目中。
- en: 'Open VS Code and open a new Terminal: “Terminal” -> “New Terminal”. Then use
    Unix shell commands to navigate to where you want to create your folder. For instance,
    use `ls` to list all the folders in the current directory, then move to one using
    `cd` and then the name of the folder. If you need to go back one level then use
    `..`.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 打开VS Code并打开一个新的终端：“终端”->“新建终端”。然后使用Unix shell命令导航到你想要创建文件夹的位置。例如，使用`ls`列出当前目录下的所有文件夹，然后使用`cd`移动到其中一个文件夹，然后是文件夹的名称。如果你需要退回到上一级，则使用`..`。
- en: Once you are happy with where you are going to create this new folder, we can
    use `uv init` in the Terminal to do this, pressing “return/enter” afterwards (`cd`
    then moves to the new folder “shelter_usage”).
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你确定好创建新文件夹的位置，我们就可以在终端中使用`uv init`来完成这个操作，之后按“return/enter”键（然后`cd`命令将移动到新的文件夹“shelter_usage”）。
- en: '[PRE0]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '*By default, there will be a script in the example folder. We want to use `uv
    run` to run that script, which will then create an project environment for us.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '*默认情况下，示例文件夹中会有一个脚本。我们希望使用`uv run`来运行该脚本，这将为我们创建一个项目环境。'
- en: '[PRE1]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '*A project environment is specific to that project. We will use the package
    `numpy` to simulate data. We need to add this package to our environment with
    `uv add`.'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '*项目环境是特定于该项目的。我们将使用`numpy`包来模拟数据。我们需要使用`uv add`将此包添加到我们的环境中。'
- en: '[PRE2]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '*We can then modify `hello.py` to use `numpy` to simulate from the Normal distribution.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们可以修改`hello.py`以使用`numpy`从正态分布中进行模拟。'
- en: '[PRE3]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '*After we have modified and saved `hello.py` we can run it with `uv run` in
    exactly the same way as before.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '*在修改并保存`hello.py`之后，我们可以用`uv run`以与之前相同的方式运行它。'
- en: At this point we should close VS Code. We want to re-open it to make sure that
    our project environment is working as it needs to. In VS Code, a project is a
    self-contained folder. You can open a folder with “File” -> “Open Folder…” and
    then select the relevant folder, in this case “shelter_usage”. You should then
    be able to re-run `uv run hello.py` and it should work.****  ***### B.3.2 Plan
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，我们应该关闭VS Code。我们想要重新打开它以确保我们的项目环境按需工作。在VS Code中，项目是一个自包含的文件夹。你可以通过“文件”->“打开文件夹...”来打开一个文件夹，然后选择相关的文件夹，在这种情况下是“shelter_usage”。然后你应该能够重新运行`uv
    run hello.py`，并且它应该可以工作。
- en: We first used this dataset in [Chapter 2](02-drinking_from_a_fire_hose.html),
    but as a reminder, for each day, for each shelter, there is a number of people
    that used the shelter. So the dataset that we want to simulate is something like
    [Figure B.2 (a)](#fig-python_torontohomeless-data) and we are wanting to create
    a table of average daily number of occupied beds each month, along the lines of
    [Figure B.2 (b)](#fig-python_torontohomeless-table).
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先在[第二章](02-drinking_from_a_fire_hose.html)中使用了这个数据集，但为了提醒，对于每一天，对于每一个避难所，都有使用避难所的人数。因此，我们想要模拟的数据集类似于[图B.2(a)](#fig-python_torontohomeless-data)，并且我们希望创建一个表格，展示每个月的平均占用床位数，类似于[图B.2(b)](#fig-python_torontohomeless-table)。
- en: '![](../Images/3939adbb008f0078e02db44a6251a47e.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3939adbb008f0078e02db44a6251a47e.png)'
- en: (a) Quick sketch of a dataset
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: (a) 数据集的快速草图
- en: '![](../Images/140727b507e9582e8278c78cb69dbbb6.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/140727b507e9582e8278c78cb69dbbb6.png)'
- en: (b) Quick sketch of a table of the average number of beds occupied each month
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: (b) 每月占用床数的快速表格草图
- en: 'Figure B.2: Sketches of a dataset and table related shelter usage in Toronto'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图B.2：与多伦多避难所使用相关的数据集和表格草图
- en: B.3.3 Simulate
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.3.3 模拟
- en: We would like to more thoroughly simulate the dataset that we are interested
    in. We will use `polars` to provide a dataframe to store our simulated results,
    so we should add this to our environment with `uv add`.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 我们希望更彻底地模拟我们感兴趣的数据集。我们将使用`polars`提供一个dataframe来存储我们的模拟结果，因此我们应该使用`uv add`将其添加到我们的环境中。
- en: '[PRE4]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '*Create a new Python file called `00-simulate_data.py`.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '*创建一个名为`00-simulate_data.py`的新Python文件。'
- en: '[PRE5]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '*We would like to write tests based on this simulated data that we will then
    apply to our real data. We use `pydantic` to do this and so we should add this
    to our environment with `uv add`.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们希望基于这个模拟数据编写测试，然后将这些测试应用到我们的真实数据上。我们使用`pydantic`来完成这个任务，因此我们应该使用`uv add`将其添加到我们的环境中。'
- en: '[PRE6]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '*Create a new Python file called `00-test_simulated_data.py`. The first step
    is to define a subclass ``ShelterData` of `BaseModel` which comes from `pydantic`.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '*创建一个名为`00-test_simulated_data.py`的新Python文件。第一步是定义一个名为`ShelterData`的子类，它来自`pydantic`的`BaseModel`。'
- en: '[PRE7]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '*We are interested in testing that dates are valid, shelters have the correct
    type, and that capacity and usage are both non-negative integers. One additional
    wrinkle is that usage should not exceed capacity. To write a test for that we
    use a `field_validator`.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们感兴趣的是测试日期是否有效，庇护所的类型是否正确，以及容量和利用率都是非负整数。还有一个额外的细节是，利用率不应超过容量。为了编写这样的测试，我们使用`field_validator`。'
- en: We can then import our simulated dataset and test it.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以导入我们的模拟数据集并进行测试。
- en: '[PRE8]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '*To see what would have happened if there were an error we can consider a smaller
    dataset that contains two errors: one poorly formatted date and one situation
    where usage is above capacity.'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '*为了了解如果出现错误会发生什么，我们可以考虑一个包含两个错误的小数据集：一个格式错误的日期和一个利用率超过容量的情况。'
- en: '[PRE9]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '*We get the following message:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们得到以下信息：'
- en: '[PRE10]******  ***### B.3.4 Acquire'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE10]******  ***### B.3.4 获取'
- en: 'Using the same source as before: https://open.toronto.ca/dataset/daily-shelter-overnight-service-occupancy-capacity/'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 使用之前相同的来源：https://open.toronto.ca/dataset/daily-shelter-overnight-service-occupancy-capacity/
- en: '[PRE11]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '*We are likely only interested in a few columns and only rows where there are
    data.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们可能只对少数几列和有数据的行感兴趣。'
- en: '[PRE12]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '*We may then want to apply the tests to the real dataset'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们可能还想将测试应用到实际数据集上'
- en: '[PRE13]**  ***### B.3.5 Explore'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE13]**  ***### B.3.5 探索'
- en: Manipulate the data
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 操作数据
- en: '[PRE14]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '*Make a graph'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '*制作图表'
- en: '[PRE15]*  **### B.3.6 Share'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE15]*  **### B.3.6 分享'
- en: One nice aspect is that we can use Python in a Quarto document. To do this we
    need to add it to VS Code by installing the Quarto extension from [here](https://marketplace.visualstudio.com/items?itemName=quarto.quarto).
    You can render a document by running `quarto preview` in the terminal.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 一个很好的方面是，我们可以在Quarto文档中使用Python。为此，我们需要通过安装来自[这里](https://marketplace.visualstudio.com/items?itemName=quarto.quarto)的Quarto扩展将其添加到VS
    Code中。您可以通过在终端中运行`quarto preview`来渲染文档。
- en: VS Code is built by Microsoft which also owns GitHub. So we can add our account
    to VS Code by going to accounts and then signing in.***********  ***## B.4 Python
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: VS Code由微软构建，微软也拥有GitHub。因此，我们可以通过转到“账户”并登录来将我们的账户添加到VS Code中。***********  ***##
    B.4 Python
- en: For loops
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 循环
- en: List comprehensions
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 列推导式
- en: B.5 Making graphs
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.5 制作图表
- en: matplotlib
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: matplotlib
- en: seaborn
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: seaborn
- en: B.6 Exploring polars
  id: totrans-80
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.6 探索polars
- en: B.6.1 Importing data
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.6.1 导入数据
- en: B.6.2 Dataset manipulation with joins and pivots
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.6.2 使用连接和转置操作数据集
- en: B.6.3 String manipulation
  id: totrans-83
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.6.3 字符串操作
- en: B.6.4 Factor variables
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.6.4 因子变量
- en: B.7 Exercises
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.7 练习
- en: Practice
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习
- en: Quiz
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 测验
- en: Task
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 任务
- en: Free Replit “100 Days of Code” Python [course](https://replit.com/learn/100-days-of-python).
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: Free Replit “100 Days of Code” Python [课程](https://replit.com/learn/100-days-of-python)。
- en: Python Software Foundation. 2024\. *Python Language Reference, version 3.13.0*.
    [https://docs.python.org/3/index.html](https://docs.python.org/3/index.html).***
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: Python软件基金会。2024\. *Python语言参考，版本3.13.0*。[https://docs.python.org/3/index.html](https://docs.python.org/3/index.html)。***
