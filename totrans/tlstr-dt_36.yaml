- en: Online Appendix B — Python essentials
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://tellingstorieswithdata.com/21-python_essentials.html](https://tellingstorieswithdata.com/21-python_essentials.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Appendices](./20-r_essentials.html)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[B  Python essentials](./21-python_essentials.html)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Prerequisites**'
  prefs: []
  type: TYPE_NORMAL
- en: '**Key concepts and skills**'
  prefs: []
  type: TYPE_NORMAL
- en: '**Software and packages**'
  prefs: []
  type: TYPE_NORMAL
- en: '`Python` ([Python Software Foundation 2024](99-references.html#ref-python))'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`datetime>=5.5`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`uv`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`polars`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: B.1 Introduction
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '`Python` is a general-purpose programming language created by Guido van Rossum.
    `Python` version 0.9.0 was released in February 1991, and the current version,
    3.13, was released in October 2024\. It was named `Python` after *Monty Python’s
    Flying Circus*.'
  prefs: []
  type: TYPE_NORMAL
- en: '`Python` is a popular language in machine learning, but it was designed, and
    is more commonly used, for more general software applications. This means that
    we will especially rely on packages when we use Python for data science. This
    use of `Python` in this book is focused on data science, rather than the other,
    more general, uses for which it was developed.'
  prefs: []
  type: TYPE_NORMAL
- en: Knowing `R` will allow you to pick up `Python` for data science quickly. The
    main data science packages share the need to solve the same underlying problems.
  prefs: []
  type: TYPE_NORMAL
- en: B.2 Python, VS Code, and uv
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We could use `Python` within RStudio, but another option is to use what is used
    by the community more broadly, which is VS Code. You can download VS Code for
    free [here](https://code.visualstudio.com) and then install it. If you have difficulties
    with this, then in the same way we started with Posit Cloud and the shifted to
    our local machine, you could initially use Google Colab [here](https://colab.google).
  prefs: []
  type: TYPE_NORMAL
- en: 'Open VS Code ([Figure B.1 (a)](#fig-vscodesetup-a)), and open a new Terminal:
    Terminal -> New Terminal ([Figure B.1 (b)](#fig-vscodesetup-b)). We can then install
    `uv`, which is a Python package manager, by putting `curl -LsSf https://astral.sh/uv/install.sh
    | sh` into the Terminal and pressing “return/enter” afterwards ([Figure B.1 (c)](#fig-vscodesetup-c)).
    Finally, to install Python we can use `uv` by putting `uv python install` into
    that Terminal and pressing “return/enter” afterwards ([Figure B.1 (d)](#fig-vscodesetup-d)).'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8578396621a2311c740d7972064240a2.png)'
  prefs: []
  type: TYPE_IMG
- en: (a) Opening VS Code
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1c02b9d1b87599897cd93909488cb35f.png)'
  prefs: []
  type: TYPE_IMG
- en: (b) Opening a Terminal in VS Code
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7df187607f972b0ef3bb6cd315991a1c.png)'
  prefs: []
  type: TYPE_IMG
- en: (c) Install uv
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a4566e2734bf2eebe9e3359f77e94b7e.png)'
  prefs: []
  type: TYPE_IMG
- en: (d) Install Python
  prefs: []
  type: TYPE_NORMAL
- en: 'Figure B.1: Opening VS Code and a new terminal and then installing uv and Python'
  prefs: []
  type: TYPE_NORMAL
- en: B.3 Getting started
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: B.3.1 Project set-up
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We are going to get started with an example that downloads some data from Open
    Data Toronto. To start, we need to create a project, which will allow all our
    code to be self-contained.
  prefs: []
  type: TYPE_NORMAL
- en: 'Open VS Code and open a new Terminal: “Terminal” -> “New Terminal”. Then use
    Unix shell commands to navigate to where you want to create your folder. For instance,
    use `ls` to list all the folders in the current directory, then move to one using
    `cd` and then the name of the folder. If you need to go back one level then use
    `..`.'
  prefs: []
  type: TYPE_NORMAL
- en: Once you are happy with where you are going to create this new folder, we can
    use `uv init` in the Terminal to do this, pressing “return/enter” afterwards (`cd`
    then moves to the new folder “shelter_usage”).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '*By default, there will be a script in the example folder. We want to use `uv
    run` to run that script, which will then create an project environment for us.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '*A project environment is specific to that project. We will use the package
    `numpy` to simulate data. We need to add this package to our environment with
    `uv add`.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '*We can then modify `hello.py` to use `numpy` to simulate from the Normal distribution.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '*After we have modified and saved `hello.py` we can run it with `uv run` in
    exactly the same way as before.'
  prefs: []
  type: TYPE_NORMAL
- en: At this point we should close VS Code. We want to re-open it to make sure that
    our project environment is working as it needs to. In VS Code, a project is a
    self-contained folder. You can open a folder with “File” -> “Open Folder…” and
    then select the relevant folder, in this case “shelter_usage”. You should then
    be able to re-run `uv run hello.py` and it should work.****  ***### B.3.2 Plan
  prefs: []
  type: TYPE_NORMAL
- en: We first used this dataset in [Chapter 2](02-drinking_from_a_fire_hose.html),
    but as a reminder, for each day, for each shelter, there is a number of people
    that used the shelter. So the dataset that we want to simulate is something like
    [Figure B.2 (a)](#fig-python_torontohomeless-data) and we are wanting to create
    a table of average daily number of occupied beds each month, along the lines of
    [Figure B.2 (b)](#fig-python_torontohomeless-table).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3939adbb008f0078e02db44a6251a47e.png)'
  prefs: []
  type: TYPE_IMG
- en: (a) Quick sketch of a dataset
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/140727b507e9582e8278c78cb69dbbb6.png)'
  prefs: []
  type: TYPE_IMG
- en: (b) Quick sketch of a table of the average number of beds occupied each month
  prefs: []
  type: TYPE_NORMAL
- en: 'Figure B.2: Sketches of a dataset and table related shelter usage in Toronto'
  prefs: []
  type: TYPE_NORMAL
- en: B.3.3 Simulate
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We would like to more thoroughly simulate the dataset that we are interested
    in. We will use `polars` to provide a dataframe to store our simulated results,
    so we should add this to our environment with `uv add`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '*Create a new Python file called `00-simulate_data.py`.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '*We would like to write tests based on this simulated data that we will then
    apply to our real data. We use `pydantic` to do this and so we should add this
    to our environment with `uv add`.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '*Create a new Python file called `00-test_simulated_data.py`. The first step
    is to define a subclass ``ShelterData` of `BaseModel` which comes from `pydantic`.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '*We are interested in testing that dates are valid, shelters have the correct
    type, and that capacity and usage are both non-negative integers. One additional
    wrinkle is that usage should not exceed capacity. To write a test for that we
    use a `field_validator`.'
  prefs: []
  type: TYPE_NORMAL
- en: We can then import our simulated dataset and test it.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '*To see what would have happened if there were an error we can consider a smaller
    dataset that contains two errors: one poorly formatted date and one situation
    where usage is above capacity.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '*We get the following message:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]******  ***### B.3.4 Acquire'
  prefs: []
  type: TYPE_NORMAL
- en: 'Using the same source as before: https://open.toronto.ca/dataset/daily-shelter-overnight-service-occupancy-capacity/'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: '*We are likely only interested in a few columns and only rows where there are
    data.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: '*We may then want to apply the tests to the real dataset'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]**  ***### B.3.5 Explore'
  prefs: []
  type: TYPE_NORMAL
- en: Manipulate the data
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: '*Make a graph'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]*  **### B.3.6 Share'
  prefs: []
  type: TYPE_NORMAL
- en: One nice aspect is that we can use Python in a Quarto document. To do this we
    need to add it to VS Code by installing the Quarto extension from [here](https://marketplace.visualstudio.com/items?itemName=quarto.quarto).
    You can render a document by running `quarto preview` in the terminal.
  prefs: []
  type: TYPE_NORMAL
- en: VS Code is built by Microsoft which also owns GitHub. So we can add our account
    to VS Code by going to accounts and then signing in.***********  ***## B.4 Python
  prefs: []
  type: TYPE_NORMAL
- en: For loops
  prefs: []
  type: TYPE_NORMAL
- en: List comprehensions
  prefs: []
  type: TYPE_NORMAL
- en: B.5 Making graphs
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: matplotlib
  prefs: []
  type: TYPE_NORMAL
- en: seaborn
  prefs: []
  type: TYPE_NORMAL
- en: B.6 Exploring polars
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: B.6.1 Importing data
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: B.6.2 Dataset manipulation with joins and pivots
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: B.6.3 String manipulation
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: B.6.4 Factor variables
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: B.7 Exercises
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Practice
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Quiz
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Task
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Free Replit “100 Days of Code” Python [course](https://replit.com/learn/100-days-of-python).
  prefs: []
  type: TYPE_NORMAL
- en: Python Software Foundation. 2024\. *Python Language Reference, version 3.13.0*.
    [https://docs.python.org/3/index.html](https://docs.python.org/3/index.html).***
  prefs: []
  type: TYPE_NORMAL
