<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Chapter 8 Data Frames</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Chapter 8 Data Frames</h1>
<blockquote>原文：<a href="https://randpythonbook.netlify.app/data-frames">https://randpythonbook.netlify.app/data-frames</a></blockquote>
<div id="data-frames" class="section level1 hasAnchor">

<p>The rectangular array of information (e.g. an Excel spreadsheet ) is what many think of when they hear the word “data.” Each column contains elements of a shared data type, and these data types can vary from column to column.</p>
<p>There is a type for this in R and Python: a data frame. It might even be the most common way that data is stored in both R and Python programs because many functions that read in data from an external source return objects of this type (e.g. <code>read.csv()</code> in R and <code>pd.read_csv()</code> in Python).</p>
<p>R and Python’s data frames have a number of things in common:</p>
<ol style="list-style-type: decimal">
<li>each column must be the same length as all other columns,</li>
<li>each column’s elements will all have the same type,</li>
<li>elements in any rows can have different types,</li>
<li>columns and rows can be named in different ways,</li>
<li>there are many ways to get and set different subsets of data, and</li>
<li>when reading in data, the same sorts of difficulties arise in both languages.</li>
</ol>
<div id="data-frames-in-r" class="section level2 hasAnchor">
<h2><span class="header-section-number">8.1</span> Data Frames in R<a aria-label="Anchor link to header" class="anchor-section" href="/data-frames#data-frames-in-r"/></h2>
<p>Let’s consider as an example Fisher’s “Iris” data set <span class="citation">(Fisher <a href="#ref-misc_iris_53">1988</a>)</span> hosted by <span class="citation">(Dua and Graff <a href="#ref-uci_data">2017</a>)</span>. We will read this data set in from a comma separated file (more information on input/output can be found in chapter <a href="/input-and-output#input-and-output">9</a>). This file can be downloaded from this link: <a href="https://archive.ics.uci.edu/ml/datasets/iris">https://archive.ics.uci.edu/ml/datasets/iris</a>.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1">irisData &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"data/iris.csv"</span>, <span class="dt">header =</span> F)</a>
<a class="sourceLine" id="cb132-2" title="2"><span class="kw">head</span>(irisData, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb132-3" title="3"><span class="co">##    V1  V2  V3  V4          V5</span></a>
<a class="sourceLine" id="cb132-4" title="4"><span class="co">## 1 5.1 3.5 1.4 0.2 Iris-setosa</span></a>
<a class="sourceLine" id="cb132-5" title="5"><span class="co">## 2 4.9 3.0 1.4 0.2 Iris-setosa</span></a>
<a class="sourceLine" id="cb132-6" title="6"><span class="co">## 3 4.7 3.2 1.3 0.2 Iris-setosa</span></a>
<a class="sourceLine" id="cb132-7" title="7"><span class="kw">typeof</span>(irisData)</a>
<a class="sourceLine" id="cb132-8" title="8"><span class="co">## [1] "list"</span></a>
<a class="sourceLine" id="cb132-9" title="9"><span class="kw">class</span>(irisData) <span class="co"># we'll talk more about classes later</span></a>
<a class="sourceLine" id="cb132-10" title="10"><span class="co">## [1] "data.frame"</span></a>
<a class="sourceLine" id="cb132-11" title="11"><span class="kw">dim</span>(irisData)</a>
<a class="sourceLine" id="cb132-12" title="12"><span class="co">## [1] 150   5</span></a>
<a class="sourceLine" id="cb132-13" title="13"><span class="kw">nrow</span>(irisData)</a>
<a class="sourceLine" id="cb132-14" title="14"><span class="co">## [1] 150</span></a>
<a class="sourceLine" id="cb132-15" title="15"><span class="kw">ncol</span>(irisData)</a>
<a class="sourceLine" id="cb132-16" title="16"><span class="co">## [1] 5</span></a></code></pre></div>
<p>There are some exceptions, but most data sets can be stored as a <code>data.frame</code>. These kinds of two-dimensional data sets are quite common. Any particular row is often an observation on one experimental unit (e.g. person, place or thing). Looking at a particular column gives you one kind of measurement stored for all observations.</p>
<div class="rmd-caution">
<p>Do not rely on the default arguments of <code>read.csv()</code> or <code>read.table()</code>! After you read in a data frame, always check to make sure that</p>
<ol style="list-style-type: decimal">
<li>the number of columns is correct because the correct column <em>separator</em> was used (c.f. <code>sep=</code>),</li>
<li>column names were parsed correctly, if there were some in the raw text file,</li>
<li>the first row of data wasn’t used as a column name sequence, if there weren’t column names in the text file, and</li>
<li>the last few rows aren’t reading in empty spaces</li>
<li>character columns are read in correctly (c.f. <code>stringsAsFactors=</code>), and</li>
<li>special characters signifying missing data were correctly identified (c.f. <code>na.strings=</code>).</li>
</ol>
</div>
<p><a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Data-frame-objects">A <code>data.frame</code> is a special case of a <code>list</code></a>. Every element of the list is a column. Columns can be <code>vector</code>s or <code>factor</code>s, and they can all be of a different type. This is one of the biggest differences between data frames and <code>matrix</code>s. They are both two-dimensional, but a <code>matrix</code> needs elements to be all the same type. Unlike a general <code>list</code>, a <code>data.frame</code> requires all of its columns to have the same number of elements. In other words, the <code>data.frame</code> is not a “<em>ragged</em>” list.</p>
<p>Often times you will need to extract pieces of information from a <code>data.frame</code>. This can be done in many ways. If the columns have names, you can use the <code>$</code> operator to access a single column. Accessing a single column might be followed up by creating a new vector. You can also use the <code>[</code> operator to access multiple columns by name.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1"><span class="kw">colnames</span>(irisData) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"sepal.length"</span>, <span class="st">"sepal.width"</span>, </a>
<a class="sourceLine" id="cb133-2" title="2">                        <span class="st">"petal.length"</span>,<span class="st">"petal.width"</span>, </a>
<a class="sourceLine" id="cb133-3" title="3">                        <span class="st">"species"</span>)</a>
<a class="sourceLine" id="cb133-4" title="4">firstCol &lt;-<span class="st"> </span>irisData<span class="op">$</span>sepal.length</a>
<a class="sourceLine" id="cb133-5" title="5"><span class="kw">head</span>(firstCol)</a>
<a class="sourceLine" id="cb133-6" title="6"><span class="co">## [1] 5.1 4.9 4.7 4.6 5.0 5.4</span></a>
<a class="sourceLine" id="cb133-7" title="7">firstTwoCols &lt;-<span class="st"> </span>irisData[<span class="kw">c</span>(<span class="st">"sepal.length"</span>, <span class="st">"sepal.width"</span>)] </a>
<a class="sourceLine" id="cb133-8" title="8"><span class="kw">head</span>(firstTwoCols, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb133-9" title="9"><span class="co">##   sepal.length sepal.width</span></a>
<a class="sourceLine" id="cb133-10" title="10"><span class="co">## 1          5.1         3.5</span></a>
<a class="sourceLine" id="cb133-11" title="11"><span class="co">## 2          4.9         3.0</span></a>
<a class="sourceLine" id="cb133-12" title="12"><span class="co">## 3          4.7         3.2</span></a></code></pre></div>
<p>The <code>[</code> operator is also useful for selecting rows and columns by index numbers, or by some logical criteria.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1">topLeft &lt;-<span class="st"> </span>irisData[<span class="dv">1</span>,<span class="dv">1</span>] <span class="co"># first row, first col</span></a>
<a class="sourceLine" id="cb134-2" title="2">topLeft</a>
<a class="sourceLine" id="cb134-3" title="3"><span class="co">## [1] 5.1</span></a>
<a class="sourceLine" id="cb134-4" title="4">firstThreeRows &lt;-<span class="st"> </span>irisData[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,] <span class="co"># rows 1-3, all cols</span></a>
<a class="sourceLine" id="cb134-5" title="5">firstThreeRows</a>
<a class="sourceLine" id="cb134-6" title="6"><span class="co">##   sepal.length sepal.width petal.length petal.width     species</span></a>
<a class="sourceLine" id="cb134-7" title="7"><span class="co">## 1          5.1         3.5          1.4         0.2 Iris-setosa</span></a>
<a class="sourceLine" id="cb134-8" title="8"><span class="co">## 2          4.9         3.0          1.4         0.2 Iris-setosa</span></a>
<a class="sourceLine" id="cb134-9" title="9"><span class="co">## 3          4.7         3.2          1.3         0.2 Iris-setosa</span></a>
<a class="sourceLine" id="cb134-10" title="10"><span class="co"># rows where species column is setosa</span></a>
<a class="sourceLine" id="cb134-11" title="11">setosaOnly &lt;-<span class="st"> </span>irisData[irisData<span class="op">$</span>species <span class="op">==</span><span class="st"> "Iris-setosa"</span>,] </a>
<a class="sourceLine" id="cb134-12" title="12">setosaOnly[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb134-13" title="13"><span class="co">##   sepal.width petal.length petal.width     species</span></a>
<a class="sourceLine" id="cb134-14" title="14"><span class="co">## 1         3.5          1.4         0.2 Iris-setosa</span></a>
<a class="sourceLine" id="cb134-15" title="15"><span class="co">## 2         3.0          1.4         0.2 Iris-setosa</span></a>
<a class="sourceLine" id="cb134-16" title="16"><span class="co">## 3         3.2          1.3         0.2 Iris-setosa</span></a></code></pre></div>
<p>In the code above, <code>irisData$species == "Iris-setosa"</code> creates a logical vector (try it!) using the vectorized <code>==</code> operator. The <code>[</code> operator selects the rows for which the corresponding element of this logical vector is <code>TRUE</code>.</p>
<div class="rmd-details">
<p>Be careful: depending on how you use the square brackets, you can either get a <code>data.frame</code> or a <code>vector.</code> As an example, try both <code>class(irisData[,1])</code> and <code>class(irisData[,c(1,2)])</code>.</p>
</div>
<p>In R, <code>data.frame</code>s might have row names. You can get and set this character <code>vector</code> with the <code>rownames()</code> function. You can access rows by name using the square bracket operator.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1"><span class="kw">head</span>(<span class="kw">rownames</span>(irisData))</a>
<a class="sourceLine" id="cb135-2" title="2"><span class="co">## [1] "1" "2" "3" "4" "5" "6"</span></a>
<a class="sourceLine" id="cb135-3" title="3"><span class="kw">rownames</span>(irisData) &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">rownames</span>(irisData)) <span class="op">+</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb135-4" title="4"><span class="kw">head</span>(<span class="kw">rownames</span>(irisData))</a>
<a class="sourceLine" id="cb135-5" title="5"><span class="co">## [1] "1001" "1002" "1003" "1004" "1005" "1006"</span></a>
<a class="sourceLine" id="cb135-6" title="6">irisData[<span class="st">"1002"</span>,]</a>
<a class="sourceLine" id="cb135-7" title="7"><span class="co">##      sepal.length sepal.width petal.length petal.width     species</span></a>
<a class="sourceLine" id="cb135-8" title="8"><span class="co">## 1002          4.9           3          1.4         0.2 Iris-setosa</span></a></code></pre></div>
<p>Code that modifies data usually looks quite similar to code extracting data. You’ll notice a lot of the same symbols (e.g. <code>$</code>, <code>[</code>, etc.), but the (<code>&lt;-</code>) will point in the other direction.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1">irisData<span class="op">$</span>columnOfOnes &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(irisData))</a>
<a class="sourceLine" id="cb136-2" title="2">irisData[,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NULL</span> <span class="co">#delete first col</span></a>
<a class="sourceLine" id="cb136-3" title="3">irisData[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">2</span>, <span class="dt">mean =</span> <span class="dv">999</span>)</a>
<a class="sourceLine" id="cb136-4" title="4">irisData[,<span class="st">'sepal.width'</span>] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="kw">nrow</span>(irisData), <span class="dt">mean =</span> <span class="dv">-999</span>)</a>
<a class="sourceLine" id="cb136-5" title="5">irisData[irisData<span class="op">$</span>species <span class="op">==</span><span class="st"> "Iris-setosa"</span>, <span class="st">'species'</span>] &lt;-<span class="st"> "SETOSA!"</span></a>
<a class="sourceLine" id="cb136-6" title="6"><span class="kw">head</span>(irisData, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb136-7" title="7"><span class="co">##      sepal.width petal.length petal.width species columnOfOnes</span></a>
<a class="sourceLine" id="cb136-8" title="8"><span class="co">## 1001   -998.9036          1.4         0.2 SETOSA!            1</span></a>
<a class="sourceLine" id="cb136-9" title="9"><span class="co">## 1002   -997.3385          1.4         0.2 SETOSA!            1</span></a>
<a class="sourceLine" id="cb136-10" title="10"><span class="co">## 1003   -999.6752          1.3         0.2 SETOSA!            1</span></a></code></pre></div>
</div>
<div id="data-frames-in-python" class="section level2 hasAnchor">
<h2><span class="header-section-number">8.2</span> Data Frames in Python<a aria-label="Anchor link to header" class="anchor-section" href="/data-frames#data-frames-in-python"/></h2>
<p>The Pandas library in Python has data frames that are modeled after R’s <span class="citation">(McKinney <a href="#ref-pandas_guy">2017</a>)</span>.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb137-1" title="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb137-2" title="2">iris_data <span class="op">=</span> pd.read_csv(<span class="st">"data/iris.csv"</span>, header <span class="op">=</span> <span class="va">None</span>)</a>
<a class="sourceLine" id="cb137-3" title="3">iris_data.head(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb137-4" title="4"><span class="co">##      0    1    2    3            4</span></a>
<a class="sourceLine" id="cb137-5" title="5"><span class="co">## 0  5.1  3.5  1.4  0.2  Iris-setosa</span></a>
<a class="sourceLine" id="cb137-6" title="6"><span class="co">## 1  4.9  3.0  1.4  0.2  Iris-setosa</span></a>
<a class="sourceLine" id="cb137-7" title="7"><span class="co">## 2  4.7  3.2  1.3  0.2  Iris-setosa</span></a>
<a class="sourceLine" id="cb137-8" title="8">iris_data.shape</a>
<a class="sourceLine" id="cb137-9" title="9"><span class="co">## (150, 5)</span></a>
<a class="sourceLine" id="cb137-10" title="10"><span class="bu">len</span>(iris_data) <span class="co"># num rows</span></a>
<a class="sourceLine" id="cb137-11" title="11"><span class="co">## 150</span></a>
<a class="sourceLine" id="cb137-12" title="12"><span class="bu">len</span>(iris_data.columns) <span class="co"># num columns</span></a>
<a class="sourceLine" id="cb137-13" title="13"><span class="co">## 5</span></a>
<a class="sourceLine" id="cb137-14" title="14"><span class="bu">list</span>(iris_data.dtypes)[:<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb137-15" title="15"><span class="co">## [dtype('float64'), dtype('float64'), dtype('float64')]</span></a>
<a class="sourceLine" id="cb137-16" title="16"><span class="bu">list</span>(iris_data.dtypes)[<span class="dv">3</span>:]</a>
<a class="sourceLine" id="cb137-17" title="17"><span class="co">## [dtype('float64'), dtype('O')]</span></a></code></pre></div>
<p>The structure is very similar to that of R’s data frame. It’s two dimensional, and you can <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html">access columns and rows by name or number.</a> Each column is a <code>Series</code> object, and each column can have a different <code>dtype</code>, which is analogous to R’s situation. Again, because the elements need to be the same type along columns only, this is a big difference between 2-d Numpy <code>ndarray</code>s and <code>DataFrame</code>s (c.f. R’s <code>matrix</code> versus R’s <code>data.frame</code>).</p>
<div class="rmd-caution">
<p>Again, do not rely on the default arguments of <code>pd.read_csv()</code>! After you read in a data set, always check that</p>
<ol style="list-style-type: decimal">
<li>the number of columns is correct because the correct column <em>separator</em> was used (c.f. <code>sep=</code>),</li>
<li>column names were parsed correctly, if there were some in the raw text file,</li>
<li>the first row of data wasn’t used as a column name sequence, if there weren’t column names in the text file (c.f. <code>header=</code>), and</li>
<li>the last few rows aren’t reading in empty spaces</li>
<li>character columns are read in correctly (c.f. <code>dtype=</code>), and</li>
<li>special characters signifying missing data were correctly identified (c.f. <code>na.values=</code>).</li>
</ol>
</div>
<p>Square brackets are a little different in Python than they are in R. Just like in R, you can access columns by name with square brackets, and you can also access rows. Unlike R, though, you don’t have to specify both rows and columns every time you use the square brackets.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb138-1" title="1">iris_data.columns <span class="op">=</span> [<span class="st">"sepal.length"</span>, <span class="st">"sepal.width"</span>, <span class="st">"petal.length"</span>, </a>
<a class="sourceLine" id="cb138-2" title="2">                      <span class="st">"petal.width"</span>, <span class="st">"species"</span>]</a>
<a class="sourceLine" id="cb138-3" title="3">first_col <span class="op">=</span> iris_data[<span class="st">'sepal.length'</span>]</a>
<a class="sourceLine" id="cb138-4" title="4">first_col.head()</a>
<a class="sourceLine" id="cb138-5" title="5"><span class="co">## 0    5.1</span></a>
<a class="sourceLine" id="cb138-6" title="6"><span class="co">## 1    4.9</span></a>
<a class="sourceLine" id="cb138-7" title="7"><span class="co">## 2    4.7</span></a>
<a class="sourceLine" id="cb138-8" title="8"><span class="co">## 3    4.6</span></a>
<a class="sourceLine" id="cb138-9" title="9"><span class="co">## 4    5.0</span></a>
<a class="sourceLine" id="cb138-10" title="10"><span class="co">## Name: sepal.length, dtype: float64</span></a>
<a class="sourceLine" id="cb138-11" title="11">first_two_cols <span class="op">=</span> iris_data[[<span class="st">"sepal.length"</span>, <span class="st">"sepal.width"</span>]]</a>
<a class="sourceLine" id="cb138-12" title="12">first_two_cols.head(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb138-13" title="13"><span class="co">##    sepal.length  sepal.width</span></a>
<a class="sourceLine" id="cb138-14" title="14"><span class="co">## 0           5.1          3.5</span></a>
<a class="sourceLine" id="cb138-15" title="15"><span class="co">## 1           4.9          3.0</span></a>
<a class="sourceLine" id="cb138-16" title="16"><span class="co">## 2           4.7          3.2</span></a></code></pre></div>
<div class="rmd-details">
<p>Notice that <code>iris_data['sepal.length']</code> returns a <code>Series</code> and <code>iris_data[["sepal.length", "sepal.width"]]</code> returns a Pandas <code>DataFrame</code>. This behavior is similar to what happened in R. For more details, click <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/dsintro.html#indexing-selection">here</a>.</p>
</div>
<p>You can select columns and rows by number with the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.iloc.html"><code>.iloc</code> method</a>. <code>iloc</code> is (probably) short for “integer location.”</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb139-1" title="1"><span class="co"># specify rows/cols by number</span></a>
<a class="sourceLine" id="cb139-2" title="2">top_left <span class="op">=</span> iris_data.iloc[<span class="dv">0</span>,<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb139-3" title="3">top_left</a>
<a class="sourceLine" id="cb139-4" title="4"><span class="co">## 5.1</span></a>
<a class="sourceLine" id="cb139-5" title="5">first_three_rows_without_last_col <span class="op">=</span> iris_data.iloc[:<span class="dv">3</span>,:<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb139-6" title="6">first_three_rows_without_last_col</a>
<a class="sourceLine" id="cb139-7" title="7"><span class="co">##    sepal.length  sepal.width  petal.length  petal.width</span></a>
<a class="sourceLine" id="cb139-8" title="8"><span class="co">## 0           5.1          3.5           1.4          0.2</span></a>
<a class="sourceLine" id="cb139-9" title="9"><span class="co">## 1           4.9          3.0           1.4          0.2</span></a>
<a class="sourceLine" id="cb139-10" title="10"><span class="co">## 2           4.7          3.2           1.3          0.2</span></a></code></pre></div>
<p>Selecting columns by anything besides integer number can be done with the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.loc.html"><code>.loc()</code> method</a>. You should generally prefer this method to access columns because accessing things by <em>name</em> instead of <em>number</em> is more readable. Here are some examples.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb140-1" title="1">sepal_w_to_pedal_w <span class="op">=</span> iris_data.loc[:,<span class="st">'sepal.width'</span>:<span class="st">'petal.width'</span>]</a>
<a class="sourceLine" id="cb140-2" title="2">sepal_w_to_pedal_w.head()</a>
<a class="sourceLine" id="cb140-3" title="3"><span class="co">##    sepal.width  petal.length  petal.width</span></a>
<a class="sourceLine" id="cb140-4" title="4"><span class="co">## 0          3.5           1.4          0.2</span></a>
<a class="sourceLine" id="cb140-5" title="5"><span class="co">## 1          3.0           1.4          0.2</span></a>
<a class="sourceLine" id="cb140-6" title="6"><span class="co">## 2          3.2           1.3          0.2</span></a>
<a class="sourceLine" id="cb140-7" title="7"><span class="co">## 3          3.1           1.5          0.2</span></a>
<a class="sourceLine" id="cb140-8" title="8"><span class="co">## 4          3.6           1.4          0.2</span></a>
<a class="sourceLine" id="cb140-9" title="9">setosa_only <span class="op">=</span> iris_data.loc[iris_data[<span class="st">'species'</span>] <span class="op">==</span> <span class="st">"Iris-setosa"</span>,]</a>
<a class="sourceLine" id="cb140-10" title="10"><span class="co"># don't need the redundant column anymore</span></a>
<a class="sourceLine" id="cb140-11" title="11"><span class="kw">del</span> setosa_only[<span class="st">'species'</span>]</a>
<a class="sourceLine" id="cb140-12" title="12">setosa_only.head(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb140-13" title="13"><span class="co">##    sepal.length  sepal.width  petal.length  petal.width</span></a>
<a class="sourceLine" id="cb140-14" title="14"><span class="co">## 0           5.1          3.5           1.4          0.2</span></a>
<a class="sourceLine" id="cb140-15" title="15"><span class="co">## 1           4.9          3.0           1.4          0.2</span></a>
<a class="sourceLine" id="cb140-16" title="16"><span class="co">## 2           4.7          3.2           1.3          0.2</span></a></code></pre></div>
<p>Notice we used a <code>slice</code> (i.e. <code>'sepal.width':'pedal.width'</code>) to access many columns by only referring to the left-most and the right-most. Unlike slicing with numbers, <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#slicing-ranges">the right end is included</a>. Also note that this does not work with the regular square bracket operator (i.e. <code>iris_data['sepal.width':'pedal.width']</code>). The second example filters out the rows where the <code>"species"</code> column elements are equal to <code>"Iris-setosa"</code>.</p>
<p>Each <code>DataFrame</code> in Pandas comes with an <code>.index</code> attribute. This is analogous to a row name in R, but it’s much more flexible because the index can take on a variety of types. This can help us highlight the difference between <code>.loc</code> and <code>.iloc</code>. Recall that <code>.loc</code> was <em>label-based selection.</em> Labels don’t necessarily have to be strings. Consider the following example.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb141-1" title="1">iris_data.index</a>
<a class="sourceLine" id="cb141-2" title="2"><span class="co"># reverse the index</span></a>
<a class="sourceLine" id="cb141-3" title="3"><span class="co">## RangeIndex(start=0, stop=150, step=1)</span></a>
<a class="sourceLine" id="cb141-4" title="4">iris_data <span class="op">=</span> iris_data.set_index(iris_data.index[::<span class="op">-</span><span class="dv">1</span>]) </a>
<a class="sourceLine" id="cb141-5" title="5">iris_data.iloc[<span class="op">-</span><span class="dv">2</span>:,:<span class="dv">3</span>] <span class="co"># top is now bottom</span></a>
<a class="sourceLine" id="cb141-6" title="6"><span class="co">##    sepal.length  sepal.width  petal.length</span></a>
<a class="sourceLine" id="cb141-7" title="7"><span class="co">## 1           6.2          3.4           5.4</span></a>
<a class="sourceLine" id="cb141-8" title="8"><span class="co">## 0           5.9          3.0           5.1</span></a>
<a class="sourceLine" id="cb141-9" title="9">iris_data.loc[<span class="dv">0</span>] <span class="co"># last row has 0 index</span></a>
<a class="sourceLine" id="cb141-10" title="10"><span class="co">## sepal.length               5.9</span></a>
<a class="sourceLine" id="cb141-11" title="11"><span class="co">## sepal.width                  3</span></a>
<a class="sourceLine" id="cb141-12" title="12"><span class="co">## petal.length               5.1</span></a>
<a class="sourceLine" id="cb141-13" title="13"><span class="co">## petal.width                1.8</span></a>
<a class="sourceLine" id="cb141-14" title="14"><span class="co">## species         Iris-virginica</span></a>
<a class="sourceLine" id="cb141-15" title="15"><span class="co">## Name: 0, dtype: object</span></a>
<a class="sourceLine" id="cb141-16" title="16">iris_data.iloc[<span class="dv">0</span>] <span class="co"># first row with big index </span></a>
<a class="sourceLine" id="cb141-17" title="17"><span class="co">## sepal.length            5.1</span></a>
<a class="sourceLine" id="cb141-18" title="18"><span class="co">## sepal.width             3.5</span></a>
<a class="sourceLine" id="cb141-19" title="19"><span class="co">## petal.length            1.4</span></a>
<a class="sourceLine" id="cb141-20" title="20"><span class="co">## petal.width             0.2</span></a>
<a class="sourceLine" id="cb141-21" title="21"><span class="co">## species         Iris-setosa</span></a>
<a class="sourceLine" id="cb141-22" title="22"><span class="co">## Name: 149, dtype: object</span></a></code></pre></div>
<p><code>iris_data.loc[0]</code> selects the <code>0</code>th index. The second line reversed the indexes, so this is actually the last row. If you want the first row, use <code>iris_data.iloc[0]</code>.</p>
<!-- [`DataFrame`s have a huge amount  many useful attributes and methods, too.](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#) -->
<p>Modifying data inside a data frame looks quite similar to extracting data. You’ll recognize a lot of the methods mentioned earlier.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb142-1" title="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb142-2" title="2">n_rows <span class="op">=</span> iris_data.shape[<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb142-3" title="3">iris_data[<span class="st">'col_ones'</span>] <span class="op">=</span> np.repeat(<span class="fl">1.0</span>, n_rows)</a>
<a class="sourceLine" id="cb142-4" title="4">iris_data.iloc[:<span class="dv">2</span>,<span class="dv">0</span>] <span class="op">=</span>  np.random.normal(loc<span class="op">=</span><span class="dv">999</span>, size<span class="op">=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb142-5" title="5">rand_nums <span class="op">=</span> np.random.normal(loc<span class="op">=-</span><span class="dv">999</span>, size<span class="op">=</span>n_rows)</a>
<a class="sourceLine" id="cb142-6" title="6">iris_data.loc[:,<span class="st">'sepal.width'</span>] <span class="op">=</span> rand_nums</a>
<a class="sourceLine" id="cb142-7" title="7">setosa_rows <span class="op">=</span> iris_data[<span class="st">'species'</span>] <span class="op">==</span> <span class="st">"Iris-setosa"</span></a>
<a class="sourceLine" id="cb142-8" title="8">iris_data.loc[setosa_rows, <span class="st">'species'</span>] <span class="op">=</span> <span class="st">"SETOSA!"</span></a>
<a class="sourceLine" id="cb142-9" title="9"><span class="kw">del</span> iris_data[<span class="st">'petal.length'</span>]</a>
<a class="sourceLine" id="cb142-10" title="10">iris_data.head(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb142-11" title="11"><span class="co">##      sepal.length  sepal.width  petal.width  species  col_ones</span></a>
<a class="sourceLine" id="cb142-12" title="12"><span class="co">## 149    999.146739  -998.446586          0.2  SETOSA!       1.0</span></a>
<a class="sourceLine" id="cb142-13" title="13"><span class="co">## 148    998.005821  -999.015224          0.2  SETOSA!       1.0</span></a>
<a class="sourceLine" id="cb142-14" title="14"><span class="co">## 147      4.700000  -999.803985          0.2  SETOSA!       1.0</span></a></code></pre></div>
<p>You can also use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.assign.html"><code>.assign()</code> method</a> to create a new column. This method does not modify the data frame in place. It returns a new <code>DataFrame</code> with the additional column.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb143-1" title="1">iris_data <span class="op">=</span> iris_data.assign(new_col_name <span class="op">=</span> np.arange(n_rows))</a>
<a class="sourceLine" id="cb143-2" title="2"><span class="kw">del</span> iris_data[<span class="st">'sepal.length'</span>]</a>
<a class="sourceLine" id="cb143-3" title="3">iris_data.head(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb143-4" title="4"><span class="co">##      sepal.width  petal.width  species  col_ones  new_col_name</span></a>
<a class="sourceLine" id="cb143-5" title="5"><span class="co">## 149  -998.446586          0.2  SETOSA!       1.0             0</span></a>
<a class="sourceLine" id="cb143-6" title="6"><span class="co">## 148  -999.015224          0.2  SETOSA!       1.0             1</span></a>
<a class="sourceLine" id="cb143-7" title="7"><span class="co">## 147  -999.803985          0.2  SETOSA!       1.0             2</span></a></code></pre></div>
<div class="rmd-caution">
<p>Above we were assigning Numpy arrays to columns of a <code>DataFrame</code>. Be careful when you’re assigning <code>Series</code> objects. You’ll see in the documentation that <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#basics">“Pandas aligns all AXES when setting Series and <code>DataFrame</code> from <code>.loc</code>, and <code>.iloc</code>.”</a>.</p>
</div>
</div>
<div id="exercises-6" class="section level2 hasAnchor">
<h2><span class="header-section-number">8.3</span> Exercises<a aria-label="Anchor link to header" class="anchor-section" href="/data-frames#exercises-6"/></h2>
<div id="r-questions-6" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.3.1</span> R Questions<a aria-label="Anchor link to header" class="anchor-section" href="/data-frames#r-questions-6"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>Consider the data set <code>"original_rt_snippets.txt"</code> <span class="citation">(Socher et al. <a href="#ref-SocherEtAl2013:RNTN">2013</a>)</span>, which is hosted by <span class="citation">(Dua and Graff <a href="#ref-uci_data">2017</a>)</span>. We will calculate the <em>term frequency-inverse document frequency statistics</em> <span class="citation">(Jones <a href="#ref-Jones72astatistical">1972</a>)</span> on this data set, which is a common data transformation technique used in text mining and natural language processing. You may use the <code>stringr</code> library for this question, if you wish.</p>
<ol style="list-style-type: lower-alpha">
<li>read in this data set as a <code>vector</code> and call it <code>corpus</code>.</li>
<li>create a <code>vector</code> called <code>dictionary</code> that contains the following phrases: “charming”,“fantasy”, “hate”, and “boring”.</li>
<li>Construct a <code>data.frame</code> with four columns called <code>bagOfWords</code> that contains the number of appearances of each word in the dictionary. Match the exact phrases. For simplicity, don’t worry about the case of letters or using regular expressions (c.f. section <a href="/r-vectors-versus-numpy-arrays-and-pandas-series#an-introduction-to-regular-expressions">3.9</a>). Label the columns of this <code>data.frame</code> with the phrases you’re searching for. Try to write code that is easy to modify if you decide to change the set of phrases in your dictionary.</li>
<li>Create a <code>data.frame</code> with four columns called <code>termFrequency</code>. Each element should correspond with the count from the previous <code>data.frame</code>. Instead of the count, each element should be <span class="math inline">\(\log(1 + \text{count})\)</span>.</li>
<li>Create a <code>vector</code> of length four called <code>invDocFrequency</code>. The inverse document frequency formula for any term <span class="math inline">\(t\)</span> is <span class="math inline">\(\log([\text{number of documents in corpus}])\)</span> minus <span class="math inline">\(\log([\text{number of documents that contain term } t])\)</span>. Make sure the names of this vector are the same as the words in the dictionary.</li>
<li>Create a <code>data.frame</code> called <code>tfidf</code> (short for “term frequency-inverse document frequency”). For row/document <span class="math inline">\(d\)</span>, and column/term <span class="math inline">\(t\)</span>, the formula is the product: <span class="math inline">\([\text{term frequency of term } t \text{ and document } d ] \times [\text{inverse doc. freq. of term } t]\)</span>.</li>
<li>Extract the elements of <code>corpus</code> that have at least one nonzero element in the corresponding row of <code>tfidf</code>. Call the <code>vector</code> <code>informativeDocuments</code>.</li>
<li>Do you see any documents that were labeled as informative, that do not actually contain the words you searched for?</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<p><code>mtcars</code> is a data set that is built into R, so you don’t need to read it in. You can read more about it by typing <code>?datasets::mtcars</code>.</p>
<ol style="list-style-type: lower-alpha">
<li>Create a new <code>data.frame</code> called <code>withoutDisp</code> that is the same as <code>mtcars</code>, but has its <code>disp</code> column removed.</li>
<li>Create a new column for <code>withoutDisp</code> called <code>coolnessScore</code>. The formula is <span class="math inline">\(\frac{1}{\text{mpg}} + \text{quarter mile time}\)</span>.</li>
<li>Create a new <code>data.frame</code> called <code>sortedWD</code> that is equal to <code>withoutDisp</code>, but sorted in descending order by the coolness score.</li>
<li>Create a new <code>data.frame</code> from <code>sortedWD</code> called <code>specialRows</code> that keeps only rows where <span class="math inline">\(\text{weight (1000lbs)} + \text{rear axle ratio} &lt; 7\)</span></li>
<li>Calculate the percent reduction in number of rows, going from <code>sortedWD</code> to <code>specialRows</code>. Call it <code>percReduction</code>. Make sure it is between <span class="math inline">\(0\)</span> and <span class="math inline">\(100\)</span>.</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li/>
</ol>
<p>This question investigates the <a href="https://www.zillow.com/research/data/"><em>Zillow Home Value Index (ZHVI)</em></a> for single family homes.</p>
<ol style="list-style-type: lower-alpha">
<li>read in <code>"Zip_zhvi_uc_sfr_tier_0.33_0.67_sm_sa_month.csv"</code>. Call the <code>data.frame</code> <code>homeData</code>. Remember to be careful with file paths. Also, when looking at the data set with a text editor, be sure that “word wrap” is not turned on.</li>
<li>Extract the rows of <code>homeData</code> that correspond with Charlottesville, VA, and assign them as a <code>data.frame</code> to the variable <code>cvilleData</code></li>
<li>Assign all the unique zip codes to a <code>character vector</code> called <code>cvilleZips</code>.</li>
<li>Extract the columns of <code>cvilleData</code> that correspond with home prices, and transpose them so that each row of the result corresponds with a different month. Call this new <code>data.frame</code> <code>timeSeriesData</code>. Also, make sure that the column names of this new <code>data.frame</code> are set equal to the appropriate zip codes.</li>
<li>Write a function called <code>getAveMonthlyChange</code> that takes in a numeric <code>vector</code>, and returns the average change. Your function should not return an <code>NA</code>, so be sure to deal with <code>NA</code>s appropriately.</li>
<li>Calculate the average monthly price change for each zip code. Store your results in a <code>vector</code> called <code>aveMonthlyChanges</code>. Make sure this <code>vector</code> has named elements so one can extract elements by zip code.</li>
</ol>
</div>
<div id="python-questions-6" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.3.2</span> Python Questions<a aria-label="Anchor link to header" class="anchor-section" href="/data-frames#python-questions-6"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>This question deals with looking at historical prices of the S&amp;P500 Index. This data was downloaded from <a href="https://finance.yahoo.com">https://finance.yahoo.com</a> <span class="citation">(“GSPC Data” <a href="#ref-gspc_data">2021</a>)</span>. It contains prices starting from “2007-01-03” and going until “2021-10-01”.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data file <code>"gspc.csv"</code> as a <code>data.frame</code> and call the variable <code>gspc</code>.</li>
<li>Use <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.set_index.html"><code>.set_index()</code></a> to change the index of <code>gspc</code> to its <code>"Index"</code> column. Store the new <code>DataFrame</code> as <code>gspc_good_idx</code>.</li>
<li>Recall the formula for <em>log returns</em> provided in exercises of chapter <a href="/r-vectors-versus-numpy-arrays-and-pandas-series#r-vectors-versus-numpy-arrays-and-pandas-series">3</a>. Add a column to <code>gspc_good_idx</code> called <code>log_returns</code>. Calculate them from the column <code>GSPC.Adjusted</code>. Make sure to scale them by <span class="math inline">\(100\)</span> and put an <code>np.nan</code> in the first element where you don’t have a return.</li>
<li>Extract all the returns that are available for the year 2021, and store them as a <code>Series</code> called <code>this_year_returns</code>.</li>
<li>Add a column to <code>gspc_good_idx</code> containing the <em>drawdown</em> time series. Call this column <code>drawdown</code>. To calculate drawdown at a given date, subtract that date’s price from the running maximum price that is current at that date. Use only adjusted close prices for this calculation.<br/>
</li>
<li>Add a column to <code>gspc_good_idx</code> containing the percent drawdown time series. Call this column <code>perc_drawdown</code>. Use the previous column, but make this number a percent of the corresponding running maximum.</li>
<li>What is the maximum drawdown of this time series? Store it as a percent in the value <code>mdd</code>.</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<p>In this question we’ll look at <a href="https://www.tensorflow.org/datasets/catalog/radon">some data on radon measurements</a> <span class="citation">(Gelman and Hill <a href="#ref-GelmanHill:2007">2007</a>)</span>. Instead of reading in a text file, we will load the data into Python using the <a href="https://www.tensorflow.org/datasets"><code>tensorflow_datasets</code> module</a> <span class="citation">(“TensorFlow Datasets, a Collection of Ready-to-Use Datasets” <a href="#ref-TFDS">2021</a>)</span>.</p>
<p>Please include the following code in your submission.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb144-1" title="1"><span class="im">import</span> tensorflow_datasets <span class="im">as</span> tfds</a>
<a class="sourceLine" id="cb144-2" title="2"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb144-3" title="3"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb144-4" title="4">d <span class="op">=</span> tfds.load(<span class="st">"radon"</span>)</a>
<a class="sourceLine" id="cb144-5" title="5">d <span class="op">=</span> pd.DataFrame(tfds.as_dataframe(d[<span class="st">'train'</span>]))</a></code></pre></div>
<p>Many of you will need to install <code>tensorflow</code> and <code>tensorflow_datasets</code> before you’re able to <code>import</code> it. If that’s so, please read section <a href="/using-third-party-code#installing-packages-in-python">10.2</a> for more information on how to install packages.</p>
<ol style="list-style-type: lower-alpha">
<li>Assign to <code>worst_row</code> the row of <code>d</code> that is associated the highest recorded level of radon. Make sure it a <code>DataFrame</code>.</li>
<li>Assign to <code>nrows</code> and <code>ncols</code> the number of rows and columns of <code>d</code>, respectively.</li>
<li>Assign the most common column data type to <code>most_common_dtype</code>. Make sure the variable is of type <code>numpy.dtype</code></li>
<li>Are there any observations from Virginia in this data set? If so, assign <code>True</code> to <code>any_va</code>. Otherwise assign <code>False</code>.</li>
<li>Create a new column in <code>d</code> called <code>dist_from_cville</code>. Use the <strong>Haversine formula</strong> to calculate distance between each row and the University of Virginia, in kilometers.
<ul>
<li>Assume the University of Virginia is at 38.0336<span class="math inline">\(^\circ\)</span> N, 78.5080<span class="math inline">\(^\circ\)</span>W</li>
<li>Assume the Earth’s radius <span class="math inline">\(r = 6378.137\)</span> kilometers.</li>
<li>The formula for distance between <span class="math inline">\((\lambda_1, \phi_1)\)</span> (signed longitude in radians, signed latitude in radians) and <span class="math inline">\((\lambda_2, \phi_2)\)</span> is</li>
</ul>
<span class="math display">\[\begin{equation}
 2 \hspace{1mm} r \hspace{1mm} \text{arcsin}\left( \sqrt{ \sin^2\left( \frac{\phi_2 - \phi_1}{2}\right)  + \cos(\phi_1)\cos(\phi_2) \sin^2\left( \frac{\lambda_2 - \lambda_1}{2} \right)  } \right)
 \end{equation}\]</span></li>
<li>What is the average radon measurement between all measurements taken at the place that is closest to where we are now? Assign your answer as a <code>float</code> to <code>close_ave</code></li>
</ol>

</div>
</div>
</div>



<h3>References</h3>
<div id="refs" class="references">
<div id="ref-uci_data">
<p>Dua, Dheeru, and Casey Graff. 2017. “UCI Machine Learning Repository.” University of California, Irvine, School of Information; Computer Sciences. <a href="http://archive.ics.uci.edu/ml">http://archive.ics.uci.edu/ml</a>.</p>
</div>
<div id="ref-misc_iris_53">
<p>Fisher, Test, R.A. &amp; Creator. 1988. “Iris.” UCI Machine Learning Repository.</p>
</div>
<div id="ref-GelmanHill:2007">
<p>Gelman, Andrew, and Jennifer Hill. 2007. <em>Data Analysis Using Regression and Multilevel/Hierarchical Models</em>. Analytical Methods for Social Research. Cambridge University Press.</p>
</div>
<div id="ref-gspc_data">
<p>“GSPC Data.” 2021. <a href="https://finance.yahoo.com/quote/%5EGSPC/history?p=%5EGSPC">https://finance.yahoo.com/quote/%5EGSPC/history?p=%5EGSPC</a>.</p>
</div>
<div id="ref-Jones72astatistical">
<p>Jones, Karen Spärck. 1972. “A Statistical Interpretation of Term Specificity and Its Application in Retrieval.” <em>Journal of Documentation</em> 28: 11–21.</p>
</div>
<div id="ref-pandas_guy">
<p>McKinney, Wes. 2017. <em>Python for Data Analysis: Data Wrangling with Pandas, Numpy, and Ipython</em>. 2nd ed. O’Reilly Media, Inc.</p>
</div>
<div id="ref-SocherEtAl2013:RNTN">
<p>Socher, Richard, Alex Perelygin, Jean Wu, Jason Chuang, Christopher Manning, Andrew Ng, and Christopher Potts. 2013. “Parsing with Compositional Vector Grammars.” In <em>EMNLP</em>.</p>
</div>
<div id="ref-TFDS">
<p>“TensorFlow Datasets, a Collection of Ready-to-Use Datasets.” 2021. <a href="https://www.tensorflow.org/datasets">https://www.tensorflow.org/datasets</a>.</p>
</div>
</div>
                
</body>
</html>