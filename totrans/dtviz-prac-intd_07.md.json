["```r\np <-  ggplot(data = gapminder,\n mapping = aes(x = log(gdpPercap), y = lifeExp))\n\np +  geom_point(alpha=0.1) +\n geom_smooth(color = \"tomato\", fill=\"tomato\", method = MASS::rlm) +\n geom_smooth(color = \"steelblue\", fill=\"steelblue\", method = \"lm\")\n\np +  geom_point(alpha=0.1) +\n geom_smooth(color = \"tomato\", method = \"lm\", size = 1.2, \n formula = y ~  splines::bs(x, 3), se = FALSE)\n\np +  geom_point(alpha=0.1) +\n geom_quantile(color = \"tomato\", size = 1.2, method = \"rqss\",\n lambda = 1, quantiles = c(0.20, 0.5, 0.85))\n```", "```r\nmodel_colors <-  RColorBrewer::brewer.pal(3, \"Set1\")\nmodel_colors\n```", "```r\n## [1] \"#E41A1C\" \"#377EB8\" \"#4DAF4A\"\n```", "```r\np0 <-  ggplot(data = gapminder,\n mapping = aes(x = log(gdpPercap), y = lifeExp))\n\np1 <-  p0 +  geom_point(alpha = 0.2) +\n geom_smooth(method = \"lm\", aes(color = \"OLS\", fill = \"OLS\")) +\n geom_smooth(method = \"lm\", formula = y ~  splines::bs(x, df = 3),\n aes(color = \"Cubic Spline\", fill = \"Cubic Spline\")) +\n geom_smooth(method = \"loess\",\n aes(color = \"LOESS\", fill = \"LOESS\"))\n\np1 +  scale_color_manual(name = \"Models\", values = model_colors) +\n scale_fill_manual(name = \"Models\", values = model_colors) +\n theme(legend.position = \"top\")\n```", "```r\ngapminder\n```", "```r\n## # A tibble: 1,704 x 6\n##    country     continent  year lifeExp      pop gdpPercap\n##    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>\n##  1 Afghanistan Asia       1952    28.8  8425333       779\n##  2 Afghanistan Asia       1957    30.3  9240934       821\n##  3 Afghanistan Asia       1962    32.0 10267083       853\n##  4 Afghanistan Asia       1967    34.0 11537966       836\n##  5 Afghanistan Asia       1972    36.1 13079460       740\n##  6 Afghanistan Asia       1977    38.4 14880372       786\n##  7 Afghanistan Asia       1982    39.9 12881816       978\n##  8 Afghanistan Asia       1987    40.8 13867957       852\n##  9 Afghanistan Asia       1992    41.7 16317921       649\n## 10 Afghanistan Asia       1997    41.8 22227415       635\n## # ... with 1,694 more rows\n```", "```r\n## Classes 'tbl_df', 'tbl' and 'data.frame':    1704 obs. of  6 variables:\n## $ country : Factor w/ 142 levels \"Afghanistan\",..: 1 1 ...\n## $ continent: Factor w/ 5 levels \"Africa\",\"Americas\",..: 3 3\n##    ...\n## $ year : int 1952 1957 ...\n## $ lifeExp : num 28.8 ...\n## $ pop : int 8425333 9240934 ...\n## $ gdpPercap: num 779 ...\n```", "```r\nout <-  lm(formula = lifeExp ~  gdpPercap +  pop +  continent,\n data = gapminder)\n```", "```r\nsummary(out)\n```", "```r\n## \n## Call:\n## lm(formula = lifeExp ~ gdpPercap + pop + continent, data = gapminder)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -49.16  -4.49   0.30   5.11  25.17 \n## \n## Coefficients:\n##                   Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)       4.78e+01   3.40e-01  140.82   <2e-16 ***\n## gdpPercap         4.50e-04   2.35e-05   19.16   <2e-16 ***\n## pop               6.57e-09   1.98e-09    3.33    9e-04 ***\n## continentAmericas 1.35e+01   6.00e-01   22.46   <2e-16 ***\n## continentAsia     8.19e+00   5.71e-01   14.34   <2e-16 ***\n## continentEurope   1.75e+01   6.25e-01   27.97   <2e-16 ***\n## continentOceania  1.81e+01   1.78e+00   10.15   <2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 8.37 on 1697 degrees of freedom\n## Multiple R-squared:  0.582,  Adjusted R-squared:  0.581 \n## F-statistic:  394 on 6 and 1697 DF,  p-value: <2e-16\n```", "```r\nmin_gdp <-  min(gapminder$gdpPercap)\nmax_gdp <-  max(gapminder$gdpPercap)\nmed_pop <-  median(gapminder$pop)\n\npred_df <-  expand.grid(gdpPercap = (seq(from = min_gdp,\n to = max_gdp,\n length.out = 100)),\n pop = med_pop,\n continent = c(\"Africa\", \"Americas\",\n \"Asia\", \"Europe\", \"Oceania\"))\n\ndim(pred_df)\n```", "```r\n## [1] 500   3\n```", "```r\nhead(pred_df)\n```", "```r\n##   gdpPercap     pop continent\n## 1   241.166 7023596    Africa\n## 2  1385.428 7023596    Africa\n## 3  2529.690 7023596    Africa\n## 4  3673.953 7023596    Africa\n## 5  4818.215 7023596    Africa\n## 6  5962.477 7023596    Africa\n```", "```r\npred_out <-  predict(object = out,\n newdata = pred_df,\n interval = \"predict\")\nhead(pred_out)\n```", "```r\n##       fit     lwr     upr\n## 1 47.9686 31.5477 64.3895\n## 2 48.4830 32.0623 64.9037\n## 3 48.9973 32.5767 65.4180\n## 4 49.5117 33.0909 65.9325\n## 5 50.0260 33.6050 66.4471\n## 6 50.5404 34.1189 66.9619\n```", "```r\npred_df <-  cbind(pred_df, pred_out)\nhead(pred_df)\n```", "```r\n##   gdpPercap     pop continent  fit  lwr  upr\n## 1       241 7023596    Africa 48.0 31.5 64.4\n## 2      1385 7023596    Africa 48.5 32.1 64.9\n## 3      2530 7023596    Africa 49.0 32.6 65.4\n## 4      3674 7023596    Africa 49.5 33.1 65.9\n## 5      4818 7023596    Africa 50.0 33.6 66.4\n## 6      5962 7023596    Africa 50.5 34.1 67.0\n```", "```r\np <-  ggplot(data = subset(pred_df, continent %in%  c(\"Europe\", \"Africa\")),\n aes(x = gdpPercap,\n y = fit, ymin = lwr, ymax = upr,\n color = continent,\n fill = continent,\n group = continent))\n\np +  geom_point(data = subset(gapminder,\n continent %in%  c(\"Europe\", \"Africa\")),\n aes(x = gdpPercap, y = lifeExp,\n color = continent),\n alpha = 0.5,\n inherit.aes = FALSE) + \n geom_line() +\n geom_ribbon(alpha = 0.2, color = FALSE) +\n scale_x_log10(labels = scales::dollar)\n```", "```r\nlibrary(broom)\n```", "```r\nout_comp <-  tidy(out)\nout_comp %>%  round_df()\n```", "```r\n##                term estimate std.error statistic p.value\n## 1       (Intercept)    47.81      0.34    140.82       0\n## 2         gdpPercap     0.00      0.00     19.16       0\n## 3               pop     0.00      0.00      3.33       0\n## 4 continentAmericas    13.48      0.60     22.46       0\n## 5     continentAsia     8.19      0.57     14.34       0\n## 6   continentEurope    17.47      0.62     27.97       0\n## 7  continentOceania    18.08      1.78     10.15       0\n```", "```r\np <-  ggplot(out_comp, mapping = aes(x = term,\n y = estimate))\n\np +  geom_point() +  coord_flip() \n```", "```r\nout_conf <-  tidy(out, conf.int = TRUE)\nout_conf %>%  round_df()\n```", "```r\n##                term estimate std.error statistic p.value conf.low conf.high\n## 1       (Intercept)    47.81      0.34    140.82       0    47.15     48.48\n## 2         gdpPercap     0.00      0.00     19.16       0     0.00      0.00\n## 3               pop     0.00      0.00      3.33       0     0.00      0.00\n## 4 continentAmericas    13.48      0.60     22.46       0    12.30     14.65\n## 5     continentAsia     8.19      0.57     14.34       0     7.07      9.31\n## 6   continentEurope    17.47      0.62     27.97       0    16.25     18.70\n## 7  continentOceania    18.08      1.78     10.15       0    14.59     21.58\n```", "```r\nout_conf <-  subset(out_conf, term %nin% \"(Intercept)\")\nout_conf$nicelabs <-  prefix_strip(out_conf$term, \"continent\")\n```", "```r\np <-  ggplot(out_conf, mapping = aes(x = reorder(nicelabs, estimate),\n y = estimate, ymin = conf.low, ymax = conf.high))\np +  geom_pointrange() +  coord_flip() +  labs(x=\"\", y=\"OLS Estimate\")\n```", "```r\nout_aug <-  augment(out)\nhead(out_aug) %>%  round_df()\n```", "```r\n##   lifeExp gdpPercap      pop continent .fitted .se.fit .resid .hat .sigma .cooksd .std.resid\n## 1    28.8       779  8425333      Asia    56.4    0.47  -27.6    0   8.34    0.01      -3.31\n## 2    30.3       821  9240934      Asia    56.4    0.47  -26.1    0   8.34    0.00      -3.13\n## 3    32.0       853 10267083      Asia    56.5    0.47  -24.5    0   8.35    0.00      -2.93\n## 4    34.0       836 11537966      Asia    56.5    0.47  -22.4    0   8.35    0.00      -2.69\n## 5    36.1       740 13079460      Asia    56.4    0.47  -20.3    0   8.35    0.00      -2.44\n## 6    38.4       786 14880372      Asia    56.5    0.47  -18.0    0   8.36    0.00      -2.16\n```", "```r\nout_aug <-  augment(out, data = gapminder)\nhead(out_aug) %>%  round_df()\n```", "```r\n##       country continent year lifeExp      pop gdpPercap .fitted .se.fit .resid .hat .sigma .cooksd\n## 1 Afghanistan      Asia 1952    28.8  8425333       779    56.4    0.47  -27.6    0   8.34    0.01\n## 2 Afghanistan      Asia 1957    30.3  9240934       821    56.4    0.47  -26.1    0   8.34    0.00\n## 3 Afghanistan      Asia 1962    32.0 10267083       853    56.5    0.47  -24.5    0   8.35    0.00\n## 4 Afghanistan      Asia 1967    34.0 11537966       836    56.5    0.47  -22.4    0   8.35    0.00\n## 5 Afghanistan      Asia 1972    36.1 13079460       740    56.4    0.47  -20.3    0   8.35    0.00\n## 6 Afghanistan      Asia 1977    38.4 14880372       786    56.5    0.47  -18.0    0   8.36    0.00\n##   .std.resid\n## 1      -3.31\n## 2      -3.13\n## 3      -2.93\n## 4      -2.69\n## 5      -2.44\n## 6      -2.16\n```", "```r\np <-  ggplot(data = out_aug,\n mapping = aes(x = .fitted, y = .resid))\np +  geom_point()\n```", "```r\nglance(out) %>%  round_df()\n```", "```r\n##   r.squared adj.r.squared sigma statistic p.value df\n## 1      0.58          0.58  8.37    393.91       0  7\n##     logLik     AIC     BIC deviance df.residual\n## 1 -6033.83 12083.6 12127.2   118754        1697\n```", "```r\nlibrary(survival)\n\nout_cph <-  coxph(Surv(time, status) ~  age +  sex, data = lung)\nout_surv <-  survfit(out_cph)\n```", "```r\nout_tidy <-  tidy(out_surv)\n\np <-  ggplot(data = out_tidy, mapping = aes(time, estimate))\np +  geom_line() +\n geom_ribbon(mapping = aes(ymin = conf.low, ymax = conf.high), alpha = .2)\n```", "```r\neu77 <-  gapminder %>%  filter(continent == \"Europe\", year ==  1977)\n```", "```r\nfit <-  lm(lifeExp ~  log(gdpPercap), data = eu77)\nsummary(fit)\n```", "```r\n## \n## Call:\n## lm(formula = lifeExp ~ log(gdpPercap), data = eu77)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -7.496 -1.031  0.093  1.176  3.712 \n## \n## Coefficients:\n##                Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)      29.489      7.161    4.12  0.00031 ***\n## log(gdpPercap)    4.488      0.756    5.94  2.2e-06 ***\n## ---\n## Signif. codes:  \n## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.11 on 28 degrees of freedom\n## Multiple R-squared:  0.557,  Adjusted R-squared:  0.541 \n## F-statistic: 35.2 on 1 and 28 DF,  p-value: 2.17e-06\n```", "```r\nout_le <-  gapminder %>%\n group_by(continent, year) %>%\n nest()\n\nout_le\n```", "```r\n## # A tibble: 60 x 3\n##    continent  year data             \n##    <fct>     <int> <list>           \n##  1 Asia       1952 <tibble [33 × 4]>\n##  2 Asia       1957 <tibble [33 × 4]>\n##  3 Asia       1962 <tibble [33 × 4]>\n##  4 Asia       1967 <tibble [33 × 4]>\n##  5 Asia       1972 <tibble [33 × 4]>\n##  6 Asia       1977 <tibble [33 × 4]>\n##  7 Asia       1982 <tibble [33 × 4]>\n##  8 Asia       1987 <tibble [33 × 4]>\n##  9 Asia       1992 <tibble [33 × 4]>\n## 10 Asia       1997 <tibble [33 × 4]>\n## # ... with 50 more rows\n```", "```r\nout_le %>%  filter(continent == \"Europe\" &  year ==  1977) %>%  unnest()\n```", "```r\n## # A tibble: 30 x 6\n##    continent  year country         lifeExp    pop gdpPercap\n##    <fct>     <int> <fct>             <dbl>  <int>     <dbl>\n##  1 Europe     1977 Albania            68.9 2.51e⁶      3533\n##  2 Europe     1977 Austria            72.2 7.57e⁶     19749\n##  3 Europe     1977 Belgium            72.8 9.82e⁶     19118\n##  4 Europe     1977 Bosnia and Her…    69.9 4.09e⁶      3528\n##  5 Europe     1977 Bulgaria           70.8 8.80e⁶      7612\n##  6 Europe     1977 Croatia            70.6 4.32e⁶     11305\n##  7 Europe     1977 Czech Republic     70.7 1.02e⁷     14800\n##  8 Europe     1977 Denmark            74.7 5.09e⁶     20423\n##  9 Europe     1977 Finland            72.5 4.74e⁶     15605\n## 10 Europe     1977 France             73.8 5.32e⁷     18293\n## # ... with 20 more rows\n```", "```r\nfit_ols <-  function(df) {\n lm(lifeExp ~  log(gdpPercap), data = df)\n}\n\nout_le <-  gapminder %>%\n group_by(continent, year) %>%\n nest() %>% \n mutate(model = map(data, fit_ols)) \n\nout_le\n```", "```r\n## # A tibble: 60 x 4\n##    continent  year data              model   \n##    <fct>     <int> <list>            <list>  \n##  1 Asia       1952 <tibble [33 × 4]> <S3: lm>\n##  2 Asia       1957 <tibble [33 × 4]> <S3: lm>\n##  3 Asia       1962 <tibble [33 × 4]> <S3: lm>\n##  4 Asia       1967 <tibble [33 × 4]> <S3: lm>\n##  5 Asia       1972 <tibble [33 × 4]> <S3: lm>\n##  6 Asia       1977 <tibble [33 × 4]> <S3: lm>\n##  7 Asia       1982 <tibble [33 × 4]> <S3: lm>\n##  8 Asia       1987 <tibble [33 × 4]> <S3: lm>\n##  9 Asia       1992 <tibble [33 × 4]> <S3: lm>\n## 10 Asia       1997 <tibble [33 × 4]> <S3: lm>\n## # ... with 50 more rows\n```", "```r\nfit_ols <-  function(df) {\n lm(lifeExp ~  log(gdpPercap), data = df)\n}\n\nout_tidy <-  gapminder %>%\n group_by(continent, year) %>%\n nest() %>% \n mutate(model = map(data, fit_ols),\n tidied = map(model, tidy)) %>%\n unnest(tidied, .drop = TRUE) %>%\n filter(term %nin% \"(Intercept)\" &\n continent %nin% \"Oceania\")\n\nout_tidy %>%  sample_n(5)\n```", "```r\n## # A tibble: 5 x 7\n##   continent  year term           estimate std.error statistic      p.value\n##   <fct>     <int> <chr>             <dbl>     <dbl>     <dbl>        <dbl>\n## 1 Europe     1987 log(gdpPercap)     4.14     0.752      5.51 0.00000693  \n## 2 Asia       1972 log(gdpPercap)     4.44     1.01       4.41 0.000116    \n## 3 Europe     1972 log(gdpPercap)     4.51     0.757      5.95 0.00000208  \n## 4 Americas   1952 log(gdpPercap)    10.4      2.72       3.84 0.000827    \n## 5 Asia       1987 log(gdpPercap)     5.17     0.727      7.12 0.0000000531\n```", "```r\np <-  ggplot(data = out_tidy,\n mapping = aes(x = year, y = estimate,\n ymin = estimate -  2*std.error,\n ymax = estimate +  2*std.error,\n group = continent, color = continent))\n\np +  geom_pointrange(position = position_dodge(width = 1)) +\n scale_x_continuous(breaks = unique(gapminder$year)) + \n theme(legend.position = \"top\") +\n labs(x = \"Year\", y = \"Estimate\", color = \"Continent\")\n```", "```r\nlibrary(margins)\n```", "```r\ngss_sm$polviews_m <-  relevel(gss_sm$polviews, ref = \"Moderate\")\n\nout_bo <-  glm(obama ~  polviews_m +  sex*race,\n family = \"binomial\", data = gss_sm)\nsummary(out_bo)\n```", "```r\n## \n## Call:\n## glm(formula = obama ~ polviews_m + sex * race, family = \"binomial\", \n##     data = gss_sm)\n## \n## Deviance Residuals: \n##    Min      1Q  Median      3Q     Max  \n## -2.905  -0.554   0.177   0.542   2.244  \n## \n## Coefficients:\n##                                  Estimate Std. Error z value Pr(>|z|)    \n## (Intercept)                       0.29649    0.13409    2.21   0.0270 *  \n## polviews_mExtremely Liberal       2.37295    0.52504    4.52  6.2e-06 ***\n## polviews_mLiberal                 2.60003    0.35667    7.29  3.1e-13 ***\n## polviews_mSlightly Liberal        1.29317    0.24843    5.21  1.9e-07 ***\n## polviews_mSlightly Conservative  -1.35528    0.18129   -7.48  7.7e-14 ***\n## polviews_mConservative           -2.34746    0.20038  -11.71  < 2e-16 ***\n## polviews_mExtremely Conservative -2.72738    0.38721   -7.04  1.9e-12 ***\n## sexFemale                         0.25487    0.14537    1.75   0.0796 .  \n## raceBlack                         3.84953    0.50132    7.68  1.6e-14 ***\n## raceOther                        -0.00214    0.43576    0.00   0.9961    \n## sexFemale:raceBlack              -0.19751    0.66007   -0.30   0.7648    \n## sexFemale:raceOther               1.57483    0.58766    2.68   0.0074 ** \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## (Dispersion parameter for binomial family taken to be 1)\n## \n##     Null deviance: 2247.9  on 1697  degrees of freedom\n## Residual deviance: 1345.9  on 1686  degrees of freedom\n##   (1169 observations deleted due to missingness)\n## AIC: 1370\n## \n## Number of Fisher Scoring iterations: 6\n```", "```r\nbo_m <-  margins(out_bo)\nsummary(bo_m)\n```", "```r\n##                            factor     AME     SE        z      p   lower   upper\n##            polviews_mConservative -0.4119 0.0283 -14.5394 0.0000 -0.4674 -0.3564\n##  polviews_mExtremely Conservative -0.4538 0.0420 -10.7971 0.0000 -0.5361 -0.3714\n##       polviews_mExtremely Liberal  0.2681 0.0295   9.0996 0.0000  0.2103  0.3258\n##                 polviews_mLiberal  0.2768 0.0229  12.0736 0.0000  0.2319  0.3218\n##   polviews_mSlightly Conservative -0.2658 0.0330  -8.0596 0.0000 -0.3304 -0.2011\n##        polviews_mSlightly Liberal  0.1933 0.0303   6.3896 0.0000  0.1340  0.2526\n##                         raceBlack  0.4032 0.0173  23.3568 0.0000  0.3694  0.4371\n##                         raceOther  0.1247 0.0386   3.2297 0.0012  0.0490  0.2005\n##                         sexFemale  0.0443 0.0177   2.5073 0.0122  0.0097  0.0789\n```", "```r\nbo_gg <-  as_tibble(summary(bo_m))\nprefixes <-  c(\"polviews_m\", \"sex\")\nbo_gg$factor <-  prefix_strip(bo_gg$factor, prefixes)\nbo_gg$factor <-  prefix_replace(bo_gg$factor, \"race\", \"Race: \")\n\nbo_gg %>%  select(factor, AME, lower, upper) \n```", "```r\n## # A tibble: 9 x 4\n##   factor                     AME    lower   upper\n## * <chr>                    <dbl>    <dbl>   <dbl>\n## 1 Conservative           -0.412  -0.467   -0.356 \n## 2 Extremely Conservative -0.454  -0.536   -0.371 \n## 3 Extremely Liberal       0.268   0.210    0.326 \n## 4 Liberal                 0.277   0.232    0.322 \n## 5 Slightly Conservative  -0.266  -0.330   -0.201 \n## 6 Slightly Liberal        0.193   0.134    0.253 \n## 7 Race: Black             0.403   0.369    0.437 \n## 8 Race: Other             0.125   0.0490   0.200 \n## 9 Female                  0.0443  0.00967  0.0789\n```", "```r\np <-  ggplot(data = bo_gg, aes(x = reorder(factor, AME),\n y = AME, ymin = lower, ymax = upper))\n\np +  geom_hline(yintercept = 0, color = \"gray80\") +\n geom_pointrange() +  coord_flip() +\n labs(x = NULL, y = \"Average Marginal Effect\") \n```", "```r\npv_cp <-  cplot(out_bo, x = \"sex\", draw = FALSE)\n\np <-  ggplot(data = pv_cp, aes(x = reorder(xvals, yvals),\n y = yvals, ymin = lower, ymax = upper))\n\np +  geom_hline(yintercept = 0, color = \"gray80\") +\n geom_pointrange() +  coord_flip() +\n labs(x = NULL, y = \"Conditional Effect\") \n```", "```r\nlibrary(survey)\nlibrary(srvyr)\n```", "```r\noptions(survey.lonely.psu = \"adjust\")\noptions(na.action=\"na.pass\")\n\ngss_wt <-  subset(gss_lon, year >  1974) %>%\n mutate(stratvar = interaction(year, vstrat)) %>%\n as_survey_design(ids = vpsu,\n strata = stratvar,\n weights = wtssall,\n nest = TRUE)\n```", "```r\nout_grp <-  gss_wt %>%\n filter(year %in%  seq(1976, 2016, by = 4)) %>%\n group_by(year, race, degree) %>%\n summarize(prop = survey_mean(na.rm = TRUE))\n\nout_grp\n```", "```r\n## # A tibble: 150 x 5\n##     year race  degree           prop prop_se\n##    <dbl> <fct> <fct>           <dbl>   <dbl>\n##  1  1976 White Lt High School 0.328  0.0160 \n##  2  1976 White High School    0.518  0.0162 \n##  3  1976 White Junior College 0.0129 0.00298\n##  4  1976 White Bachelor       0.101  0.00960\n##  5  1976 White Graduate       0.0393 0.00644\n##  6  1976 Black Lt High School 0.562  0.0611 \n##  7  1976 Black High School    0.337  0.0476 \n##  8  1976 Black Junior College 0.0426 0.0193 \n##  9  1976 Black Bachelor       0.0581 0.0239 \n## 10  1976 Black Graduate       0      0      \n## # ... with 140 more rows\n```", "```r\nout_mrg <-  gss_wt %>%\n filter(year %in%  seq(1976, 2016, by = 4)) %>%\n mutate(racedeg = interaction(race, degree)) %>%\n group_by(year, racedeg) %>%\n summarize(prop = survey_mean(na.rm = TRUE))\n\nout_mrg\n```", "```r\n## # A tibble: 150 x 4\n##     year racedeg                 prop prop_se\n##    <dbl> <fct>                  <dbl>   <dbl>\n##  1  1976 White.Lt High School 0.298   0.0146 \n##  2  1976 Black.Lt High School 0.0471  0.00840\n##  3  1976 Other.Lt High School 0.00195 0.00138\n##  4  1976 White.High School    0.471   0.0160 \n##  5  1976 Black.High School    0.0283  0.00594\n##  6  1976 Other.High School    0.00325 0.00166\n##  7  1976 White.Junior College 0.0117  0.00268\n##  8  1976 Black.Junior College 0.00357 0.00162\n##  9  1976 Other.Junior College 0       0      \n## 10  1976 White.Bachelor       0.0919  0.00888\n## # ... with 140 more rows\n```", "```r\nout_mrg <-  gss_wt %>%\n filter(year %in%  seq(1976, 2016, by = 4)) %>%\n mutate(racedeg = interaction(race, degree)) %>%\n group_by(year, racedeg) %>%\n summarize(prop = survey_mean(na.rm = TRUE)) %>%\n separate(racedeg, sep = \"\\\\.\", into = c(\"race\", \"degree\"))\n\nout_mrg\n```", "```r\n## # A tibble: 150 x 5\n##     year race  degree            prop prop_se\n##    <dbl> <chr> <chr>            <dbl>   <dbl>\n##  1  1976 White Lt High School 0.298   0.0146 \n##  2  1976 Black Lt High School 0.0471  0.00840\n##  3  1976 Other Lt High School 0.00195 0.00138\n##  4  1976 White High School    0.471   0.0160 \n##  5  1976 Black High School    0.0283  0.00594\n##  6  1976 Other High School    0.00325 0.00166\n##  7  1976 White Junior College 0.0117  0.00268\n##  8  1976 Black Junior College 0.00357 0.00162\n##  9  1976 Other Junior College 0       0      \n## 10  1976 White Bachelor       0.0919  0.00888\n## # ... with 140 more rows\n```", "```r\np <-  ggplot(data = subset(out_grp, race %nin% \"Other\"),\n mapping = aes(x = degree, y = prop,\n ymin = prop -  2*prop_se,\n ymax = prop +  2*prop_se,\n fill = race,\n color = race,\n group = race))\n\ndodge <-  position_dodge(width=0.9)\n\np +  geom_col(position = dodge, alpha = 0.2) +\n geom_errorbar(position = dodge, width = 0.2) +\n scale_x_discrete(labels = scales::wrap_format(10)) +\n scale_y_continuous(labels = scales::percent) +\n scale_color_brewer(type = \"qual\", palette = \"Dark2\") +\n scale_fill_brewer(type = \"qual\", palette = \"Dark2\") +\n labs(title = \"Educational Attainment by Race\",\n subtitle = \"GSS 1976-2016\",\n fill = \"Race\",\n color = \"Race\",\n x = NULL, y = \"Percent\") +\n facet_wrap(~  year, ncol = 2) +\n theme(legend.position = \"top\")\n```", "```r\np <-  ggplot(data = subset(out_grp, race %nin% \"Other\"),\n mapping = aes(x = year, y = prop, ymin = prop -  2*prop_se,\n ymax = prop +  2*prop_se, fill = race, color = race,\n group = race))\n\np +  geom_ribbon(alpha = 0.3, aes(color = NULL)) +\n geom_line() + \n facet_wrap(~  degree, ncol = 1) +\n scale_y_continuous(labels = scales::percent) +\n scale_color_brewer(type = \"qual\", palette = \"Dark2\") +\n scale_fill_brewer(type = \"qual\", palette = \"Dark2\") +\n labs(title = \"Educational Attainment\\nby Race\",\n subtitle = \"GSS 1976-2016\", fill = \"Race\",\n color = \"Race\", x = NULL, y = \"Percent\") +\n theme(legend.position = \"top\")\n```", "```r\nout <-  lm(formula = lifeExp ~  log(gdpPercap) +  pop +  continent, data = gapminder)\n```", "```r\n# Plot not shown\nplot(out, which = c(1,2), ask=FALSE)\n```", "```r\nlibrary(coefplot)\nout <-  lm(formula = lifeExp ~  log(gdpPercap) +  log(pop) +  continent, data = gapminder)\n\ncoefplot(out, sort = \"magnitude\", intercept = FALSE)\n```", "```r\nlibrary(GGally)\n\norgandata_sm <-  organdata %>%\n select(donors, pop_dens, pubhealth,\n roads, consent_law)\n\nggpairs(data = organdata_sm,\n mapping = aes(color = consent_law),\n upper = list(continuous = wrap(\"density\"), combo = \"box_no_facet\"),\n lower = list(continuous = wrap(\"points\"), combo = wrap(\"dot_no_facet\")))\n```", "```r\nmodel_colors <-  RColorBrewer::brewer.pal(3, \"Set1\")\nmodel_colors\n```", "```r\n## [1] \"#E41A1C\" \"#377EB8\" \"#4DAF4A\"\n```", "```r\np0 <-  ggplot(data = gapminder,\n mapping = aes(x = log(gdpPercap), y = lifeExp))\n\np1 <-  p0 +  geom_point(alpha = 0.2) +\n geom_smooth(method = \"lm\", aes(color = \"OLS\", fill = \"OLS\")) +\n geom_smooth(method = \"lm\", formula = y ~  splines::bs(x, df = 3),\n aes(color = \"Cubic Spline\", fill = \"Cubic Spline\")) +\n geom_smooth(method = \"loess\",\n aes(color = \"LOESS\", fill = \"LOESS\"))\n\np1 +  scale_color_manual(name = \"Models\", values = model_colors) +\n scale_fill_manual(name = \"Models\", values = model_colors) +\n theme(legend.position = \"top\")\n```", "```r\ngapminder\n```", "```r\n## # A tibble: 1,704 x 6\n##    country     continent  year lifeExp      pop gdpPercap\n##    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>\n##  1 Afghanistan Asia       1952    28.8  8425333       779\n##  2 Afghanistan Asia       1957    30.3  9240934       821\n##  3 Afghanistan Asia       1962    32.0 10267083       853\n##  4 Afghanistan Asia       1967    34.0 11537966       836\n##  5 Afghanistan Asia       1972    36.1 13079460       740\n##  6 Afghanistan Asia       1977    38.4 14880372       786\n##  7 Afghanistan Asia       1982    39.9 12881816       978\n##  8 Afghanistan Asia       1987    40.8 13867957       852\n##  9 Afghanistan Asia       1992    41.7 16317921       649\n## 10 Afghanistan Asia       1997    41.8 22227415       635\n## # ... with 1,694 more rows\n```", "```r\n## Classes 'tbl_df', 'tbl' and 'data.frame':    1704 obs. of  6 variables:\n## $ country : Factor w/ 142 levels \"Afghanistan\",..: 1 1 ...\n## $ continent: Factor w/ 5 levels \"Africa\",\"Americas\",..: 3 3\n##    ...\n## $ year : int 1952 1957 ...\n## $ lifeExp : num 28.8 ...\n## $ pop : int 8425333 9240934 ...\n## $ gdpPercap: num 779 ...\n```", "```r\nout <-  lm(formula = lifeExp ~  gdpPercap +  pop +  continent,\n data = gapminder)\n```", "```r\nsummary(out)\n```", "```r\n## \n## Call:\n## lm(formula = lifeExp ~ gdpPercap + pop + continent, data = gapminder)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -49.16  -4.49   0.30   5.11  25.17 \n## \n## Coefficients:\n##                   Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)       4.78e+01   3.40e-01  140.82   <2e-16 ***\n## gdpPercap         4.50e-04   2.35e-05   19.16   <2e-16 ***\n## pop               6.57e-09   1.98e-09    3.33    9e-04 ***\n## continentAmericas 1.35e+01   6.00e-01   22.46   <2e-16 ***\n## continentAsia     8.19e+00   5.71e-01   14.34   <2e-16 ***\n## continentEurope   1.75e+01   6.25e-01   27.97   <2e-16 ***\n## continentOceania  1.81e+01   1.78e+00   10.15   <2e-16 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 8.37 on 1697 degrees of freedom\n## Multiple R-squared:  0.582,  Adjusted R-squared:  0.581 \n## F-statistic:  394 on 6 and 1697 DF,  p-value: <2e-16\n```", "```r\nmin_gdp <-  min(gapminder$gdpPercap)\nmax_gdp <-  max(gapminder$gdpPercap)\nmed_pop <-  median(gapminder$pop)\n\npred_df <-  expand.grid(gdpPercap = (seq(from = min_gdp,\n to = max_gdp,\n length.out = 100)),\n pop = med_pop,\n continent = c(\"Africa\", \"Americas\",\n \"Asia\", \"Europe\", \"Oceania\"))\n\ndim(pred_df)\n```", "```r\n## [1] 500   3\n```", "```r\nhead(pred_df)\n```", "```r\n##   gdpPercap     pop continent\n## 1   241.166 7023596    Africa\n## 2  1385.428 7023596    Africa\n## 3  2529.690 7023596    Africa\n## 4  3673.953 7023596    Africa\n## 5  4818.215 7023596    Africa\n## 6  5962.477 7023596    Africa\n```", "```r\npred_out <-  predict(object = out,\n newdata = pred_df,\n interval = \"predict\")\nhead(pred_out)\n```", "```r\n##       fit     lwr     upr\n## 1 47.9686 31.5477 64.3895\n## 2 48.4830 32.0623 64.9037\n## 3 48.9973 32.5767 65.4180\n## 4 49.5117 33.0909 65.9325\n## 5 50.0260 33.6050 66.4471\n## 6 50.5404 34.1189 66.9619\n```", "```r\npred_df <-  cbind(pred_df, pred_out)\nhead(pred_df)\n```", "```r\n##   gdpPercap     pop continent  fit  lwr  upr\n## 1       241 7023596    Africa 48.0 31.5 64.4\n## 2      1385 7023596    Africa 48.5 32.1 64.9\n## 3      2530 7023596    Africa 49.0 32.6 65.4\n## 4      3674 7023596    Africa 49.5 33.1 65.9\n## 5      4818 7023596    Africa 50.0 33.6 66.4\n## 6      5962 7023596    Africa 50.5 34.1 67.0\n```", "```r\np <-  ggplot(data = subset(pred_df, continent %in%  c(\"Europe\", \"Africa\")),\n aes(x = gdpPercap,\n y = fit, ymin = lwr, ymax = upr,\n color = continent,\n fill = continent,\n group = continent))\n\np +  geom_point(data = subset(gapminder,\n continent %in%  c(\"Europe\", \"Africa\")),\n aes(x = gdpPercap, y = lifeExp,\n color = continent),\n alpha = 0.5,\n inherit.aes = FALSE) + \n geom_line() +\n geom_ribbon(alpha = 0.2, color = FALSE) +\n scale_x_log10(labels = scales::dollar)\n```", "```r\nlibrary(broom)\n```", "```r\nout_comp <-  tidy(out)\nout_comp %>%  round_df()\n```", "```r\n##                term estimate std.error statistic p.value\n## 1       (Intercept)    47.81      0.34    140.82       0\n## 2         gdpPercap     0.00      0.00     19.16       0\n## 3               pop     0.00      0.00      3.33       0\n## 4 continentAmericas    13.48      0.60     22.46       0\n## 5     continentAsia     8.19      0.57     14.34       0\n## 6   continentEurope    17.47      0.62     27.97       0\n## 7  continentOceania    18.08      1.78     10.15       0\n```", "```r\np <-  ggplot(out_comp, mapping = aes(x = term,\n y = estimate))\n\np +  geom_point() +  coord_flip() \n```", "```r\nout_conf <-  tidy(out, conf.int = TRUE)\nout_conf %>%  round_df()\n```", "```r\n##                term estimate std.error statistic p.value conf.low conf.high\n## 1       (Intercept)    47.81      0.34    140.82       0    47.15     48.48\n## 2         gdpPercap     0.00      0.00     19.16       0     0.00      0.00\n## 3               pop     0.00      0.00      3.33       0     0.00      0.00\n## 4 continentAmericas    13.48      0.60     22.46       0    12.30     14.65\n## 5     continentAsia     8.19      0.57     14.34       0     7.07      9.31\n## 6   continentEurope    17.47      0.62     27.97       0    16.25     18.70\n## 7  continentOceania    18.08      1.78     10.15       0    14.59     21.58\n```", "```r\nout_conf <-  subset(out_conf, term %nin% \"(Intercept)\")\nout_conf$nicelabs <-  prefix_strip(out_conf$term, \"continent\")\n```", "```r\np <-  ggplot(out_conf, mapping = aes(x = reorder(nicelabs, estimate),\n y = estimate, ymin = conf.low, ymax = conf.high))\np +  geom_pointrange() +  coord_flip() +  labs(x=\"\", y=\"OLS Estimate\")\n```", "```r\nout_aug <-  augment(out)\nhead(out_aug) %>%  round_df()\n```", "```r\n##   lifeExp gdpPercap      pop continent .fitted .se.fit .resid .hat .sigma .cooksd .std.resid\n## 1    28.8       779  8425333      Asia    56.4    0.47  -27.6    0   8.34    0.01      -3.31\n## 2    30.3       821  9240934      Asia    56.4    0.47  -26.1    0   8.34    0.00      -3.13\n## 3    32.0       853 10267083      Asia    56.5    0.47  -24.5    0   8.35    0.00      -2.93\n## 4    34.0       836 11537966      Asia    56.5    0.47  -22.4    0   8.35    0.00      -2.69\n## 5    36.1       740 13079460      Asia    56.4    0.47  -20.3    0   8.35    0.00      -2.44\n## 6    38.4       786 14880372      Asia    56.5    0.47  -18.0    0   8.36    0.00      -2.16\n```", "```r\nout_aug <-  augment(out, data = gapminder)\nhead(out_aug) %>%  round_df()\n```", "```r\n##       country continent year lifeExp      pop gdpPercap .fitted .se.fit .resid .hat .sigma .cooksd\n## 1 Afghanistan      Asia 1952    28.8  8425333       779    56.4    0.47  -27.6    0   8.34    0.01\n## 2 Afghanistan      Asia 1957    30.3  9240934       821    56.4    0.47  -26.1    0   8.34    0.00\n## 3 Afghanistan      Asia 1962    32.0 10267083       853    56.5    0.47  -24.5    0   8.35    0.00\n## 4 Afghanistan      Asia 1967    34.0 11537966       836    56.5    0.47  -22.4    0   8.35    0.00\n## 5 Afghanistan      Asia 1972    36.1 13079460       740    56.4    0.47  -20.3    0   8.35    0.00\n## 6 Afghanistan      Asia 1977    38.4 14880372       786    56.5    0.47  -18.0    0   8.36    0.00\n##   .std.resid\n## 1      -3.31\n## 2      -3.13\n## 3      -2.93\n## 4      -2.69\n## 5      -2.44\n## 6      -2.16\n```", "```r\np <-  ggplot(data = out_aug,\n mapping = aes(x = .fitted, y = .resid))\np +  geom_point()\n```", "```r\nglance(out) %>%  round_df()\n```", "```r\n##   r.squared adj.r.squared sigma statistic p.value df\n## 1      0.58          0.58  8.37    393.91       0  7\n##     logLik     AIC     BIC deviance df.residual\n## 1 -6033.83 12083.6 12127.2   118754        1697\n```", "```r\nlibrary(survival)\n\nout_cph <-  coxph(Surv(time, status) ~  age +  sex, data = lung)\nout_surv <-  survfit(out_cph)\n```", "```r\nout_tidy <-  tidy(out_surv)\n\np <-  ggplot(data = out_tidy, mapping = aes(time, estimate))\np +  geom_line() +\n geom_ribbon(mapping = aes(ymin = conf.low, ymax = conf.high), alpha = .2)\n```", "```r\nout_comp <-  tidy(out)\nout_comp %>%  round_df()\n```", "```r\n##                term estimate std.error statistic p.value\n## 1       (Intercept)    47.81      0.34    140.82       0\n## 2         gdpPercap     0.00      0.00     19.16       0\n## 3               pop     0.00      0.00      3.33       0\n## 4 continentAmericas    13.48      0.60     22.46       0\n## 5     continentAsia     8.19      0.57     14.34       0\n## 6   continentEurope    17.47      0.62     27.97       0\n## 7  continentOceania    18.08      1.78     10.15       0\n```", "```r\np <-  ggplot(out_comp, mapping = aes(x = term,\n y = estimate))\n\np +  geom_point() +  coord_flip() \n```", "```r\nout_conf <-  tidy(out, conf.int = TRUE)\nout_conf %>%  round_df()\n```", "```r\n##                term estimate std.error statistic p.value conf.low conf.high\n## 1       (Intercept)    47.81      0.34    140.82       0    47.15     48.48\n## 2         gdpPercap     0.00      0.00     19.16       0     0.00      0.00\n## 3               pop     0.00      0.00      3.33       0     0.00      0.00\n## 4 continentAmericas    13.48      0.60     22.46       0    12.30     14.65\n## 5     continentAsia     8.19      0.57     14.34       0     7.07      9.31\n## 6   continentEurope    17.47      0.62     27.97       0    16.25     18.70\n## 7  continentOceania    18.08      1.78     10.15       0    14.59     21.58\n```", "```r\nout_conf <-  subset(out_conf, term %nin% \"(Intercept)\")\nout_conf$nicelabs <-  prefix_strip(out_conf$term, \"continent\")\n```", "```r\np <-  ggplot(out_conf, mapping = aes(x = reorder(nicelabs, estimate),\n y = estimate, ymin = conf.low, ymax = conf.high))\np +  geom_pointrange() +  coord_flip() +  labs(x=\"\", y=\"OLS Estimate\")\n```", "```r\nout_aug <-  augment(out)\nhead(out_aug) %>%  round_df()\n```", "```r\n##   lifeExp gdpPercap      pop continent .fitted .se.fit .resid .hat .sigma .cooksd .std.resid\n## 1    28.8       779  8425333      Asia    56.4    0.47  -27.6    0   8.34    0.01      -3.31\n## 2    30.3       821  9240934      Asia    56.4    0.47  -26.1    0   8.34    0.00      -3.13\n## 3    32.0       853 10267083      Asia    56.5    0.47  -24.5    0   8.35    0.00      -2.93\n## 4    34.0       836 11537966      Asia    56.5    0.47  -22.4    0   8.35    0.00      -2.69\n## 5    36.1       740 13079460      Asia    56.4    0.47  -20.3    0   8.35    0.00      -2.44\n## 6    38.4       786 14880372      Asia    56.5    0.47  -18.0    0   8.36    0.00      -2.16\n```", "```r\nout_aug <-  augment(out, data = gapminder)\nhead(out_aug) %>%  round_df()\n```", "```r\n##       country continent year lifeExp      pop gdpPercap .fitted .se.fit .resid .hat .sigma .cooksd\n## 1 Afghanistan      Asia 1952    28.8  8425333       779    56.4    0.47  -27.6    0   8.34    0.01\n## 2 Afghanistan      Asia 1957    30.3  9240934       821    56.4    0.47  -26.1    0   8.34    0.00\n## 3 Afghanistan      Asia 1962    32.0 10267083       853    56.5    0.47  -24.5    0   8.35    0.00\n## 4 Afghanistan      Asia 1967    34.0 11537966       836    56.5    0.47  -22.4    0   8.35    0.00\n## 5 Afghanistan      Asia 1972    36.1 13079460       740    56.4    0.47  -20.3    0   8.35    0.00\n## 6 Afghanistan      Asia 1977    38.4 14880372       786    56.5    0.47  -18.0    0   8.36    0.00\n##   .std.resid\n## 1      -3.31\n## 2      -3.13\n## 3      -2.93\n## 4      -2.69\n## 5      -2.44\n## 6      -2.16\n```", "```r\np <-  ggplot(data = out_aug,\n mapping = aes(x = .fitted, y = .resid))\np +  geom_point()\n```", "```r\nglance(out) %>%  round_df()\n```", "```r\n##   r.squared adj.r.squared sigma statistic p.value df\n## 1      0.58          0.58  8.37    393.91       0  7\n##     logLik     AIC     BIC deviance df.residual\n## 1 -6033.83 12083.6 12127.2   118754        1697\n```", "```r\nlibrary(survival)\n\nout_cph <-  coxph(Surv(time, status) ~  age +  sex, data = lung)\nout_surv <-  survfit(out_cph)\n```", "```r\nout_tidy <-  tidy(out_surv)\n\np <-  ggplot(data = out_tidy, mapping = aes(time, estimate))\np +  geom_line() +\n geom_ribbon(mapping = aes(ymin = conf.low, ymax = conf.high), alpha = .2)\n```", "```r\neu77 <-  gapminder %>%  filter(continent == \"Europe\", year ==  1977)\n```", "```r\nfit <-  lm(lifeExp ~  log(gdpPercap), data = eu77)\nsummary(fit)\n```", "```r\n## \n## Call:\n## lm(formula = lifeExp ~ log(gdpPercap), data = eu77)\n## \n## Residuals:\n##    Min     1Q Median     3Q    Max \n## -7.496 -1.031  0.093  1.176  3.712 \n## \n## Coefficients:\n##                Estimate Std. Error t value Pr(>|t|)    \n## (Intercept)      29.489      7.161    4.12  0.00031 ***\n## log(gdpPercap)    4.488      0.756    5.94  2.2e-06 ***\n## ---\n## Signif. codes:  \n## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Residual standard error: 2.11 on 28 degrees of freedom\n## Multiple R-squared:  0.557,  Adjusted R-squared:  0.541 \n## F-statistic: 35.2 on 1 and 28 DF,  p-value: 2.17e-06\n```", "```r\nout_le <-  gapminder %>%\n group_by(continent, year) %>%\n nest()\n\nout_le\n```", "```r\n## # A tibble: 60 x 3\n##    continent  year data             \n##    <fct>     <int> <list>           \n##  1 Asia       1952 <tibble [33 × 4]>\n##  2 Asia       1957 <tibble [33 × 4]>\n##  3 Asia       1962 <tibble [33 × 4]>\n##  4 Asia       1967 <tibble [33 × 4]>\n##  5 Asia       1972 <tibble [33 × 4]>\n##  6 Asia       1977 <tibble [33 × 4]>\n##  7 Asia       1982 <tibble [33 × 4]>\n##  8 Asia       1987 <tibble [33 × 4]>\n##  9 Asia       1992 <tibble [33 × 4]>\n## 10 Asia       1997 <tibble [33 × 4]>\n## # ... with 50 more rows\n```", "```r\nout_le %>%  filter(continent == \"Europe\" &  year ==  1977) %>%  unnest()\n```", "```r\n## # A tibble: 30 x 6\n##    continent  year country         lifeExp    pop gdpPercap\n##    <fct>     <int> <fct>             <dbl>  <int>     <dbl>\n##  1 Europe     1977 Albania            68.9 2.51e⁶      3533\n##  2 Europe     1977 Austria            72.2 7.57e⁶     19749\n##  3 Europe     1977 Belgium            72.8 9.82e⁶     19118\n##  4 Europe     1977 Bosnia and Her…    69.9 4.09e⁶      3528\n##  5 Europe     1977 Bulgaria           70.8 8.80e⁶      7612\n##  6 Europe     1977 Croatia            70.6 4.32e⁶     11305\n##  7 Europe     1977 Czech Republic     70.7 1.02e⁷     14800\n##  8 Europe     1977 Denmark            74.7 5.09e⁶     20423\n##  9 Europe     1977 Finland            72.5 4.74e⁶     15605\n## 10 Europe     1977 France             73.8 5.32e⁷     18293\n## # ... with 20 more rows\n```", "```r\nfit_ols <-  function(df) {\n lm(lifeExp ~  log(gdpPercap), data = df)\n}\n\nout_le <-  gapminder %>%\n group_by(continent, year) %>%\n nest() %>% \n mutate(model = map(data, fit_ols)) \n\nout_le\n```", "```r\n## # A tibble: 60 x 4\n##    continent  year data              model   \n##    <fct>     <int> <list>            <list>  \n##  1 Asia       1952 <tibble [33 × 4]> <S3: lm>\n##  2 Asia       1957 <tibble [33 × 4]> <S3: lm>\n##  3 Asia       1962 <tibble [33 × 4]> <S3: lm>\n##  4 Asia       1967 <tibble [33 × 4]> <S3: lm>\n##  5 Asia       1972 <tibble [33 × 4]> <S3: lm>\n##  6 Asia       1977 <tibble [33 × 4]> <S3: lm>\n##  7 Asia       1982 <tibble [33 × 4]> <S3: lm>\n##  8 Asia       1987 <tibble [33 × 4]> <S3: lm>\n##  9 Asia       1992 <tibble [33 × 4]> <S3: lm>\n## 10 Asia       1997 <tibble [33 × 4]> <S3: lm>\n## # ... with 50 more rows\n```", "```r\nfit_ols <-  function(df) {\n lm(lifeExp ~  log(gdpPercap), data = df)\n}\n\nout_tidy <-  gapminder %>%\n group_by(continent, year) %>%\n nest() %>% \n mutate(model = map(data, fit_ols),\n tidied = map(model, tidy)) %>%\n unnest(tidied, .drop = TRUE) %>%\n filter(term %nin% \"(Intercept)\" &\n continent %nin% \"Oceania\")\n\nout_tidy %>%  sample_n(5)\n```", "```r\n## # A tibble: 5 x 7\n##   continent  year term           estimate std.error statistic      p.value\n##   <fct>     <int> <chr>             <dbl>     <dbl>     <dbl>        <dbl>\n## 1 Europe     1987 log(gdpPercap)     4.14     0.752      5.51 0.00000693  \n## 2 Asia       1972 log(gdpPercap)     4.44     1.01       4.41 0.000116    \n## 3 Europe     1972 log(gdpPercap)     4.51     0.757      5.95 0.00000208  \n## 4 Americas   1952 log(gdpPercap)    10.4      2.72       3.84 0.000827    \n## 5 Asia       1987 log(gdpPercap)     5.17     0.727      7.12 0.0000000531\n```", "```r\np <-  ggplot(data = out_tidy,\n mapping = aes(x = year, y = estimate,\n ymin = estimate -  2*std.error,\n ymax = estimate +  2*std.error,\n group = continent, color = continent))\n\np +  geom_pointrange(position = position_dodge(width = 1)) +\n scale_x_continuous(breaks = unique(gapminder$year)) + \n theme(legend.position = \"top\") +\n labs(x = \"Year\", y = \"Estimate\", color = \"Continent\")\n```", "```r\nlibrary(margins)\n```", "```r\ngss_sm$polviews_m <-  relevel(gss_sm$polviews, ref = \"Moderate\")\n\nout_bo <-  glm(obama ~  polviews_m +  sex*race,\n family = \"binomial\", data = gss_sm)\nsummary(out_bo)\n```", "```r\n## \n## Call:\n## glm(formula = obama ~ polviews_m + sex * race, family = \"binomial\", \n##     data = gss_sm)\n## \n## Deviance Residuals: \n##    Min      1Q  Median      3Q     Max  \n## -2.905  -0.554   0.177   0.542   2.244  \n## \n## Coefficients:\n##                                  Estimate Std. Error z value Pr(>|z|)    \n## (Intercept)                       0.29649    0.13409    2.21   0.0270 *  \n## polviews_mExtremely Liberal       2.37295    0.52504    4.52  6.2e-06 ***\n## polviews_mLiberal                 2.60003    0.35667    7.29  3.1e-13 ***\n## polviews_mSlightly Liberal        1.29317    0.24843    5.21  1.9e-07 ***\n## polviews_mSlightly Conservative  -1.35528    0.18129   -7.48  7.7e-14 ***\n## polviews_mConservative           -2.34746    0.20038  -11.71  < 2e-16 ***\n## polviews_mExtremely Conservative -2.72738    0.38721   -7.04  1.9e-12 ***\n## sexFemale                         0.25487    0.14537    1.75   0.0796 .  \n## raceBlack                         3.84953    0.50132    7.68  1.6e-14 ***\n## raceOther                        -0.00214    0.43576    0.00   0.9961    \n## sexFemale:raceBlack              -0.19751    0.66007   -0.30   0.7648    \n## sexFemale:raceOther               1.57483    0.58766    2.68   0.0074 ** \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## (Dispersion parameter for binomial family taken to be 1)\n## \n##     Null deviance: 2247.9  on 1697  degrees of freedom\n## Residual deviance: 1345.9  on 1686  degrees of freedom\n##   (1169 observations deleted due to missingness)\n## AIC: 1370\n## \n## Number of Fisher Scoring iterations: 6\n```", "```r\nbo_m <-  margins(out_bo)\nsummary(bo_m)\n```", "```r\n##                            factor     AME     SE        z      p   lower   upper\n##            polviews_mConservative -0.4119 0.0283 -14.5394 0.0000 -0.4674 -0.3564\n##  polviews_mExtremely Conservative -0.4538 0.0420 -10.7971 0.0000 -0.5361 -0.3714\n##       polviews_mExtremely Liberal  0.2681 0.0295   9.0996 0.0000  0.2103  0.3258\n##                 polviews_mLiberal  0.2768 0.0229  12.0736 0.0000  0.2319  0.3218\n##   polviews_mSlightly Conservative -0.2658 0.0330  -8.0596 0.0000 -0.3304 -0.2011\n##        polviews_mSlightly Liberal  0.1933 0.0303   6.3896 0.0000  0.1340  0.2526\n##                         raceBlack  0.4032 0.0173  23.3568 0.0000  0.3694  0.4371\n##                         raceOther  0.1247 0.0386   3.2297 0.0012  0.0490  0.2005\n##                         sexFemale  0.0443 0.0177   2.5073 0.0122  0.0097  0.0789\n```", "```r\nbo_gg <-  as_tibble(summary(bo_m))\nprefixes <-  c(\"polviews_m\", \"sex\")\nbo_gg$factor <-  prefix_strip(bo_gg$factor, prefixes)\nbo_gg$factor <-  prefix_replace(bo_gg$factor, \"race\", \"Race: \")\n\nbo_gg %>%  select(factor, AME, lower, upper) \n```", "```r\n## # A tibble: 9 x 4\n##   factor                     AME    lower   upper\n## * <chr>                    <dbl>    <dbl>   <dbl>\n## 1 Conservative           -0.412  -0.467   -0.356 \n## 2 Extremely Conservative -0.454  -0.536   -0.371 \n## 3 Extremely Liberal       0.268   0.210    0.326 \n## 4 Liberal                 0.277   0.232    0.322 \n## 5 Slightly Conservative  -0.266  -0.330   -0.201 \n## 6 Slightly Liberal        0.193   0.134    0.253 \n## 7 Race: Black             0.403   0.369    0.437 \n## 8 Race: Other             0.125   0.0490   0.200 \n## 9 Female                  0.0443  0.00967  0.0789\n```", "```r\np <-  ggplot(data = bo_gg, aes(x = reorder(factor, AME),\n y = AME, ymin = lower, ymax = upper))\n\np +  geom_hline(yintercept = 0, color = \"gray80\") +\n geom_pointrange() +  coord_flip() +\n labs(x = NULL, y = \"Average Marginal Effect\") \n```", "```r\npv_cp <-  cplot(out_bo, x = \"sex\", draw = FALSE)\n\np <-  ggplot(data = pv_cp, aes(x = reorder(xvals, yvals),\n y = yvals, ymin = lower, ymax = upper))\n\np +  geom_hline(yintercept = 0, color = \"gray80\") +\n geom_pointrange() +  coord_flip() +\n labs(x = NULL, y = \"Conditional Effect\") \n```", "```r\nlibrary(survey)\nlibrary(srvyr)\n```", "```r\noptions(survey.lonely.psu = \"adjust\")\noptions(na.action=\"na.pass\")\n\ngss_wt <-  subset(gss_lon, year >  1974) %>%\n mutate(stratvar = interaction(year, vstrat)) %>%\n as_survey_design(ids = vpsu,\n strata = stratvar,\n weights = wtssall,\n nest = TRUE)\n```", "```r\nout_grp <-  gss_wt %>%\n filter(year %in%  seq(1976, 2016, by = 4)) %>%\n group_by(year, race, degree) %>%\n summarize(prop = survey_mean(na.rm = TRUE))\n\nout_grp\n```", "```r\n## # A tibble: 150 x 5\n##     year race  degree           prop prop_se\n##    <dbl> <fct> <fct>           <dbl>   <dbl>\n##  1  1976 White Lt High School 0.328  0.0160 \n##  2  1976 White High School    0.518  0.0162 \n##  3  1976 White Junior College 0.0129 0.00298\n##  4  1976 White Bachelor       0.101  0.00960\n##  5  1976 White Graduate       0.0393 0.00644\n##  6  1976 Black Lt High School 0.562  0.0611 \n##  7  1976 Black High School    0.337  0.0476 \n##  8  1976 Black Junior College 0.0426 0.0193 \n##  9  1976 Black Bachelor       0.0581 0.0239 \n## 10  1976 Black Graduate       0      0      \n## # ... with 140 more rows\n```", "```r\nout_mrg <-  gss_wt %>%\n filter(year %in%  seq(1976, 2016, by = 4)) %>%\n mutate(racedeg = interaction(race, degree)) %>%\n group_by(year, racedeg) %>%\n summarize(prop = survey_mean(na.rm = TRUE))\n\nout_mrg\n```", "```r\n## # A tibble: 150 x 4\n##     year racedeg                 prop prop_se\n##    <dbl> <fct>                  <dbl>   <dbl>\n##  1  1976 White.Lt High School 0.298   0.0146 \n##  2  1976 Black.Lt High School 0.0471  0.00840\n##  3  1976 Other.Lt High School 0.00195 0.00138\n##  4  1976 White.High School    0.471   0.0160 \n##  5  1976 Black.High School    0.0283  0.00594\n##  6  1976 Other.High School    0.00325 0.00166\n##  7  1976 White.Junior College 0.0117  0.00268\n##  8  1976 Black.Junior College 0.00357 0.00162\n##  9  1976 Other.Junior College 0       0      \n## 10  1976 White.Bachelor       0.0919  0.00888\n## # ... with 140 more rows\n```", "```r\nout_mrg <-  gss_wt %>%\n filter(year %in%  seq(1976, 2016, by = 4)) %>%\n mutate(racedeg = interaction(race, degree)) %>%\n group_by(year, racedeg) %>%\n summarize(prop = survey_mean(na.rm = TRUE)) %>%\n separate(racedeg, sep = \"\\\\.\", into = c(\"race\", \"degree\"))\n\nout_mrg\n```", "```r\n## # A tibble: 150 x 5\n##     year race  degree            prop prop_se\n##    <dbl> <chr> <chr>            <dbl>   <dbl>\n##  1  1976 White Lt High School 0.298   0.0146 \n##  2  1976 Black Lt High School 0.0471  0.00840\n##  3  1976 Other Lt High School 0.00195 0.00138\n##  4  1976 White High School    0.471   0.0160 \n##  5  1976 Black High School    0.0283  0.00594\n##  6  1976 Other High School    0.00325 0.00166\n##  7  1976 White Junior College 0.0117  0.00268\n##  8  1976 Black Junior College 0.00357 0.00162\n##  9  1976 Other Junior College 0       0      \n## 10  1976 White Bachelor       0.0919  0.00888\n## # ... with 140 more rows\n```", "```r\np <-  ggplot(data = subset(out_grp, race %nin% \"Other\"),\n mapping = aes(x = degree, y = prop,\n ymin = prop -  2*prop_se,\n ymax = prop +  2*prop_se,\n fill = race,\n color = race,\n group = race))\n\ndodge <-  position_dodge(width=0.9)\n\np +  geom_col(position = dodge, alpha = 0.2) +\n geom_errorbar(position = dodge, width = 0.2) +\n scale_x_discrete(labels = scales::wrap_format(10)) +\n scale_y_continuous(labels = scales::percent) +\n scale_color_brewer(type = \"qual\", palette = \"Dark2\") +\n scale_fill_brewer(type = \"qual\", palette = \"Dark2\") +\n labs(title = \"Educational Attainment by Race\",\n subtitle = \"GSS 1976-2016\",\n fill = \"Race\",\n color = \"Race\",\n x = NULL, y = \"Percent\") +\n facet_wrap(~  year, ncol = 2) +\n theme(legend.position = \"top\")\n```", "```r\np <-  ggplot(data = subset(out_grp, race %nin% \"Other\"),\n mapping = aes(x = year, y = prop, ymin = prop -  2*prop_se,\n ymax = prop +  2*prop_se, fill = race, color = race,\n group = race))\n\np +  geom_ribbon(alpha = 0.3, aes(color = NULL)) +\n geom_line() + \n facet_wrap(~  degree, ncol = 1) +\n scale_y_continuous(labels = scales::percent) +\n scale_color_brewer(type = \"qual\", palette = \"Dark2\") +\n scale_fill_brewer(type = \"qual\", palette = \"Dark2\") +\n labs(title = \"Educational Attainment\\nby Race\",\n subtitle = \"GSS 1976-2016\", fill = \"Race\",\n color = \"Race\", x = NULL, y = \"Percent\") +\n theme(legend.position = \"top\")\n```", "```r\nout <-  lm(formula = lifeExp ~  log(gdpPercap) +  pop +  continent, data = gapminder)\n```", "```r\n# Plot not shown\nplot(out, which = c(1,2), ask=FALSE)\n```", "```r\nlibrary(coefplot)\nout <-  lm(formula = lifeExp ~  log(gdpPercap) +  log(pop) +  continent, data = gapminder)\n\ncoefplot(out, sort = \"magnitude\", intercept = FALSE)\n```", "```r\nlibrary(GGally)\n\norgandata_sm <-  organdata %>%\n select(donors, pop_dens, pubhealth,\n roads, consent_law)\n\nggpairs(data = organdata_sm,\n mapping = aes(color = consent_law),\n upper = list(continuous = wrap(\"density\"), combo = \"box_no_facet\"),\n lower = list(continuous = wrap(\"points\"), combo = wrap(\"dot_no_facet\")))\n```", "```r\nout <-  lm(formula = lifeExp ~  log(gdpPercap) +  pop +  continent, data = gapminder)\n```", "```r\n# Plot not shown\nplot(out, which = c(1,2), ask=FALSE)\n```", "```r\nlibrary(coefplot)\nout <-  lm(formula = lifeExp ~  log(gdpPercap) +  log(pop) +  continent, data = gapminder)\n\ncoefplot(out, sort = \"magnitude\", intercept = FALSE)\n```", "```r\nlibrary(GGally)\n\norgandata_sm <-  organdata %>%\n select(donors, pop_dens, pubhealth,\n roads, consent_law)\n\nggpairs(data = organdata_sm,\n mapping = aes(color = consent_law),\n upper = list(continuous = wrap(\"density\"), combo = \"box_no_facet\"),\n lower = list(continuous = wrap(\"points\"), combo = wrap(\"dot_no_facet\")))\n```"]