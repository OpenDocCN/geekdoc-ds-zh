<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Chapter 4 Numpy ndarrays Versus R’s matrix and array Types</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Chapter 4 Numpy ndarrays Versus R’s matrix and array Types</h1>
<blockquote>原文：<a href="https://randpythonbook.netlify.app/numpy-ndarrays-versus-rs-matrix-and-array-types">https://randpythonbook.netlify.app/numpy-ndarrays-versus-rs-matrix-and-array-types</a></blockquote>
<div id="numpy-ndarrays-versus-rs-matrix-and-array-types" class="section level1 hasAnchor">

<p>Sometimes you want a collection of elements that are <em>all the same type</em>, but you want to store them in a two- or three-dimensional structure. For instance, say you need to use matrix multiplication for some linear regression software you’re writing, or that you need to use tensors for a computer vision project you’re working on.</p>
<div id="numpy-ndarrays-in-python" class="section level2 hasAnchor">
<h2><span class="header-section-number">4.1</span> Numpy <code>ndarray</code>s In Python<a aria-label="Anchor link to header" class="anchor-section" href="/numpy-ndarrays-versus-rs-matrix-and-array-types#numpy-ndarrays-in-python"/></h2>
<p>In Python, you could still use arrays for these kinds of tasks. You will be pleased to learn that the Numpy <code>array</code>s we discussed earlier are a special case of <a href="https://numpy.org/doc/stable/reference/arrays.ndarray.html">Numpy’s N-dimensional arrays</a>. Each array will come with an enormous amount of <a href="https://numpy.org/doc/stable/reference/arrays.ndarray.html#array-methods">methods</a> and <a href="https://numpy.org/doc/stable/reference/arrays.ndarray.html#array-attributes">attributes</a> (more on object-oriented program in chapter <a href="/an-introduction-to-object-oriented-programming#an-introduction-to-object-oriented-programming">14</a>) attached to it. A few are demonstrated below.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb71-1" title="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb71-2" title="2">a <span class="op">=</span> np.array([[<span class="dv">1</span>,<span class="dv">2</span>],[<span class="dv">3</span>,<span class="dv">4</span>]], np.<span class="bu">float</span>)</a>
<a class="sourceLine" id="cb71-3" title="3">a</a>
<a class="sourceLine" id="cb71-4" title="4"><span class="co">## array([[1., 2.],</span></a>
<a class="sourceLine" id="cb71-5" title="5"><span class="co">##        [3., 4.]])</span></a>
<a class="sourceLine" id="cb71-6" title="6">a.shape</a>
<a class="sourceLine" id="cb71-7" title="7"><span class="co">## (2, 2)</span></a>
<a class="sourceLine" id="cb71-8" title="8">a.ndim</a>
<a class="sourceLine" id="cb71-9" title="9"><span class="co">## 2</span></a>
<a class="sourceLine" id="cb71-10" title="10">a.dtype</a>
<a class="sourceLine" id="cb71-11" title="11"><span class="co">## dtype('float64')</span></a>
<a class="sourceLine" id="cb71-12" title="12">a.<span class="bu">max</span>()</a>
<a class="sourceLine" id="cb71-13" title="13"><span class="co">## 4.0</span></a>
<a class="sourceLine" id="cb71-14" title="14">a.resize((<span class="dv">1</span>,<span class="dv">4</span>)) <span class="co"># modification is **in place**</span></a>
<a class="sourceLine" id="cb71-15" title="15">a</a>
<a class="sourceLine" id="cb71-16" title="16"><span class="co">## array([[1., 2., 3., 4.]])</span></a></code></pre></div>
<p>Matrix and elementwise multiplication is often useful, too.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb72-1" title="1">b <span class="op">=</span> np.ones(<span class="dv">4</span>).reshape((<span class="dv">4</span>,<span class="dv">1</span>)) </a>
<a class="sourceLine" id="cb72-2" title="2">np.dot(b,a) <span class="co"># matrix mult.</span></a>
<a class="sourceLine" id="cb72-3" title="3"><span class="co">## array([[1., 2., 3., 4.],</span></a>
<a class="sourceLine" id="cb72-4" title="4"><span class="co">##        [1., 2., 3., 4.],</span></a>
<a class="sourceLine" id="cb72-5" title="5"><span class="co">##        [1., 2., 3., 4.],</span></a>
<a class="sourceLine" id="cb72-6" title="6"><span class="co">##        [1., 2., 3., 4.]])</span></a>
<a class="sourceLine" id="cb72-7" title="7">b <span class="op">@</span> a <span class="co"># infix matrix mult. from PEP 465</span></a>
<a class="sourceLine" id="cb72-8" title="8"><span class="co">## array([[1., 2., 3., 4.],</span></a>
<a class="sourceLine" id="cb72-9" title="9"><span class="co">##        [1., 2., 3., 4.],</span></a>
<a class="sourceLine" id="cb72-10" title="10"><span class="co">##        [1., 2., 3., 4.],</span></a>
<a class="sourceLine" id="cb72-11" title="11"><span class="co">##        [1., 2., 3., 4.]])</span></a>
<a class="sourceLine" id="cb72-12" title="12">a <span class="op">*</span> np.arange(<span class="dv">4</span>) <span class="co"># elementwise mult.</span></a>
<a class="sourceLine" id="cb72-13" title="13"><span class="co">## array([[ 0.,  2.,  6., 12.]])</span></a></code></pre></div>
<p>I should mention that there is also a <code>matrix</code> type in Numpy; however, this is not described in this text because it is preferable to work with Numpy <code>array</code>s <span class="citation">(Albon <a href="#ref-ml_with_python_cookbook">2018</a>)</span>.</p>
<div class="rmd-details">
<p>In both R and Python, there are <code>matrix</code> types and <code>array</code> types. In R, it is more common to work with <code>matrix</code>s than <code>array</code>s, and the opposite is true in Python!</p>
</div>
</div>
<div id="the-matrix-and-array-classes-in-r" class="section level2 hasAnchor">
<h2><span class="header-section-number">4.2</span> The <code>matrix</code> and <code>array</code> classes in R<a aria-label="Anchor link to header" class="anchor-section" href="/numpy-ndarrays-versus-rs-matrix-and-array-types#the-matrix-and-array-classes-in-r"/></h2>
<p>In Python, adding a dimension to your “container” is simple. You keep using Numpy arrays, and you just change the <code>.shape</code> attribute (perhaps with a call to <code>.reshape()</code> or something similar). In R, there is a stronger distinction between 1-,2-, and 3-dimensional containers. Each has its own class. 2-dimensional containers that store objects of the same type are of the <code>matrix</code> class. Containers with 3 or more dimensions are of the <code>array</code> class<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>. In this section, I will provide a quick introduction to using these two classes. For more information, see chapter 3 of <span class="citation">(Matloff <a href="#ref-matloff_r_book">2011</a>)</span>.</p>
<div class="rmd-caution">
<p>Just like <code>vector</code>s, <code>matrix</code> objects do not necessarily have to be used to perform matrix arithmetic. Yes, they require all the elements are of the same type, but it doesn’t really make sense to “multiply” <code>matrix</code> objects that hold onto <code>character</code>s.</p>
</div>
<p>I usually create <code>matrix</code> objects with the <code>matrix()</code> function or the <code>as.matrix()</code> function. <code>matrix()</code> is to be preferred in my opinion. The first argument is explicitly a <code>vector</code> of all the flattened data that you want in your <code>matrix</code>. On the other hand, <code>as.matrix()</code> is more flexible; it takes in a variety of R objects (e.g. <code>data.frame</code>s), and tries to figure out what to do with them on a case-by-case basis. In other words, <code>as.matrix()</code> is a <em>generic function</em>. More information about generic functions is provided in <a href="/an-introduction-to-object-oriented-programming#using-s3-objects">14.2.2</a>.</p>
<p>Some other things to remember with <code>matrix()</code>: <code>byrow=</code> is <code>FALSE</code> by default, and you will also need to specify either <code>ncol=</code> and/or <code>nrow=</code> if you want anything that isn’t a 1-column <code>matrix</code>.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1">A &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb73-2" title="2">A</a>
<a class="sourceLine" id="cb73-3" title="3"><span class="co">##      [,1]</span></a>
<a class="sourceLine" id="cb73-4" title="4"><span class="co">## [1,]    1</span></a>
<a class="sourceLine" id="cb73-5" title="5"><span class="co">## [2,]    2</span></a>
<a class="sourceLine" id="cb73-6" title="6"><span class="co">## [3,]    3</span></a>
<a class="sourceLine" id="cb73-7" title="7"><span class="co">## [4,]    4</span></a>
<a class="sourceLine" id="cb73-8" title="8"><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb73-9" title="9"><span class="co">##      [,1] [,2]</span></a>
<a class="sourceLine" id="cb73-10" title="10"><span class="co">## [1,]    1    3</span></a>
<a class="sourceLine" id="cb73-11" title="11"><span class="co">## [2,]    2    4</span></a>
<a class="sourceLine" id="cb73-12" title="12"><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> T)</a>
<a class="sourceLine" id="cb73-13" title="13"><span class="co">##      [,1] [,2]</span></a>
<a class="sourceLine" id="cb73-14" title="14"><span class="co">## [1,]    1    2</span></a>
<a class="sourceLine" id="cb73-15" title="15"><span class="co">## [2,]    3    4</span></a>
<a class="sourceLine" id="cb73-16" title="16"><span class="kw">as.matrix</span>(</a>
<a class="sourceLine" id="cb73-17" title="17">  <span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb73-18" title="18">    <span class="dt">firstCol =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb73-19" title="19">    <span class="dt">secondCol =</span> <span class="kw">c</span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>))) <span class="co"># coerces numbers to characters!</span></a>
<a class="sourceLine" id="cb73-20" title="20"><span class="co">##      firstCol secondCol</span></a>
<a class="sourceLine" id="cb73-21" title="21"><span class="co">## [1,] "1"      "a"      </span></a>
<a class="sourceLine" id="cb73-22" title="22"><span class="co">## [2,] "2"      "b"      </span></a>
<a class="sourceLine" id="cb73-23" title="23"><span class="co">## [3,] "3"      "c"</span></a>
<a class="sourceLine" id="cb73-24" title="24"><span class="kw">dim</span>(A)</a>
<a class="sourceLine" id="cb73-25" title="25"><span class="co">## [1] 4 1</span></a>
<a class="sourceLine" id="cb73-26" title="26"><span class="kw">nrow</span>(A)</a>
<a class="sourceLine" id="cb73-27" title="27"><span class="co">## [1] 4</span></a>
<a class="sourceLine" id="cb73-28" title="28"><span class="kw">ncol</span>(A)</a>
<a class="sourceLine" id="cb73-29" title="29"><span class="co">## [1] 1</span></a></code></pre></div>
<p><code>array()</code> is used to create <code>array</code> objects. This type is used less than the <code>matrix</code> type, but this doesn’t mean you should avoid learning about it. This is mostly a reflection of what kind of data sets people prefer to work with, and the fact that matrix algebra is generally better understood than tensor algebra. You won’t be able to avoid 3-d data sets (3-dimensions, not a 3-column <code>matrix</code>) forever, though, particularly if you’re working in an area such as neuroimaging or computer vision.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1">myArray &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">each =</span> <span class="dv">4</span>), <span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb74-2" title="2">myArray</a>
<a class="sourceLine" id="cb74-3" title="3"><span class="co">## , , 1</span></a>
<a class="sourceLine" id="cb74-4" title="4"><span class="co">## </span></a>
<a class="sourceLine" id="cb74-5" title="5"><span class="co">##      [,1] [,2]</span></a>
<a class="sourceLine" id="cb74-6" title="6"><span class="co">## [1,]    1    1</span></a>
<a class="sourceLine" id="cb74-7" title="7"><span class="co">## [2,]    1    1</span></a>
<a class="sourceLine" id="cb74-8" title="8"><span class="co">## </span></a>
<a class="sourceLine" id="cb74-9" title="9"><span class="co">## , , 2</span></a>
<a class="sourceLine" id="cb74-10" title="10"><span class="co">## </span></a>
<a class="sourceLine" id="cb74-11" title="11"><span class="co">##      [,1] [,2]</span></a>
<a class="sourceLine" id="cb74-12" title="12"><span class="co">## [1,]    2    2</span></a>
<a class="sourceLine" id="cb74-13" title="13"><span class="co">## [2,]    2    2</span></a>
<a class="sourceLine" id="cb74-14" title="14"><span class="co">## </span></a>
<a class="sourceLine" id="cb74-15" title="15"><span class="co">## , , 3</span></a>
<a class="sourceLine" id="cb74-16" title="16"><span class="co">## </span></a>
<a class="sourceLine" id="cb74-17" title="17"><span class="co">##      [,1] [,2]</span></a>
<a class="sourceLine" id="cb74-18" title="18"><span class="co">## [1,]    3    3</span></a>
<a class="sourceLine" id="cb74-19" title="19"><span class="co">## [2,]    3    3</span></a></code></pre></div>
<p>You can matrix-multiply <code>matrix</code> objects together with the <code>%*%</code> operator. If you’re working on this, then the transpose operator (i.e. <code>t()</code>) comes in handy, too. You can still use element-wise (Hadamard) multiplication. This is defined with the more familiar multiplication operator <code>*</code>.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1"><span class="co"># calculate a quadratic form y'Qy</span></a>
<a class="sourceLine" id="cb75-2" title="2">y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb75-3" title="3">Q &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span>, <span class="dv">3</span>) <span class="co"># diag() gets and sets diagonal matrices</span></a>
<a class="sourceLine" id="cb75-4" title="4"><span class="kw">t</span>(y) <span class="op">%*%</span><span class="st"> </span>Q <span class="op">%*%</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb75-5" title="5"><span class="co">##      [,1]</span></a>
<a class="sourceLine" id="cb75-6" title="6"><span class="co">## [1,]   14</span></a></code></pre></div>
<p>Sometimes you need to access or modify individual elements of a <code>matrix</code> object. You can use the familiar <code>[</code> and <code>[&lt;-</code> operators to do this. Here is a setting example. You don’t need to worry about coercion to different types here.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1">Qcopy &lt;-<span class="st"> </span>Q</a>
<a class="sourceLine" id="cb76-2" title="2">Qcopy[<span class="dv">1</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb76-3" title="3">Qcopy[<span class="dv">2</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb76-4" title="4">Qcopy</a>
<a class="sourceLine" id="cb76-5" title="5"><span class="co">##      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb76-6" title="6"><span class="co">## [1,]    3    0    0</span></a>
<a class="sourceLine" id="cb76-7" title="7"><span class="co">## [2,]    0    4    0</span></a>
<a class="sourceLine" id="cb76-8" title="8"><span class="co">## [3,]    0    0    1</span></a></code></pre></div>
<p>Here are some extraction examples. Notice that, if it can, <code>[</code> will coerce a <code>matrix</code> to <code>vector</code>. If you wish to avoid this, you can specify <code>drop=FALSE</code>.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">Q</a>
<a class="sourceLine" id="cb77-2" title="2"><span class="co">##      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb77-3" title="3"><span class="co">## [1,]    1    0    0</span></a>
<a class="sourceLine" id="cb77-4" title="4"><span class="co">## [2,]    0    1    0</span></a>
<a class="sourceLine" id="cb77-5" title="5"><span class="co">## [3,]    0    0    1</span></a>
<a class="sourceLine" id="cb77-6" title="6">Q[<span class="dv">1</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb77-7" title="7"><span class="co">## [1] 1</span></a>
<a class="sourceLine" id="cb77-8" title="8">Q[<span class="dv">2</span>,]</a>
<a class="sourceLine" id="cb77-9" title="9"><span class="co">## [1] 0 1 0</span></a>
<a class="sourceLine" id="cb77-10" title="10">Q[<span class="dv">2</span>,,drop=<span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb77-11" title="11"><span class="co">##      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb77-12" title="12"><span class="co">## [1,]    0    1    0</span></a>
<a class="sourceLine" id="cb77-13" title="13"><span class="kw">class</span>(Q)</a>
<a class="sourceLine" id="cb77-14" title="14"><span class="co">## [1] "matrix" "array"</span></a>
<a class="sourceLine" id="cb77-15" title="15"><span class="kw">class</span>(Q[<span class="dv">2</span>,])</a>
<a class="sourceLine" id="cb77-16" title="16"><span class="co">## [1] "numeric"</span></a>
<a class="sourceLine" id="cb77-17" title="17"><span class="kw">class</span>(Q[<span class="dv">2</span>,,<span class="dt">drop=</span><span class="ot">FALSE</span>])  </a>
<a class="sourceLine" id="cb77-18" title="18"><span class="co">## [1] "matrix" "array"</span></a>
<a class="sourceLine" id="cb77-19" title="19"><span class="kw">row</span>(Q) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb77-20" title="20"><span class="co">##       [,1]  [,2]  [,3]</span></a>
<a class="sourceLine" id="cb77-21" title="21"><span class="co">## [1,] FALSE FALSE FALSE</span></a>
<a class="sourceLine" id="cb77-22" title="22"><span class="co">## [2,]  TRUE  TRUE  TRUE</span></a>
<a class="sourceLine" id="cb77-23" title="23"><span class="co">## [3,]  TRUE  TRUE  TRUE</span></a>
<a class="sourceLine" id="cb77-24" title="24">Q[<span class="kw">row</span>(Q) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>] <span class="co"># column-wise ordering</span></a>
<a class="sourceLine" id="cb77-25" title="25"><span class="co">## [1] 0 0 1 0 0 1</span></a></code></pre></div>
<p>There are other functions that operate on one or more <code>matrix</code> objects in more interesting ways, but much of this will be covered in future sections. For instance, we will describe how <code>apply()</code> works with <code>matrix</code>s in section <a href="/an-introduction-to-functional-programming#an-introduction-to-functional-programming">15</a>, and we will discuss combining <code>matrix</code> objects in different ways in section <a href="/reshaping-and-combining-data-sets#reshaping-and-combining-data-sets">12</a>.</p>
</div>
<div id="exercises-2" class="section level2 hasAnchor">
<h2><span class="header-section-number">4.3</span> Exercises<a aria-label="Anchor link to header" class="anchor-section" href="/numpy-ndarrays-versus-rs-matrix-and-array-types#exercises-2"/></h2>
<div id="r-questions-2" class="section level3 hasAnchor">
<h3><span class="header-section-number">4.3.1</span> R Questions<a aria-label="Anchor link to header" class="anchor-section" href="/numpy-ndarrays-versus-rs-matrix-and-array-types#r-questions-2"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>Consider the following data set. Let <span class="math inline">\(N = 20\)</span> be the number of rows. For <span class="math inline">\(i=1,\ldots,N\)</span>, define <span class="math inline">\(\mathbf{x}_i \in \mathbb{R}^4\)</span> as the data in row <span class="math inline">\(i\)</span>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1">d &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(</a>
<a class="sourceLine" id="cb78-2" title="2">  <span class="fl">-1.1585476</span>,  <span class="fl">0.06059602</span>, <span class="fl">-1.854421163</span>,  <span class="fl">1.62855626</span>,</a>
<a class="sourceLine" id="cb78-3" title="3">  <span class="fl">0.5619835</span>,  <span class="fl">0.74857327</span>, <span class="fl">-0.830973409</span>,  <span class="fl">0.38432716</span>,</a>
<a class="sourceLine" id="cb78-4" title="4">  <span class="fl">-1.6949202</span>,  <span class="fl">1.24726626</span>,  <span class="fl">0.068601035</span>, <span class="fl">-0.32505127</span>,</a>
<a class="sourceLine" id="cb78-5" title="5">  <span class="fl">2.8260260</span>, <span class="fl">-0.68567999</span>, <span class="fl">-0.109012111</span>, <span class="fl">-0.59738648</span>,</a>
<a class="sourceLine" id="cb78-6" title="6">  <span class="fl">-0.3128249</span>, <span class="fl">-0.21192009</span>, <span class="fl">-0.317923437</span>, <span class="fl">-1.60813901</span>,</a>
<a class="sourceLine" id="cb78-7" title="7">  <span class="fl">0.3830597</span>,  <span class="fl">0.68000706</span>,  <span class="fl">0.787044622</span>,  <span class="fl">0.13872087</span>,</a>
<a class="sourceLine" id="cb78-8" title="8">  <span class="fl">-0.2381630</span>,  <span class="fl">1.02531172</span>, <span class="fl">-0.606091651</span>,  <span class="fl">1.80442260</span>,</a>
<a class="sourceLine" id="cb78-9" title="9">  <span class="fl">1.5429671</span>, <span class="fl">-0.05174198</span>, <span class="fl">-1.950780046</span>, <span class="fl">-0.87716787</span>,</a>
<a class="sourceLine" id="cb78-10" title="10">  <span class="fl">-0.5927925</span>, <span class="fl">-0.40566883</span>, <span class="fl">-0.309193162</span>,  <span class="fl">1.25575250</span>,</a>
<a class="sourceLine" id="cb78-11" title="11">  <span class="fl">-0.8970403</span>, <span class="fl">-0.10111751</span>,  <span class="fl">1.555160257</span>, <span class="fl">-0.54434356</span>,</a>
<a class="sourceLine" id="cb78-12" title="12">  <span class="fl">2.4060504</span>, <span class="fl">-0.08199934</span>, <span class="fl">-0.472715155</span>,  <span class="fl">0.25254794</span>,</a>
<a class="sourceLine" id="cb78-13" title="13">  <span class="fl">-1.0145770</span>, <span class="fl">-0.83132666</span>, <span class="fl">-0.009597552</span>, <span class="fl">-1.71378699</span>,</a>
<a class="sourceLine" id="cb78-14" title="14">  <span class="fl">-0.3590219</span>,  <span class="fl">0.84127504</span>,  <span class="fl">0.062052945</span>, <span class="fl">-1.00587841</span>,</a>
<a class="sourceLine" id="cb78-15" title="15">  <span class="fl">-0.1335952</span>, <span class="fl">-0.02769315</span>, <span class="fl">-0.102229046</span>, <span class="fl">-1.08526057</span>,</a>
<a class="sourceLine" id="cb78-16" title="16">  <span class="fl">0.1641571</span>, <span class="fl">-0.08308289</span>, <span class="fl">-0.711009361</span>,  <span class="fl">0.06809487</span>,</a>
<a class="sourceLine" id="cb78-17" title="17">  <span class="fl">2.2450975</span>,  <span class="fl">0.32619749</span>,  <span class="fl">1.280665384</span>,  <span class="fl">1.75090469</span>,</a>
<a class="sourceLine" id="cb78-18" title="18">  <span class="fl">1.2147885</span>,  <span class="fl">0.10720830</span>, <span class="fl">-2.018215962</span>,  <span class="fl">0.34602861</span>,</a>
<a class="sourceLine" id="cb78-19" title="19">  <span class="fl">0.7309219</span>, <span class="fl">-0.60083707</span>, <span class="fl">-1.007344145</span>, <span class="fl">-1.77345958</span>,</a>
<a class="sourceLine" id="cb78-20" title="20">  <span class="fl">0.1791807</span>, <span class="fl">-0.49500051</span>,  <span class="fl">0.402840566</span>,  <span class="fl">0.60532646</span>,</a>
<a class="sourceLine" id="cb78-21" title="21">  <span class="fl">1.0454594</span>,  <span class="fl">1.09878293</span>,  <span class="fl">2.784986486</span>, <span class="fl">-0.22579848</span>), <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p>For the following problems, make sure to only use the transpose function <code>t()</code>, matrix multiplication (i.e. <code>%*%</code>), and scalar multiplication/division. You may use other functions in interactive mode to check your work, but please do not use them in your submission.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Calculate the sample mean <span class="math inline">\(\bar{\mathbf{x}} = \frac{1}{N} \sum_{i=1}^N \mathbf{x}_i\)</span>. Check your work with <code>colMeans()</code>, <strong>but don’t use that function in your submitted code.</strong> Assign it to the variable <code>xbar</code>. Make sure it is a <span class="math inline">\(4 \times 1\)</span> <code>matrix</code> object.</p></li>
<li><p>Calculate the <span class="math inline">\(4 \times 4\)</span> sample covariance of the following data. Call the variable <code>mySampCov</code>, and make sure it is also a <code>matrix</code> object. <strong>You can check your work with <code>cov()</code>, but don’t use it in your submitted code.</strong> A formula for the sample covariance is
<span class="math display">\[\begin{equation} 
  \frac{1}{N-1} \sum_{i=1}^N (\mathbf{x}_i - \bar{\mathbf{x}})(\mathbf{x}_i - \bar{\mathbf{x}})^\intercal
  \end{equation}\]</span></p></li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<p>Create a <code>matrix</code> called <code>P</code> that has one hundred rows, one hundred columns, all of its elements nonnegative, <span class="math inline">\(1/10\)</span> on every diagonal element, and all rows summing to one. This matrix is called <strong>stochastic</strong> and it describes how a Markov chain moves randomly through time.</p>
<ol start="3" style="list-style-type: decimal">
<li/>
</ol>
<p>Create a <code>matrix</code> called <code>X</code> that has one thousand rows, four columns, has every element set to either <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>, has its first column set to all <span class="math inline">\(1\)</span>s, has the second column set to <span class="math inline">\(1\)</span> in the second <span class="math inline">\(250\)</span> elements and <span class="math inline">\(0\)</span> elsewhere, has the third column set to <span class="math inline">\(1\)</span> in the third <span class="math inline">\(250\)</span> spots and <span class="math inline">\(0\)</span> elsewhere, and has the fourth column set to <span class="math inline">\(1\)</span> in the last <span class="math inline">\(250\)</span> spots and <span class="math inline">\(0\)</span> elsewhere. In other words, it looks something like</p>
<p><span class="math display">\[\begin{equation} 
  \begin{bmatrix}
  \mathbf{1}_{250}  &amp; \mathbf{0}_{250} &amp; \mathbf{0}_{250} &amp; \mathbf{0}_{250} \\
  \mathbf{1}_{250}  &amp; \mathbf{1}_{250} &amp; \mathbf{0}_{250} &amp; \mathbf{0}_{250} \\
  \mathbf{1}_{250}  &amp; \mathbf{0}_{250} &amp; \mathbf{1}_{250} &amp; \mathbf{0}_{250} \\
  \mathbf{1}_{250}  &amp; \mathbf{0}_{250} &amp; \mathbf{0}_{250} &amp; \mathbf{1}_{250} \\
  \end{bmatrix}
\end{equation}\]</span>
where <span class="math inline">\(\mathbf{1}_{250}\)</span> and <span class="math inline">\(\mathbf{0}_{250}\)</span> are length <span class="math inline">\(250\)</span> column vectors with all of their elements set to <span class="math inline">\(1\)</span> or <span class="math inline">\(0\)</span>, respectively.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Compute the <strong>projection (or hat) matrix</strong> <span class="math inline">\(\mathbf{H} := \mathbf{X}\left(\mathbf{X}^\intercal \mathbf{X}\right)^{-1} \mathbf{X}^\intercal\)</span>. Make it a <code>matrix</code> and call it <code>H</code>.</p></li>
<li><p>An <strong>exchangeable</strong> covariance matrix for a random vector is a covariance matrix that has all the same variances, and all the same covariances. In other words, it has two unique elements: the diagonal elements should be the same, and the off-diagonals should be the same. In R, generate ten <span class="math inline">\(100 \times 100\)</span> <strong>exchangeable</strong> covariance matrices, each with <span class="math inline">\(2\)</span> as the variance, and have the possible covariances take values in the collection <span class="math inline">\(0,.01,.02, ..., .09.\)</span> Store these ten covariance matrices in a three-dimensional array. The first index should be each matrix’s row index, the second should be the column index of each matrix, and the third index should be the “layer” or “slice” indicating which of the <span class="math inline">\(10\)</span> matrices you have. Name this array <code>myCovMats</code></p></li>
<li><p>In R, generate one hundred <span class="math inline">\(10 \times 10\)</span> <strong>exchangeable</strong> covariance matrices, each with <span class="math inline">\(2\)</span> as the variance, and have the possible covariances take values in the collection <span class="math inline">\(0,0.0009090909, ..., 0.0890909091, .09.\)</span> Store these <span class="math inline">\(100\)</span> covariance matrices in a three-dimensional array. The first index should be each matrix’s row index, the second should be the column index of each matrix, and the third index should be the “layer” or “slice” indicating which of the <span class="math inline">\(100\)</span> matrices you have. Name this array <code>myCovMats2</code></p></li>
</ol>
</div>
<div id="python-questions-2" class="section level3 hasAnchor">
<h3><span class="header-section-number">4.3.2</span> Python Questions<a aria-label="Anchor link to header" class="anchor-section" href="/numpy-ndarrays-versus-rs-matrix-and-array-types#python-questions-2"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>Let <span class="math inline">\(\mathbf{X}\)</span> be an <span class="math inline">\(n \times 1\)</span> random vector. It has a multivariate normal distribution with mean vector <span class="math inline">\(\mathbf{m}\)</span> and positive definite covariance matrix <span class="math inline">\(\mathbf{C}\)</span> if its probability density function can be written as</p>
<p><span class="math display">\[\begin{equation} 
f(\mathbf{x}; \mathbf{m}, \mathbf{C}) = (2\pi)^{-n/2}\text{det}\left( \mathbf{C} \right)^{-1/2}\exp\left[- \frac{1}{2} (\mathbf{x}- \mathbf{m})^\intercal \mathbf{C}^{-1} (\mathbf{x}- \mathbf{m}) \right]
\end{equation}\]</span></p>
<p>Evaluating this density should be done with care. There is no one function that is optimal for all situations. Here are a couple quick things to consider.</p>
<ul>
<li><p>Inverting very large matrices with either <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.solve.html"><code>np.linalg.solve</code></a> or <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.inv.html"><code>np.linalg.inv</code></a> becomes very slow if the covariance matrix is high-dimensional. If you have special assumptions about the structure of the covariance matrix, use it! Also, it’s a good idea to be aware of what happens when you try to invert noninvertible matrices. For instance, can you rely on errors to be thrown, or will it return a bogus answer?</p></li>
<li><p>Recall from the last lab that exponentiating numbers close to <span class="math inline">\(-\infty\)</span> risks numerical underflow. It’s better to prefer evaluating log densities (base <span class="math inline">\(e\)</span>, the natural logarithm). There are also <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.slogdet.html">special functions that evaluate log determinants</a> that are less likely to underflow/overflow, too!</p></li>
</ul>
<p>Complete the following problems. <strong>Do not use pre-made functions such as <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.norm.html"><code>scipy.stats.norm</code></a> and <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.multivariate_normal.html"><code>scipy.stats.multivariate_normal</code></a> in your submission, but you may use them to check your work. Use only “standard” functions and Numpy n-dimensional arrays.</strong> Use the following definitions for <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{m}\)</span>:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb79-1" title="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb79-2" title="2">x <span class="op">=</span> np.array([<span class="fl">1.1</span>, <span class="fl">.9</span>, <span class="fl">1.0</span>]).reshape((<span class="dv">3</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb79-3" title="3">m <span class="op">=</span> np.ones(<span class="dv">3</span>).reshape((<span class="dv">3</span>,<span class="dv">1</span>))</a></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><p>Let <span class="math inline">\(\mathbf{C} = \begin{bmatrix} 10 &amp; 0 &amp; 0 \\ 0 &amp; 10 &amp; 0 \\ 0 &amp; 0 &amp; 10 \end{bmatrix}\)</span>. Evaluate and assign the log density to a <code>float</code>-like called <code>log_dens1</code>. Can you do this without defining a numpy array for <span class="math inline">\(\mathbf{C}\)</span>?</p></li>
<li><p>Let <span class="math inline">\(\mathbf{C} = \begin{bmatrix} 10 &amp; 0 &amp; 0 \\ 0 &amp; 11 &amp; 0 \\ 0 &amp; 0 &amp; 12 \end{bmatrix}\)</span>. Evaluate and assign the log density to a <code>float</code>-like called <code>log_dens2</code>. Can you do this without defining a numpy array for <span class="math inline">\(\mathbf{C}\)</span>?</p></li>
<li><p>Let <span class="math inline">\(\mathbf{C} = \begin{bmatrix} 10 &amp; -.9 &amp; -.9 \\ -.9 &amp; 11 &amp; -.9 \\ -.9 &amp; -.9 &amp; 12 \end{bmatrix}\)</span>. Evaluate and assign the log density to a <code>float</code>-like called <code>log_dens3</code>. Can you do this without defining a numpy array for <span class="math inline">\(\mathbf{C}\)</span>?</p></li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<p>Consider this <a href="https://archive.ics.uci.edu/ml/datasets/Wine+Quality">wine data set</a> from <span class="citation">(Cortez et al. <a href="#ref-wine_data">2009</a>)</span> hosted by <span class="citation">(Dua and Graff <a href="#ref-uci_data">2017</a>)</span>. Read it in with the following code. Note that you might need to use <code>os.chdir()</code> first.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb80-1" title="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb80-2" title="2">d <span class="op">=</span> pd.read_csv(<span class="st">"winequality-red.csv"</span>, sep <span class="op">=</span> <span class="st">";"</span>)</a>
<a class="sourceLine" id="cb80-3" title="3">d.head()</a></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><p>Create the <strong>design matrix</strong> (denoted mathematically by <span class="math inline">\(\mathbf{X}\)</span>) by removing the <code>"quality"</code> column, and subtracting the column mean from each element. Call the variable <code>X</code>, and make sure that it is a Numpy <code>ndarray</code>, not a Pandas <code>DataFrame</code>.</p></li>
<li><p>Compute the <strong>spectral decomposition</strong> of <span class="math inline">\(\mathbf{X}^\intercal \mathbf{X}\)</span>. In other words, find “special” matrices<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> <span class="math inline">\(\mathbf{V}\)</span> and <span class="math inline">\(\boldsymbol{\Lambda}\)</span> such that <span class="math inline">\(\mathbf{X}^\intercal \mathbf{X} = \mathbf{V} \boldsymbol{\Lambda} \mathbf{V}^\intercal\)</span>. Note that the <em>eigenvectors</em> are stored as columns in a matrix <span class="math inline">\(\mathbf{V} := \begin{bmatrix} \mathbf{V}_1 &amp; \cdots &amp; \mathbf{V}_{11}\end{bmatrix}\)</span>, and the scalar <em>eigenvalues</em> are stored as diagonal elements <span class="math inline">\(\boldsymbol{\Lambda} = \text{diag}(\lambda_1, \ldots, \lambda_{11})\)</span>. Store the eigenvectors in an <code>ndarray</code> called <code>eig_vecs</code>, and store the eigenvalues in a Numpy <code>array</code> called <code>eig_vals</code>. Hint: use <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.eig.html"><code>np.linalg.eig()</code></a>. Also, if you’re rusty with your linear algebra, don’t worry too much about refreshing your memory about what eigenvectors and eigenvalues are.</p></li>
<li><p>Compute the <strong>singular value decomposition</strong> of <span class="math inline">\(\mathbf{X}\)</span>. In other words, find “special”<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a> matrices <span class="math inline">\(\mathbf{U}\)</span>, <span class="math inline">\(\mathbf{\Sigma}\)</span>, and <span class="math inline">\(\mathbf{V}\)</span> such that <span class="math inline">\(\mathbf{X} = \mathbf{U} \mathbf{\Sigma} \mathbf{V}^\intercal\)</span>. Use <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.svd.html"><code>np.linalg.svd</code></a>, and don’t worry too much about the mathematical details. These two decompositions are related. If you do it correctly, the two <span class="math inline">\(\mathbf{V}\)</span> matrices should be the same, and the elements of <span class="math inline">\(\boldsymbol{\Sigma}\)</span> should be the square roots of the elements of <span class="math inline">\(\boldsymbol{\Lambda}\)</span>. Store the eigenvectors as columns in an <code>ndarray</code> called <code>eig_vecs_v2</code>, and store the singular values (diagonal elements of <span class="math inline">\(\boldsymbol{\Sigma}\)</span>) in a Numpy <code>array</code> called <code>sing_vals</code>.</p></li>
<li><p>Compute the <strong>first principal component</strong> vector, and call it <code>first_pc_v1</code>. The mathematical formula is <span class="math inline">\(\mathbf{X} \mathbf{U}_1\)</span> where <span class="math inline">\(\mathbf{U}_1\)</span> is the eigenvector associated with the largest eigenvalue <span class="math inline">\(\lambda_1\)</span>. This can be thought of as, in a sense, the most informative predictor that you can create by averaging together all other predictors.</p></li>
</ol>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-ml_with_python_cookbook">
<p>Albon, Chris. 2018. <em>Machine Learning with Python Cookbook: Practical Solutions from Preprocessing to Deep Learning</em>. 1st ed. O’Reilly Media, Inc.</p>
</div>
<div id="ref-wine_data">
<p>Cortez, Paulo, António Cerdeira, Fernando Almeida, Telmo Matos, and José Reis. 2009. “Modeling Wine Preferences by Data Mining from Physicochemical Properties.” <em>Decis. Support Syst.</em> 47 (4): 547–53. <a href="http://dblp.uni-trier.de/db/journals/dss/dss47.html#CortezCAMR09">http://dblp.uni-trier.de/db/journals/dss/dss47.html#CortezCAMR09</a>.</p>
</div>
<div id="ref-uci_data">
<p>Dua, Dheeru, and Casey Graff. 2017. “UCI Machine Learning Repository.” University of California, Irvine, School of Information; Computer Sciences. <a href="http://archive.ics.uci.edu/ml">http://archive.ics.uci.edu/ml</a>.</p>
</div>
<div id="ref-matloff_r_book">
<p>Matloff, Norman. 2011. <em>The Art of R Programming: A Tour of Statistical Software Design</em>. 1st ed. USA: No Starch Press.</p>
</div>
</div>
<div class="footnotes">
<hr/>
<ol start="7">
<li id="fn7"><p>Technically, the distinction between all of these containers is more subtle. An <code>array</code> in R can have one, two or more dimensions, and it is just a vector which is stored with additional dimension attributes. Moreover, a 2-dimensional array is the same as a <code>matrix</code>.<a class="footnote-back" href="/numpy-ndarrays-versus-rs-matrix-and-array-types#fnref7">↩</a></p></li>
<li id="fn8"><p>Do not worry too much about the properties of these matrices for this problem<a class="footnote-back" href="/numpy-ndarrays-versus-rs-matrix-and-array-types#fnref8">↩</a></p></li>
<li id="fn9"><p>Again, do not worry too much about the properties of these matrices for this problem.<a class="footnote-back" href="/numpy-ndarrays-versus-rs-matrix-and-array-types#fnref9">↩</a></p></li>
</ol>
</div>
                
</body>
</html>