<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Affine Particle-In-Cell Transfer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Affine Particle-In-Cell Transfer</h1>
<blockquote>原文：<a href="https://phys-sim-book.github.io/lec30.3-apic_transfer.html">https://phys-sim-book.github.io/lec30.3-apic_transfer.html</a></blockquote>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"/>

<p>We defined the material point data following <a href="./lec29.1-simulation_setup.html">Simulation Setup</a>, extending it with two additional terms: the affine velocity field <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9722em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathbf">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span> used in the APIC transfer scheme and the scalar <code>log_J_diff</code> used for volume correction as described in <a href="./lec30.1-drucker_prager.html">Drucker-Prager Elastoplasticity</a>.</p>
<p>During the particle-to-grid (P2G) transfer, we adopt the <strong>APIC formulation</strong> for momentum exchange. Instead of directly transferring particle velocity, we include the local affine velocity field <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9722em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathbf">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span>. Specifically, momentum is transferred using the form:</p>
<p><a name="imp:lec30:apic_p2g"/>
<strong>Implementation 31.3.1 (Affine Transfer in APIC Particle-to-Grid (P2G), simulator.py).</strong></p>
<pre><code class="language-python">                grid_v[base + offset] += weight * m[p] * (v[p] + C[p] @ dpos) # momentum Transfer, APIC formulation
</code></pre>
<p>Here, <code>dpos</code> is the offset from the particle to the grid node.</p>
<p>During the grid-to-particle (G2P) transfer, we gather both the updated velocity and the <strong>affine velocity matrix <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9722em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathbf">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></strong> from the background grid. The affine matrix is computed from the weighted outer product of grid velocities and position offsets. This allows each particle to retain local velocity variation, significantly reducing numerical dissipation compared to PIC.</p>
<p><a name="imp:lec30:apic_g2p"/>
<strong>Implementation 31.3.2 (Affine Transfer in APIC Grid-to-Particle (G2P), simulator.py).</strong></p>
<pre><code class="language-python">                new_C += weight * grid_v[base + offset].outer_product(dpos) / D
</code></pre>
<p>Here, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> is a constant factor when using the Quadratic B-spline interpolation function:</p>
<p><a name="imp:lec30:D_def"/>
<strong>Implementation 31.3.3 (Constant D for Quadratic B-spline used for APIC, simulator.py).</strong></p>
<pre><code class="language-python">D = (1./4.) * dx * dx # constant D for Quadratic B-spline used for APIC
</code></pre>
<figure>
    <center>
    <img src="../Images/59983679509afb8a49f1db1670113e62.png" data-original-src="https://phys-sim-book.github.io/img/lec30/mpm_sand_simulation_result.png"/>
    </center>
    <figcaption><b><a name="fig:lec30:mpm_sand_simulation_result"/>
Figure 31.3.1.</b> Time sequence of a 2D sand block falling onto a static red sphere collider. The sand undergoes irreversible deformation and splashing upon impact, demonstrating granular flow and frictional boundary response. </figcaption>
</figure>
                        
</body>
</html>