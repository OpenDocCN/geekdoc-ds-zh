- en: RAM & CPU Caches
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://en.algorithmica.org/hpc/cpu-cache/](https://en.algorithmica.org/hpc/cpu-cache/)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In the [previous chapter](../external-memory), we studied computer memory from
    a theoretical standpoint, using the [external memory model](../external-memory/model)
    to estimate the performance of memory-bound algorithms.
  prefs: []
  type: TYPE_NORMAL
- en: While the external memory model is more or less accurate for computations involving
    HDDs and network storage, where cost of arithmetic operations on in-memory values
    is negligible compared to external I/O operations, it is too imprecise for lower
    levels in the cache hierarchy, where the costs of these operations become comparable.
  prefs: []
  type: TYPE_NORMAL
- en: To perform more fine-grained optimization of in-memory algorithms, we have to
    start taking into account the many specific details of the CPU cache system. And
    instead of studying loads of boring Intel documents with dry specs and theoretically
    achievable limits, we will estimate these parameters experimentally by running
    numerous small benchmark programs with access patterns that resemble the ones
    that often occur in practical code.
  prefs: []
  type: TYPE_NORMAL
- en: Experimental Setup
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'As before, I will be running all experiments on Ryzen 7 4700U, which is a “Zen
    2” CPU with the following main cache-related specs:'
  prefs: []
  type: TYPE_NORMAL
- en: 8 physical cores (without hyper-threading) clocked at 2GHz (and 4.1GHz in boost
    mode — [which we disable](/hpc/profiling/noise));
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 256K of 8-way set associative L1 data cache or 32K per core;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 4M of 8-way set associative L2 cache or 512K per core;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 8M of 16-way set associative L3 cache, [shared](sharing) between 8 cores;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 16GB (2x8G) of DDR4 RAM @ 2667MHz.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can compare it with your own hardware by running `dmidecode -t cache` or
    `lshw -class memory` on Linux or by installing [CPU-Z](https://en.wikipedia.org/wiki/CPU-Z)
    on Windows. You can also find additional details about the CPU on [WikiChip](https://en.wikichip.org/wiki/amd/ryzen_7/4700u)
    and [7-CPU](https://www.7-cpu.com/cpu/Zen2.html). Not all conclusions will generalize
    to every CPU platform in existence.
  prefs: []
  type: TYPE_NORMAL
- en: Due to difficulties in [preventing the compiler from optimizing away unused
    values](/hpc/profiling/noise/), the code snippets in this article are slightly
    simplified for exposition purposes. Check the [code repository](https://github.com/sslotin/amh-code/tree/main/cpu-cache)
    if you want to reproduce them yourself.
  prefs: []
  type: TYPE_NORMAL
- en: Acknowledgements
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: This chapter is inspired by “[Gallery of Processor Cache Effects](http://igoro.com/archive/gallery-of-processor-cache-effects/)”
    by Igor Ostrovsky and “[What Every Programmer Should Know About Memory](https://people.freebsd.org/~lstewart/articles/cpumemory.pdf)”
    by Ulrich Drepper, both of which can serve as good accompanying readings.
  prefs: []
  type: TYPE_NORMAL
- en: '[← Spatial and Temporal Locality](https://en.algorithmica.org/hpc/external-memory/locality/)'
  prefs: []
  type: TYPE_NORMAL
- en: '[← ../External Memory](https://en.algorithmica.org/hpc/external-memory/)[Memory
    Bandwidth →](https://en.algorithmica.org/hpc/cpu-cache/bandwidth/)'
  prefs: []
  type: TYPE_NORMAL
- en: '[../SIMD Parallelism →](https://en.algorithmica.org/hpc/simd/)'
  prefs: []
  type: TYPE_NORMAL
