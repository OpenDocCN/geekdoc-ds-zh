["```r\nlibrary(tidyverse)\n```", "```r\ncancer <- read_csv(\"data/wdbc.csv\")\ncancer\n```", "```r\n## # A tibble: 569 × 12\n##        ID Class Radius Texture Perimeter   Area Smoothness Compactness Concavity\n##     <dbl> <chr>  <dbl>   <dbl>     <dbl>  <dbl>      <dbl>       <dbl>     <dbl>\n##  1 8.42e5 M      1.10   -2.07     1.27    0.984      1.57       3.28      2.65  \n##  2 8.43e5 M      1.83   -0.353    1.68    1.91      -0.826     -0.487    -0.0238\n##  3 8.43e7 M      1.58    0.456    1.57    1.56       0.941      1.05      1.36  \n##  4 8.43e7 M     -0.768   0.254   -0.592  -0.764      3.28       3.40      1.91  \n##  5 8.44e7 M      1.75   -1.15     1.78    1.82       0.280      0.539     1.37  \n##  6 8.44e5 M     -0.476  -0.835   -0.387  -0.505      2.24       1.24      0.866 \n##  7 8.44e5 M      1.17    0.161    1.14    1.09      -0.123      0.0882    0.300 \n##  8 8.45e7 M     -0.118   0.358   -0.0728 -0.219      1.60       1.14      0.0610\n##  9 8.45e5 M     -0.320   0.588   -0.184  -0.384      2.20       1.68      1.22  \n## 10 8.45e7 M     -0.473   1.10    -0.329  -0.509      1.58       2.56      1.74  \n## # ℹ 559 more rows\n## # ℹ 3 more variables: Concave_Points <dbl>, Symmetry <dbl>,\n## #   Fractal_Dimension <dbl>\n```", "```r\nglimpse(cancer)\n```", "```r\n## Rows: 569\n## Columns: 12\n## $ ID                <dbl> 842302, 842517, 84300903, 84348301, 84358402, 843786…\n## $ Class             <chr> \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M…\n## $ Radius            <dbl> 1.0960995, 1.8282120, 1.5784992, -0.7682333, 1.74875…\n## $ Texture           <dbl> -2.0715123, -0.3533215, 0.4557859, 0.2535091, -1.150…\n## $ Perimeter         <dbl> 1.26881726, 1.68447255, 1.56512598, -0.59216612, 1.7…\n## $ Area              <dbl> 0.98350952, 1.90703027, 1.55751319, -0.76379174, 1.8…\n## $ Smoothness        <dbl> 1.56708746, -0.82623545, 0.94138212, 3.28066684, 0.2…\n## $ Compactness       <dbl> 3.28062806, -0.48664348, 1.05199990, 3.39991742, 0.5…\n## $ Concavity         <dbl> 2.65054179, -0.02382489, 1.36227979, 1.91421287, 1.3…\n## $ Concave_Points    <dbl> 2.53024886, 0.54766227, 2.03543978, 1.45043113, 1.42…\n## $ Symmetry          <dbl> 2.215565542, 0.001391139, 0.938858720, 2.864862154, …\n## $ Fractal_Dimension <dbl> 2.25376381, -0.86788881, -0.39765801, 4.90660199, -0…\n```", "```r\ncancer |>\n distinct(Class)\n```", "```r\n## # A tibble: 2 × 1\n##   Class\n##   <chr>\n## 1 M    \n## 2 B\n```", "```r\ncancer <- cancer |>\n mutate(Class = as_factor(Class)) |>\n mutate(Class = fct_recode(Class, \"Malignant\" = \"M\", \"Benign\" = \"B\"))\nglimpse(cancer)\n```", "```r\n## Rows: 569\n## Columns: 12\n## $ ID                <dbl> 842302, 842517, 84300903, 84348301, 84358402, 843786…\n## $ Class             <fct> Malignant, Malignant, Malignant, Malignant, Malignan…\n## $ Radius            <dbl> 1.0960995, 1.8282120, 1.5784992, -0.7682333, 1.74875…\n## $ Texture           <dbl> -2.0715123, -0.3533215, 0.4557859, 0.2535091, -1.150…\n## $ Perimeter         <dbl> 1.26881726, 1.68447255, 1.56512598, -0.59216612, 1.7…\n## $ Area              <dbl> 0.98350952, 1.90703027, 1.55751319, -0.76379174, 1.8…\n## $ Smoothness        <dbl> 1.56708746, -0.82623545, 0.94138212, 3.28066684, 0.2…\n## $ Compactness       <dbl> 3.28062806, -0.48664348, 1.05199990, 3.39991742, 0.5…\n## $ Concavity         <dbl> 2.65054179, -0.02382489, 1.36227979, 1.91421287, 1.3…\n## $ Concave_Points    <dbl> 2.53024886, 0.54766227, 2.03543978, 1.45043113, 1.42…\n## $ Symmetry          <dbl> 2.215565542, 0.001391139, 0.938858720, 2.864862154, …\n## $ Fractal_Dimension <dbl> 2.25376381, -0.86788881, -0.39765801, 4.90660199, -0…\n```", "```r\ncancer |>\n distinct(Class)\n```", "```r\n## # A tibble: 2 × 1\n##   Class    \n##   <fct>    \n## 1 Malignant\n## 2 Benign\n```", "```r\nnum_obs <- nrow(cancer)\ncancer |>\n group_by(Class) |>\n summarize(\n count = n(),\n percentage = n() / num_obs * 100\n )\n```", "```r\n## # A tibble: 2 × 3\n##   Class     count percentage\n##   <fct>     <int>      <dbl>\n## 1 Malignant   212       37.3\n## 2 Benign      357       62.7\n```", "```r\nperim_concav <- cancer |>\n ggplot(aes(x = Perimeter, y = Concavity, color = Class)) +\n geom_point(alpha = 0.6) +\n labs(x = \"Perimeter (standardized)\",\n y = \"Concavity (standardized)\",\n color = \"Diagnosis\") +\n scale_color_manual(values = c(\"darkorange\", \"steelblue\")) +\n theme(text = element_text(size = 12))\nperim_concav\n```", "```r\nnew_obs_Perimeter <- 0\nnew_obs_Concavity <- 3.5\ncancer |>\n select(ID, Perimeter, Concavity, Class) |>\n mutate(dist_from_new = sqrt((Perimeter - new_obs_Perimeter)^2 +\n (Concavity - new_obs_Concavity)^2)) |>\n slice_min(dist_from_new, n = 5) # take the 5 rows of minimum distance\n```", "```r\n## # A tibble: 5 × 5\n##        ID Perimeter Concavity Class     dist_from_new\n##     <dbl>     <dbl>     <dbl> <fct>             <dbl>\n## 1   86409     0.241      2.65 Benign            0.881\n## 2  887181     0.750      2.87 Malignant         0.980\n## 3  899667     0.623      2.54 Malignant         1.14 \n## 4  907914     0.417      2.31 Malignant         1.26 \n## 5 8710441    -1.16       4.04 Benign            1.28\n```", "```r\nnew_obs_Perimeter <- 0\nnew_obs_Concavity <- 3.5\nnew_obs_Symmetry <- 1\ncancer |>\n select(ID, Perimeter, Concavity, Symmetry, Class) |>\n mutate(dist_from_new = sqrt((Perimeter - new_obs_Perimeter)^2 +\n (Concavity - new_obs_Concavity)^2 +\n (Symmetry - new_obs_Symmetry)^2)) |>\n slice_min(dist_from_new, n = 5) # take the 5 rows of minimum distance\n```", "```r\n## # A tibble: 5 × 6\n##         ID Perimeter Concavity Symmetry Class     dist_from_new\n##      <dbl>     <dbl>     <dbl>    <dbl> <fct>             <dbl>\n## 1   907914     0.417      2.31    0.837 Malignant          1.27\n## 2 90439701     1.33       2.89    1.10  Malignant          1.47\n## 3   925622     0.470      2.08    1.15  Malignant          1.50\n## 4   859471    -1.37       2.81    1.09  Benign             1.53\n## 5   899667     0.623      2.54    2.06  Malignant          1.56\n```", "```r\nlibrary(tidymodels)\n```", "```r\ncancer_train <- cancer |>\n select(Class, Perimeter, Concavity)\ncancer_train\n```", "```r\n## # A tibble: 569 × 3\n##    Class     Perimeter Concavity\n##    <fct>         <dbl>     <dbl>\n##  1 Malignant    1.27      2.65  \n##  2 Malignant    1.68     -0.0238\n##  3 Malignant    1.57      1.36  \n##  4 Malignant   -0.592     1.91  \n##  5 Malignant    1.78      1.37  \n##  6 Malignant   -0.387     0.866 \n##  7 Malignant    1.14      0.300 \n##  8 Malignant   -0.0728    0.0610\n##  9 Malignant   -0.184     1.22  \n## 10 Malignant   -0.329     1.74  \n## # ℹ 559 more rows\n```", "```r\nknn_spec <- nearest_neighbor(weight_func = \"rectangular\", neighbors = 5) |>\n set_engine(\"kknn\") |>\n set_mode(\"classification\")\nknn_spec\n```", "```r\n## K-Nearest Neighbor Model Specification (classification)\n## \n## Main Arguments:\n##   neighbors = 5\n##   weight_func = rectangular\n## \n## Computational engine: kknn\n```", "```r\nknn_fit <- knn_spec |>\n fit(Class ~ Perimeter + Concavity, data = cancer_train)\n```", "```r\nknn_fit <- knn_spec |>\n fit(Class ~ ., data = cancer_train)\nknn_fit\n```", "```r\n## parsnip model object\n## \n## \n## Call:\n## kknn::train.kknn(formula = Class ~ ., data = data, ks = min_rows(5,     data, 5)\n## , kernel = ~\"rectangular\")\n## \n## Type of response variable: nominal\n## Minimal misclassification: 0.07557118\n## Best kernel: rectangular\n## Best k: 5\n```", "```r\nnew_obs <- tibble(Perimeter = 0, Concavity = 3.5)\npredict(knn_fit, new_obs)\n```", "```r\n## # A tibble: 1 × 1\n##   .pred_class\n##   <fct>      \n## 1 Malignant\n```", "```r\nunscaled_cancer <- read_csv(\"data/wdbc_unscaled.csv\") |>\n mutate(Class = as_factor(Class)) |>\n mutate(Class = fct_recode(Class, \"Benign\" = \"B\", \"Malignant\" = \"M\")) |>\n select(Class, Area, Smoothness)\nunscaled_cancer\n```", "```r\n## # A tibble: 569 × 3\n##    Class      Area Smoothness\n##    <fct>     <dbl>      <dbl>\n##  1 Malignant 1001      0.118 \n##  2 Malignant 1326      0.0847\n##  3 Malignant 1203      0.110 \n##  4 Malignant  386\\.     0.142 \n##  5 Malignant 1297      0.100 \n##  6 Malignant  477\\.     0.128 \n##  7 Malignant 1040      0.0946\n##  8 Malignant  578\\.     0.119 \n##  9 Malignant  520\\.     0.127 \n## 10 Malignant  476\\.     0.119 \n## # ℹ 559 more rows\n```", "```r\nuc_recipe <- recipe(Class ~ ., data = unscaled_cancer)\nuc_recipe\n```", "```r\n## \n## ── Recipe ──────────\n## \n## ── Inputs \n## Number of variables by role\n## outcome:   1\n## predictor: 2\n```", "```r\nuc_recipe <- uc_recipe |>\n step_scale(all_predictors()) |>\n step_center(all_predictors()) |>\n prep()\nuc_recipe\n```", "```r\n## \n## ── Recipe ──────────\n## \n## ── Inputs \n## Number of variables by role\n## outcome:   1\n## predictor: 2\n## \n## ── Training information \n## Training data contained 569 data points and no incomplete rows.\n## \n## ── Operations \n## • Scaling for: Area, Smoothness | Trained\n## • Centering for: Area, Smoothness | Trained\n```", "```r\nscaled_cancer <- bake(uc_recipe, unscaled_cancer)\nscaled_cancer\n```", "```r\n## # A tibble: 569 × 3\n##      Area Smoothness Class    \n##     <dbl>      <dbl> <fct>    \n##  1  0.984      1.57  Malignant\n##  2  1.91      -0.826 Malignant\n##  3  1.56       0.941 Malignant\n##  4 -0.764      3.28  Malignant\n##  5  1.82       0.280 Malignant\n##  6 -0.505      2.24  Malignant\n##  7  1.09      -0.123 Malignant\n##  8 -0.219      1.60  Malignant\n##  9 -0.384      2.20  Malignant\n## 10 -0.509      1.58  Malignant\n## # ℹ 559 more rows\n```", "```r\nrare_cancer <- bind_rows(\n filter(cancer, Class == \"Benign\"),\n cancer |> filter(Class == \"Malignant\") |> slice_head(n = 3)\n ) |>\n select(Class, Perimeter, Concavity)\n\nrare_plot <- rare_cancer |>\n ggplot(aes(x = Perimeter, y = Concavity, color = Class)) +\n geom_point(alpha = 0.5) +\n labs(x = \"Perimeter (standardized)\",\n y = \"Concavity (standardized)\",\n color = \"Diagnosis\") +\n scale_color_manual(values = c(\"darkorange\", \"steelblue\")) +\n theme(text = element_text(size = 12))\n\nrare_plot\n```", "```r\nlibrary(themis)\n\nups_recipe <- recipe(Class ~ ., data = rare_cancer) |>\n step_upsample(Class, over_ratio = 1, skip = FALSE) |>\n prep()\n\nups_recipe\n```", "```r\n## \n## ── Recipe ──────────\n## \n## ── Inputs \n## Number of variables by role\n## outcome:   1\n## predictor: 2\n## \n## ── Training information \n## Training data contained 360 data points and no incomplete rows.\n## \n## ── Operations \n## • Up-sampling based on: Class | Trained\n```", "```r\nupsampled_cancer <- bake(ups_recipe, rare_cancer)\n\nupsampled_cancer |>\n group_by(Class) |>\n summarize(n = n())\n```", "```r\n## # A tibble: 2 × 2\n##   Class         n\n##   <fct>     <int>\n## 1 Malignant   357\n## 2 Benign      357\n```", "```r\nmissing_cancer <- read_csv(\"data/wdbc_missing.csv\") |>\n select(Class, Radius, Texture, Perimeter) |>\n mutate(Class = as_factor(Class)) |>\n mutate(Class = fct_recode(Class, \"Malignant\" = \"M\", \"Benign\" = \"B\"))\nmissing_cancer\n```", "```r\n## # A tibble: 7 × 4\n##   Class     Radius Texture Perimeter\n##   <fct>      <dbl>   <dbl>     <dbl>\n## 1 Malignant NA      NA         1.27 \n## 2 Malignant  1.83   -0.353     1.68 \n## 3 Malignant  1.58   NA         1.57 \n## 4 Malignant -0.768   0.254    -0.592\n## 5 Malignant  1.75   -1.15      1.78 \n## 6 Malignant -0.476  -0.835    -0.387\n## 7 Malignant  1.17    0.161     1.14\n```", "```r\nno_missing_cancer <- missing_cancer |> drop_na()\nno_missing_cancer\n```", "```r\n## # A tibble: 5 × 4\n##   Class     Radius Texture Perimeter\n##   <fct>      <dbl>   <dbl>     <dbl>\n## 1 Malignant  1.83   -0.353     1.68 \n## 2 Malignant -0.768   0.254    -0.592\n## 3 Malignant  1.75   -1.15      1.78 \n## 4 Malignant -0.476  -0.835    -0.387\n## 5 Malignant  1.17    0.161     1.14\n```", "```r\nimpute_missing_recipe <- recipe(Class ~ ., data = missing_cancer) |>\n step_impute_mean(all_predictors()) |>\n prep()\nimpute_missing_recipe\n```", "```r\n## \n## ── Recipe ──────────\n## \n## ── Inputs \n## Number of variables by role\n## outcome:   1\n## predictor: 3\n## \n## ── Training information \n## Training data contained 7 data points and 2 incomplete rows.\n## \n## ── Operations \n## • Mean imputation for: Radius, Texture, Perimeter | Trained\n```", "```r\nimputed_cancer <- bake(impute_missing_recipe, missing_cancer)\nimputed_cancer\n```", "```r\n## # A tibble: 7 × 4\n##   Radius Texture Perimeter Class    \n##    <dbl>   <dbl>     <dbl> <fct>    \n## 1  0.847  -0.385     1.27  Malignant\n## 2  1.83   -0.353     1.68  Malignant\n## 3  1.58   -0.385     1.57  Malignant\n## 4 -0.768   0.254    -0.592 Malignant\n## 5  1.75   -1.15      1.78  Malignant\n## 6 -0.476  -0.835    -0.387 Malignant\n## 7  1.17    0.161     1.14  Malignant\n```", "```r\n# load the unscaled cancer data\n# and make sure the response variable, Class, is a factor\nunscaled_cancer <- read_csv(\"data/wdbc_unscaled.csv\") |>\n mutate(Class = as_factor(Class)) |>\n mutate(Class = fct_recode(Class, \"Malignant\" = \"M\", \"Benign\" = \"B\"))\n\n# create the K-NN model\nknn_spec <- nearest_neighbor(weight_func = \"rectangular\", neighbors = 7) |>\n set_engine(\"kknn\") |>\n set_mode(\"classification\")\n\n# create the centering / scaling recipe\nuc_recipe <- recipe(Class ~ Area + Smoothness, data = unscaled_cancer) |>\n step_scale(all_predictors()) |>\n step_center(all_predictors())\n```", "```r\nknn_fit <- workflow() |>\n add_recipe(uc_recipe) |>\n add_model(knn_spec) |>\n fit(data = unscaled_cancer)\n\nknn_fit\n```", "```r\n## ══ Workflow [trained] ══════════\n## Preprocessor: Recipe\n## Model: nearest_neighbor()\n## \n## ── Preprocessor ──────────\n## 2 Recipe Steps\n## \n## • step_scale()\n## • step_center()\n## \n## ── Model ──────────\n## \n## Call:\n## kknn::train.kknn(formula = ..y ~ ., data = data, ks = min_rows(7,     data, 5), \n## kernel = ~\"rectangular\")\n## \n## Type of response variable: nominal\n## Minimal misclassification: 0.112478\n## Best kernel: rectangular\n## Best k: 7\n```", "```r\nnew_observation <- tibble(Area = c(500, 1500), Smoothness = c(0.075, 0.1))\nprediction <- predict(knn_fit, new_observation)\n\nprediction\n```", "```r\n## # A tibble: 2 × 1\n##   .pred_class\n##   <fct>      \n## 1 Benign     \n## 2 Malignant\n```", "```r\n# create the grid of area/smoothness vals, and arrange in a data frame\nare_grid <- seq(min(unscaled_cancer$Area),\n max(unscaled_cancer$Area),\n length.out = 100)\nsmo_grid <- seq(min(unscaled_cancer$Smoothness),\n max(unscaled_cancer$Smoothness),\n length.out = 100)\nasgrid <- as_tibble(expand.grid(Area = are_grid,\n Smoothness = smo_grid))\n\n# use the fit workflow to make predictions at the grid points\nknnPredGrid <- predict(knn_fit, asgrid)\n\n# bind the predictions as a new column with the grid points\nprediction_table <- bind_cols(knnPredGrid, asgrid) |>\n rename(Class = .pred_class)\n\n# plot:\n# 1\\. the colored scatter of the original data\n# 2\\. the faded colored scatter for the grid points\nwkflw_plot <-\n ggplot() +\n geom_point(data = unscaled_cancer,\n mapping = aes(x = Area,\n y = Smoothness,\n color = Class),\n alpha = 0.75) +\n geom_point(data = prediction_table,\n mapping = aes(x = Area,\n y = Smoothness,\n color = Class),\n alpha = 0.02,\n size = 5) +\n labs(color = \"Diagnosis\",\n x = \"Area\",\n y = \"Smoothness\") +\n scale_color_manual(values = c(\"darkorange\", \"steelblue\")) +\n theme(text = element_text(size = 12))\n\nwkflw_plot\n```"]