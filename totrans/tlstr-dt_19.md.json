["```py\nlibrary(janitor)\nlibrary(lubridate)\nlibrary(modelsummary)\nlibrary(opendatatoronto)\nlibrary(pdftools)\nlibrary(pointblank)\nlibrary(readxl)\nlibrary(scales)\nlibrary(stringi)\nlibrary(testthat)\nlibrary(tidyverse)\nlibrary(tinytable)\nlibrary(validate)\n```", "```py\nset.seed(853)\n\nsimulated_population <-\n tibble(\n state = state.name,\n population = runif(n = 50, min = 0, max = 50) |>\n round(digits = 2)\n )\n\nsimulated_population\n```", "```py\n# A tibble: 50 × 2\n   state       population\n   <chr>            <dbl>\n 1 Alabama          18.0 \n 2 Alaska            6.01\n 3 Arizona          24.2 \n 4 Arkansas         15.8 \n 5 California        1.87\n 6 Colorado         20.2 \n 7 Connecticut       6.54\n 8 Delaware         12.1 \n 9 Florida           7.9 \n10 Georgia           9.44\n# ℹ 40 more rows\n```", "```py\nAlabama, 5\nAlaska, 0.7\nArizona, 7\nArkansas, 3\nCalifornia, 40\n```", "```py\nState is Alabama and population is 5 million.\nState is Alaska and population is 0.7 million.\nState is Arizona and population is 7 million.\nState is Arkansas and population is 3 million.\nState is California and population is 40 million.\n```", "```py\nAlabama 5 Alaska 0.7 Arizona 7 Arkansas 3 California 40\n```", "```py\nunedited_data <-\n c(\"Alabama 5 Alaska 0.7 Arizona 7 Arkansas 3 California 40\")\n\ntidy_data <-\n tibble(raw = unedited_data) |>\n separate(\n col = raw,\n into = letters[1:5],\n sep = \"(?<=[[:digit:]]) \" # A bracket preceded by numbers\n ) |>\n pivot_longer(\n cols = letters[1:5],\n names_to = \"drop_me\",\n values_to = \"separate_me\"\n ) |>\n separate(\n col = separate_me,\n into = c(\"state\", \"population\"),\n sep = \" (?=[[:digit:]])\" # A space followed by a number\n ) |>\n select(-drop_me)\n\ntidy_data\n```", "```py\n# A tibble: 5 × 2\n  state      population\n  <chr>      <chr>     \n1 Alabama    5         \n2 Alaska     0.7       \n3 Arizona    7         \n4 Arkansas   3         \n5 California 40 \n```", "```py\nmessy_string <- paste(\n c(\"Patricia, Ptricia, PatricIa, Patric1a, PatricIa\"),\n c(\"PatrIcia, Patricia, Patricia, Patricia , 8atricia\"),\n sep = \", \"\n)\n```", "```py\nmessy_dataset <-\n tibble(names = messy_string) |>\n separate_rows(names, sep = \", \")\n\nmessy_dataset\n```", "```py\n# A tibble: 10 × 1\n   names      \n   <chr>      \n 1 \"Patricia\" \n 2 \"Ptricia\"  \n 3 \"PatricIa\" \n 4 \"Patric1a\" \n 5 \"PatricIa\" \n 6 \"PatrIcia\" \n 7 \"Patricia\" \n 8 \"Patricia\" \n 9 \"Patricia \"\n10 \"8atricia\" \n```", "```py\nmessy_dataset |>\n count(names, sort = TRUE)\n```", "```py\n# A tibble: 7 × 2\n  names           n\n  <chr>       <int>\n1 \"Patricia\"      3\n2 \"PatricIa\"      2\n3 \"8atricia\"      1\n4 \"PatrIcia\"      1\n5 \"Patric1a\"      1\n6 \"Patricia \"     1\n7 \"Ptricia\"       1\n```", "```py\nmessy_dataset_fix_I_8 <-\n messy_dataset |>\n mutate(\n names = str_to_title(names)\n )\n\nmessy_dataset_fix_I_8 |>\n count(names, sort = TRUE)\n```", "```py\n# A tibble: 5 × 2\n  names           n\n  <chr>       <int>\n1 \"Patricia\"      6\n2 \"8atricia\"      1\n3 \"Patric1a\"      1\n4 \"Patricia \"     1\n5 \"Ptricia\"       1\n```", "```py\nmessy_dataset_fix_a_n <-\n messy_dataset_fix_I_8 |>\n mutate(\n names = str_replace_all(names, \"8atricia\", \"Patricia\"),\n names = str_replace_all(names, \"Ptricia\", \"Patricia\")\n )\n\nmessy_dataset_fix_a_n |>\n count(names, sort = TRUE)\n```", "```py\n# A tibble: 3 × 2\n  names           n\n  <chr>       <int>\n1 \"Patricia\"      8\n2 \"Patric1a\"      1\n3 \"Patricia \"     1\n```", "```py\ncleaned_data <-\n messy_dataset_fix_a_n |>\n mutate(\n names = str_replace_all(names, \"Patric1a\", \"Patricia\"),\n names = str_trim(names, side = c(\"right\"))\n )\n\ncleaned_data |>\n count(names, sort = TRUE)\n```", "```py\n# A tibble: 1 × 2\n  names        n\n  <chr>    <int>\n1 Patricia    10\n```", "```py\ncheck_me <-\n cleaned_data |>\n filter(names != \"Patricia\")\n\nif (nrow(check_me) > 0) {\n print(\"Still have values that are not Patricia!\")\n}\n```", "```py\nstopifnot(nrow(check_me) == 0)\n```", "```py\n# Is the dataset of length one?\nexpect_length(check_me, 1) \n# Are the observations characters?\nexpect_equal(class(cleaned_data$names), \"character\") \n# Is every unique observation \"Patricia\"?\nexpect_equal(unique(cleaned_data$names), \"Patricia\") \n```", "```py\nyouth_survey_data <-\n tibble(ages = c(\n 15.9, 14.9, 16.6, 15.8, 16.7, 17.9, 12.6, 11.5, 16.2, 19.5, 150\n ))\n```", "```py\nyouth_survey_data |>\n ggplot(aes(x = ages)) +\n geom_histogram(binwidth = 1) +\n theme_minimal() +\n labs(\n x = \"Age of respondent\",\n y = \"Number of respondents\"\n )\n\nyouth_survey_data_fixed |>\n ggplot(aes(x = ages)) +\n geom_histogram(binwidth = 1) +\n theme_minimal() +\n labs(\n x = \"Age of respondent\",\n y = \"Number of respondents\"\n )\n```", "```py\naustralian_names_data <-\n tibble(\n country = c(\n \"Australie\", \"Austrelia\", \"Australie\", \"Australie\", \"Aeustralia\",\n \"Austraia\", \"Australia\", \"Australia\", \"Australia\", \"Australia\"\n )\n )\n\naustralian_names_data |>\n count(country, sort = TRUE)\n```", "```py\n# A tibble: 5 × 2\n  country        n\n  <chr>      <int>\n1 Australia      4\n2 Australie      3\n3 Aeustralia     1\n4 Austraia       1\n5 Austrelia      1\n```", "```py\ncorrect_kenya_counties <-\n c(\n \"Nairobi\", \"Kiambu\", \"Nakuru\", \"Kakamega\", \"Bungoma\"\n )\n```", "```py\ntop_five_kenya <-\n tibble(county = c(\n \"Nairobi\",  \"Nairob1\", \"Nakuru\", \"Kakamega\", \"Nakuru\",\n \"Kiambu\", \"Kiambru\", \"Kabamega\", \"Bun8oma\", \"Bungoma\"\n ))\n\ntop_five_kenya |>\n count(county, sort = TRUE)\n```", "```py\n# A tibble: 9 × 2\n  county       n\n  <chr>    <int>\n1 Nakuru       2\n2 Bun8oma      1\n3 Bungoma      1\n4 Kabamega     1\n5 Kakamega     1\n6 Kiambru      1\n7 Kiambu       1\n8 Nairob1      1\n9 Nairobi      1\n```", "```py\ntop_five_kenya_fixed_1_8 <-\n top_five_kenya |>\n mutate(\n county = str_replace_all(county, \"Nairob1\", \"Nairobi\"),\n county = str_replace_all(county, \"Bun8oma\", \"Bungoma\")\n )\n\ntop_five_kenya_fixed_1_8 |>\n count(county, sort = TRUE)\n```", "```py\n# A tibble: 7 × 2\n  county       n\n  <chr>    <int>\n1 Bungoma      2\n2 Nairobi      2\n3 Nakuru       2\n4 Kabamega     1\n5 Kakamega     1\n6 Kiambru      1\n7 Kiambu       1\n```", "```py\nif (all(top_five_kenya_fixed_1_8$county |>\n unique() %in% correct_kenya_counties)) {\n \"The cleaned counties match the expected countries\"\n} else {\n \"Not all of the counties have been cleaned completely\"\n}\n```", "```py\n[1] \"Not all of the counties have been cleaned completely\"\n```", "```py\nif (all(correct_kenya_counties %in% top_five_kenya_fixed_1_8$county |>\n unique())) {\n \"The expected countries are in the cleaned counties\"\n} else {\n \"Not all the expected countries are in the cleaned counties\"\n}\n```", "```py\n[1] \"The expected countries are in the cleaned counties\"\n```", "```py\nset.seed(853)\n\ndataset_with_issues <-\n tibble(\n age = c(\n runif(n = 9, min = 0, max = 100) |> round(),\n 1000\n ),\n gender = c(\n sample(\n x = c(\"female\", \"male\", \"other\", \"prefer not to disclose\"),\n size = 9,\n replace = TRUE,\n prob = c(0.4, 0.4, 0.1, 0.1)\n ),\n \"tasmania\"\n ),\n income = rexp(n = 10, rate = 0.10) |> round() |> as.character()\n )\n\ndataset_with_issues\n```", "```py\n# A tibble: 10 × 3\n     age gender                 income\n   <dbl> <chr>                  <chr> \n 1    36 female                 20    \n 2    12 prefer not to disclose 16    \n 3    48 male                   0     \n 4    32 female                 2     \n 5     4 female                 1     \n 6    40 female                 13    \n 7    13 female                 13    \n 8    24 female                 7     \n 9    16 male                   3     \n10  1000 tasmania               2 \n```", "```py\nrules <- validator(\n is.numeric(age),\n is.character(gender),\n is.numeric(income),\n age < 120,\n gender %in% c(\"female\", \"male\", \"other\", \"prefer not to disclose\")\n)\n\nout <-\n confront(dataset_with_issues, rules)\n\nsummary(out)\n```", "```py\n name items passes fails nNA error warning\n1   V1     1      1     0   0 FALSE   FALSE\n2   V2     1      1     0   0 FALSE   FALSE\n3   V3     1      0     1   0 FALSE   FALSE\n4   V4    10      9     1   0 FALSE   FALSE\n5   V5    10      9     1   0 FALSE   FALSE\n                                                           expression\n1                                                     is.numeric(age)\n2                                                is.character(gender)\n3                                                  is.numeric(income)\n4                                                           age < 120\n5 gender %vin% c(\"female\", \"male\", \"other\", \"prefer not to disclose\")\n```", "```py\nsimulated_class_data <-\n tibble(\n response = c(1, 1, 0, 1, 0, 1, 1, 0, 0),\n group = c(1, 2, 1, 1, 2, 3, 1, 2, 3)\n ) |>\n mutate(\n group_as_integer = as.integer(group),\n group_as_factor = as.factor(group),\n )\n```", "```py\nmodels <- list(\n \"Group as integer\" = glm(\n response ~ group_as_integer,\n data = simulated_class_data,\n family = \"binomial\"\n ),\n \"Group as factor\" = glm(\n response ~ group_as_factor,\n data = simulated_class_data,\n family = \"binomial\"\n )\n)\nmodelsummary(models)\n```", "```py\nraw_igme_data <-\n read_csv(\n file = \"https://childmortality.org/wp-content/uploads/2021/09/UNIGME-2021.csv\",\n show_col_types = FALSE\n )\n```", "```py\nraw_igme_data <-\n read_csv(\n file = \"https://childmortality.org/wp-content/uploads/2021/09/UNIGME-2021.csv\",\n col_select = c(`Geographic area`, TIME_PERIOD, OBS_VALUE),\n col_types = cols(\n `Geographic area` = col_character(),\n TIME_PERIOD = col_character(),\n OBS_VALUE = col_double(),\n )\n )\n```", "```py\ntoronto_shelters_2017 <-\n search_packages(\"Daily Shelter Occupancy\") |>\n list_package_resources() |>\n filter(name == \"Daily shelter occupancy 2017.csv\") |>\n group_split(name) |>\n map_dfr(get_resource, .id = \"file\")\n\nwrite_csv(\n x = toronto_shelters_2017,\n file = \"toronto_shelters_2017.csv\"\n)\n```", "```py\ntoronto_shelters_2017 <-\n toronto_shelters_2017 |>\n clean_names() |>\n select(occupancy_date, sector, occupancy, capacity)\n```", "```py\ntoronto_shelters_2017 <-\n toronto_shelters_2017 |>\n mutate(\n # remove times\n occupancy_date =\n str_remove(\n occupancy_date,\n \"T[:digit:]{2}:[:digit:]{2}:[:digit:]{2}\"\n )) |>\n mutate(generated_date = ymd(occupancy_date, quiet = TRUE))\n\ntoronto_shelters_2017\n```", "```py\n# A tibble: 38,700 × 5\n   occupancy_date sector   occupancy capacity generated_date\n   <chr>          <chr>        <dbl>    <dbl> <date>        \n 1 2017-01-01     Co-ed           16       16 2017-01-01    \n 2 2017-01-01     Men             13       17 2017-01-01    \n 3 2017-01-01     Men             63       63 2017-01-01    \n 4 2017-01-01     Families        66       70 2017-01-01    \n 5 2017-01-01     Men             58       60 2017-01-01    \n 6 2017-01-01     Families       168      160 2017-01-01    \n 7 2017-01-01     Families       119      150 2017-01-01    \n 8 2017-01-01     Men             23       28 2017-01-01    \n 9 2017-01-01     Families         8        0 2017-01-01    \n10 2017-01-01     Co-ed           14       40 2017-01-01    \n# ℹ 38,690 more rows\n```", "```py\ntoronto_shelters_2017 |>\n separate(\n generated_date,\n into = c(\"one\", \"two\", \"three\"),\n sep = \"-\",\n remove = FALSE\n ) |>\n count(three) |>\n ggplot(aes(x = three, y = n)) +\n geom_point() +\n theme_minimal() +\n labs(x = \"Third component of occupancy date\",\n y = \"Number\")\n\ntoronto_shelters_2017 |>\n mutate(row_number = c(seq_len(nrow(toronto_shelters_2017)))) |>\n ggplot(aes(x = row_number, y = generated_date), alpha = 0.1) +\n geom_point(alpha = 0.3) +\n theme_minimal() +\n labs(\n x = \"Row number\",\n y = \"Date\"\n )\n```", "```py\n# Idea from Lisa Lendway\ntoronto_shelters_by_day <-\n toronto_shelters_2017 |>\n drop_na(occupancy, capacity) |>\n summarise(\n occupancy = sum(occupancy),\n capacity = sum(capacity),\n usage = occupancy / capacity,\n .by = generated_date\n )\n```", "```py\ntoronto_shelters_by_day |>\n ggplot(aes(x = day(generated_date), y = occupancy)) +\n geom_point(alpha = 0.3) +\n scale_y_continuous(limits = c(0, NA)) +\n labs(\n color = \"Type\",\n x = \"Day\",\n y = \"Occupancy (number)\"\n ) +\n facet_wrap(\n vars(month(generated_date, label = TRUE)),\n scales = \"free_x\"\n ) +\n theme_minimal() +\n scale_color_brewer(palette = \"Set1\")\n```", "```py\n# Code by Monica Alexander\npadded_1_to_12 <- sprintf(\"%02d\", 1:12)\n\nlist_of_dates_to_flip <-\n paste(2017, padded_1_to_12, \n rep(padded_1_to_12, each = 12), sep = \"-\")\n\ntoronto_shelters_2017_flip <-\n toronto_shelters_2017 |>\n mutate(\n year = year(generated_date),\n month = month(generated_date),\n day = day(generated_date),\n generated_date = as.character(generated_date),\n changed_date = if_else(\n generated_date %in% list_of_dates_to_flip,\n paste(year, day, month, sep = \"-\"),\n paste(year, month, day, sep = \"-\"),\n ),\n changed_date = ymd(changed_date)\n ) |>\n select(-year, -month, -day)\n```", "```py\ntoronto_shelters_2017_flip |>\n mutate(counter = seq_len(nrow(toronto_shelters_2017_flip))) |>\n ggplot(aes(x = counter, y = changed_date)) +\n geom_point(alpha = 0.3) +\n labs(x = \"Row in the dataset\",\n y = \"Date of that row\") +\n theme_minimal()\n\ntoronto_shelters_2017_flip |>\n drop_na(occupancy, capacity) |>\n summarise(occupancy = sum(occupancy),\n .by = changed_date) |>\n ggplot(aes(x = day(changed_date), y = occupancy)) +\n geom_point(alpha = 0.3) +\n scale_y_continuous(limits = c(0, NA)) +\n labs(color = \"Type\",\n x = \"Changed day\",\n y = \"Occupancy (number)\") +\n facet_wrap(vars(month(changed_date, label = TRUE)),\n scales = \"free_x\") +\n theme_minimal()\n```", "```py\nset.seed(853)\n\nnum_observations <- 200\nexpected_relationship <- 8.4\nfast_time <- 15\ngood_time <- 30\n\nsim_run_data <-\n tibble(\n five_km_time =\n runif(n = num_observations, min = fast_time, max = good_time),\n noise = rnorm(n = num_observations, mean = 0, sd = 20),\n marathon_time = five_km_time * expected_relationship + noise\n ) |>\n mutate(\n five_km_time = round(x = five_km_time, digits = 1),\n marathon_time = round(x = marathon_time, digits = 1)\n ) |>\n select(-noise)\n\nsim_run_data\n```", "```py\n# A tibble: 200 × 2\n   five_km_time marathon_time\n          <dbl>         <dbl>\n 1         20.4          164.\n 2         16.8          158 \n 3         22.3          196.\n 4         19.7          160.\n 5         15.6          121.\n 6         21.1          178.\n 7         17            157.\n 8         18.6          169.\n 9         17.4          150.\n10         17.8          126.\n# ℹ 190 more rows\n```", "```py\nstopifnot(\n class(sim_run_data$marathon_time) == \"numeric\",\n class(sim_run_data$five_km_time) == \"numeric\",\n nrow(sim_run_data) == 200\n)\n```", "```py\nstopifnot(\n min(sim_run_data$five_km_time) >= 15,\n max(sim_run_data$five_km_time) <= 30\n)\n```", "```py\nstopifnot(\n min(sim_run_data$marathon_time) >= 118,\n max(sim_run_data$marathon_time) <= 300\n)\n```", "```py\nvickers_data <- \n read_excel(\"13102_2016_52_MOESM2_ESM.xlsx\") |> \n select(k5_ti, mf_ti) |> \n drop_na()\n\nvickers_data\n```", "```py\n# A tibble: 430 × 2\n   k5_ti mf_ti\n   <dbl> <dbl>\n 1  1075 10295\n 2  1292 12292\n 3  1222 13452\n 4   893  9515\n 5  1050 10875\n 6  1603 16580\n 7  1457 15440\n 8  1256 13113\n 9  1572 17190\n10  2575 22139\n# ℹ 420 more rows\n```", "```py\nvickers_data <- \n vickers_data |> \n mutate(five_km_time = round(k5_ti / 60, 1),\n marathon_time = round(mf_ti / 60, 1)\n ) |> \n select(five_km_time, marathon_time)\n\nvickers_data\n```", "```py\n# A tibble: 430 × 2\n   five_km_time marathon_time\n          <dbl>         <dbl>\n 1         17.9          172.\n 2         21.5          205.\n 3         20.4          224.\n 4         14.9          159.\n 5         17.5          181.\n 6         26.7          276.\n 7         24.3          257.\n 8         20.9          219.\n 9         26.2          286.\n10         42.9          369 \n# ℹ 420 more rows\n```", "```py\nstopifnot(\n class(vickers_data$marathon_time) == \"numeric\",\n class(vickers_data$five_km_time) == \"numeric\",\n min(vickers_data$five_km_time) >= 15,\n max(vickers_data$five_km_time) <= 30,\n min(vickers_data$marathon_time) >= 118,\n max(vickers_data$marathon_time) <= 300\n)\n```", "```py\nsome_bad_names <-\n tibble(\n \"Second Name has spaces\" = c(1),\n \"weird#symbol\" = c(1),\n \"InCoNsIsTaNtCaPs\" = c(1)\n )\n\nbad_names_made_better <-\n some_bad_names |>\n clean_names()\n\nsome_bad_names\n```", "```py\n# A tibble: 1 × 3\n  `Second Name has spaces` `weird#symbol` InCoNsIsTaNtCaPs\n                     <dbl>          <dbl>            <dbl>\n1                        1              1                1\n```", "```py\nbad_names_made_better\n```", "```py\n# A tibble: 1 × 3\n  second_name_has_spaces weird_number_symbol in_co_ns_is_ta_nt_ca_ps\n                   <dbl>               <dbl>                   <dbl>\n1                      1                   1                       1\n```", "```py\npartial_matching_example <-\n data.frame(\n my_first_name = c(1, 2),\n another_name = c(\"wow\", \"great\")\n )\n\npartial_matching_example$my_first_name\n```", "```py\n[1] 1 2\n```", "```py\npartial_matching_example$my\n```", "```py\n[1] 1 2\n```", "```py\nsome_names <-\n tibble(\n age = as.integer(c(1, 3, 35, 36)),\n sex = factor(c(\"male\", \"male\", \"female\", \"male\"))\n )\n\nriederer_names <-\n some_names |>\n rename(\n integer_age_respondent = age,\n factor_sex_respondent = sex\n )\n\nsome_names\n```", "```py\n# A tibble: 4 × 2\n    age sex   \n  <int> <fct> \n1     1 male  \n2     3 male  \n3    35 female\n4    36 male \n```", "```py\nriederer_names\n```", "```py\n# A tibble: 4 × 2\n  integer_age_respondent factor_sex_respondent\n                   <int> <fct>                \n1                      1 male                 \n2                      3 male                 \n3                     35 female               \n4                     36 male \n```", "```py\nset.seed(853)\n\nage_group <- tibble(starter = 0:19) |>\n mutate(lower = starter * 5, upper = starter * 5 + 4) |>\n unite(string_sequence, lower, upper, sep = \"-\") |>\n pull(string_sequence)\n\nmean_value <- 10\n\nsimulated_tanzania_dataset <-\n tibble(\n age_group = age_group,\n urban_male = round(rnorm(length(age_group), mean_value)),\n urban_female = round(rnorm(length(age_group), mean_value)),\n rural_male = round(rnorm(length(age_group), mean_value)),\n rural_female = round(rnorm(length(age_group), mean_value)),\n total_male = round(rnorm(length(age_group), mean_value)),\n total_female = round(rnorm(length(age_group), mean_value))\n ) |>\n mutate(\n urban_total = urban_male + urban_female,\n rural_total = rural_male + rural_female,\n total_total = total_male + total_female\n )\n\nsimulated_tanzania_dataset\n```", "```py\n# A tibble: 20 × 10\n   age_group urban_male urban_female rural_male rural_female total_male\n   <chr>          <dbl>        <dbl>      <dbl>        <dbl>      <dbl>\n 1 0-4               10           10          9            9         11\n 2 5-9               10            9          9           10          9\n 3 10-14              8           11         11           11         10\n 4 15-19              9           11         10            9         10\n 5 20-24              9            8         11           10          9\n 6 25-29             12            9         10           10         10\n 7 30-34              9            8         10           10          8\n 8 35-39             10           11          8           10         10\n 9 40-44              9            9          9           10         11\n10 45-49              9           10         11           10         11\n11 50-54             12           10          9           13         10\n12 55-59              9           11         10            9          9\n13 60-64             10            9         11           11         10\n14 65-69             10           10         10           10         11\n15 70-74             10           10         12            9          8\n16 75-79             10            8         10            9         10\n17 80-84             10            9          9           10          9\n18 85-89             10            9         10           11         11\n19 90-94             11           11         11           10         11\n20 95-99             10           10         10           11         11\n# ℹ 4 more variables: total_female <dbl>, urban_total <dbl>, rural_total <dbl>,\n#   total_total <dbl>\n```", "```py\ndownload.file(\n url = \"https://dhsprogram.com/pubs/pdf/FR83/FR83.pdf\",\n destfile = \"1996_Tanzania_DHS.pdf\",\n mode = \"wb\"\n)\n```", "```py\ntanzania_dhs <-\n pdf_text(\n pdf = \"1996_Tanzania_DHS.pdf\"\n )\n```", "```py\n# From Bob Rudis: https://stackoverflow.com/a/47793617\ntanzania_dhs_page_33 <- stri_split_lines(tanzania_dhs[[33]])[[1]]\n```", "```py\ntanzania_dhs_page_33_only_data <- tanzania_dhs_page_33[31:55]\n\ntanzania_dhs_raw <- tibble(all = tanzania_dhs_page_33_only_data)\n\ntanzania_dhs_raw\n```", "```py\n# A tibble: 25 × 1\n   all                                                                          \n   <chr>                                                                        \n 1 \"                                  Urban                              Rural …\n 2 \"\"                                                                           \n 3 \" Age group             Male      Female       Total          Male   Female …\n 4 \"\"                                                                           \n 5 \"\"                                                                           \n 6 \" 0-4                   16.4        13.8        15.1          18.1     17.1 …\n 7 \" 5-9                   13.5        13.0        13.2          17.5     16,0 …\n 8 \" 10-14                 12.6        13.1        12.8          15.3     13.5 …\n 9 \" 15-19                 10.8        11.3        11.1           9.8      8.8 …\n10 \" 20-~                   9.4        12.2        10,8           5.9      8.2 …\n# ℹ 15 more rows\n```", "```py\n# Separate columns\ntanzania_dhs_separated <-\n tanzania_dhs_raw |>\n mutate(all = str_squish(all)) |>\n mutate(all = str_replace(all, \"Age group\", \"Age-group\")) |>\n separate(\n col = all,\n into = c(\n \"age_group\", \n \"male_urban\", \"female_urban\", \"total_urban\",\n \"male_rural\", \"female_rural\", \"total_rural\",\n \"male_total\", \"female_total\", \"total_total\"\n ),\n sep = \" \",\n remove = TRUE,\n fill = \"right\",\n extra = \"drop\"\n )\n\ntanzania_dhs_separated\n```", "```py\n# A tibble: 25 × 10\n   age_group   male_urban female_urban total_urban male_rural female_rural\n   <chr>       <chr>      <chr>        <chr>       <chr>      <chr>       \n 1 \"Urban\"     Rural      Total        <NA>        <NA>       <NA>        \n 2 \"\"          <NA>       <NA>         <NA>        <NA>       <NA>        \n 3 \"Age-group\" Male       Female       Total       Male       Female      \n 4 \"\"          <NA>       <NA>         <NA>        <NA>       <NA>        \n 5 \"\"          <NA>       <NA>         <NA>        <NA>       <NA>        \n 6 \"0-4\"       16.4       13.8         15.1        18.1       17.1        \n 7 \"5-9\"       13.5       13.0         13.2        17.5       16,0        \n 8 \"10-14\"     12.6       13.1         12.8        15.3       13.5        \n 9 \"15-19\"     10.8       11.3         11.1        9.8        8.8         \n10 \"20-~\"      9.4        12.2         10,8        5.9        8.2         \n# ℹ 15 more rows\n# ℹ 4 more variables: total_rural <chr>, male_total <chr>, female_total <chr>,\n#   total_total <chr>\n```", "```py\ntanzania_dhs_separated |>\n mutate(across(everything(), ~ str_remove_all(., \"[:digit:]\"))) |>\n distinct()\n```", "```py\n# A tibble: 15 × 10\n   age_group   male_urban female_urban total_urban male_rural female_rural\n   <chr>       <chr>      <chr>        <chr>       <chr>      <chr>       \n 1 \"Urban\"     Rural      Total        <NA>        <NA>       <NA>        \n 2 \"\"          <NA>       <NA>         <NA>        <NA>       <NA>        \n 3 \"Age-group\" Male       Female       Total       Male       Female      \n 4 \"-\"         .          .            .           .          .           \n 5 \"-\"         .          .            .           .          ,           \n 6 \"-\"         .          .            .           .          .           \n 7 \"-~\"        .          .            ,           .          .           \n 8 \"-\"         .          .            ,           ,          ,           \n 9 \"-\"         ,          .            .           .          .           \n10 \"-\"         .          .            .           .          .           \n11 \"-\"         ,          .            .           ;          .           \n12 \"-\"         .          .            .           ,          .           \n13 \"+\"         .          .            .           .          .           \n14 \"Total\"     .          .            .           .          .           \n15 \"Number\"    ,          ,            ,           .          ,           \n# ℹ 4 more variables: total_rural <chr>, male_total <chr>, female_total <chr>,\n#   total_total <chr>\n```", "```py\ntanzania_dhs_cleaned <-\n tanzania_dhs_separated |>\n slice(6:22, 24, 25) |>\n mutate(across(everything(), ~ str_replace_all(., \"[,;]\", \".\"))) |>\n mutate(\n age_group = str_replace(age_group, \"20-~\", \"20-24\"),\n age_group = str_replace(age_group, \"40-~\", \"40-44\"),\n male_rural = str_replace(male_rural, \"14.775\", \"14775\")\n ) |>\n mutate(across(starts_with(c(\n \"male\", \"female\", \"total\"\n )),\n as.numeric))\n\ntanzania_dhs_cleaned\n```", "```py\n# A tibble: 19 × 10\n   age_group male_urban female_urban total_urban male_rural female_rural\n   <chr>          <dbl>        <dbl>       <dbl>      <dbl>        <dbl>\n 1 0-4            16.4         13.8        15.1        18.1         17.1\n 2 5-9            13.5         13          13.2        17.5         16  \n 3 10-14          12.6         13.1        12.8        15.3         13.5\n 4 15-19          10.8         11.3        11.1         9.8          8.8\n 5 20-24           9.4         12.2        10.8         5.9          8.2\n 6 25-29           8.4          9.8         9.1         5.6          7.1\n 7 30-34           6.6          6.3         6.4         5.2          5.6\n 8 35-39           5.8          5.9         5.8         4            4.5\n 9 40-44           4.4          3.5         3.9         3.3          3.5\n10 45-49           3.2          2.3         2.7         3.2          3.3\n11 50-54           2            2.4         2.2         2.2          3.4\n12 55-59           1.8          1.8         1.8         2.1          2.9\n13 60-64           2.1          1.7         1.9         2.4          2  \n14 65-69           1.3          1.3         1.3         2.2          1.6\n15 70-74           0.9          0.7         0.8         1.3          1.2\n16 75-79           0.3          0.4         0.4         0.8          0.6\n17 80+             0.3          0.5         0.4         0.9          0.7\n18 Total         100          100         100         100          100  \n19 Number          3.69         3.88        7.57    14775           15.9\n# ℹ 4 more variables: total_rural <dbl>, male_total <dbl>, female_total <dbl>,\n#   total_total <dbl>\n```", "```py\ntanzania_dhs_cleaned |>\n filter(!age_group %in% c(\"Total\", \"Number\")) |>\n summarise(sum = sum(total_total))\n```", "```py\n# A tibble: 1 × 1\n    sum\n  <dbl>\n1  99.7\n```", "```py\ncensus_url <-\n paste0(\n \"https://www.knbs.or.ke/download/2019-kenya-population-and-\",\n \"housing-census-volume-iii-distribution-of-population-by-age-\",\n \"sex-and-administrative-units/?wpdmdl=5729&refresh=\",\n \"620561f1ce3ad1644519921\"\n )\n\ndownload.file(\n url = census_url,\n destfile = \"2019_Kenya_census.pdf\",\n mode = \"wb\"\n)\n```", "```py\nkenya_census <-\n pdf_text(\n pdf = \"2019_Kenya_census.pdf\"\n )\n```", "```py\n# Focus on the page of interest\njust_nairobi <- stri_split_lines(kenya_census[[410]])[[1]]\n\n# Remove blank lines\njust_nairobi <- just_nairobi[just_nairobi != \"\"]\n\n# Remove titles, headings and other content at the top of the page\njust_nairobi <- just_nairobi[5:length(just_nairobi)]\n\n# Remove page numbers and other content at the bottom of the page\njust_nairobi <- just_nairobi[1:62]\n\n# Convert into a tibble\ndemography_data <- tibble(all = just_nairobi)\n```", "```py\ndemography_data <-\n demography_data |>\n mutate(all = str_squish(all)) |>\n mutate(all = str_replace(all, \"10 -14\", \"10-14\")) |>\n mutate(all = str_replace(all, \"Not Stated\", \"NotStated\")) |>\n # Deal with the two column set-up\n separate(\n col = all,\n into = c(\n \"age\", \"male\", \"female\", \"total\",\n \"age_2\", \"male_2\", \"female_2\", \"total_2\"\n ),\n sep = \" \",\n remove = TRUE,\n fill = \"right\",\n extra = \"drop\"\n )\n```", "```py\ndemography_data_long <-\n rbind(\n demography_data |> select(age, male, female, total),\n demography_data |>\n select(age_2, male_2, female_2, total_2) |>\n rename(\n age = age_2,\n male = male_2,\n female = female_2,\n total = total_2\n )\n )\n```", "```py\n# There is one row of NAs, so remove it\ndemography_data_long <-\n demography_data_long |>\n remove_empty(which = c(\"rows\"))\n\ndemography_data_long\n```", "```py\n# A tibble: 123 × 4\n   age   male      female    total    \n   <chr> <chr>     <chr>     <chr>    \n 1 Total 2,192,452 2,204,376 4,396,828\n 2 0     57,265    56,523    113,788  \n 3 1     56,019    54,601    110,620  \n 4 2     52,518    51,848    104,366  \n 5 3     51,115    51,027    102,142  \n 6 4     47,182    46,889    94,071   \n 7 0-4   264,099   260,888   524,987  \n 8 5     45,203    44,711    89,914   \n 9 6     43,635    44,226    87,861   \n10 7     43,507    43,655    87,162   \n# ℹ 113 more rows\n```", "```py\ndemography_data_long |>\n select(male, female, total) |>\n mutate(across(everything(), ~ str_remove_all(., \"[:digit:]\"))) |>\n distinct()\n```", "```py\n# A tibble: 5 × 3\n  male  female total\n  <chr> <chr>  <chr>\n1 \",,\"  \",,\"   \",,\" \n2 \",\"   \",\"    \",\"  \n3 \"\"    \",\"    \",\"  \n4 \"\"    \"\"     \",\"  \n5 \"\"    \"\"     \"\" \n```", "```py\ndemography_data_long <-\n demography_data_long |>\n mutate(across(c(male, female, total), ~ str_remove_all(., \",\"))) |>\n mutate(across(c(male, female, total), ~ as.integer(.)))\n\ndemography_data_long\n```", "```py\n# A tibble: 123 × 4\n   age      male  female   total\n   <chr>   <int>   <int>   <int>\n 1 Total 2192452 2204376 4396828\n 2 0       57265   56523  113788\n 3 1       56019   54601  110620\n 4 2       52518   51848  104366\n 5 3       51115   51027  102142\n 6 4       47182   46889   94071\n 7 0-4    264099  260888  524987\n 8 5       45203   44711   89914\n 9 6       43635   44226   87861\n10 7       43507   43655   87162\n# ℹ 113 more rows\n```", "```py\ndemography_data_long <-\n demography_data_long |>\n mutate(\n age_type = if_else(str_detect(age, \"-\"), \n \"age-group\", \n \"single-year\"),\n age_type = if_else(str_detect(age, \"Total\"), \n \"age-group\", \n age_type)\n )\n```", "```py\ndemography_data_long <-\n demography_data_long |>\n mutate(\n age = as_factor(age)\n )\n```", "```py\ndemography_data_long |>\n mutate(\n check_sum = male + female,\n totals_match = if_else(total == check_sum, 1, 0)\n ) |>\n filter(totals_match == 0)\n```", "```py\n# A tibble: 0 × 7\n# ℹ 7 variables: age <fct>, male <int>, female <int>, total <int>,\n#   age_type <chr>, check_sum <int>, totals_match <dbl>\n```", "```py\ndemography_data_long |>\n mutate(age_groups = if_else(age_type == \"age-group\", \n age, \n NA_character_)) |>\n fill(age_groups, .direction = \"up\") |>\n mutate(\n group_sum = sum(total),\n group_sum = group_sum / 2,\n difference = total - group_sum,\n .by = c(age_groups)\n ) |>\n filter(age_type == \"age-group\" & age_groups != \"Total\") |> \n head()\n```", "```py\n# A tibble: 6 × 8\n  age     male female  total age_type  age_groups group_sum difference\n  <fct>  <int>  <int>  <int> <chr>     <chr>          <dbl>      <dbl>\n1 0-4   264099 260888 524987 age-group 0-4           524987          0\n2 5-9   215230 217482 432712 age-group 5-9           432712          0\n3 10-14 185008 193542 378550 age-group 10-14         378550          0\n4 15-19 159098 192755 351853 age-group 15-19         351853          0\n5 20-24 249534 313485 563019 age-group 20-24         563019          0\n6 25-29 282703 300845 583548 age-group 25-29         583548          0\n```", "```py\ndemography_data_tidy <-\n demography_data_long |>\n rename_with(~paste0(., \"_total\"), male:total) |>\n pivot_longer(cols = contains(\"_total\"), \n names_to = \"type\", \n values_to = \"number\") |>\n separate(\n col = type,\n into = c(\"gender\", \"part_of_area\"),\n sep = \"_\"\n ) |>\n select(age, age_type, gender, number)\n```", "```py\ndemography_data_tidy |>\n filter(age_type == \"single-year\") |>\n select(age, gender, number) |>\n filter(gender != \"total\") |>\n ggplot(aes(x = age, y = number, fill = gender)) +\n geom_col(aes(x = age, y = number, fill = gender), \n position = \"dodge\") +\n scale_y_continuous(labels = comma) +\n scale_x_discrete(breaks = c(seq(from = 0, to = 99, by = 5), \"100+\")) +\n theme_classic() +\n scale_fill_brewer(palette = \"Set1\") +\n labs(\n y = \"Number\",\n x = \"Age\",\n fill = \"Gender\",\n caption = \"Data source: 2019 Kenya Census\"\n ) +\n theme(legend.position = \"bottom\") +\n coord_flip()\n```", "```py\ncolumn_names_as_contracts <-\n demography_data_tidy |>\n filter(age_type == \"single-year\") |>\n select(age, gender, number) |>\n rename(\n \"fctr_group_age\" = \"age\",\n \"chr_group_gender\" = \"gender\",\n \"int_group_count\" = \"number\"\n )\n```", "```py\nagent <-\n create_agent(tbl = column_names_as_contracts) |>\n col_is_character(columns = vars(chr_group_gender)) |>\n col_is_factor(columns = vars(fctr_group_age)) |>\n col_is_integer(columns = vars(int_group_count)) |>\n col_vals_in_set(\n columns = chr_group_gender,\n set = c(\"male\", \"female\", \"total\")\n ) |>\n interrogate()\n\nagent\n```", "```py\ntibble(\n name = c(\"Ian\", \"Patricia\", \"Ville\", \"Karen\"),\n age_group = c(\"18-29\", \"30-44\", \"45-60\", \"60+\"),\n)\n```", "```py\na.  Yes\nb. No\n```", "```py\nraw_penguin_data <-\n read_csv(file = \"https://portal.edirepository.org/nis/dataviewer?packageid=knb-lter-pal.219.5&entityid=002f3893385f710df69eeebe893144ff\",\n show_col_types = FALSE)\n```", "```py\ntibble(\n income_1 = c(88515, 103608, -99, 87644, 118279, 107342, 97300, 97226, 73367, 101528),\n income_2 = c(88515, 103608, 102582, 87644, 118279, 107342, \"missing\", 97226, 73367, 101528),\n income_3 = c(999999, 103608, 102582, 87644, 118279, 107342, 97300, 97226, 73367, 101528),\n income_4 = c(88515, 103608, 102582, 87644, 0, 107342, 97300, 97226, 73367, 101528),\n income_5 = c(88515, 103608, 102582, 87644, 118279, 107342, 97300, 97226, 73367, NA_integer_)\n)\n```", "```py\ntibble(\n period = c(1901, 1901, 1901, 2023, 2023, 2023),\n country = c(\n \"Prussia\",\n \"Austro-Hungarian Empire\",\n \"Kingdom of Hungary\",\n \"Canada\",\n \"Australia\",\n \"UK\"\n ),\n highest_education = c(\n \"Gymnasium\",\n \"Higher Polytechnic School\",\n \"Matura\",\n \"High school\",\n \"Undergraduate Honours\",\n \"A-levels\"\n )\n)\n```", "```py\ntibble(\n date = c(\"20-02-2023\",\n \"20 February 2023\",\n \"02-20-2023\",\n \"2023-20-02\",\n \"February 20, 2023\")\n )\n```", "```py\ntibble(\n date = c(\"01-02-2023\",\n \"02-01-2023\",\n \"2023-01-02\")\n )\n```"]