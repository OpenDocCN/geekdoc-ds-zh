["```r\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(gridExtra)\n\nset.seed(5)\n\nsacramento <- read_csv(\"data/sacramento.csv\")\nsacramento\n```", "```r\n## # A tibble: 932 × 9\n##    city           zip     beds baths  sqft type        price latitude longitude\n##    <chr>          <chr>  <dbl> <dbl> <dbl> <chr>       <dbl>    <dbl>     <dbl>\n##  1 SACRAMENTO     z95838     2     1   836 Residential 59222     38.6     -121.\n##  2 SACRAMENTO     z95823     3     1  1167 Residential 68212     38.5     -121.\n##  3 SACRAMENTO     z95815     2     1   796 Residential 68880     38.6     -121.\n##  4 SACRAMENTO     z95815     2     1   852 Residential 69307     38.6     -121.\n##  5 SACRAMENTO     z95824     2     1   797 Residential 81900     38.5     -121.\n##  6 SACRAMENTO     z95841     3     1  1122 Condo       89921     38.7     -121.\n##  7 SACRAMENTO     z95842     3     2  1104 Residential 90895     38.7     -121.\n##  8 SACRAMENTO     z95820     3     1  1177 Residential 91002     38.5     -121.\n##  9 RANCHO_CORDOVA z95670     2     2   941 Condo       94905     38.6     -121.\n## 10 RIO_LINDA      z95673     3     2  1146 Residential 98937     38.7     -121.\n## # ℹ 922 more rows\n```", "```r\neda <- ggplot(sacramento, aes(x = sqft, y = price)) +\n geom_point(alpha = 0.4) +\n xlab(\"House size (square feet)\") +\n ylab(\"Price (USD)\") +\n scale_y_continuous(labels = dollar_format()) +\n theme(text = element_text(size = 12))\n\neda\n```", "```r\nsmall_sacramento <- slice_sample(sacramento, n = 30)\n```", "```r\nsmall_plot <- ggplot(small_sacramento, aes(x = sqft, y = price)) +\n geom_point() +\n xlab(\"House size (square feet)\") +\n ylab(\"Price (USD)\") +\n scale_y_continuous(labels = dollar_format()) +\n geom_vline(xintercept = 2000, linetype = \"dashed\") +\n theme(text = element_text(size = 12))\n\nsmall_plot\n```", "```r\nnearest_neighbors <- small_sacramento |>\n mutate(diff = abs(2000 - sqft)) |>\n slice_min(diff, n = 5)\n\nnearest_neighbors\n```", "```r\n## # A tibble: 5 × 10\n##   city       zip     beds baths  sqft type        price latitude longitude  diff\n##   <chr>      <chr>  <dbl> <dbl> <dbl> <chr>       <dbl>    <dbl>     <dbl> <dbl>\n## 1 ROSEVILLE  z95661     3   2    2049 Residenti… 395500     38.7     -121\\.    49\n## 2 ANTELOPE   z95843     4   3    2085 Residenti… 408431     38.7     -121\\.    85\n## 3 SACRAMENTO z95823     4   2    1876 Residenti… 299940     38.5     -121\\.   124\n## 4 ROSEVILLE  z95747     3   2.5  1829 Residenti… 306500     38.8     -121\\.   171\n## 5 SACRAMENTO z95825     4   2    1776 Multi_Fam… 221250     38.6     -121\\.   224\n```", "```r\nprediction <- nearest_neighbors |>\n summarise(predicted = mean(price))\n\nprediction\n```", "```r\n## # A tibble: 1 × 1\n##   predicted\n##       <dbl>\n## 1   326324.\n```", "```r\nsacramento_split <- initial_split(sacramento, prop = 0.75, strata = price)\nsacramento_train <- training(sacramento_split)\nsacramento_test <- testing(sacramento_split)\n```", "```r\nsacr_recipe <- recipe(price ~ sqft, data = sacramento_train) |>\n step_scale(all_predictors()) |>\n step_center(all_predictors())\n\nsacr_spec <- nearest_neighbor(weight_func = \"rectangular\",\n neighbors = tune()) |>\n set_engine(\"kknn\") |>\n set_mode(\"regression\")\n\nsacr_vfold <- vfold_cv(sacramento_train, v = 5, strata = price)\n\nsacr_wkflw <- workflow() |>\n add_recipe(sacr_recipe) |>\n add_model(sacr_spec)\n\nsacr_wkflw\n```", "```r\n## ══ Workflow ══════════\n## Preprocessor: Recipe\n## Model: nearest_neighbor()\n## \n## ── Preprocessor ──────────\n## 2 Recipe Steps\n## \n## • step_scale()\n## • step_center()\n## \n## ── Model ──────────\n## K-Nearest Neighbor Model Specification (regression)\n## \n## Main Arguments:\n##   neighbors = tune()\n##   weight_func = rectangular\n## \n## Computational engine: kknn\n```", "```r\ngridvals <- tibble(neighbors = seq(from = 1, to = 200, by = 3))\n\nsacr_results <- sacr_wkflw |>\n tune_grid(resamples = sacr_vfold, grid = gridvals) |>\n collect_metrics() |>\n filter(.metric == \"rmse\")\n\n# show the results\nsacr_results\n```", "```r\n## # A tibble: 67 × 7\n##    neighbors .metric .estimator    mean     n std_err .config              \n##        <dbl> <chr>   <chr>        <dbl> <int>   <dbl> <chr>                \n##  1         1 rmse    standard   107206\\.     5   4102\\. Preprocessor1_Model01\n##  2         4 rmse    standard    90469\\.     5   3312\\. Preprocessor1_Model02\n##  3         7 rmse    standard    86580\\.     5   3062\\. Preprocessor1_Model03\n##  4        10 rmse    standard    85321\\.     5   3395\\. Preprocessor1_Model04\n##  5        13 rmse    standard    85045\\.     5   3641\\. Preprocessor1_Model05\n##  6        16 rmse    standard    84675\\.     5   3679\\. Preprocessor1_Model06\n##  7        19 rmse    standard    84776\\.     5   3984\\. Preprocessor1_Model07\n##  8        22 rmse    standard    84617\\.     5   3952\\. Preprocessor1_Model08\n##  9        25 rmse    standard    84953\\.     5   3929\\. Preprocessor1_Model09\n## 10        28 rmse    standard    84612\\.     5   3917\\. Preprocessor1_Model10\n## # ℹ 57 more rows\n```", "```r\n# show only the row of minimum RMSPE\nsacr_min <- sacr_results |>\n filter(mean == min(mean))\n\nsacr_min\n```", "```r\n## # A tibble: 1 × 7\n##   neighbors .metric .estimator   mean     n std_err .config              \n##       <dbl> <chr>   <chr>       <dbl> <int>   <dbl> <chr>                \n## 1        52 rmse    standard   84561\\.     5   4470\\. Preprocessor1_Model18\n```", "```r\nkmin <- sacr_min |> pull(neighbors)\n\nsacr_spec <- nearest_neighbor(weight_func = \"rectangular\", neighbors = kmin) |>\n set_engine(\"kknn\") |>\n set_mode(\"regression\")\n\nsacr_fit <- workflow() |>\n add_recipe(sacr_recipe) |>\n add_model(sacr_spec) |>\n fit(data = sacramento_train)\n\nsacr_summary <- sacr_fit |>\n predict(sacramento_test) |>\n bind_cols(sacramento_test) |>\n metrics(truth = price, estimate = .pred) |>\n filter(.metric == 'rmse')\n\nsacr_summary\n```", "```r\n## # A tibble: 1 × 3\n##   .metric .estimator .estimate\n##   <chr>   <chr>          <dbl>\n## 1 rmse    standard      90529.\n```", "```r\nsqft_prediction_grid <- tibble(\n sqft = seq(\n from = sacramento |> select(sqft) |> min(),\n to = sacramento |> select(sqft) |> max(),\n by = 10\n )\n)\n\nsacr_preds <- sacr_fit |>\n predict(sqft_prediction_grid) |>\n bind_cols(sqft_prediction_grid)\n\nplot_final <- ggplot(sacramento, aes(x = sqft, y = price)) +\n geom_point(alpha = 0.4) +\n geom_line(data = sacr_preds,\n mapping = aes(x = sqft, y = .pred),\n color = \"steelblue\",\n linewidth = 1) +\n xlab(\"House size (square feet)\") +\n ylab(\"Price (USD)\") +\n scale_y_continuous(labels = dollar_format()) +\n ggtitle(paste0(\"K = \", kmin)) +\n theme(text = element_text(size = 12))\n\nplot_final\n```", "```r\nplot_beds <- sacramento |>\n ggplot(aes(x = beds, y = price)) +\n geom_point(alpha = 0.4) +\n labs(x = 'Number of Bedrooms', y = 'Price (USD)') +\n theme(text = element_text(size = 12))\nplot_beds\n```", "```r\nsacr_recipe <- recipe(price ~ sqft + beds, data = sacramento_train) |>\n step_scale(all_predictors()) |>\n step_center(all_predictors())\nsacr_spec <- nearest_neighbor(weight_func = \"rectangular\",\n neighbors = tune()) |>\n set_engine(\"kknn\") |>\n set_mode(\"regression\")\n```", "```r\ngridvals <- tibble(neighbors = seq(1, 200))\n\nsacr_multi <- workflow() |>\n add_recipe(sacr_recipe) |>\n add_model(sacr_spec) |>\n tune_grid(sacr_vfold, grid = gridvals) |>\n collect_metrics() |>\n filter(.metric == \"rmse\") |>\n filter(mean == min(mean))\n\nsacr_k <- sacr_multi |>\n pull(neighbors)\nsacr_multi\n```", "```r\n## # A tibble: 1 × 7\n##   neighbors .metric .estimator   mean     n std_err .config               \n##       <int> <chr>   <chr>       <dbl> <int>   <dbl> <chr>                 \n## 1        11 rmse    standard   81839\\.     5   3108\\. Preprocessor1_Model011\n```", "```r\nsacr_spec <- nearest_neighbor(weight_func = \"rectangular\",\n neighbors = sacr_k) |>\n set_engine(\"kknn\") |>\n set_mode(\"regression\")\n\nknn_mult_fit <- workflow() |>\n add_recipe(sacr_recipe) |>\n add_model(sacr_spec) |>\n fit(data = sacramento_train)\n\nknn_mult_preds <- knn_mult_fit |>\n predict(sacramento_test) |>\n bind_cols(sacramento_test)\n\nknn_mult_mets <- metrics(knn_mult_preds, truth = price, estimate = .pred) |>\n filter(.metric == 'rmse')\n\nknn_mult_mets\n```", "```r\n## # A tibble: 1 × 3\n##   .metric .estimator .estimate\n##   <chr>   <chr>          <dbl>\n## 1 rmse    standard      90862.\n```"]