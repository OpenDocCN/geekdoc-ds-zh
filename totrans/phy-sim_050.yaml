- en: Semi-Implicit Discretization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 半隐式离散化
- en: 原文：[https://phys-sim-book.github.io/lec9.2-semi_imp_fric.html](https://phys-sim-book.github.io/lec9.2-semi_imp_fric.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://phys-sim-book.github.io/lec9.2-semi_imp_fric.html](https://phys-sim-book.github.io/lec9.2-semi_imp_fric.html)
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
- en: However, challenges still remain on incorporating friction into the optimization
    time integration. A major problem is that friction is not a conservative force
    and there is no well-defined potential such that taking the opposite of its gradient
    produces the frictional force. In other words, implicit friction force is not
    integrable. Without a potential energy, backtracking line search could not be
    performed, and thus guarantees on the stability and convergence of the optimization
    will be broken.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，将摩擦力纳入优化时间积分中仍然存在挑战。一个主要问题是摩擦力不是一个守恒力，没有定义良好的势能，使得取其梯度的相反数可以得到摩擦力。换句话说，隐式摩擦力是不可积的。没有势能，就无法进行回溯线搜索，因此优化稳定性和收敛性的保证将被破坏。
- en: In fact, whether a force has well-defined potential energy really depends on
    the temporal discretization. For example, with explicit time integration, any
    force f is constant within a time step and it has a potential energy −fTx. Taking
    this inspiration, we could make friction force integrable with a smarter temporal
    discretization. Making friction force constant within a time step would certainly
    restrict the size of the time step to obtain high quality results. Therefore,
    we discretize part of the friction force explicitly and formulate an integrable
    semi-implicit friction force.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，一个力是否具有定义良好的势能确实取决于时间离散化。例如，在显式时间积分中，任何力f在时间步长内是恒定的，并且具有势能−fTx。受到这种灵感的启发，我们可以通过更智能的时间离散化使摩擦力可积。使摩擦力在时间步长内保持恒定无疑会限制时间步长的大小以获得高质量的结果。因此，我们显式地离散化部分摩擦力，并制定了一个可积的半隐式摩擦力。
- en: 'Following IPC, we fix the normal force magnitude λ (the ones only used in calculating
    friction) and the tangent operator T during the nonlinear optimization to the
    value in the last time step n: λn=λ(xn), and Tn=T(xn), which then makes the friction
    force integrable with a potential energy Pf​(x)=k∑​μλkn​f0​(∥vˉk​h^∥),(9.2.1)
    where vˉk​=(Tkn​)Tv, h^I=(∂v/∂x)−1, and f0​(y)={−3ϵv2​h^2y3​+ϵv​h^y2​+3ϵv​h^​,y,​y∈[0,ϵv​h^)y≥ϵv​h^,​(9.2.2)
    so that f0′​(y)=f1​(y/h^). Here h^ is a constant multiple of the time step size
    h for most linear (multi-)step time integration methods including implicit Euler
    and higher-order backward difference formulas, etc. Then, taking the gradient
    of Equation [(9.2.1)](#eq:lec9:fric_potential) w.r.t. x we obtain −∇Pf​(x)=−k∑​μλkn​Tkn​f1​(∥vˉk​∥)s(vˉk​),(9.2.3)
    which is a semi-implicit discretization of our mollified friction force with explicit
    terms λkn​ and Tkn​. The Hessian of Pf​ can be calculated as =​∇2Pf​(x)k∑​μλkn​Tkn​(∥vˉk​∥3f1′​(∥vˉk​∥)∥vˉk​∥−f1​(∥vˉk​∥)​vˉk​vˉkT​+∥vˉk​∥f1​(∥vˉk​∥)​I3​)Tkn​T∂x∂v​.​(9.2.4)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 遵循IPC，我们在非线性优化期间将法向力大小λ（仅用于计算摩擦力）和切向算子T固定为最后一个时间步n的值：λn=λ(xn)，Tn=T(xn)，这使得摩擦力与势能Pf(x)=k∑μλknf0(∥vˉk∥),(9.2.1)可积，其中vˉk=(Tkn)Tv,
    h^I=(∂v/∂x)−1, 和 f0(y)={−3ϵv2h^2y3+ϵvh^y2+3ϵvh^​,y,​y∈[0,ϵvh^)y≥ϵvh^,​(9.2.2)
    以便 f0′(y)=f1(y/h^)。这里h^是时间步长h的常数倍，对于大多数线性（多步）时间积分方法，包括隐式欧拉和高阶后差公式等。然后，对方程[(9.2.1)](#eq:lec9:fric_potential)关于x求梯度，我们得到
    −∇Pf(x)=−k∑μλknTknf1(∥vˉk∥)s(vˉk),(9.2.3)，这是我们的光滑摩擦力的半隐式离散化，具有显式项λkn和Tkn。Pf的Hessian可以计算为
    =∇2Pf(x)k∑μλknTkn(∥vˉk∥3f1′(∥vˉk∥)∥vˉk∥−f1(∥vˉk∥)∥vˉk∥vˉkT+∥vˉk∥f1(∥vˉk∥)I3)TknT∂x∂v.​(9.2.4)
- en: '***Remark 9.2.1.*** In the friction gradient and Hessian expression (Equation
    [(9.2.3)](#eq:lec9:fric_grad) and Equation [(9.2.4)](#eq:lec9:fric_hess)), there
    are ∥vk​∥ in the denominators, which could be 0 when there is no relative sliding
    motion at a contact point. To avoid division by 0 during the computation, for
    friction gradient, we can derive ∥vˉk​∥f1​(∥vˉk​∥)​={−ϵv2​∥vˉk​∥​+ϵv​2​,1/∥vˉk​∥,​∥vˉk​∥∈[0,ϵv​)∥vˉk​∥≥ϵv​,​(9.2.5)
    which is well-defined everywhere, and so we obtain −∇Pf,k​(x)=−μλkn​Tkn​∥vˉk​∥f1​(∥vˉk​∥)​vˉk​=0when∥vˉk​∥=0.
    For friction Hessian, we can derive ∥vˉk​∥2f1′​(∥vˉk​∥)∥vˉk​∥−f1​(∥vˉk​∥)​={−1/ϵv2​,−1/∥vˉk​∥2,​∥vˉk​∥∈[0,ϵv​)∥vˉk​∥≥ϵv​,​(9.2.6)
    which is also well-defined everywhere, and since vˉk​vˉkT​/∥vˉk​∥=0 when ∥vˉk​∥=0,
    we know that ∇2Pf,k​(x)=μλkn​Tkn​(∥vˉk​∥f1​(∥vˉk​∥)​I3​)Tkn​T∂x∂v​when∥vˉk​∥=0.'
  id: totrans-6
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***注9.2.1.*** 在摩擦梯度和Hessian的表达式（方程[(9.2.3)](#eq:lec9:fric_grad)和方程[(9.2.4)](#eq:lec9:fric_hess)）中，分母中有∥vk∥，当接触点没有相对滑动运动时，这可能是0。为了避免计算过程中的除以0，对于摩擦梯度，我们可以推导出∥vˉk∥f1(∥vˉk∥)={−ϵv2∥vˉk∥+ϵv2,1/∥vˉk∥，∥vˉk∥∈[0,ϵv)∥vˉk∥≥ϵv，(9.2.5)这在任何地方都是良好定义的，因此我们得到−∇Pf,k(x)=−μλknTkn∥vˉk∥f1(∥vˉk∥)vˉk=0当∥vˉk∥=0。对于摩擦Hessian，我们可以推导出∥vˉk∥2f1′(∥vˉk∥)∥vˉk∥−f1(∥vˉk∥)={−1/ϵv2，−1/∥vˉk∥2，∥vˉk∥∈[0,ϵv)∥vˉk∥≥ϵv，(9.2.6)这同样在任何地方都是良好定义的，并且由于当∥vˉk∥=0时，vˉkvˉkT/∥vˉk∥=0，我们知道当∥vˉk∥=0时，∇2Pf,k(x)=μλknTkn(∥vˉk∥f1(∥vˉk∥)I3)TknT∂x∂v。'
- en: '***Remark 9.2.2.*** The friction formulation in this lecture is introduced
    slightly differently from the original IPC [[Li et al. 2020]](bibliography.html#li2020incremental)
    in 2 places:'
  id: totrans-7
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***注9.2.2.*** 本讲座中摩擦公式的介绍与原始的IPC [[Li et al. 2020]](bibliography.html#li2020incremental)在两个地方略有不同：'
- en: ''
  id: totrans-8
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: We directly use the relative sliding velocity vk​ rather than the relative sliding
    displacement uk​=h^vk​ in IPC as the input to the mollifier f1​(), and so our
    f1​() differs from that in the IPC on h^ in the denominators. When time integration
    rules other than implicit Euler is applied (so xn+1−xn=h^vn+1), calling uk​ the
    relative sliding displacement is inappropriate and may cause confusions.
  id: totrans-9
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们直接使用相对滑动速度vk而不是相对滑动位移uk=h^vk，如IPC中所述，作为mollifier f1()的输入，因此我们的f1()在分母中的h^与IPC中的不同。当应用除了隐式Euler以外的时积分规则（因此xn+1−xn≠h^vn+1）时，将uk称为相对滑动位移是不恰当的，并可能引起混淆。
- en: We did not introduce a tangent basis to express relative sliding velocity in
    the tangent space, because this is not necessary in computing the friction energy,
    gradient, and Hessian.
  id: totrans-10
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们没有引入切线基来表示切线空间中的相对滑动速度，因为在计算摩擦能、梯度和Hessian时这不是必要的。
