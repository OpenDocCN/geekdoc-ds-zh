- en: Semi-Implicit Discretization
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://phys-sim-book.github.io/lec9.2-semi_imp_fric.html](https://phys-sim-book.github.io/lec9.2-semi_imp_fric.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
  prefs: []
  type: TYPE_NORMAL
- en: However, challenges still remain on incorporating friction into the optimization
    time integration. A major problem is that friction is not a conservative force
    and there is no well-defined potential such that taking the opposite of its gradient
    produces the frictional force. In other words, implicit friction force is not
    integrable. Without a potential energy, backtracking line search could not be
    performed, and thus guarantees on the stability and convergence of the optimization
    will be broken.
  prefs: []
  type: TYPE_NORMAL
- en: In fact, whether a force has well-defined potential energy really depends on
    the temporal discretization. For example, with explicit time integration, any
    force f is constant within a time step and it has a potential energy −fTx. Taking
    this inspiration, we could make friction force integrable with a smarter temporal
    discretization. Making friction force constant within a time step would certainly
    restrict the size of the time step to obtain high quality results. Therefore,
    we discretize part of the friction force explicitly and formulate an integrable
    semi-implicit friction force.
  prefs: []
  type: TYPE_NORMAL
- en: 'Following IPC, we fix the normal force magnitude λ (the ones only used in calculating
    friction) and the tangent operator T during the nonlinear optimization to the
    value in the last time step n: λn=λ(xn), and Tn=T(xn), which then makes the friction
    force integrable with a potential energy Pf​(x)=k∑​μλkn​f0​(∥vˉk​h^∥),(9.2.1)
    where vˉk​=(Tkn​)Tv, h^I=(∂v/∂x)−1, and f0​(y)={−3ϵv2​h^2y3​+ϵv​h^y2​+3ϵv​h^​,y,​y∈[0,ϵv​h^)y≥ϵv​h^,​(9.2.2)
    so that f0′​(y)=f1​(y/h^). Here h^ is a constant multiple of the time step size
    h for most linear (multi-)step time integration methods including implicit Euler
    and higher-order backward difference formulas, etc. Then, taking the gradient
    of Equation [(9.2.1)](#eq:lec9:fric_potential) w.r.t. x we obtain −∇Pf​(x)=−k∑​μλkn​Tkn​f1​(∥vˉk​∥)s(vˉk​),(9.2.3)
    which is a semi-implicit discretization of our mollified friction force with explicit
    terms λkn​ and Tkn​. The Hessian of Pf​ can be calculated as =​∇2Pf​(x)k∑​μλkn​Tkn​(∥vˉk​∥3f1′​(∥vˉk​∥)∥vˉk​∥−f1​(∥vˉk​∥)​vˉk​vˉkT​+∥vˉk​∥f1​(∥vˉk​∥)​I3​)Tkn​T∂x∂v​.​(9.2.4)'
  prefs: []
  type: TYPE_NORMAL
- en: '***Remark 9.2.1.*** In the friction gradient and Hessian expression (Equation
    [(9.2.3)](#eq:lec9:fric_grad) and Equation [(9.2.4)](#eq:lec9:fric_hess)), there
    are ∥vk​∥ in the denominators, which could be 0 when there is no relative sliding
    motion at a contact point. To avoid division by 0 during the computation, for
    friction gradient, we can derive ∥vˉk​∥f1​(∥vˉk​∥)​={−ϵv2​∥vˉk​∥​+ϵv​2​,1/∥vˉk​∥,​∥vˉk​∥∈[0,ϵv​)∥vˉk​∥≥ϵv​,​(9.2.5)
    which is well-defined everywhere, and so we obtain −∇Pf,k​(x)=−μλkn​Tkn​∥vˉk​∥f1​(∥vˉk​∥)​vˉk​=0when∥vˉk​∥=0.
    For friction Hessian, we can derive ∥vˉk​∥2f1′​(∥vˉk​∥)∥vˉk​∥−f1​(∥vˉk​∥)​={−1/ϵv2​,−1/∥vˉk​∥2,​∥vˉk​∥∈[0,ϵv​)∥vˉk​∥≥ϵv​,​(9.2.6)
    which is also well-defined everywhere, and since vˉk​vˉkT​/∥vˉk​∥=0 when ∥vˉk​∥=0,
    we know that ∇2Pf,k​(x)=μλkn​Tkn​(∥vˉk​∥f1​(∥vˉk​∥)​I3​)Tkn​T∂x∂v​when∥vˉk​∥=0.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '***Remark 9.2.2.*** The friction formulation in this lecture is introduced
    slightly differently from the original IPC [[Li et al. 2020]](bibliography.html#li2020incremental)
    in 2 places:'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: We directly use the relative sliding velocity vk​ rather than the relative sliding
    displacement uk​=h^vk​ in IPC as the input to the mollifier f1​(), and so our
    f1​() differs from that in the IPC on h^ in the denominators. When time integration
    rules other than implicit Euler is applied (so xn+1−xn=h^vn+1), calling uk​ the
    relative sliding displacement is inappropriate and may cause confusions.
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
- en: We did not introduce a tangent basis to express relative sliding velocity in
    the tangent space, because this is not necessary in computing the friction energy,
    gradient, and Hessian.
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
