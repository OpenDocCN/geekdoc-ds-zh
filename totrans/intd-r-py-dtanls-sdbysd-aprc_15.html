<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Chapter 11 Control Flow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Chapter 11 Control Flow</h1>
<blockquote>原文：<a href="https://randpythonbook.netlify.app/control-flow">https://randpythonbook.netlify.app/control-flow</a></blockquote>
<div id="control-flow" class="section level1 hasAnchor">

<div id="conditional-logic" class="section level2 hasAnchor">
<h2><span class="header-section-number">11.1</span> Conditional Logic<a aria-label="Anchor link to header" class="anchor-section" href="/control-flow#conditional-logic"/></h2>
<p>We discussed Boolean/logical objects in <a href="/basic-types#basic-types">2</a>. We used these for</p>
<ul>
<li>counting the number of times a condition appeared, and</li>
<li>subsetting vectors and data frames.</li>
</ul>
<p>Another way to use them is to conditionally execute code. You can choose to execute code depending on whether or not a Boolean/logical value is true or not.</p>
<p>This is what an <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#if">if statement looks like In R</a>:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" title="1">myName &lt;-<span class="st"> "Taylor"</span></a>
<a class="sourceLine" id="cb177-2" title="2"><span class="cf">if</span>(myName <span class="op">!=</span><span class="st"> "Clare"</span>){</a>
<a class="sourceLine" id="cb177-3" title="3">  <span class="kw">print</span>(<span class="st">"you are not Clare"</span>)</a>
<a class="sourceLine" id="cb177-4" title="4">}</a>
<a class="sourceLine" id="cb177-5" title="5"><span class="co">## [1] "you are not Clare"</span></a></code></pre></div>
<p><a href="https://docs.python.org/3/tutorial/controlflow.html#if-statements">In Python</a>, you don’t need curly braces, but the indentation needs to be just right, and you need a colon <span class="citation">(Lutz <a href="#ref-Lutz13">2013</a>)</span>.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb178-1" title="1">my_name <span class="op">=</span> <span class="st">"Taylor"</span></a>
<a class="sourceLine" id="cb178-2" title="2"><span class="cf">if</span> my_name <span class="op">==</span> <span class="st">"Taylor"</span>:</a>
<a class="sourceLine" id="cb178-3" title="3">    <span class="bu">print</span>(<span class="st">"hi Taylor"</span>)</a>
<a class="sourceLine" id="cb178-4" title="4"><span class="co">## hi Taylor</span></a></code></pre></div>
<p>There can be more than one test of truth. To test alternative conditions, you can add one or more <code>else if</code> (in R) or <code>elif</code> (in Python) blocks. The first block with a Boolean that is found to be true will execute, and none of the resulting conditions will be checked.</p>
<p>If no <code>if</code> block or <code>else if</code>/<code>elif</code> block executes, an <code>else</code> block will always execute. That’s why <code>else</code> blocks don’t need to look at a Boolean. Whether they execute only depends on the Booleans in the previous blocks. If there is no <code>else</code> block, and none of the previous conditions are true, nothing will execute.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" title="1"><span class="co"># in R</span></a>
<a class="sourceLine" id="cb179-2" title="2">food &lt;-<span class="st"> "muffin"</span></a>
<a class="sourceLine" id="cb179-3" title="3"><span class="cf">if</span>(food <span class="op">==</span><span class="st"> "apple"</span>){</a>
<a class="sourceLine" id="cb179-4" title="4">    <span class="kw">print</span>(<span class="st">"an apple a day keeps the doctor away"</span>)</a>
<a class="sourceLine" id="cb179-5" title="5">}<span class="cf">else</span> <span class="cf">if</span>(food <span class="op">==</span><span class="st"> "muffin"</span>){</a>
<a class="sourceLine" id="cb179-6" title="6">  <span class="kw">print</span>(<span class="st">"muffins have a lot of sugar in them"</span>)</a>
<a class="sourceLine" id="cb179-7" title="7">}<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb179-8" title="8">  <span class="kw">print</span>(<span class="st">"neither an apple nor a muffin"</span>)</a>
<a class="sourceLine" id="cb179-9" title="9">}</a>
<a class="sourceLine" id="cb179-10" title="10"><span class="co">## [1] "muffins have a lot of sugar in them"</span></a></code></pre></div>
<div class="sourceCode" id="cb180"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb180-1" title="1"><span class="co"># in Python</span></a>
<a class="sourceLine" id="cb180-2" title="2">my_num <span class="op">=</span> <span class="fl">42.999</span></a>
<a class="sourceLine" id="cb180-3" title="3"><span class="cf">if</span> my_num <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb180-4" title="4">    <span class="bu">print</span>(<span class="st">"my_num is even"</span>)</a>
<a class="sourceLine" id="cb180-5" title="5"><span class="cf">elif</span> my_num <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span>:</a>
<a class="sourceLine" id="cb180-6" title="6">    my_num <span class="op">+=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb180-7" title="7">    <span class="bu">print</span>(<span class="st">"my_num was made even"</span>)</a>
<a class="sourceLine" id="cb180-8" title="8"><span class="cf">else</span>:</a>
<a class="sourceLine" id="cb180-9" title="9">    <span class="bu">print</span>(<span class="st">"you're cheating by not using integers!"</span>)</a>
<a class="sourceLine" id="cb180-10" title="10"><span class="co">## you're cheating by not using integers!</span></a></code></pre></div>
</div>
<div id="loops" class="section level2 hasAnchor">
<h2><span class="header-section-number">11.2</span> Loops<a aria-label="Anchor link to header" class="anchor-section" href="/control-flow#loops"/></h2>
<p>One line of code generally does one “thing,” unless you’re using loops. Code written inside a loop will execute many times.</p>
<p>The most common loop for us will be a <code>for</code> loop. A simple <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#for"><code>for</code> loop in R</a> might look like this</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" title="1"><span class="co">#in R</span></a>
<a class="sourceLine" id="cb181-2" title="2">myLength &lt;-<span class="st"> </span><span class="dv">9</span></a>
<a class="sourceLine" id="cb181-3" title="3">r &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">"numeric"</span>, <span class="dt">length =</span> myLength)</a>
<a class="sourceLine" id="cb181-4" title="4"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(myLength)){</a>
<a class="sourceLine" id="cb181-5" title="5">  r[i] &lt;-<span class="st"> </span>i</a>
<a class="sourceLine" id="cb181-6" title="6">}</a>
<a class="sourceLine" id="cb181-7" title="7">r</a>
<a class="sourceLine" id="cb181-8" title="8"><span class="co">## [1] 1 2 3 4 5 6 7 8 9</span></a></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>seq_len(myLength)</code> gives us a <code>vector</code>.</li>
<li><code>i</code> is a variable that takes on the values found in <code>seq_len(myLength)</code>.</li>
<li>Code inside the loop (inside the curly braces), is repeatedly executed, and it may or may not reference the dynamic variable <code>i</code>.</li>
</ol>
<p><a href="https://docs.python.org/3/tutorial/controlflow.html#for-statements">Here is an example of a for loop in Python</a> <span class="citation">(Lutz <a href="#ref-Lutz13">2013</a>)</span>:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb182-1" title="1"><span class="co">#in Python</span></a>
<a class="sourceLine" id="cb182-2" title="2">my_length <span class="op">=</span> <span class="dv">9</span></a>
<a class="sourceLine" id="cb182-3" title="3">r <span class="op">=</span> []</a>
<a class="sourceLine" id="cb182-4" title="4"><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(my_length):</a>
<a class="sourceLine" id="cb182-5" title="5">  r.append(i)</a>
<a class="sourceLine" id="cb182-6" title="6">r</a>
<a class="sourceLine" id="cb182-7" title="7"><span class="co">## [0, 1, 2, 3, 4, 5, 6, 7, 8]</span></a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Unsurprisingly, Python’s syntax opts for indentation and colons instead of curly braces and parentheses.</li>
<li>Code inside the loop (indented underneath the <code>for</code> line), is repeatedly executed, and it may or may not reference the dynamic variable <code>i</code>.</li>
<li><code>for</code> loops in Python are more flexible because they iterate over many different types of data structures–in this case <a href="https://docs.python.org/3/library/stdtypes.html#range"><code>range()</code> returns an object of type <code>range</code></a>.</li>
<li>The <a href="https://docs.python.org/3/tutorial/controlflow.html#the-range-function"><code>range</code></a> doesn’t generate all the numbers in the sequence at once, so it saves on memory. This can be quite useful if you’re looping over a large collection, and you don’t need to store everything all at once. However, in this example, <code>r</code> is a list that <em>does</em> store all the consecutive integers.</li>
</ol>
<p>Loops are for repeatedly executing code. <code>for</code> loops are great when you know the number of iterations needed ahead of time. If the number of iterations is not known, then you’ll need a <code>while</code> loop. While loops will only terminate after a condition is found to be true. Here are some examples <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#while">in R</a> and <a href="https://docs.python.org/3/reference/compound_stmts.html#while">in Python</a>.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" title="1"><span class="co"># in R</span></a>
<a class="sourceLine" id="cb183-2" title="2">keepGoing &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb183-3" title="3"><span class="cf">while</span>(keepGoing){</a>
<a class="sourceLine" id="cb183-4" title="4">  oneOrZero &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb183-5" title="5">  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">"oneOrZero:"</span>, oneOrZero))</a>
<a class="sourceLine" id="cb183-6" title="6">  <span class="cf">if</span>(oneOrZero <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb183-7" title="7">    keepGoing &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb183-8" title="8">}</a>
<a class="sourceLine" id="cb183-9" title="9"><span class="co">## [1] "oneOrZero: 0"</span></a>
<a class="sourceLine" id="cb183-10" title="10"><span class="co">## [1] "oneOrZero: 0"</span></a>
<a class="sourceLine" id="cb183-11" title="11"><span class="co">## [1] "oneOrZero: 1"</span></a></code></pre></div>
<div class="sourceCode" id="cb184"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb184-1" title="1"><span class="co"># in Python</span></a>
<a class="sourceLine" id="cb184-2" title="2">keep_going <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb184-3" title="3"><span class="cf">while</span> keep_going:</a>
<a class="sourceLine" id="cb184-4" title="4">    one_or_zero <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, <span class="fl">.5</span>) </a>
<a class="sourceLine" id="cb184-5" title="5">    <span class="bu">print</span>(<span class="st">"one_or_zero: "</span>, one_or_zero)</a>
<a class="sourceLine" id="cb184-6" title="6">    <span class="cf">if</span> one_or_zero <span class="op">==</span> <span class="dv">1</span>:</a>
<a class="sourceLine" id="cb184-7" title="7">        keep_going <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb184-8" title="8"><span class="co">## one_or_zero:  0</span></a>
<a class="sourceLine" id="cb184-9" title="9"><span class="co">## one_or_zero:  1</span></a></code></pre></div>
<div class="rmd-caution">
<p>Here are some tips for writing loops:</p>
<ol style="list-style-type: decimal">
<li>If you find yourself copying and pasting code, changing only a small portion of text on each line of code, you should consider using a loop.</li>
<li>If a <code>for</code> loop works for something you are trying to do, first try to find a replacement function that does what you want. The examples above just made a <code>vector</code>/<code>list</code> of consecutive integers. There are many built in functions that accomplish this. Avoiding loops in this case would make your program shorter, easier to read, and (potentially) much faster.</li>
<li>A third option between looping, and a built-in function, is to try the functional approach. This will be explained more in the last chapter.</li>
<li>Watch out for <a href="https://en.wikipedia.org/wiki/Off-by-one_error"><strong>off-by-one</strong> errors</a>. Iterating over the wrong sequence is a common mistake, considering
<ul>
<li>Python starts counting from <span class="math inline">\(0\)</span>, while R starts counting from <span class="math inline">\(1\)</span></li>
<li>sometimes iteration <code>i</code> references the <code>i-1</code>th element of a container</li>
<li>The behavior of loops is sometimes more difficult to understand if they’re using <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Looping"><code>break</code></a> or <a href="https://docs.python.org/3/tutorial/controlflow.html#break-and-continue-statements-and-else-clauses-on-loops"><code>continue</code>/<code>next</code> statements</a>.</li>
</ul></li>
<li><em>Don’t hardcode variables.</em> In other words, don’t write code that is specific to particulars of your script’s current draft. Write code that will still run if your program is fed different data, or if you need to calculate something else that’s closely-related (e.g. run the same calculations on different data sets, or vary the number of simulations, or make the same plot several times in similar situations, etc.). I can guarantee that most of the code you write will need to be run in many different situations. If, at every time you decide to make a change, you need to hunt down multiple places and make multiple changes, there is a nontrivial probability you will miss at least one. As a result, you will introduce a bug into your program, and waste (sometimes a lot of) time trying to find it.</li>
<li>Watch out for infinite <code>while</code> loops. Make sure that your stopping criterion is guaranteed to eventually become true.</li>
</ol>
</div>
<p>Python also provides an alternative way to construct lists similar to the one we constructed in the above example. They are called <a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions"><strong>list comprehensions</strong></a>. These are convenient because you can incorporate iteration and conditional logic in one line of code.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb185-1" title="1">[<span class="dv">3</span><span class="op">*</span>i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>) <span class="cf">if</span> i<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</a>
<a class="sourceLine" id="cb185-2" title="2"><span class="co">## [0, 6, 12, 18, 24]</span></a></code></pre></div>
<p>You might also have a look at <a href="https://www.python.org/dev/peps/pep-0289/"><em>generator expressions</em></a> and <a href="https://www.python.org/dev/peps/pep-0274/"><em>dictionary comprehensions</em></a>.</p>
<p>R can come close to replicating the above behavior with vectorization, but the conditional part is hard to achieve without subsetting.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" title="1"><span class="dv">3</span><span class="op">*</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>)[<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>)<span class="op">%%</span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]</a>
<a class="sourceLine" id="cb186-2" title="2"><span class="co">## [1]  0  6 12 18 24</span></a></code></pre></div>
</div>
<div id="exercises-9" class="section level2 hasAnchor">
<h2><span class="header-section-number">11.3</span> Exercises<a aria-label="Anchor link to header" class="anchor-section" href="/control-flow#exercises-9"/></h2>
<div id="r-questions-8" class="section level3 hasAnchor">
<h3><span class="header-section-number">11.3.1</span> R Questions<a aria-label="Anchor link to header" class="anchor-section" href="/control-flow#r-questions-8"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>Suppose you have a <code>vector</code> of <code>numeric</code> data: <span class="math inline">\(x_1, \ldots, x_n\)</span>. Write a function called <code>cappedMoveAve(dataVector)</code> that takes in a <code>vector</code> and returns a 3-period “capped” moving average. Make sure to use a <code>for</code> loop. The formula you should use is
<span class="math display">\[\begin{equation} 
y_t = \min\left(10, \frac{1}{3}\sum_{i=0}^2x_{t-i} \right).
\end{equation}\]</span>
The function should return <span class="math inline">\(y_1, \ldots, y_n\)</span> as a <code>vector</code>. Let <span class="math inline">\(y_1 = y_2 = 0\)</span>.</p>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<p>Say we have a target<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a> distribution that we want to sample from:
<span class="math display">\[\begin{equation} 
p(x) = 
\begin{cases}
\frac{x^2(1-x)}{\int_0^1 y^2(1-y) dy} &amp; 0 &lt; x &lt; 1 \\
0 &amp; \text{otherwise}
\end{cases}.
\end{equation}\]</span>
The denominator, <span class="math inline">\(\int_0^1 y^2(1-y) dy\)</span>, is the target’s normalizing constant. You might know how to solve this integral (it’s equal to <span class="math inline">\(1/12\)</span>), but let’s pretend for the sake of our example that it’s too difficult for us. We want to sample from <span class="math inline">\(p(x)\)</span> while only being able to evaluate (not sample) from its unnormalized version <span class="math inline">\(f(x) := x^2(1-x)\)</span>. This is a situation that arises often–wanting to sample from some complicated distribution whose density you can only evaluate up to a constant of proportionality.</p>
<p>Next, let’s choose a uniform distribution for our <em>proposal distribution</em>: <span class="math inline">\(q(x) = 1\)</span> if <span class="math inline">\(0 &lt; x &lt; 1\)</span>. This means we will sample from this distribution, because it’s easier. We just need to “adjust” our samples somehow, because it’s not the same as our target.</p>
<p>We can plot all three functions. The area under the <span class="math inline">\(p(x)\)</span> and <span class="math inline">\(q(x)\)</span> curves is <span class="math inline">\(1\)</span>, because they are true probability density functions. <span class="math inline">\(f(x)\)</span>, however, is not.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-189"/>
<img src="../Images/6b3064f3480a1014a66fde65807f27a6.png" alt="Visualizing Our Three Functions" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-189-1.png"/>
<p class="caption">
Figure 11.1: Visualizing Our Three Functions
</p>
</div>
<p>Note that this algorithm allows for other proposal distributions. The only requirement of a proposal distribution is that its range of possible values must subsume the range of possible values of the target.</p>
<ol style="list-style-type: lower-alpha">
<li>Write a function called <code>arSamp(n)</code> that samples from <span class="math inline">\(p(x)\)</span> using accept-reject sampling. It should take a single argument that is equal to the number of samples desired. Below is one step of the accept-reject algorithm. You will need to do many iterations of this. The number of iterations will be random, because some of these proposals will not be accepted.</li>
</ol>
<p><strong>Algorithm 1</strong>: Accept-Reject Sampling (One Step)</p>
<ol style="list-style-type: lower-roman">
<li>Find <span class="math inline">\(M\)</span> such that <span class="math inline">\(M &gt; \frac{f(x)}{q(x)}\)</span> for all possible <span class="math inline">\(x\)</span> (the smaller the better).</li>
<li>Sample <span class="math inline">\(X\)</span> from <span class="math inline">\(q(x)\)</span>.</li>
<li>Sample <span class="math inline">\(Y \mid X\)</span> from <span class="math inline">\(\text{Bernoulli}\left(\frac{f(X)}{q(X)M}\right)\)</span>.</li>
<li>If <span class="math inline">\(Y = 1\)</span>, then return <span class="math inline">\(X\)</span>.</li>
<li>Otherwise, return nothing.</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li/>
</ol>
<p>Write a function called <code>multiplyTwoMats(A,B)</code> that performs matrix multiplication. It should take two <code>matrix</code> arguments: <code>A</code> and <code>B</code>. Then it should return the matrix product <code>AB</code>. Use two nested <code>for</code> loops to write this function. Make sure to test this function against the usual tool you use to multiply matrices together: <code>%*%</code>.</p>
<ol start="4" style="list-style-type: decimal">
<li/>
</ol>
<p>Suppose you are trying to predict a value of <span class="math inline">\(Y\)</span> given some information about a corresponding independent variable <span class="math inline">\(x\)</span>. Suppose further that you have a historical data set of observations <span class="math inline">\((x_1, y_1), \ldots, (x_n,y_n)\)</span>. One approach for coming up with predictions is to use <strong>Nadaraya–Watson Kernel Regression</strong> <span class="citation">(Nadaraya <a href="#ref-Nadaraya">1964</a>)</span> <span class="citation">(Watson <a href="#ref-Watson">1964</a>)</span>. The prediction this approach provides is simply a weighted average of all of the historically-observed data points <span class="math inline">\(y_1, \ldots, y_n\)</span>. The weight for a given <span class="math inline">\(y_i\)</span> will be larger if <span class="math inline">\(x_i\)</span> is “close” to the value <span class="math inline">\(x\)</span> that you are obtaining predictions for. On the other hand, if <span class="math inline">\(x_j\)</span> is far away from <span class="math inline">\(x\)</span>, then the weight for <span class="math inline">\(y_j\)</span> will be relatively small, and so this data point won’t influence the prediction much.</p>
<p>Write a function called <code>kernReg(xPred,xData,yData,kernFunc)</code> that computes the Nadaraya–Watson estimate of the prediction of <span class="math inline">\(Y\)</span> given <span class="math inline">\(X=x\)</span>. Do not use a <code>for</code> loop in your function definition. The formula is
<span class="math display">\[\begin{equation} 
\sum_{i=1}^n \frac{K(x-x_i)}{\sum_{j=1}^n K(x-x_j) } y_i,
\end{equation}\]</span>
where <span class="math inline">\(x\)</span> is the point you’re trying to get a prediction for.</p>
<ul>
<li>Your function should return one floating point number.</li>
<li>The input <code>xPred</code> will be a floating point number.</li>
<li>The input <code>xData</code> is a one-dimensional <code>vector</code> of numerical data of independent variables.</li>
<li>The input <code>yData</code> is a one-dimensional <code>vector</code> of numerical data of dependent variables.</li>
<li><code>kernFunc</code> is a function that accepts a <code>numeric</code> <code>vector</code> and returns a floating point. It’s vectorized.</li>
</ul>
<p>Below is some code that will help you test your predictions. The kernel function, <code>gaussKernel()</code>, implements the Gaussian kernel function <span class="math inline">\(K(z) = \exp[-z^2/2]/\sqrt{2\pi}\)</span>. Notice the creation of <code>preds</code> was commented out. Use a <code>for</code> loop to generate predictions for all elements of <code>xTest</code> and store them in the vector <code>preds</code>.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" title="1">gaussKernel &lt;-<span class="st"> </span>dnorm</a>
<a class="sourceLine" id="cb187-2" title="2">xTest &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dt">length.out=</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb187-3" title="3">yTest &lt;-<span class="st"> </span>xTest<span class="op">*</span><span class="dv">2</span> </a>
<a class="sourceLine" id="cb187-4" title="4"><span class="co"># preds &lt;- ?</span></a>
<a class="sourceLine" id="cb187-5" title="5"><span class="kw">plot</span>(xTest, yTest, <span class="dt">type =</span> <span class="st">"b"</span>)</a>
<a class="sourceLine" id="cb187-6" title="6"><span class="kw">lines</span>(xTest, preds, <span class="dt">col =</span> <span class="st">"red"</span>)</a></code></pre></div>
</div>
<div id="python-questions-8" class="section level3 hasAnchor">
<h3><span class="header-section-number">11.3.2</span> Python Questions<a aria-label="Anchor link to header" class="anchor-section" href="/control-flow#python-questions-8"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>Suppose you go to the casino with <span class="math inline">\(10\)</span> dollars. You decide that your policy is to play until you go broke, or until you triple your money. The only game you play costs <span class="math inline">\(\$1\)</span> to play. If you lose, you lose that dollar. If you win, you get another <span class="math inline">\(\$1\)</span> in addition to getting your money back.</p>
<ol style="list-style-type: lower-alpha">
<li>Write a function called <code>sim_night(p)</code> that simulates your night of gambling. Have it return a Pandas <code>Series</code> with the running balance of money you have over the course of a night. For example, if you lose <span class="math inline">\(10\)</span> games in a row, and go home early, the returned <code>Series</code> contains <span class="math inline">\(9, \ldots, 1,0\)</span>. This function will only take one input, <code>p</code>, which is the probability of winning any/every game you play.</li>
<li>Use a <code>for</code> loop to call your function <span class="math inline">\(5000\)</span> times with probability <code>p=.5</code>. Each time, store the number of games played. Store them all in a Numpy <code>array</code> or Pandas <code>Series</code> called <code>simulated_durations</code>.</li>
<li>Take the average of <code>simulated_durations</code>. This is your Monte Carlo estimate of the expected duration. How does it compare with what you think it should be theoretically?</li>
<li>Perform the same analysis to estimate the expected duration when <span class="math inline">\(p=.7\)</span>. Store your answer as a <code>float</code> called <code>expec_duration</code>.</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<p>Suppose you have the following data set. Please include the following snippet in your submission.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb188-1" title="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb188-2" title="2"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb188-3" title="3">my_data <span class="op">=</span> pd.read_csv(<span class="st">"sim_data.csv"</span>, header<span class="op">=</span><span class="va">None</span>).values.flatten()</a></code></pre></div>
<p>This question will demonstrate how to implement <strong>The Bootstrap</strong> <span class="citation">(Efron <a href="#ref-bootstrap">1979</a>)</span>, which is a popular nonparametric approach to understand the distribution of a statistic of interest. The main idea is to calculate your statistic over and over again on <em>bootstrapped</em> data sets, which are data sets randomly chosen, with replacement, from your original data set <code>my_data</code>. Each bootstrapped data set is of the same size as the original data set, and each bootstrapped data set will yield one statistic. Collect all of these random statistics, and it is a good approximation to the statistic’s theoretical distribution.</p>
<ol style="list-style-type: lower-alpha">
<li>Calculate the mean of this data set and store it as a floating point number called <code>sample_mean</code>.</li>
<li>Calculate <span class="math inline">\(5,000\)</span> bootstrap sample means. Store them in a Numpy <code>array</code> called <code>bootstrapped_means</code>. Use a <code>for</code> loop, and inside the loop, sample with replacement <span class="math inline">\(1000\)</span> times from the length <span class="math inline">\(1000\)</span> data set. You can use the function <code>np.random.choice()</code> to accomplish this.</li>
<li>Calculate the sample mean of these bootstrapped means. This is a good estimate of the <em>theoretical</em> mean/expectation of the sample mean. Call it <code>mean_of_means</code>.</li>
<li>Calculate the sample variance of these bootstrapped means. This is a good estimate of the <em>theoretical</em> variance of the sample mean. Call it <code>var_of_means</code>.</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li/>
</ol>
<p>Write a function called <code>ar_samp(n)</code> that samples from <span class="math inline">\(p(x)\)</span> using accept-reject sampling. Use any proposal distribution that you’d like. It should take a single argument that is equal to the number of samples desired. Sample from the following target:
<span class="math display">\[\begin{equation} 
p(x) \propto f(x) := \exp[\cos(2\pi x)] x^2(1-x), \hspace{5mm} 0 &lt; x &lt; 1.
\end{equation}\]</span></p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-bootstrap">
<p>Efron, B. 1979. “Bootstrap Methods: Another Look at the Jackknife.” <em>The Annals of Statistics</em> 7 (1): 1–26. <a href="https://doi.org/10.1214/aos/1176344552">https://doi.org/10.1214/aos/1176344552</a>.</p>
</div>
<div id="ref-Lutz13">
<p>Lutz, Mark. 2013. <em>Learning Python</em>. 5th ed. Beijing: O’Reilly. <a href="https://www.safaribooksonline.com/library/view/learning-python-5th/9781449355722/">https://www.safaribooksonline.com/library/view/learning-python-5th/9781449355722/</a>.</p>
</div>
<div id="ref-Nadaraya">
<p>Nadaraya, E. A. 1964. “On Estimating Regression.” <em>Theory of Probability &amp; Its Applications</em> 9 (1): 141–42. <a href="https://doi.org/10.1137/1109020">https://doi.org/10.1137/1109020</a>.</p>
</div>
<div id="ref-Watson">
<p>Watson, Geoffrey S. 1964. “Smooth Regression Analysis.” <em>Sankhyā: The Indian Journal of Statistics, Series A (1961-2002)</em> 26 (4): 359–72. <a href="http://www.jstor.org/stable/25049340">http://www.jstor.org/stable/25049340</a>.</p>
</div>
</div>
<div class="footnotes">
<hr/>
<ol start="20">
<li id="fn20"><p>This is the density of a <span class="math inline">\(\text{Beta}(3,2)\)</span> random variable, if you’re curious.<a class="footnote-back" href="/control-flow#fnref20">↩</a></p></li>
</ol>
</div>
                
</body>
</html>