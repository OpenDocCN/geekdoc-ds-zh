["```py\nlibrary(haven)\nlibrary(labelled)\nlibrary(tidyverse)\nlibrary(tinytable)\n```", "```py\nset.seed(853)\n\ntreat_control <-\n tibble(\n group = sample(x = c(\"Treatment\", \"Control\"), size = 100, replace = TRUE),\n binary_effect = sample(x = c(0, 1), size = 100, replace = TRUE)\n )\n\ntreat_control\n```", "```py\n# A tibble: 100 × 2\n   group     binary_effect\n   <chr>             <dbl>\n 1 Treatment             0\n 2 Control               1\n 3 Control               1\n 4 Treatment             1\n 5 Treatment             1\n 6 Treatment             0\n 7 Treatment             1\n 8 Treatment             1\n 9 Control               0\n10 Control               0\n# ℹ 90 more rows\n```", "```py\ntreat_control |>\n summarise(\n treat_result = sum(binary_effect) / length(binary_effect),\n .by = group\n )\n```", "```py\n# A tibble: 2 × 2\n  group     treat_result\n  <chr>            <dbl>\n1 Treatment        0.552\n2 Control          0.333\n```", "```py\nset.seed(853)\n\nnum_people <- 5000\n\npopulation <- tibble(\n person = 1:num_people,\n favorite_color = sample(c(\"Blue\", \"White\"), size = num_people, replace = TRUE),\n prefers_dogs = if_else(favorite_color == \"Blue\", \n rbinom(num_people, 1, 0.9), \n rbinom(num_people, 1, 0.1))\n )\n\npopulation |>\n count(favorite_color, prefers_dogs)\n```", "```py\n# A tibble: 4 × 3\n  favorite_color prefers_dogs     n\n  <chr>                 <int> <int>\n1 Blue                      0   256\n2 Blue                      1  2291\n3 White                     0  2239\n4 White                     1   214\n```", "```py\nset.seed(853)\n\nframe <-\n population |>\n mutate(in_frame = rbinom(n = num_people, 1, prob = 0.8)) |> \n filter(in_frame == 1)\n\nframe |>\n count(favorite_color, prefers_dogs)\n```", "```py\n# A tibble: 4 × 3\n  favorite_color prefers_dogs     n\n  <chr>                 <int> <int>\n1 Blue                      0   201\n2 Blue                      1  1822\n3 White                     0  1803\n4 White                     1   177\n```", "```py\nset.seed(853)\n\nsample <-\n frame |>\n select(-prefers_dogs) |>\n mutate(\n group = \n sample(x = c(\"Treatment\", \"Control\"), size = nrow(frame), replace = TRUE\n ))\n```", "```py\nsample |>\n count(group, favorite_color) |>\n mutate(prop = n / sum(n),\n .by = group) |>\n tt() |> \n style_tt(j = 1:4, align = \"llrr\") |> \n format_tt(digits = 2, num_mark_big = \",\", num_fmt = \"decimal\") |> \n setNames(c(\"Group\", \"Prefers\", \"Number\", \"Proportion\"))\n```", "```py\nsample |>\n left_join(\n frame |> select(person, prefers_dogs),\n by = \"person\"\n ) |>\n count(group, prefers_dogs) |>\n mutate(prop = n / sum(n),\n .by = group) |>\n tt() |> \n style_tt(j = 1:4, align = \"llrr\") |> \n format_tt(digits = 2, num_mark_big = \",\", num_fmt = \"decimal\") |> \n setNames(c(\n \"Group\",\n \"Prefers dogs to cats\",\n \"Number\",\n \"Proportion\"\n ))\n```", "```py\nset.seed(853)\n\nate_example <- \n tibble(person = 1:1000,\n treated = sample(c(\"Yes\", \"No\"), size = 1000, replace = TRUE)) |>\n mutate(outcome = case_when(\n treated == \"No\" ~ rnorm(n(), mean = 5, sd = 1),\n treated == \"Yes\" ~ rnorm(n(), mean = 6, sd = 1),\n ))\n```", "```py\nate_example |>\n ggplot(aes(x = outcome, fill = treated)) +\n geom_histogram(position = \"dodge2\", binwidth = 0.2) +\n theme_minimal() +\n labs(x = \"Outcome\", \n y = \"Number of people\", \n fill = \"Person was treated\") +\n scale_fill_brewer(palette = \"Set1\") +\n theme(legend.position = \"bottom\")\n```", "```py\nate_example |>\n summarise(mean = mean(outcome),\n .by = treated) |> \n tt() |> \n style_tt(j = 1:2, align = \"lr\") |> \n format_tt(digits = 2, num_fmt = \"decimal\") |> \n setNames(c(\n \"Was treated?\",\n \"Average effect\"\n ))\n```", "```py\nraw_nationscape_data <-\n read_dta(\"ns20200625.dta\")\n```", "```py\n# The Stata format separates labels so reunite those\nraw_nationscape_data <-\n to_factor(raw_nationscape_data)\n\n# Just keep relevant variables\nnationscape_data <-\n raw_nationscape_data |>\n select(vote_2020, gender, education, state, age)\n```", "```py\nnationscape_data\n```", "```py\n# A tibble: 6,479 × 5\n   vote_2020                gender education                         state   age\n * <fct>                    <fct>  <fct>                             <chr> <dbl>\n 1 Donald Trump             Female Associate Degree                  WI       49\n 2 I am not sure/don't know Female College Degree (such as B.A., B.… VA       39\n 3 Donald Trump             Female College Degree (such as B.A., B.… VA       46\n 4 Donald Trump             Female High school graduate              TX       75\n 5 Donald Trump             Female High school graduate              WA       52\n 6 I would not vote         Female Other post high school vocationa… OH       44\n 7 Joe Biden                Female Completed some college, but no d… MA       21\n 8 Joe Biden                Female Completed some college, but no d… TX       38\n 9 Donald Trump             Female Completed some college, but no d… CA       69\n10 Donald Trump             Female College Degree (such as B.A., B.… NC       59\n# ℹ 6,469 more rows\n```", "```py\nnationscape_data <-\n nationscape_data |>\n filter(vote_2020 %in% c(\"Joe Biden\", \"Donald Trump\")) |>\n mutate(vote_biden = if_else(vote_2020 == \"Joe Biden\", 1, 0)) |>\n select(-vote_2020)\n```", "```py\nnationscape_data <-\n nationscape_data |>\n mutate(\n age_group = case_when(\n age <= 29 ~ \"18-29\",\n age <= 44 ~ \"30-44\",\n age <= 59 ~ \"45-59\",\n age >= 60 ~ \"60+\",\n TRUE ~ \"Trouble\"\n ),\n gender = case_when(\n gender == \"Female\" ~ \"female\",\n gender == \"Male\" ~ \"male\",\n TRUE ~ \"Trouble\"\n ),\n education_level = case_when(\n education %in% c(\n \"3rd Grade or less\",\n \"Middle School - Grades 4 - 8\",\n \"Completed some high school\",\n \"High school graduate\"\n ) ~ \"High school or less\",\n education %in% c(\n \"Other post high school vocational training\",\n \"Completed some college, but no degree\"\n ) ~ \"Some post sec\",\n education %in% c(\n \"Associate Degree\",\n \"College Degree (such as B.A., B.S.)\",\n \"Completed some graduate, but no degree\"\n ) ~ \"Post sec +\",\n education %in% c(\"Masters degree\",\n \"Doctorate degree\") ~ \"Grad degree\",\n TRUE ~ \"Trouble\"\n )\n ) |>\n select(-education,-age)\n```", "```py\nwrite_csv(x = nationscape_data,\n file = \"nationscape_data.csv\")\n```", "```py\nnationscape_data |>\n mutate(supports = if_else(vote_biden == 1, \"Biden\", \"Trump\")) |> \n mutate(supports = factor(supports, levels = c(\"Trump\", \"Biden\"))) |> \n ggplot(mapping = aes(x = age_group, fill = supports)) +\n geom_bar(position = \"dodge2\") +\n theme_minimal() +\n labs(\n x = \"Age-group of respondent\",\n y = \"Number of respondents\",\n fill = \"Voted for\"\n ) +\n facet_wrap(vars(gender)) +\n guides(x = guide_axis(angle = 90)) +\n theme(legend.position = \"bottom\") +\n scale_fill_brewer(palette = \"Set1\")\n```", "```py\nupworthy <- read_csv(\"https://osf.io/vy8mj/download\")\n```", "```py\nupworthy |>\n names()\n```", "```py\n [1] \"...1\"                 \"created_at\"           \"updated_at\"          \n [4] \"clickability_test_id\" \"excerpt\"              \"headline\"            \n [7] \"lede\"                 \"slug\"                 \"eyecatcher_id\"       \n[10] \"impressions\"          \"clicks\"               \"significance\"        \n[13] \"first_place\"          \"winner\"               \"share_text\"          \n[16] \"square\"               \"test_week\" \n```", "```py\nupworthy |>\n head()\n```", "```py\n# A tibble: 6 × 17\n   ...1 created_at          updated_at          clickability_test_id     excerpt\n  <dbl> <dttm>              <dttm>              <chr>                    <chr>  \n1    11 2014-11-20 11:33:26 2016-04-02 16:25:54 546dd17e26714c82cc00001c Things…\n2    12 2014-11-20 15:00:01 2016-04-02 16:25:54 546e01d626714c6c4400004e Things…\n3    13 2014-11-20 11:33:51 2016-04-02 16:25:54 546dd17e26714c82cc00001c Things…\n4    14 2014-11-20 11:34:12 2016-04-02 16:25:54 546dd17e26714c82cc00001c Things…\n5    15 2014-11-20 11:34:33 2016-04-02 16:25:54 546dd17e26714c82cc00001c Things…\n6    16 2014-11-20 11:34:48 2016-04-02 16:25:54 546dd17e26714c82cc00001c Things…\n# ℹ 12 more variables: headline <chr>, lede <chr>, slug <chr>,\n#   eyecatcher_id <chr>, impressions <dbl>, clicks <dbl>, significance <dbl>,\n#   first_place <lgl>, winner <lgl>, share_text <chr>, square <chr>,\n#   test_week <dbl>\n```", "```py\nupworthy_restricted <-\n upworthy |>\n select(\n created_at, clickability_test_id, headline, impressions, clicks\n )\n```", "```py\nhead(upworthy_restricted)\n```", "```py\n# A tibble: 6 × 5\n  created_at          clickability_test_id     headline       impressions clicks\n  <dttm>              <chr>                    <chr>                <dbl>  <dbl>\n1 2014-11-20 11:33:26 546dd17e26714c82cc00001c Let’s See … H…        3118      8\n2 2014-11-20 15:00:01 546e01d626714c6c4400004e People Sent T…        4587    130\n3 2014-11-20 11:33:51 546dd17e26714c82cc00001c $3 Million Is…        3017     19\n4 2014-11-20 11:34:12 546dd17e26714c82cc00001c The Fact That…        2974     26\n5 2014-11-20 11:34:33 546dd17e26714c82cc00001c Reason #351 T…        3050     10\n6 2014-11-20 11:34:48 546dd17e26714c82cc00001c I Was Already…        3061     20\n```", "```py\nupworthy_restricted <-\n upworthy_restricted |>\n mutate(\n asks_question =\n str_detect(string = headline, pattern = \"\\\\?\")\n )\n\nupworthy_restricted |>\n count(asks_question)\n```", "```py\n# A tibble: 2 × 2\n  asks_question     n\n  <lgl>         <int>\n1 FALSE         89559\n2 TRUE          15992\n```", "```py\nquestion_or_not <-\n upworthy_restricted |>\n summarise(\n ave_clicks = mean(clicks),\n .by = c(clickability_test_id, asks_question)\n ) \n\nquestion_or_not |>\n pivot_wider(names_from = asks_question,\n values_from = ave_clicks,\n names_prefix = \"ave_clicks_\") |>\n drop_na(ave_clicks_FALSE, ave_clicks_TRUE) |>\n mutate(difference_in_clicks = ave_clicks_TRUE - ave_clicks_FALSE) |> \n summarise(average_differce = mean(difference_in_clicks))\n```", "```py\n# A tibble: 1 × 1\n  average_differce\n             <dbl>\n1            -4.16\n```", "```py\nquestion_or_not |> \n summarise(mean = mean(ave_clicks),\n .by = asks_question) |> \n tt() |> \n style_tt(j = 1:2, align = \"lr\") |> \n format_tt(digits = 0, num_fmt = \"decimal\") |> \n setNames(c(\"Asks a question?\", \"Mean clicks\"))\n```", "```py\nnetflix_data <-\n tibble(\n person = c(\"Ian\", \"Ian\", \"Roger\", \"Roger\",\n \"Roger\", \"Patricia\", \"Patricia\", \"Helen\"\n ),\n tv_show = c(\n \"Broadchurch\", \"Duty-Shame\", \"Broadchurch\", \"Duty-Shame\",\n \"Shetland\", \"Broadchurch\", \"Shetland\", \"Duty-Shame\"\n ),\n hours = c(6.8, 8.0, 0.8, 9.2, 3.2, 4.0, 0.2, 10.2)\n )\n```"]