<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Chapter 13 Visualization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Chapter 13 Visualization</h1>
<blockquote>原文：<a href="https://randpythonbook.netlify.app/visualization">https://randpythonbook.netlify.app/visualization</a></blockquote>
<div id="visualization" class="section level1 hasAnchor">

<p>I describe a few plotting paradigms in R and Python below. Note that these descriptions are brief. More details could easily turn any of these subsections into an entire textbook.</p>
<div id="base-r-plotting" class="section level2 hasAnchor">
<h2><span class="header-section-number">13.1</span> Base R Plotting<a aria-label="Anchor link to header" class="anchor-section" href="/visualization#base-r-plotting"/></h2>
<p>R comes with some built-in plotting functions such as <code>plot()</code>, <code>hist()</code> and <code>boxplot()</code>. Many of these reside in <code>package:graphics</code>, which comes pre-loaded into the search path. <code>plot()</code> on the other hand, is higher up the search path in <code>package:base</code>–it is a generic method whose methods can reside in many places (e.g. in <code>package:graphics</code> or some place else).</p>
<p>Base plotting will usually cover most of your needs, so that is what we spend the most time learning about. However, there are a large number of third-party libraries for plotting that you might consider looking into if you want to use a certain aesthetic, or if you want plotting functionality that is specialized for certain cases (e.g. geospatial plots).</p>
<p>Recall our Albemarle Real Estate data set <span class="citation">(Albemarle County Geographic Data Services Office <a href="#ref-albemarle_county_gis_web">2021</a>)</span> <span class="citation">(Ford <a href="#ref-clay_ford">2016</a>)</span>.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" title="1">df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"data/albemarle_real_estate.csv"</span>)</a>
<a class="sourceLine" id="cb216-2" title="2"><span class="kw">str</span>(df, <span class="dt">strict.width =</span> <span class="st">"cut"</span>)</a>
<a class="sourceLine" id="cb216-3" title="3"><span class="co">## 'data.frame':    30381 obs. of  12 variables:</span></a>
<a class="sourceLine" id="cb216-4" title="4"><span class="co">##  $ YearBuilt    : int  1769 1818 2004 2006 2004 1995 1900 1960 ..</span></a>
<a class="sourceLine" id="cb216-5" title="5"><span class="co">##  $ YearRemodeled: int  1988 1991 NA NA NA NA NA NA NA NA ...</span></a>
<a class="sourceLine" id="cb216-6" title="6"><span class="co">##  $ Condition    : chr  "Average" "Average" "Average" "Average" ..</span></a>
<a class="sourceLine" id="cb216-7" title="7"><span class="co">##  $ NumStories   : num  1.7 2 1 1 1.5 2.3 2 1 1 1 ...</span></a>
<a class="sourceLine" id="cb216-8" title="8"><span class="co">##  $ FinSqFt      : int  5216 5160 1512 2019 1950 2579 1530 800 9..</span></a>
<a class="sourceLine" id="cb216-9" title="9"><span class="co">##  $ Bedroom      : int  4 6 3 3 3 3 4 2 2 2 ...</span></a>
<a class="sourceLine" id="cb216-10" title="10"><span class="co">##  $ FullBath     : int  3 4 2 3 3 2 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb216-11" title="11"><span class="co">##  $ HalfBath     : int  0 1 1 0 0 1 0 0 0 0 ...</span></a>
<a class="sourceLine" id="cb216-12" title="12"><span class="co">##  $ TotalRooms   : int  8 11 9 10 8 8 6 4 4 4 ...</span></a>
<a class="sourceLine" id="cb216-13" title="13"><span class="co">##  $ LotSize      : num  5.1 453.9 42.6 5 5.5 ...</span></a>
<a class="sourceLine" id="cb216-14" title="14"><span class="co">##  $ TotalValue   : num  1096600 2978600 677800 453200 389200 ...</span></a>
<a class="sourceLine" id="cb216-15" title="15"><span class="co">##  $ City         : chr  "CROZET" "CROZET" "CROZET" "CROZET" ...</span></a></code></pre></div>
<p>If we wanted to get a general idea of how expensive homes were in Albemarle County, we could use a histogram. This helps us visualize a univariate numerical variable/column. Below I plot the (natural) logarithm of home prices.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" title="1"><span class="kw">hist</span>(<span class="kw">log</span>(df<span class="op">$</span>TotalValue), </a>
<a class="sourceLine" id="cb217-2" title="2">     <span class="dt">xlab =</span> <span class="st">"natural logarithm of home price"</span>, </a>
<a class="sourceLine" id="cb217-3" title="3">     <span class="dt">main =</span> <span class="st">"Super-Duper Plot!"</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-220"/>
<img src="../Images/362d8955c8588b70bbc930803c87dab5.png" alt="A Simple Histogram" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-220-1.png"/>
<p class="caption">
Figure 13.1: A Simple Histogram
</p>
</div>
<p>I specified the <code>xlab=</code> and <code>main=</code> arguments, but there are many more that could be tweaked. Make sure to skim the options in the documentation (<code>?hist</code>).</p>
<p><code>plot()</code> is useful for plotting <em>two</em> univariate numerical variables. This can be done in time series plots (variable versus time) and scatter plots (one variable versus another).</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb218-2" title="2"><span class="kw">plot</span>(df<span class="op">$</span>TotalValue, df<span class="op">$</span>LotSize, </a>
<a class="sourceLine" id="cb218-3" title="3">     <span class="dt">xlab =</span> <span class="st">"total value ($)"</span>, <span class="dt">ylab =</span> <span class="st">"lot size (sq. ft.)"</span>,</a>
<a class="sourceLine" id="cb218-4" title="4">     <span class="dt">pch =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">type =</span> <span class="st">"b"</span>)</a>
<a class="sourceLine" id="cb218-5" title="5"><span class="kw">plot</span>(<span class="kw">log</span>(df<span class="op">$</span>TotalValue), <span class="kw">log</span>(df<span class="op">$</span>LotSize), </a>
<a class="sourceLine" id="cb218-6" title="6">     <span class="dt">xlab =</span> <span class="st">"log. total value"</span>, <span class="dt">ylab =</span> <span class="st">"log. lot size"</span>, </a>
<a class="sourceLine" id="cb218-7" title="7">     <span class="dt">pch =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">type =</span> <span class="st">"p"</span>)</a>
<a class="sourceLine" id="cb218-8" title="8"><span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">log</span>(<span class="kw">mean</span>(df<span class="op">$</span>LotSize)), <span class="dt">col =</span> <span class="st">"green"</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-221"/>
<img src="../Images/d5e2b5acb1f9767219c34658dd03f57f.png" alt="Some Scatterplots" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-221-1.png"/>
<p class="caption">
Figure 13.2: Some Scatterplots
</p>
</div>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</a></code></pre></div>
<p>I use some of the many arguments available (type <code>?plot</code>). <code>xlab=</code> and <code>ylab=</code> specify the x- and y-axis labels, respectively. <code>col=</code> is short for “color.” <code>pch=</code> is short for “point character.” Changing this will change the symbol shapes used for each point. <code>type=</code> is more general than that, but it is related. I typically use it to specify whether or not I want the points connected with lines.</p>
<p>I use a couple other functions in the above code. <code>abline()</code> is used to superimpose lines over the top of a plot. They can be <code>h</code>orizontal, <code>v</code>ertical, or you can specify them in slope-intercept form, or by providing a linear model object. I also used <code>par()</code> to set a graphical parameter. The graphical parameter <code>par()$mfrow</code> sets the layout of a multiple plot visualization. I then set it back to the standard <span class="math inline">\(1 \times 1\)</span> layout afterwards.</p>
</div>
<div id="plotting-with-ggplot2" class="section level2 hasAnchor">
<h2><span class="header-section-number">13.2</span> Plotting with <code>ggplot2</code><a aria-label="Anchor link to header" class="anchor-section" href="/visualization#plotting-with-ggplot2"/></h2>
<p><a href="https://ggplot2.tidyverse.org/"><code>ggplot2</code></a> is a popular third-party visualization package for R. There are also libraries in Python (e.g. <a href="https://plotnine.readthedocs.io/en/stable/#"><code>plotnine</code></a>) that have a similar look and feel. This subsection provides a short tutorial on how to use <code>ggplot2</code> in R, and it is primarily based off of the material provided in <span class="citation">(Wickham <a href="#ref-ggplot2">2016</a>)</span>. Other excellent descriptions of <code>ggplot2</code> are <span class="citation">(Kabacoff <a href="#ref-r_in_action">2015</a>)</span> and <span class="citation">(Chang <a href="#ref-r_graphics_cookbook">2013</a>)</span>.</p>
<p><code>ggplot2</code> code looks a lot different than the code in the above section<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a>. There, we would write a series of function calls, and each would change some state in the current figure. Here, we call different <code>ggplot2</code> functions that create S3 objects with special behavior (more information about S3 objects in subsection <a href="/an-introduction-to-object-oriented-programming#using-s3-objects">14.2.2</a>), and then we “add” (i.e. we use the <code>+</code> operator) them together.</p>
<p>This new design is not to encourage you to think about S3 object-oriented systems. Rather, it is to get you thinking about making visualizations using the “grammar of graphics” <span class="citation">(Wilkinson <a href="#ref-gog">2005</a>)</span>. <code>ggplot2</code> makes use of its own specialized vocabulary that is taken from this book. As we get started, I will try to introduce some of this vocabulary slowly.</p>
<p>The core function in this library is the <a href="https://www.rdocumentation.org/packages/ggplot2/versions/3.3.5/topics/ggplot"><code>ggplot()</code> function</a>. This function initializes figures; it is the function that will take in information about <em>which</em> data set you want to plot, and <em>how</em> you want to plot it. The raw data is provided in the first argument. The second argument, <code>mapping=</code>, is more confusing. The argument should be constructed with the <code>aes()</code> function. In the parlance of <code>ggplot2</code>, <code>aes()</code> constructs an <strong>aesthetic mapping</strong>. Think of the “aesthetic mapping” as stored information that can be used later on–it “maps” data to visual properties of a figure.</p>
<p>Consider this first example by typing the following into your own console.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb220-2" title="2"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</a></code></pre></div>
<p>You’ll notice a few things about the code and the result produced:</p>
<ol style="list-style-type: decimal">
<li><p>No geometric shapes show up!</p></li>
<li><p>A Cartesian coordinate system is displayed, and the x-axis and y-axis were created based on aesthetic mapping provided (confirm this by typing <code>summary(mpg$displ)</code> and <code>summary(mpg$hwy)</code>).</p></li>
<li><p>The axis labels are taken from the column names provided to <code>aes()</code>.</p></li>
</ol>
<p>To display geometric shapes (aka <em>geoms</em> in the parlance of <code>ggplot2</code>), we need to add <a href="https://ggplot2-book.org/toolbox.html#toolbox"><strong>layers</strong></a> to the figure. “Layers” is quite a broad term–it does not only apply to geometric objects. In fact, in <code>ggplot2</code>, a layer can be pretty much anything: raw data, summarized data, transformed data, annotations, etc. However, the functions that add geometric object layers usually start with the prefix <code>geom_</code>. In RStudio, after loading <code>ggplot2</code>, type <code>geom_</code>, and then press <code>&lt;Tab&gt;</code> (autocomplete) to see some of the options.</p>
<p>Consider the function <a href="https://www.rdocumentation.org/packages/ggplot2/versions/3.3.5/topics/geom_point"><code>geom_point()</code></a>. It too returns an S3 instance that has specialized behavior. In the parlance of <code>ggplot2</code>, it adds a <a href="https://ggplot2-book.org/getting-started.html#basic-use">scatterplot</a> layer to the figure.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb221-2" title="2"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))  <span class="op">+</span></a>
<a class="sourceLine" id="cb221-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-223"/>
<img src="../Images/d3cf3b67f644b3cdceb572820881accf.png" alt="A Second Scatterplot" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-223-1.png"/>
<p class="caption">
Figure 13.3: A Second Scatterplot
</p>
</div>
<p>Notice that we did not need to provide any arguments to <code>geom_point()</code>–the aesthetic mappings were used by the new layer.</p>
<p>There are <em>many</em> types of layers that you can add, and you are not limited to any number of them in a given plot. For example, if we wanted to add a title, we could use the <code>ggtitle()</code> function to add a title layer. Unlike <code>geom_point()</code>, this function will need to take an argument because the desired title is not stored as an aesthetic mapping. Try running the following code on your own machine.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" title="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))  <span class="op">+</span></a>
<a class="sourceLine" id="cb222-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-3" title="3"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"my favorite scatterplot"</span>)</a></code></pre></div>
<p>Additionally, notice that the same layer will behave much differently if we change the aesthetic mapping.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" title="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> manufacturer))  <span class="op">+</span></a>
<a class="sourceLine" id="cb223-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb223-3" title="3"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"my favorite scatterplot"</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-225"/>
<img src="../Images/c6f1cb8b5937df541e5d00312e9a7a22.png" alt="Adding Some Color" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-225-1.png"/>
<p class="caption">
Figure 13.4: Adding Some Color
</p>
</div>
<p>If we want tighter control on the aesthetic mapping, we can use <a href="https://ggplot2-book.org/scales.html#scales"><strong>scales</strong></a>. Syntactically, these are things we “add” (<code>+</code>) to the figure, just like layers. However, these scales are constructed with a different set of functions, many of which start with the prefix <code>scale_</code>. We can change attributes of the axes like this.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" title="1">base_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mpg, </a>
<a class="sourceLine" id="cb224-2" title="2">                    <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> manufacturer)) <span class="op">+</span></a>
<a class="sourceLine" id="cb224-3" title="3"><span class="st">             </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-4" title="4"><span class="st">             </span><span class="kw">ggtitle</span>(<span class="st">"my favorite scatterplot"</span>)</a>
<a class="sourceLine" id="cb224-5" title="5">base_plot <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_reverse</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-226"/>
<img src="../Images/63bd87feba98b8bc142609f495b21960.png" alt="Changing Scales" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-226-1.png"/>
<p class="caption">
Figure 13.5: Changing Scales
</p>
</div>
<p>We can also change plot colors with scale layers. Let’s add an aesthetic called <code>fill=</code> so we can use colors to denote the value of a numerical (not categorical) column. This data set doesn’t have any more unused numerical columns, so let’s create a new one called <code>score</code>. We also use a new geom layer from a function called <code>geom_tile()</code>.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" title="1">mpg<span class="op">$</span>score &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>(mpg<span class="op">$</span>displ<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>mpg<span class="op">$</span>hwy<span class="op">^</span><span class="dv">2</span>) </a>
<a class="sourceLine" id="cb225-2" title="2"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">fill =</span> score ))  <span class="op">+</span></a>
<a class="sourceLine" id="cb225-3" title="3"><span class="st">  </span><span class="kw">geom_tile</span>() </a></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-227"/>
<img src="../Images/cd138860430c2e4d46edaaa5854e4c2f.png" alt="Changing the Fill" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-227-1.png"/>
<p class="caption">
Figure 13.6: Changing the Fill
</p>
</div>
<p>If we didn’t like these colors, we could change them with a scale layer. Personally, I like this one.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1">mpg<span class="op">$</span>score &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>(mpg<span class="op">$</span>displ<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>mpg<span class="op">$</span>hwy<span class="op">^</span><span class="dv">2</span>) </a>
<a class="sourceLine" id="cb226-2" title="2"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">fill =</span> score ))  <span class="op">+</span></a>
<a class="sourceLine" id="cb226-3" title="3"><span class="st">  </span><span class="kw">geom_tile</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb226-4" title="4"><span class="st">  </span><span class="kw">scale_fill_viridis_b</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-228"/>
<img src="../Images/0ee730b41fcb176481f738eb62bd4602.png" alt="Changing the Fill Again" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-228-1.png"/>
<p class="caption">
Figure 13.7: Changing the Fill Again
</p>
</div>
<p>There are many to choose from, though. Try to run the following code on your own to see what it produces.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" title="1">mpg<span class="op">$</span>score &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>(mpg<span class="op">$</span>displ<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>mpg<span class="op">$</span>hwy<span class="op">^</span><span class="dv">2</span>) </a>
<a class="sourceLine" id="cb227-2" title="2"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">fill =</span> score ))  <span class="op">+</span></a>
<a class="sourceLine" id="cb227-3" title="3"><span class="st">  </span><span class="kw">geom_tile</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb227-4" title="4"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>()</a></code></pre></div>
</div>
<div id="plotting-with-matplotlib" class="section level2 hasAnchor">
<h2><span class="header-section-number">13.3</span> Plotting with Matplotlib<a aria-label="Anchor link to header" class="anchor-section" href="/visualization#plotting-with-matplotlib"/></h2>
<p>Matplotlib <span class="citation">(Hunter <a href="#ref-Hunter:2007">2007</a>)</span> is a third-party visualization library in Python. It is the oldest and most heavily-used, so it is the best way to start making graphics in Python, in my humble opinion. It also comes installed with Anaconda.</p>
<p>This short introduction borrows heavily from the myriad of <a href="https://matplotlib.org/stable/tutorials/index.html">tutorials</a> on Matplotlib’s website. I will start off making a simple plot, and commenting on each line of code. If you’re interested in learning more, <span class="citation">(VanderPlas <a href="#ref-py_ds_handbook">2016</a>)</span> and <span class="citation">(McKinney <a href="#ref-pandas_guy">2017</a>)</span> are also terrific resources.</p>
<div class="rmd-details">
<p>You can use either “pyplot-style” (e.g. <code>plt.plot()</code>) or “object-oriented-style” to make figures in Matplotlib. Even though using the first type is faster to make simple plots, I will only describe the second one. It is the recommended approach because it is more extensible. However, the first one resembles the syntax of MATLAB. If you’re familiar with MATLAB, you might consider learning a little about the first style, as well.</p>
</div>
<div class="sourceCode" id="cb228"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb228-1" title="1"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt       <span class="co"># 1</span></a>
<a class="sourceLine" id="cb228-2" title="2"><span class="im">import</span> numpy <span class="im">as</span> np                    <span class="co"># 2</span></a>
<a class="sourceLine" id="cb228-3" title="3">fig, ax <span class="op">=</span> plt.subplots()              <span class="co"># 3</span></a>
<a class="sourceLine" id="cb228-4" title="4">_ <span class="op">=</span> ax.hist(np.random.normal(size<span class="op">=</span><span class="dv">1000</span>))  <span class="co"># 4</span></a>
<a class="sourceLine" id="cb228-5" title="5">plt.show()                            <span class="co"># 5</span></a></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-230"/>
<img src="../Images/cda72ae653628ff6c60151e762733f74.png" alt="Another Simple Histogram" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-230-1.png"/>
<p class="caption">
Figure 13.8: Another Simple Histogram
</p>
</div>
<p>In the first line, we import the <code>pyplot</code> submodule of <code>matplotlib</code>. We rename it to <code>plt</code>, which is short, and will save us some typing. Calling it <code>plt</code> follows the most popular naming convention.</p>
<p>Second, we import Numpy in the same way we always have. Matplotlib is written to work with Numpy arrays. If you want to plot some data, and it isn’t in a Numpy array, you should convert it first.</p>
<p>Third, we call the <code>subplots()</code> function, and use <em>sequence unpacking</em> to unpack the returned container into individual objects without storing the overall container. “Subplots” sounds like it will make many different plots all on one figure, but if you look at the <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib-pyplot-subplots">documentation</a> the number of rows and columns defaults to one and one, respectively.</p>
<p><code>plt.subplots()</code> returns a <a href="https://docs.python.org/3.3/library/stdtypes.html?highlight=tuple#tuple"><code>tuple</code></a><a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a> of two things: a <code>Figure</code> object, and one or more <code>Axes</code> object(s). These two classes will require some explanation.</p>
<ol style="list-style-type: decimal">
<li><p>A <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure"><code>Figure</code> object</a> is the overall visualization object you’re making. It holds onto all of the plot elements. If you want to save all of your progress (e.g. with <code>fig.savefig('my_picture.png')</code>), you’re saving the overall <code>Figure</code> object.</p></li>
<li><p>One or more <a href="https://matplotlib.org/stable/api/axes_api.html#the-axes-class"><code>Axes</code> objects</a> are contained in a <code>Figure</code> object. Each is “<a href="https://matplotlib.org/stable/tutorials/introductory/usage.html#axes">what you think of as ‘a plot’</a>.” They hold onto two <code>Axis</code> objects (in the case of 2-dimensional plots) or three (in the case of 3-dimensional arguments). We are usually calling the methods of these objects to effect changes on a plot.</p></li>
</ol>
<p>In line four, we call the <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.hist.html#matplotlib.axes.Axes.hist"><code>hist()</code> method</a> of the <code>Axes</code> object called <code>ax</code>. We assign the output of <code>.hist()</code> to a variable <code>_</code>. This is done to suppress the printing of the method’s output, and because this variable name is a Python convention that signals the object is temporary and will not be used later in the program. There are many more plots available than plain histograms. Each one has its own method, and you can peruse the options in <a href="https://matplotlib.org/stable/api/axes_api.html#plotting">the documentation</a>.</p>
<p>If you want to make figures that are more elaborate, just keep calling different methods of <code>ax</code>. If you want to fit more subplots to the same figure, add more <code>Axes</code> objects. Here is an example using some code from <a href="https://matplotlib.org/stable/tutorials/introductory/usage.html#the-object-oriented-interface-and-the-pyplot-interface">one of the official Matplotlib tutorials</a>.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb229-1" title="1"><span class="co"># x values grid shared by both subplots</span></a>
<a class="sourceLine" id="cb229-2" title="2">x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>np.pi, <span class="dv">100</span>) </a>
<a class="sourceLine" id="cb229-3" title="3"/>
<a class="sourceLine" id="cb229-4" title="4"><span class="co"># create two subplots...one row two columns</span></a>
<a class="sourceLine" id="cb229-5" title="5">fig, myAxes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>) <span class="co"># kind of like par(mfrow=c(1,2)) in R</span></a>
<a class="sourceLine" id="cb229-6" title="6"/>
<a class="sourceLine" id="cb229-7" title="7"><span class="co"># first subplot</span></a>
<a class="sourceLine" id="cb229-8" title="8">myAxes[<span class="dv">0</span>].plot(x, x, label<span class="op">=</span><span class="st">'linear'</span>)  <span class="co"># Plot some data on the axes.</span></a>
<a class="sourceLine" id="cb229-9" title="9"><span class="co">## [&lt;matplotlib.lines.Line2D object at 0x7f1fc9edd5c0&gt;]</span></a>
<a class="sourceLine" id="cb229-10" title="10">myAxes[<span class="dv">0</span>].plot(x, x<span class="op">**</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'quadratic'</span>)  <span class="co"># Plot more data </span></a>
<a class="sourceLine" id="cb229-11" title="11"><span class="co">## [&lt;matplotlib.lines.Line2D object at 0x7f1fc9edd6d8&gt;]</span></a>
<a class="sourceLine" id="cb229-12" title="12">myAxes[<span class="dv">0</span>].plot(x, x<span class="op">**</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'cubic'</span>)  <span class="co"># ... and some more.</span></a>
<a class="sourceLine" id="cb229-13" title="13"><span class="co">## [&lt;matplotlib.lines.Line2D object at 0x7f1fc9edda20&gt;]</span></a>
<a class="sourceLine" id="cb229-14" title="14">myAxes[<span class="dv">0</span>].set_xlabel(<span class="st">'x label'</span>)  <span class="co"># Add an x-label to the axes.</span></a>
<a class="sourceLine" id="cb229-15" title="15"><span class="co">## Text(0.5, 0, 'x label')</span></a>
<a class="sourceLine" id="cb229-16" title="16">myAxes[<span class="dv">0</span>].set_ylabel(<span class="st">'y label'</span>)  <span class="co"># Add a y-label to the axes.</span></a>
<a class="sourceLine" id="cb229-17" title="17"><span class="co">## Text(0, 0.5, 'y label')</span></a>
<a class="sourceLine" id="cb229-18" title="18">myAxes[<span class="dv">0</span>].set_title(<span class="st">"Simple Plot"</span>)  <span class="co"># Add a title to the axes.</span></a>
<a class="sourceLine" id="cb229-19" title="19"><span class="co">## Text(0.5, 1.0, 'Simple Plot')</span></a>
<a class="sourceLine" id="cb229-20" title="20">myAxes[<span class="dv">0</span>].legend()  <span class="co"># Add a legend.</span></a>
<a class="sourceLine" id="cb229-21" title="21"/>
<a class="sourceLine" id="cb229-22" title="22"><span class="co"># second subplot</span></a>
<a class="sourceLine" id="cb229-23" title="23"><span class="co">## &lt;matplotlib.legend.Legend object at 0x7f1fc9f11e48&gt;</span></a>
<a class="sourceLine" id="cb229-24" title="24">myAxes[<span class="dv">1</span>].plot(x,np.sin(x), label<span class="op">=</span><span class="st">'sine wave'</span>)</a>
<a class="sourceLine" id="cb229-25" title="25"><span class="co">## [&lt;matplotlib.lines.Line2D object at 0x7f1fc9eea7b8&gt;]</span></a>
<a class="sourceLine" id="cb229-26" title="26">myAxes[<span class="dv">1</span>].legend()</a>
<a class="sourceLine" id="cb229-27" title="27"><span class="co">## &lt;matplotlib.legend.Legend object at 0x7f1fc9e78128&gt;</span></a>
<a class="sourceLine" id="cb229-28" title="28">plt.show()</a></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-231"/>
<img src="../Images/0da9bf6addb001f8c89a75996921a096.png" alt="Side-By-Side Line Plots in Matplotlib" width="80%" data-original-src="https://randpythonbook.netlify.app/r_and_python_book_files/figure-html/unnamed-chunk-231-3.png"/>
<p class="caption">
Figure 13.9: Side-By-Side Line Plots in Matplotlib
</p>
</div>
</div>
<div id="plotting-with-pandas" class="section level2 hasAnchor">
<h2><span class="header-section-number">13.4</span> Plotting with Pandas<a aria-label="Anchor link to header" class="anchor-section" href="/visualization#plotting-with-pandas"/></h2>
<p>Pandas provides several <code>DataFrame</code> and <code>Series</code> methods that perform plotting. These methods are mostly just wrapper functions around Matplotlib code. They are written for convenience, so generally speaking, plotting can be done more quickly with Pandas compared to Matplotlib. Here I describe a few options that are available, and <a href="https://pandas.pydata.org/docs/user_guide/visualization.html#chart-visualization">the documentation</a> provides many more details for the curious reader.</p>
<p>The <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.plot.html"><code>.plot()</code></a> method is very all-encompassing because it allows you to choose between many different plot types: a line plot, horizontal and vertical bar plots, histograms, boxplots, density plots, area plots, pie charts, scatterplots and hexbin plots. If you only want to remember one function name for plotting in Pandas, this is it.</p>
<p>If you already have Pandas <code>import</code>ed, you can make good-looking plots in just one line of code. The default plot type for <code>.plot()</code> is a line plot, so there tends to be less typing if you’re working with time series data.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb230-1" title="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb230-2" title="2">df <span class="op">=</span> pd.read_csv(<span class="st">"data/gspc.csv"</span>)</a>
<a class="sourceLine" id="cb230-3" title="3">df.head()</a>
<a class="sourceLine" id="cb230-4" title="4"><span class="co">##         Index    GSPC.Open  ...   GSPC.Volume  GSPC.Adjusted</span></a>
<a class="sourceLine" id="cb230-5" title="5"><span class="co">## 0  2007-01-03  1418.030029  ...  3.429160e+09    1416.599976</span></a>
<a class="sourceLine" id="cb230-6" title="6"><span class="co">## 1  2007-01-04  1416.599976  ...  3.004460e+09    1418.339966</span></a>
<a class="sourceLine" id="cb230-7" title="7"><span class="co">## 2  2007-01-05  1418.339966  ...  2.919400e+09    1409.709961</span></a>
<a class="sourceLine" id="cb230-8" title="8"><span class="co">## 3  2007-01-08  1409.260010  ...  2.763340e+09    1412.839966</span></a>
<a class="sourceLine" id="cb230-9" title="9"><span class="co">## 4  2007-01-09  1412.839966  ...  3.038380e+09    1412.109985</span></a>
<a class="sourceLine" id="cb230-10" title="10"><span class="co">## </span></a>
<a class="sourceLine" id="cb230-11" title="11"><span class="co">## [5 rows x 7 columns]</span></a>
<a class="sourceLine" id="cb230-12" title="12">df[<span class="st">'GSPC.Adjusted'</span>].plot()</a>
<a class="sourceLine" id="cb230-13" title="13"><span class="co">## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f1fc9e4a828&gt;</span></a></code></pre></div>
<p>Choosing among nondefault plot types can be done in a variety of ways. You can either use the <code>.plot</code> accessor data member of a <code>DataFrame</code>, or you can pass in different strings to <code>.plot()</code>’s <code>kind=</code> parameter. Third, some plot types (e.g. boxplots and histograms) have their own dedicated methods.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb231-1" title="1">df[<span class="st">'returns'</span>] <span class="op">=</span> df[<span class="st">'GSPC.Adjusted'</span>].pct_change()</a>
<a class="sourceLine" id="cb231-2" title="2">df[<span class="st">'returns'</span>].plot(kind<span class="op">=</span><span class="st">'hist'</span>)</a>
<a class="sourceLine" id="cb231-3" title="3"><span class="co"># same as df['returns'].plot.hist()</span></a>
<a class="sourceLine" id="cb231-4" title="4"><span class="co"># same as df['returns'].hist()</span></a>
<a class="sourceLine" id="cb231-5" title="5"><span class="co">## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f1fc9e4a828&gt;</span></a></code></pre></div>
<p>There are also <a href="https://pandas.pydata.org/docs/user_guide/visualization.html#visualization-tools">several freestanding plotting functions</a> (not methods) that take in <code>DataFrame</code>s and <code>Series</code> objects. Each of these functions is typically imported individually from the <code>pandas.plotting</code> submodule.</p>
<p>The following code is an example of creating a “lag plot,” which is simply a scatterplot between a time series’ lagged and nonlagged values. The primary benefit of this function over <code>.plot()</code> is that this function does not require you to construct an additional column of lagged values, and it comes up with good default axis labels.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb232-1" title="1"><span class="im">from</span> pandas.plotting <span class="im">import</span> lag_plot</a>
<a class="sourceLine" id="cb232-2" title="2">lag_plot(df[<span class="st">'returns'</span>])</a>
<a class="sourceLine" id="cb232-3" title="3"><span class="co">## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f1fc9e4a828&gt;</span></a></code></pre></div>
</div>
<div id="exercises-11" class="section level2 hasAnchor">
<h2><span class="header-section-number">13.5</span> Exercises<a aria-label="Anchor link to header" class="anchor-section" href="/visualization#exercises-11"/></h2>
<div id="r-questions-10" class="section level3 hasAnchor">
<h3><span class="header-section-number">13.5.1</span> R Questions<a aria-label="Anchor link to header" class="anchor-section" href="/visualization#r-questions-10"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>The density of a particular bivariate Gaussian distribution is</p>
<p><span class="math display">\[
f(x,y) = \frac{1}{2 \pi}  \exp\left[ -\frac{x ^2 + y^2}{2}     \right] \tag{1}.
\]</span>
The random elements <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, in this particular case, are independent, each have unit variance, and zero mean. In this case, the marginal for <span class="math inline">\(X\)</span> is a mean <span class="math inline">\(0\)</span>, unit variance normal distribution:</p>
<p><span class="math display">\[
g(x) = \frac{1}{\sqrt{2\pi}} \exp\left[ -\frac{x ^2 }{2}     \right] \tag{2}.
\]</span></p>
<ol style="list-style-type: lower-alpha">
<li>Generate two plots of the bivariate density. For one, use <code>persp()</code>. For the other, use <code>contour()</code>.</li>
<li>Generate a third plot of the univariate density.</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<p>Consider again the Militarized Interstate Disputes (v5.0) <span class="citation">(Palmer et al.<a href="#ref-mid5"/>)</span> data set from <a href="https://correlatesofwar.org/">The Correlates of War Project</a>. A description of this data was given in the previous chapter. Feel free to re-use the code you used in the related exercise.</p>
<ol style="list-style-type: lower-alpha">
<li>Use a scatterplot to display the relationship between the maximum duration and the end year. Plot each country as a different color.</li>
</ol>
</div>
<div id="python-questions-10" class="section level3 hasAnchor">
<h3><span class="header-section-number">13.5.2</span> Python Questions<a aria-label="Anchor link to header" class="anchor-section" href="/visualization#python-questions-10"/></h3>
<ol style="list-style-type: decimal">
<li/>
</ol>
<p>Reproduce figure <a href="/an-introduction-to-functional-programming#fig:spline-plot">15.1</a>) in section <a href="/an-introduction-to-functional-programming#map">15.2.1.1</a> that displays the simple “spline” function. Feel free to use any of the visible code in the text.</p>
<ol start="2" style="list-style-type: decimal">
<li/>
</ol>
<p>The “4 Cs of diamonds”–or the four most important factors that explain a diamond’s price–are cut, color, clarity and carat. How does the price of diamonds vary as these three factors vary?</p>
<ul>
<li>Consider the data set <code>diamonds.csv</code> from <span class="citation">(Wickham <a href="#ref-ggplot2">2016</a>)</span> and plot the <code>price</code> against <code>carat</code>.</li>
<li>Visualize the other categorical factors simultaneously. Determine the most elegant way of visualizing all four factors at once and create a plot that does that. Determine the worst way to visualize all factors at once, and create that plot as well.</li>
</ul>

</div>
</div>
</div>



<h3>References</h3>
<div id="refs" class="references">
<div id="ref-albemarle_county_gis_web">
<p>Albemarle County Geographic Data Services Office. 2021. “Albemarle County GIS Web.” <a href="https://www.albemarle.org/government/community-development/gis-mapping/gis-data">https://www.albemarle.org/government/community-development/gis-mapping/gis-data</a>.</p>
</div>
<div id="ref-r_graphics_cookbook">
<p>Chang, Winston. 2013. <em>R Graphics Cookbook</em>. O’Reilly Media, Inc.</p>
</div>
<div id="ref-clay_ford">
<p>Ford, Clay. 2016. “ggplot: Files for UVA StatLab workshop, Fall 2016.” <em>GitHub Repository</em>. <a href="https://github.com/clayford/ggplot2">https://github.com/clayford/ggplot2</a>; GitHub.</p>
</div>
<div id="ref-Hunter:2007">
<p>Hunter, J. D. 2007. “Matplotlib: A 2D Graphics Environment.” <em>Computing in Science &amp; Engineering</em> 9 (3): 90–95. <a href="https://doi.org/10.1109/MCSE.2007.55">https://doi.org/10.1109/MCSE.2007.55</a>.</p>
</div>
<div id="ref-r_in_action">
<p>Kabacoff, Robert I. 2015. <em>R in Action</em>. Second. Manning. <a href="http://www.worldcat.org/isbn/9781617291388">http://www.worldcat.org/isbn/9781617291388</a>.</p>
</div>
<div id="ref-pandas_guy">
<p>McKinney, Wes. 2017. <em>Python for Data Analysis: Data Wrangling with Pandas, Numpy, and Ipython</em>. 2nd ed. O’Reilly Media, Inc.</p>
</div>
<div id="ref-mid5">
<p>Palmer, Glenn, Roseanne W McManus, Vito D’Orazio, Michael R Kenwick, Mikaela Karstens, Chase Bloch, Nick Dietrich, Kayla Kahn, Kellan Ritter, and Michael J Soules“The Mid5 Dataset, 2011–2014: Procedures, Coding Rules, and Description.” <em>Conflict Management and Peace Science</em> 0 (0): 0738894221995743. <a href="https://doi.org/10.1177/0738894221995743">https://doi.org/10.1177/0738894221995743</a>.</p>
</div>
<div id="ref-py_ds_handbook">
<p>VanderPlas, Jake. 2016. <em>Python Data Science Handbook: Essential Tools for Working with Data</em>. 1st ed. O’Reilly Media, Inc.</p>
</div>
<div id="ref-ggplot2">
<p>Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.</p>
</div>
<div id="ref-gog">
<p>Wilkinson, Leland. 2005. <em>The Grammar of Graphics (Statistics and Computing)</em>. Berlin, Heidelberg: Springer-Verlag.</p>
</div>
</div>
<div class="footnotes">
<hr/>
<ol start="21">
<li id="fn21"><p>Personally, I find its syntax more confusing, and so I tend to prefer base graphics. However, it is very popular, and so I do believe that it is important to mention it here in this text.<a class="footnote-back" href="/visualization#fnref21">↩</a></p></li>
<li id="fn22"><p>We didn’t talk about <code>tuple</code>s in chapter 2, but you can think of them as being similar to <code>list</code>s. They are containers that can hold elements of different types. There are a few key differences, though: they are made with parentheses (e.g. <code>('a')</code> ) instead of square brackets, and they are immutable instead of mutable.<a class="footnote-back" href="/visualization#fnref22">↩</a></p></li>
</ol>
</div>
                
</body>
</html>