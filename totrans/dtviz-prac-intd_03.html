<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2 Get started</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>2 Get started</h1>
<blockquote>原文：<a href="https://socviz.co/gettingstarted.html">https://socviz.co/gettingstarted.html</a></blockquote>

<p>In this Chapter, we will begin to learn how to create pictures of data
that people, including ourselves, can look at and learn from. R and
ggplot are the tools we will use. The best way to learn them is to
follow along and repeatedly write code as you go. The material in this
book is designed to be interactive and hands-on. If you work through
it with me using the approach described below, you will end up with a
book much like this one, with many code samples along side your notes,
and the figures or other output produced by that code shown nearby.</p>
<p>I strongly encourage you to type out your code, rather than copying
and pasting the examples from the text. Typing it out will help you
learn it. At the beginning it may feel like tedious transcription you
don’t fully understand. But it slows you down in a way that gets you
used to what the syntax and structure of R is like, and is a very
effective way to learn the language. It’s especially useful for
ggplot, where the code for our figures will repeatedly have a very
similar structure, built up piece by piece.</p>
<div id="work-in-plain-text-using-rmarkdown" class="section level2">
<h2><span class="header-section-number">2.1</span> Work in plain text, using RMarkdown</h2>
<p>When taking notes, and when writing your own code, you should write
plain text in a text editor. Do not use Microsoft Word or some other
word processor. You may be used to thinking of your final outputs
(e.g. a Word file, a PDF document, presentation slides, or the tables
and figures you make) as what’s “real” about your project. Instead,
it’s better to think of the data and code as what’s real, together
with the text you write. The idea is that all of your finished
output—your figures, tables, and text, and so on—can be
procedurally and reproducibly generated from code, data, and written
material stored in a simple, plain-text format.</p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:ch-02-markdown-margin"/>
<img src="../Images/8b3c8114189c9e97fe617516777a7dd3.png" alt="Top: Some elements of RMarkdown syntax. Bottom: From a plain text RMarkdown file to PDF output." width="546" data-original-src="https://socviz.co/assets/ch-02-markdown-margin.png"/><img src="../Images/8a6a98cd16161948fc8e6571bbbc8658.png" alt="Top: Some elements of RMarkdown syntax. Bottom: From a plain text RMarkdown file to PDF output." width="414" data-original-src="https://socviz.co/assets/ch-02-simple-knit-tall.png"/>
<!--
<p class="caption marginnote">-->Figure 2.1: Top: Some elements of RMarkdown syntax. Bottom: From a plain text RMarkdown file to PDF output.<!--</p>-->
<!--</div>--></span>
</p>
<p>The ability to reproduce your work in this way is important to the
scientific process. But you should also see it as a pragmatic choice
that will make life easier for you in future. The reality for most of
us is that the person who will most want to easily reproduce your work
is <em>you</em>, six months or a year from now. This is especially true for
graphics and figures. These often have a “finished” quality to them,
as a result of much tweaking and adjustments to the details of the
figure. That can make them hard to reproduce later. While it is normal
for graphics to undergo a substantial amount of polishing on their way
to publication, our goal is to do as much of this as possible
<em>programmatically</em>, in code we write, rather than in a way that is
retrospectively invisible, as for example when we edit an image in an
application like Adobe Illustrator.</p>
<p>While learning ggplot, and later while doing data analysis, you will
find yourself constantly pinging back and forth between three things:</p>
<ol style="list-style-type: decimal">
<li><em>Writing code</em>. You will write a lot of code to produce plots. You
will also write code to load your data, to look quickly at tables
of that data. Sometimes you will want to summarize, rearrange,
subset, or augment your data, or run a statistical model with it.
You will want to be able to write that code as easily and
effectively as possible.</li>
<li><em>Looking at output</em>. Your code is a set of instructions that, when
executed, produces the output you want: a table, a model, or a
figure. It is often helpful to be able to see that output, and its
partial results. While we’re working, it’s also useful
to keep the code and the things produced by the code close
together, if we can.</li>
<li><em>Taking Notes</em>. You will also be writing about what we
are doing, and what your results mean. When learning how to do
something in ggplot, for instance, you will want to make notes to
yourself about what you did, why you wrote it this way rather than
that, or what this new concept, function, or instruction does.
Later, when doing data analysis and making figures, you will be
writing up reports or drafting papers.</li>
</ol>
<p>How can you do all this effectively? The simplest way to keep code and
notes together is to write your code and intersperse it with
comments. All programming languages have some way of demarcating lines
as comments, usually by putting a special character (like <code>#</code>) at the
start of the line. We could create a plain-text script file called, e.g.,
<code>notes.r</code>, containing code and our comments on it. This is fine as far
as it goes. But except for very short files, it will be difficult to
do anything useful with the comments we write. If we want a report
from an analysis, for example, we will have to write it up separately.
While a script file can keep comments and code together, it loses
the connection between code and its output, such as the figure we want
to produce. But there is a better alternative: we can write our notes
using RMarkdown.</p>
<p>An RMarkdown file is just a plain text document where text (such as
notes or discussion) is interspersed with pieces, or <em>chunks</em>, of R
code. When you feed the document to R, it <em>knits</em> this file into a new
document by running the R code piece by piece, in sequence, and either
supplementing or replacing the chunks of code with their output. The
resulting file is then converted into a more easily-readable document
formatted in HTML, PDF, or Word. The non-code segments of the document
are plain text, but they can have simple formatting instructions in
them. These are set using
<a href="http://en.wikipedia.org/wiki/Markdown">Markdown</a>, a set of
conventions for marking up plain text in a way that indicates how it
should be formatted. The basic elements of Markdown are shown in the
upper part of Figure <a href="gettingstarted.html#fig:ch-02-markdown-margin">2.1</a>. When you create a
markdown document in R Studio, it contains some sample text to get you
started.</p>
<p>RMarkdown documents look like the one shown schematically in the lower
part of Figure <a href="gettingstarted.html#fig:ch-02-markdown-margin">2.1</a>. Your notes or text, with
Markdown formatting as needed, are interspersed with code. There is a
set format for code chunks. They look like this:</p>
<p class="sourceCode"/><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb8-1" data-line-number="1">```{r}</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"/>
<a class="sourceLine" id="cb8-3" data-line-number="3">```</a></code></pre>
<p>Three backticks (on a U.S. keyboard, that’s the character under the
escape key) followed by a pair of curly braces containing the name of
the language we are using.<label for="tufte-mn-14" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-14" class="margin-toggle"/><span class="marginnote shownote">The format is
language-agnostic, and can be used with, e.g. Python and other
languages.</span> The backticks-and-braces part signal that a chunk of
code is about to begin. You write your code as needed, and then end
the chunk with a new line containing just three backticks.</p>
<p>If you keep your notes in this way, you will be able to see the code
you wrote, the output it produces, and your own commentary or
clarification on it in a convenient way. Moreover, you can turn it
into a good-looking document right away.</p>
</div>
<div id="use-r-with-rstudio" class="section level2">
<h2><span class="header-section-number">2.2</span> Use R with RStudio</h2>
<div id="the-rstudio-environment" class="section level3">
<h3><span class="header-section-number">2.2.1</span> The RStudio environment</h3>
<p>R itself is a relatively small application with next to no user interface.
Everything works through a command line, or <em>console</em>. At its most
basic, you launch it from your Terminal application (on a Mac) or
Command Prompt (on Windows) by typing <code>R</code>. Once launched, R awaits
your instructions at a command line of its own, denoted by the
right angle bracket symbol, <code>&gt;</code>. When you type an instruction and hit
return, R interprets it and sends any resulting output back to the
console.</p>
<div class="figure"><span id="fig:ch-02-rterminal"/>
<p class="caption marginnote shownote">
Figure 2.2: Bare-bones R running from the Terminal.
</p>
<img src="../Images/f7cb8f4fd5b5c80f5f4080a8be3c777e.png" alt="Bare-bones R running from the Terminal." width="90%" data-original-src="https://socviz.co/assets/ch-02-r-terminal-light.png"/>
</div>
<p>In addition to interacting with the console, you can also write your
code in a text file and send that to R all at once. You can use any
good text editor to write your <code>.r</code> scripts. But although a plain text
file and a command line is the absolute minimum you need to work with
R, it is a rather spartan arrangement. We can make life easier for
ourselves by using <a href="https://rstudio.com">RStudio</a>. RStudio is an
“integrated development environment”, or IDE. It is a separate
application from R proper. When launched, it starts up an instance of
R’s console inside of itself. It also conveniently pulls together
various other elements to help you get your work done. These include
the document where you are writing your code, the output it produces,
and R’s help system. RStudio also knows about RMarkdown, and
understands a lot about the R language and the organization of your
project. When you launch RStudio, it should look much like Figure
<a href="gettingstarted.html#fig:ch-02-rstudio1">2.3</a>.</p>
<div class="figure fullwidth"><span id="fig:ch-02-rstudio1"/>
<img src="../Images/a0414452145bf50b63b622bdb5f88caa.png" alt="The RStudio IDE." width="90%" data-original-src="https://socviz.co/assets/ch-02-rstudio-annotated.png"/>
<p class="caption marginnote shownote">
Figure 2.3: The RStudio IDE.
</p>
</div>
</div>
<div id="create-a-project" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Create a project</h3>
<p>To begin, create a project. From the menu, choose File &gt; New Project … from the
menu bar, choose the New Directory option, and create the project.<label for="tufte-mn-15" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-15" class="margin-toggle"/><span class="marginnote shownote">You can create your new project wherever you like—most commonly it will go somewhere in your Documents folder.</span> Once it is set up, create an RMarkdown file in the directory, with File &gt; New File &gt; RMarkdown.
This will give you a set of choices including the default “Document”.
The <code>socviz</code> library comes with a small RMarkdown template that
follows the structure of this book. To use it instead of the default
document, after selecting File &gt; New File &gt; RMarkdown, choose the “From
Template” option in the sidebar of the dialog box that appears. Then
choose “Data Visualization Notes” from the resulting list of options.
When the RMarkdown document appears, save it right away in your
project folder, with File &gt; Save. The <code>socviz</code> template contains a
little bit of information about how RMarkdown works, together with
some headers to get you started. Read what it has to say. Look at the
code chunks and RMarkdown formatting. Experiment with knitting the
document, and compare the output to the content of the plain text
document.</p>
<p>RMarkdown is not required for R. An alternative is to use an R script, which just contains R commands only.<label for="tufte-mn-16" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-16" class="margin-toggle"/><span class="marginnote shownote">You can create an r script via File &gt; New File &gt; R Script.</span> R script files conventionally have the extension <code>.r</code> or <code>.R</code>. (RMarkdown files conventionally end in <code>.Rmd</code>.) A very brief project might just need a single <code>.r</code> file. But RMarkdown is very useful for documents, notes, or reports of any length, especially when you need to take notes. If you do use an <code>.r</code> file you can leave comments or notes to yourself by starting a line with the hash character, <code>#</code>. You can also add comments at the end of lines in this way, as for any particular line R will ignore whatever code or text that appears after a <code>#</code>.</p>
<p>RStudio has various keyboard and menu shortcuts to help you edit code and text quickly. For example you can insert chunks of code in your RMarkdown document with a keyboard shortcut.<label for="tufte-mn-17" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-17" class="margin-toggle"/><span class="marginnote shownote"><code>Command+Option+I</code> on MacOS. <code>Ctrl+Alt+I</code> on Windows.</span> This saves you from writing the backticks and braces every time. You can run the current line of code with a shortcut, too.<label for="tufte-mn-18" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-18" class="margin-toggle"/><span class="marginnote shownote"><code>Command+Enter</code> on MacOS. <code>Alt+Enter</code> on Windows.</span> A third shortcut gives you a pop-over display with summary of many other useful keystroke combinations.<label for="tufte-mn-19" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-19" class="margin-toggle"/><span class="marginnote shownote"><code>Option+Shift+K</code> on MacOS. <code>Alt-Shift-K</code> on Windows.</span> RMarkdown documents can include all kinds of other options and formatting paraphernalia, from text formatting to cross-references to bibliographical information. But never mind about those for now.</p>
<div class="figure"><span id="fig:ch-02-rstudio-window-2"/>
<p class="caption marginnote shownote">
Figure 2.4: An RMarkdown file open in R Studio. The small icons in the top right-hand corner of each code chunk can be used to set options (the gear icon), run all chunks up to the current one (the downward-facing triangle), and just run the current chunk (the right-facing triangle).
</p>
<img src="../Images/778c59a11834942c702d99559e87754e.png" alt="An RMarkdown file open in R Studio. The small icons in the top right-hand corner of each code chunk can be used to set options (the gear icon), run all chunks up to the current one (the downward-facing triangle), and just run the current chunk (the right-facing triangle)." width="90%" data-original-src="https://socviz.co/assets/ch-02-rstudio-markdown.png"/>
</div>
<p>To make sure you are ready to go, load the <code>tidyverse</code> library. The
tidyverse is a suite of related libraries for R developed by Hadley
Wickham and others. The <code>ggplot2</code> library is one of its components.
The other pieces make it easier to get data in to R and manipulate it
once it is there. Either knit the notes file you created from the
socviz template, or load the library manually at the console:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"/>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">library</span>(socviz)</a></code></pre>
<p>We load the <code>socviz</code> library after the tidyverse. This library contains datasets that we will use throughout the book, along with some other tools that will make life a little easier. If you get an error message saying either library can’t be found, then re-read the “Before you Begin” section in the Preface to this book and follow the instructions there.</p>
<p>You only need to <em>install</em> a library once, but you will need to <em>load</em> it at the beginning of each R session with <code>library()</code> if you want to use the tools it contains. In practice this means that the very first lines of your working file should contain a code chunk that loads the libraries you will need in the file. If you forget to do this, then R will be unable to find the functions you want to use later on.</p>
</div>
</div>
<div id="things-to-know-about-r" class="section level2">
<h2><span class="header-section-number">2.3</span> Things to know about R</h2>
<p>Any new piece of software takes a bit of getting used to. This is especially true when using an IDE to work in a language like R. You are getting oriented to the language itself (what happens at the console), while learning to take notes in what might seem like an odd format (chunks of code interspersed with plain-text comments), in an IDE that that has a many features designed to make your life easier in the long run, but which can be hard to decipher at the beginning. Here are some general points to bear in mind about how R is designed. They might help you get a feel for how the language works.</p>
<div id="everything-has-a-name" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Everything has a name</h3>
<p>In R, everything you deal with has a name. You refer to things by
their names as you examine, use, or modify them. Named entities
include variables (like <code>x</code>, or <code>y</code>), data that you have loaded (like
<code>my_data</code>), and functions that you use. (More about functions
momentarily.) You will spend a lot of time talking about, creating,
referring to, and modifying things with names.</p>
<p>Some names are forbidden. These include reserved words like <code>FALSE</code>
and <code>TRUE</code>, core programming words like <code>Inf</code>, <code>for</code>, <code>else</code>, <code>break</code>,
<code>function</code>, and words for special entities like <code>NA</code> and <code>NaN</code>. (These
last two are codes designating missing data and “Not a Number”,
respectively.) You probably won’t use these names by accident, but
it’s good do know that they are not allowed.</p>
<p>Some names you should not use, even if they are technically permitted.
These are mostly words that are already in use for objects or
functions that form part of the core of R. These include the names of
basic functions like <code>q()</code> or <code>c()</code>, common statistical functions like
<code>mean()</code>, <code>range()</code> or <code>var()</code>, and built-in mathematical constants
like <code>pi</code>.</p>
<p>Names in R are case sensitive. The object <code>my_data</code> is not the same as
the object <code>My_Data</code>. When choosing names for things, be concise,
consistent, and informative. Follow the style of the tidyverse and
name things in lower case, separating words with the underscore
character, <code>_</code>, as needed. Do not use spaces when naming things,
including variables in your data.</p>
</div>
<div id="everything-is-an-object" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Everything is an object</h3>
<p>Some objects are built in to R, some are added via libraries, and some
are created by the user. But almost everything is some kind of object.
The code you write will create, manipulate, and use named objects as a
matter of course. We can start immediately. Let’s create a vector of numbers. The
command <code>c()</code> is a function. It’s short for “combine” or
“concatenate”. It will take a sequence of comma-separated things
inside the parentheses and join them together into a vector where each
element is still individually accessible.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">25</span>)</a></code></pre>
<pre><code>## [1]  1  2  3  1  3  5 25</code></pre>
<p>Instead of sending the result to the console, we can instead <em>assign</em> it to an object we create<label for="tufte-mn-20" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-20" class="margin-toggle"/><span class="marginnote shownote">You can type the arrow using <code>&lt;</code> and then <code>-</code>.</span>:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">my_numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">25</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">your_numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">31</span>, <span class="dv">71</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">21</span>, <span class="dv">6</span>)</a></code></pre>
<p>To see what you made, type the name of the object and hit return:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">my_numbers</a></code></pre>
<pre><code>## [1]  1  2  3  1  3  5 25</code></pre>
<p>Each of our numbers is still there, and can be accessed directly if we
want. They are now just part of a new object, a vector, called
<code>my_numbers</code>.</p>
<p>You create objects by assigning them to names. The <em>assignment
operator</em> is <code>&lt;-</code>. Think of assignment as the verb “gets”, reading
left to right. So, the bit of code above can be read as “The object
<code>my_numbers</code> gets the result of concatenating the following numbers:
1, 2, …” The<label for="tufte-mn-21" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-21" class="margin-toggle"/><span class="marginnote shownote">If you only learn one keyboard shortcut in RStudio make it this one! Always use <code>Option+minus</code> on MacOS or <code>Alt+minus</code> on Windows to type the assignment operator.</span> operator is two separate keys on your keyboard: the <code>&lt;</code> key and the <code>-</code> (minus) key. Because you type this so often in R,
there is a shortcut for it in R Studio. To write the assignment
operator in one step, hold down the <code>option</code> key and hit <code>-</code>. On
Windows hold down the <code>alt</code> key and hit <code>-</code>. You will be constantly
creating objects in this way, and trying typing the two characters
separately is both tedious and prone to error. You will make
hard-to-notice mistakes like typing <code>&lt; -</code> (with a space in between the
characters) instead of <code>&lt;-</code>.</p>
<p>When you create objects by assigning things to names, they come into
existence in R’s <em>workspace</em> or <em>environment</em>. You can think of this
most straightforwardly as your project directory. Your workspace is
specific to your current project. It is the folder from which you
launched R. Unless you have particular needs (such as extremely large
datasets or analytical tastes that take a very long time) you will not
need to give any thought to where objects “really” live. Just think of
your code and data files as the permanent features of your project.
When you start up an R project, you will generally begin by loading
your data. That is, you will read it in from disk and assign it
to a named object like <code>my_data</code>. The rest of your code will be a series of instructions to act on and create more named objects.</p>
</div>
<div id="you-do-things-using-functions" class="section level3">
<h3><span class="header-section-number">2.3.3</span> You do things using functions</h3>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:ch-02-function-schematic"/>
<img src="../Images/7a6859d77a6a3eaf81c369f8905db946.png" alt="Upper: What functions look like, very schematically. Lower: an imaginary function that takes two vectors and plots them with a title. We supply the function with the particular vectors we want it to use, and the title. The vectors are objects, so are given as-is. The title is not an object, so we enclose it in quotes." width="100%" data-original-src="https://socviz.co/assets/ch-02-function-schematic.png"/>
<!--
<p class="caption marginnote">-->Figure 2.5: Upper: What functions look like, very schematically. Lower: an imaginary function that takes two vectors and plots them with a title. We supply the function with the particular vectors we want it to use, and the title. The vectors are objects, so are given as-is. The title is not an object, so we enclose it in quotes.<!--</p>-->
<!--</div>--></span>
</p>
<p>You do almost everything in R using functions. Think of a function as
a special kind of object that can perform actions for you. It produces
output based on the input that it receives. Like a good dog, when we
want a function to do something for us, we <em>call</em> it. Somewhat less
like a dog, it will reliably do what we tell it. We give the function
some information, it acts on that information, and some results come
out the other side. Functions can be recognized by the parentheses at
the end of their names. This distinguishes them from other objects,
such as single numbers, named vectors, tables of data, and so on.</p>
<p>The parentheses are what allow you to send information to the
function. Most functions accept one or more named <em>arguments</em>. A
function’s arguments are the things it needs to know in order to do
something. They can be some bit of your data (<code>data = my_numbers</code>), or
specific instructions (<code>title = "GDP per Capita"</code>), or an option you
want to choose (<code>smoothing = "splines", show = FALSE</code>). For example,
the object <code>my_numbers</code> is a numeric vector:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">my_numbers</a></code></pre>
<pre><code>## [1]  1  2  3  1  3  5 25</code></pre>
<p>But the thing we used to create it, <code>c()</code>, is a function. It
concatenates items into a vector composed of the series of
comma-separated elements you give it. Similarly, <code>mean()</code> is a
function that calculates a simple average for a vector of numbers.
What happens if we just type <code>mean()</code> without any arguments inside the parentheses?</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">mean</span>()</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co"># Error in mean.default() : argument "x" is missing, with no default</span></a></code></pre>
<p>The error message is terse but informative. The function needs an
argument to work, and we haven’t given it one. In this case, ‘x’, the
name of another object that <code>mean()</code> can perform its calculation on:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">mean</span>(<span class="dt">x =</span> my_numbers)</a></code></pre>
<pre><code>## [1] 5.714286</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">mean</span>(<span class="dt">x =</span> your_numbers)</a></code></pre>
<pre><code>## [1] 19.71429</code></pre>
<p>While the function arguments have names that are used internally,
(here, <code>x</code>), you don’t strictly need to specify the name for the function to
work:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">mean</span>(my_numbers)</a></code></pre>
<pre><code>## [1] 5.714286</code></pre>
<p>If you omit the name of the argument, R will just
assume you are giving the function what it needs, and in a default
order. The documentation for a function will tell you what the order
of required arguments is for any particular function.<label for="tufte-mn-22" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-22" class="margin-toggle"/><span class="marginnote shownote">See the Appendix for a guide to how to read the help page for a function.</span> For simple
functions that only require one or two arguments, omitting their names
is usually not confusing. For more complex functions, you will
typically want to use the names of the arguments rather than try to
remember what the ordering is.</p>
<p>In general, when providing arguments to a function the syntax is
<code>&lt;argument&gt; = &lt;value&gt;</code>. If <code>&lt;value&gt;</code> is a named <em>object</em> that already
exists in your workspace, like a vector of numbers of a table of data,
then you provide it unquoted, as in <code>mean(my_numbers)</code>. If <code>&lt;value&gt;</code>
is not an object, a number, or a logical value like <code>TRUE</code>, then you
usually put it in quotes, e.g., <code>labels(x = "X Axis Label")</code>.</p>
<p>Functions take inputs via their arguments, do something, and return
outputs. What the output is depends on what the function does. The
<code>c()</code> function takes a sequence of comma-separated elements and
returns a vector consisting of those same elements. The <code>mean()</code>
function takes a vector of numbers and returns a single number, their
average. Functions can return far more than single numbers. The output
returned by functions can be a table of data, or a complex object such
as the results of a linear model, or the instructions needed to draw a
plot on the screen (as we shall see). They can even be other
functions. For example, the <code>summary()</code> function performs a series of
calculations on a vector and produces what is in effect a little table
with named elements.</p>
<p>A function’s argument names are internal to that function. Say you
have created an object in your environment named <code>x</code>, for example. A
function like <code>mean()</code> also has a named argument, <code>x</code>, but R will not
get confused by this. It will not use your <code>x</code> object by mistake.</p>
<p>As we have already seen with <code>c()</code> and <code>mean()</code>, you can assign the
result of a function to an object:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">my_summary &lt;-<span class="st"> </span><span class="kw">summary</span>(my_numbers)</a></code></pre>
<p>When you do this, there’s no output to the console. R just
puts the results into the new object, as you instructed. To look
inside the object you can type its name and hit return:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">my_summary</a></code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.00    1.50    3.00    5.71    4.00   25.00</code></pre>
</div>
<div id="functions-come-in-libraries" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Functions come in libraries</h3>
<p>The code you write will be more or less complex depending on the task
you want to accomplish. Once you have gotten used to working in R, you
will probably end up writing your own functions to produce the results
that you need. But as with other programming languages, you will not
have to do everything yourself. Families of useful functions are
bundled into libraries that you can install, load into your R session,
and make use of as you work. Libraries save you from reinventing the
wheel. They make it so that you do not, for example, have to figure
out how to write code from scratch to draw a shape on screen, or load
a data file into memory. Libraries are also what allow you to build on
the efforts of others in order to do your own work. Ggplot is a
library of functions. There are many other such libraries and we will
make use of several throughout this book, either by loading them with the
<code>library()</code> function, or “reaching in” to them and pulling a useful
function from them directly. Writing code and functions of your own is
a good way to get a sense of the amazing volume of effort put into R
and its associated toolkits, work freely contributed by many hands
over the years and available for anyone to use.</p>
<p>All of the visualization we will do will involve choosing the right
function or functions, and then giving those functions the right
instructions through a series of named arguments. Most of the mistakes
we will make, and the errors we will fix, will involve us having not
picked the right function, or having not fed the function the right
arguments, or having failed to provide information in a form the
function can understand.</p>
<p>For now, just remember that you do things in R by creating and
manipulating named objects. You manipulate objects by feeding
information about them to functions. The functions do something useful
with that information (calculate a mean, recode a variable, fit a
model) and give you the results back.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">table</span>(my_numbers)</a></code></pre>
<pre><code>## my_numbers
##  1  2  3  5 25 
##  2  1  2  1  1</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">sd</span>(my_numbers)</a></code></pre>
<pre><code>## [1] 8.6</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">my_numbers <span class="op">*</span><span class="st"> </span><span class="dv">5</span></a></code></pre>
<pre><code>## [1]   5  10  15   5  15  25 125</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">my_numbers <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a></code></pre>
<pre><code>## [1]  2  3  4  2  4  6 26</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">my_numbers <span class="op">+</span><span class="st"> </span>my_numbers</a></code></pre>
<pre><code>## [1]  2  4  6  2  6 10 50</code></pre>
<p>The first two functions here gave us a simple table of counts and
calculated the standard deviation of <code>my_numbers</code>. It’s worth noticing
what R did in the last three cases. First we multiplied <code>my_numbers</code>
by two. R interprets that as you asking it to take each <em>element</em> of
<code>my_numbers</code> one at a time and multiply it by five. It does the same with the instruction <code>my_numbers + 1</code>. The single value is “recycled” down the length of the vector. By contrast, in the last case we add <code>my_numbers</code> to itself. Because the two objects being added are the same length, R adds each element in the first vector to the
corresponding element in the second vector. This is an example of a <em>vectorized</em> operation.</p>
</div>
<div id="if-youre-not-sure-what-an-object-is-ask-for-its-class" class="section level3">
<h3><span class="header-section-number">2.3.5</span> If you’re not sure what an object is, ask for its class</h3>
<p>Every object has a <em>class</em>. This is the sort of object it is, whether a
vector, a character string, a function, a list, and so on. Knowing an
object’s class tells you a lot about what you can and can’t do with
it.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">class</span>(my_numbers)</a></code></pre>
<pre><code>## [1] "numeric"</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">class</span>(my_summary)</a></code></pre>
<pre><code>## [1] "summaryDefault" "table"</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">class</span>(summary)</a></code></pre>
<pre><code>## [1] "function"</code></pre>
<p>Certain actions you take may change an object’s class. For instance,
consider <code>my_numbers</code> again:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">my_new_vector &lt;-<span class="st"> </span><span class="kw">c</span>(my_numbers, <span class="st">"Apple"</span>)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">my_new_vector</a></code></pre>
<pre><code>## [1] "1"     "2"     "3"     "1"     "3"     "5"     "25"   
## [8] "Apple"</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">class</span>(my_new_vector)</a></code></pre>
<pre><code>## [1] "character"</code></pre>
<p>The function added the word “Apple” to our vector of numbers, as we
asked. But in doing so, the result is that the new object also has a
new class, switching from “numeric” to “character”. All the numbers
are now enclosed in quotes. They have been turned into character
strings. In that form, they can’t be used in calculations.</p>
<p>Most of the work we’ll be doing will not involve directly picking out
this or that value from vectors or other entities. Instead we will try
to work at a slightly higher level that will be easier and safer. But
it’s worth knowing just the very basics<label for="tufte-mn-23" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-23" class="margin-toggle"/><span class="marginnote shownote">The Appendix has a little more discussion of the basics of selecting the elements within objects.</span> of how elements of vectors can
be referred to, because the c() function in particular is a useful
tool.</p>
<p>We will spend a lot of time in this book working with a series of datasets. These typically start life as files stored locally on your computer or somewhere remotely accessible to you. Once they are imported into R, then like everything exist as objects of some kind. R has several classes of objects used to store data. A basic one is a matrix, which consists of rows and columns of numbers. But the most common kind of data object in R is a <em>data frame</em>, which you can think of as a rectangular table consisting of rows (of observations) and columns (of variables). In a data frame the columns can be of different classes. Some may be character strings, some numeric, and so on. For instance, here is a very small dataset from the <code>socviz</code> library:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">titanic</a></code></pre>
<pre><code>##       fate    sex    n percent
## 1 perished   male 1364    62.0
## 2 perished female  126     5.7
## 3 survived   male  367    16.7
## 4 survived female  344    15.6</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">class</span>(titanic)</a></code></pre>
<pre><code>## [1] "data.frame"</code></pre>
<p>In this <code>titanic</code> data, two of the columns are numeric and two are not. You can access the rows and columns in various ways. For example, the <code>$</code> operator allows you to pick out a named column of a data frame:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">titanic<span class="op">$</span>percent</a></code></pre>
<pre><code>## [1] 62.0  5.7 16.7 15.6</code></pre>
<p>In Appendix <a href="appendix.html#app-select">A.1.2</a> there is a little more information about selecting particular elements from different kinds of objects.</p>
<p>We will also regularly encounter a slightly augmented version of a data frame called a <em>tibble</em>. The tidyverse libraries make extensive use of tibbles. Like data frames, they are used to store variables of different classes all together in a single table of data. They also do a little more to let us know about what they contain, and are a little more friendly when interacted with from the console. We can convert a data frame to a tibble if we want:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">titanic_tb &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(titanic)</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">titanic_tb</a></code></pre>
<pre><code>## # A tibble: 4 x 4
##   fate     sex        n percent
##   &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 perished male    1364   62.0 
## 2 perished female   126    5.70
## 3 survived male     367   16.7 
## 4 survived female   344   15.6</code></pre>
<p>Look carefully at the top and bottom of the output to see what additional information the tibble class gives you over and above the data frame version.</p>
</div>
<div id="objectstructure" class="section level3">
<h3><span class="header-section-number">2.3.6</span> To see inside an object, ask for its structure</h3>
<p>The <code>str()</code> function is sometimes useful. It lets you see what is
inside an object.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw">str</span>(my_numbers)</a></code></pre>
<pre><code>##  num [1:7] 1 2 3 1 3 5 25</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">str</span>(my_summary)</a></code></pre>
<pre><code>## Classes 'summaryDefault', 'table'  Named num [1:6] 1 1.5 3 5.71 4 ...
##   ..- attr(*, "names")= chr [1:6] "Min." "1st Qu." "Median" "Mean" ...</code></pre>
<p>Fair warning: while some objects are relatively simple (a vector is
just a sequence of numbers), others are more complicated, so asking
about their <code>str()</code> might output a forbidding amount of information to
the console. In general, complex objects are organized collections of
simpler objects, often assembled as a big list, sometimes with a
nested structure. Think for example of a master to-do list for a
complex activity like moving house. It might be organized into
sub-tasks of different kinds, several of which would themselves have
lists of individual items. One list of tasks might be related to
scheduling the moving truck, another might cover things to be donated,
and a third list of tasks might be related to setting up utilities at
the new house. In a similar sort of way, the objects we create to make
plots will have many parts and sub-parts, as the overall task of
drawing a plot has many individual to-do items. But we will be able to
build these objects up from simple forms through a series of
well-defined steps. And unlike moving house, the computer will take
care of actually carrying out the task for us. We just need to get the
to-do list right.</p>
</div>
</div>
<div id="be-patient-with-r-and-with-yourself" class="section level2">
<h2><span class="header-section-number">2.4</span> Be patient with R, and with yourself</h2>
<p>Like all programming languages, R does exactly what you tell it to,
rather than exactly what you want it to. This can make it frustrating
to work with. It is as if one had an endlessly energetic, powerful,
but also extremely literal-minded robot to order around. Remember that
no-one writes fluent, error-free code on the first go all the time.
From simple typos to big misunderstandings, mistakes are a standard
part of the activity of programming. This is why error-checking,
debugging, and testing are also a central part of programming. So,
just try to be patient with yourself and with R while you use it. Expect
to make errors, and don’t worry when that happens. You won’t break
anything. Each time you figure out why a bit of code has gone wrong
you will have learned a new thing about how the language works.</p>
<p>Here are three very specific things to watch out for:</p>
<ul>
<li>Make sure parentheses are balanced and that every opening “<code>(</code>” has
a corresponding closing “<code>)</code>”.</li>
<li>Make sure you complete your expressions. If you think you have completed typing your code, but instead of seeing the <code>&gt;</code> command prompt at the console you see the <code>+</code>
character instead, that may mean R thinks you haven’t written a complete
expression yet. You can hit <code>Esc</code> or <code>Ctrl-C</code> to force your way back to the console and try typing your code again.</li>
<li>In ggplot specifically, as you will see, we will build up plots a
piece at a time by adding expressions to one another. When doing
this, make sure your <code>+</code> character goes at the end of the line, and
not the beginning. That is, write this:</li>
</ul>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre>
<p>and not this:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre>
<p>R Studio will do its best to help you with the task of writing your
code. It will highlight your code by syntax; it will try to match
characters (like parentheses) that need to be balanced; it will try to
narrow down the source of errors in code that fails to run; it will
try to auto-complete the names of objects you type, so that you make fewer
typos; it will make help files more easily accessible and the
arguments of functions directly available. Go slowly and see how the
software is trying to help you out.</p>
</div>
<div id="get-data-into-r" class="section level2">
<h2><span class="header-section-number">2.5</span> Get data into R</h2>
<p>Before we can plot anything at all we have to get our data into R in a
format it can use. Cleaning and reading in your data is one of the
least immediately satisfying pieces of an analysis, whether you use R,
Stata<label for="tufte-mn-24" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-24" class="margin-toggle"/><span class="marginnote shownote">These are all commercial software applications for statistical analysis. Stata, in particular, is in wide use across the social sciences.</span>, SAS, SPSS, or any other statistical software. This is the reason that many of the datasets for this book are provided in a pre-prepared form via the <code>socviz</code> library rather than as data files you must manually
read in. However, it is something you will have to face, and that
you will want to do, sooner rather than later if you want to use the
skills you learn in this book. We might as well see how to do it now.
Even when learning R, it can be useful and very motivating to try out
the code on your own data rather than working with the sample
datasets.</p>
<p>Use the <code>read_csv()</code> function to read in comma separated data. This
function is in the <code>readr</code> library, one of the pieces of the
tidyverse. R and the tidyverse also have functions to import various
Stata, SAS, and SPSS formats directly. These can be found in the
<code>haven</code> library. All we need to do is point <code>read_csv()</code> at a file.
This can be a local file, e.g. in a subdirectory called <code>data/</code>, or it
can be a remote file. If <code>read_csv()</code> is given a URL or ftp address it
will follow it automatically. In this example, we have a CSV file
called <code>organdonation.csv</code> stored at a remote location. While online, we assign the
URL for the file to an object, for convenience, and then tell
<code>read_csv()</code> to fetch it for us and put it in an object named <code>organs</code>.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">url &lt;-<span class="st"> "https://cdn.rawgit.com/kjhealy/viz-organdata/master/organdonation.csv"</span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2"/>
<a class="sourceLine" id="cb61-3" data-line-number="3">organs &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> url)</a></code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   year = col_integer(),
##   donors = col_double(),
##   pop = col_integer(),
##   pop.dens = col_double(),
##   gdp = col_integer(),
##   gdp.lag = col_integer(),
##   health = col_double(),
##   health.lag = col_double(),
##   pubhealth = col_double(),
##   roads = col_double(),
##   cerebvas = col_integer(),
##   assault = col_integer(),
##   external = col_integer(),
##   txp.pop = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<p>The resulting message at the console tells us the <code>read_csv()</code> function
has assigned a class to each of the columns of the object it created
from the CSV file. There are columns with integer values, some are
character strings, and so on. (The <code>double</code> class is for numbers other
than integers.) Part of the reason <code>read_csv()</code> is telling you this
information is that it is helpful to know what class each column, or
variable, is. A variable’s class determines what sort of operations
can be performed on it. You also see this information because the
tidyverse’s <code>read_csv()</code> (with an underscore character in the middle
of its name) is more opinionated than an older, and also still very
widely-used function, <code>read.csv()</code> (with a period in the middle of its
name). The newer <code>read_csv()</code> will not classify variables as factors
unless you tell it to. This is in contrast to the older function,
which treats any vector of characters as a factor unless told
otherwise. Factors have some very useful features in R (especially
when it comes to representing various kinds of treatment and control
groups in experiments), but they often trip up users who are not fully
aware of them. Thus, <code>read_csv()</code> avoids them unless you explicitly
say otherwise.</p>
<p>R can read in data files in many different formats. The <code>haven</code> package is part of the tidyverse. It provides functions to read files created in a variety of commercial software packages.<label for="tufte-mn-25" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-25" class="margin-toggle"/><span class="marginnote shownote">R can also talk directly to databases, a topic not covered here.</span> If your dataset is a Stata <code>.dta</code> file, for instance, you can use the <code>read_dta()</code> function in much the same way as we used <code>read_csv()</code> above. This function can read and write variables stored as logical values, integers, numbers, characters and factors. Stata also has a <em>labelled</em> data class that the haven library partially supports.<label for="tufte-mn-26" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-26" class="margin-toggle"/><span class="marginnote shownote">See haven’s documentation for more details.</span> In general you will end up converting labelled variables to one of R’s basic classes. Stata also supports an extensive coding scheme for missing data. This is generally not used directly in R, where missing data is coded simply as <code>NA</code>. Again, you will need to take care that any labelled variables imported into R are coded properly, so that you do not end up mistakenly using missing data in your analysis.</p>
<p>When preparing your data for use in R, and in particular for graphing
with <code>ggplot</code>, bear in mind that it is best if it is represented in a
“tidy” format. Essentially this means that your data should be in
<em>long</em> rather than <em>wide</em> format, with every observation a row and
every variable a column. We will discuss this in more detail in
Chapter <a href="makeplot.html#makeplot">3</a>, and you can also consult the discussion of tidy data in the
Appendix.</p>
</div>
<div id="make-your-first-figure" class="section level2">
<h2><span class="header-section-number">2.6</span> Make your first figure</h2>
<p>That’s enough ground-clearing for now. Writing code can be
frustrating, but it also allows you to do interesting things quickly.
Since the goal of this book is not to teach you all about R, but just
how to produce good graphics, we can postpone a lot of details until
later (or indeed ignore them indefinitely). We will start as we mean
to go on, by using a function to make a named object, and plot the
result. We will use the Gapminder dataset, which you should already
have available on your computer. We load the data with <code>library()</code>
and take a look.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">library</span>(gapminder)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2">gapminder</a></code></pre>
<pre><code>## # A tibble: 1,704 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333       779
##  2 Afghanistan Asia       1957    30.3  9240934       821
##  3 Afghanistan Asia       1962    32.0 10267083       853
##  4 Afghanistan Asia       1967    34.0 11537966       836
##  5 Afghanistan Asia       1972    36.1 13079460       740
##  6 Afghanistan Asia       1977    38.4 14880372       786
##  7 Afghanistan Asia       1982    39.9 12881816       978
##  8 Afghanistan Asia       1987    40.8 13867957       852
##  9 Afghanistan Asia       1992    41.7 16317921       649
## 10 Afghanistan Asia       1997    41.8 22227415       635
## # ... with 1,694 more rows</code></pre>
<p>This is a table of data about a large number of countries, each observed over several years. Let’s make a scatterplot with it. Type the code below and try to get a sense of what’s happening. Don’t worry too much yet about the details.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,</a>
<a class="sourceLine" id="cb66-2" data-line-number="2">            <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp))</a>
<a class="sourceLine" id="cb66-3" data-line-number="3">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre>
<div class="figure"><span id="fig:ch-02-gapminder-example-fig"/>
<p class="caption marginnote shownote">
Figure 2.6: Life expectancy plotted against GDP per capita for a large number of country-years.
</p>
<img src="../Images/4bb84df38c71e2e6800e0eb2e04fdea8.png" alt="Life expectancy plotted against GDP per capita for a large number of country-years." width="960" data-original-src="https://socviz.co/dataviz-pdfl_files/figure-html4/ch-02-gapminder-example-fig-1.png"/>
</div>
<p>Not a bad start. Our graph is fairly legible, it has its axes informatively labeled, and it shows some sort of relationship between the two variables we have chosen. It could also be made better. Let’s learn more about how to improve it.</p>
</div>
<div id="where-to-go-next-1" class="section level2">
<h2><span class="header-section-number">2.7</span> Where to go next</h2>
<p>You should go straight to the next Chapter. However, you could also
spend a little more time getting familiar with R and RStudio. Some
information in the Appendix to this book might already be worth glancing
at, especially the additional introductory material on R, and the
discussion there about some common problems that tend to happen when
reading in your own data. There<label for="tufte-mn-27" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-27" class="margin-toggle"/><span class="marginnote shownote"><code>swirlstats.com</code></span> are several<label for="tufte-mn-28" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-28" class="margin-toggle"/><span class="marginnote shownote"><code>tryr.codeschool.com</code></span> free or initially free online introductions<label for="tufte-mn-29" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-29" class="margin-toggle"/><span class="marginnote shownote"><code>datacamp.com</code></span> to the R language that are worth trying. You do not need to know the material they cover in order to keep going with this book, but you might find one or more of them useful. If you get a little bogged down in any of them, or find the examples they choose are not that relevant to you, don’t worry. These introductions tend to want to introduce you to a range of programming concepts and tools that we will not need right away.</p>
<p>It is also worth familiarizing yourself a little with how RStudio works and with what it can do for you. The RStudio website<label for="tufte-mn-30" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-30" class="margin-toggle"/><span class="marginnote shownote"><code>rstudio.com</code></span> has a great deal of introductory material to help you along. You can also find a number of handy cheat sheets there that summarize different pieces of RStudio, RMarkdown, and various tidyverse packages that we will use throughout the book.<label for="tufte-mn-31" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-31" class="margin-toggle"/><span class="marginnote shownote"><code>rstudio.com/resources/cheatsheets</code></span> These cheat-sheets are not meant to teach you the material. But they are helpful points of reference once you are up and running.</p>

</div>
&#13;

<h2><span class="header-section-number">2.1</span> Work in plain text, using RMarkdown</h2>
<p>When taking notes, and when writing your own code, you should write
plain text in a text editor. Do not use Microsoft Word or some other
word processor. You may be used to thinking of your final outputs
(e.g. a Word file, a PDF document, presentation slides, or the tables
and figures you make) as what’s “real” about your project. Instead,
it’s better to think of the data and code as what’s real, together
with the text you write. The idea is that all of your finished
output—your figures, tables, and text, and so on—can be
procedurally and reproducibly generated from code, data, and written
material stored in a simple, plain-text format.</p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:ch-02-markdown-margin"/>
<img src="../Images/8b3c8114189c9e97fe617516777a7dd3.png" alt="Top: Some elements of RMarkdown syntax. Bottom: From a plain text RMarkdown file to PDF output." width="546" data-original-src="https://socviz.co/assets/ch-02-markdown-margin.png"/><img src="../Images/8a6a98cd16161948fc8e6571bbbc8658.png" alt="Top: Some elements of RMarkdown syntax. Bottom: From a plain text RMarkdown file to PDF output." width="414" data-original-src="https://socviz.co/assets/ch-02-simple-knit-tall.png"/>
<!--
<p class="caption marginnote">-->Figure 2.1: Top: Some elements of RMarkdown syntax. Bottom: From a plain text RMarkdown file to PDF output.<!--</p>-->
<!--</div>--></span>
</p>
<p>The ability to reproduce your work in this way is important to the
scientific process. But you should also see it as a pragmatic choice
that will make life easier for you in future. The reality for most of
us is that the person who will most want to easily reproduce your work
is <em>you</em>, six months or a year from now. This is especially true for
graphics and figures. These often have a “finished” quality to them,
as a result of much tweaking and adjustments to the details of the
figure. That can make them hard to reproduce later. While it is normal
for graphics to undergo a substantial amount of polishing on their way
to publication, our goal is to do as much of this as possible
<em>programmatically</em>, in code we write, rather than in a way that is
retrospectively invisible, as for example when we edit an image in an
application like Adobe Illustrator.</p>
<p>While learning ggplot, and later while doing data analysis, you will
find yourself constantly pinging back and forth between three things:</p>
<ol style="list-style-type: decimal">
<li><em>Writing code</em>. You will write a lot of code to produce plots. You
will also write code to load your data, to look quickly at tables
of that data. Sometimes you will want to summarize, rearrange,
subset, or augment your data, or run a statistical model with it.
You will want to be able to write that code as easily and
effectively as possible.</li>
<li><em>Looking at output</em>. Your code is a set of instructions that, when
executed, produces the output you want: a table, a model, or a
figure. It is often helpful to be able to see that output, and its
partial results. While we’re working, it’s also useful
to keep the code and the things produced by the code close
together, if we can.</li>
<li><em>Taking Notes</em>. You will also be writing about what we
are doing, and what your results mean. When learning how to do
something in ggplot, for instance, you will want to make notes to
yourself about what you did, why you wrote it this way rather than
that, or what this new concept, function, or instruction does.
Later, when doing data analysis and making figures, you will be
writing up reports or drafting papers.</li>
</ol>
<p>How can you do all this effectively? The simplest way to keep code and
notes together is to write your code and intersperse it with
comments. All programming languages have some way of demarcating lines
as comments, usually by putting a special character (like <code>#</code>) at the
start of the line. We could create a plain-text script file called, e.g.,
<code>notes.r</code>, containing code and our comments on it. This is fine as far
as it goes. But except for very short files, it will be difficult to
do anything useful with the comments we write. If we want a report
from an analysis, for example, we will have to write it up separately.
While a script file can keep comments and code together, it loses
the connection between code and its output, such as the figure we want
to produce. But there is a better alternative: we can write our notes
using RMarkdown.</p>
<p>An RMarkdown file is just a plain text document where text (such as
notes or discussion) is interspersed with pieces, or <em>chunks</em>, of R
code. When you feed the document to R, it <em>knits</em> this file into a new
document by running the R code piece by piece, in sequence, and either
supplementing or replacing the chunks of code with their output. The
resulting file is then converted into a more easily-readable document
formatted in HTML, PDF, or Word. The non-code segments of the document
are plain text, but they can have simple formatting instructions in
them. These are set using
<a href="http://en.wikipedia.org/wiki/Markdown">Markdown</a>, a set of
conventions for marking up plain text in a way that indicates how it
should be formatted. The basic elements of Markdown are shown in the
upper part of Figure <a href="gettingstarted.html#fig:ch-02-markdown-margin">2.1</a>. When you create a
markdown document in R Studio, it contains some sample text to get you
started.</p>
<p>RMarkdown documents look like the one shown schematically in the lower
part of Figure <a href="gettingstarted.html#fig:ch-02-markdown-margin">2.1</a>. Your notes or text, with
Markdown formatting as needed, are interspersed with code. There is a
set format for code chunks. They look like this:</p>
<p class="sourceCode"/><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb8-1" data-line-number="1">```{r}</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"/>
<a class="sourceLine" id="cb8-3" data-line-number="3">```</a></code></pre>
<p>Three backticks (on a U.S. keyboard, that’s the character under the
escape key) followed by a pair of curly braces containing the name of
the language we are using.<label for="tufte-mn-14" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-14" class="margin-toggle"/><span class="marginnote shownote">The format is
language-agnostic, and can be used with, e.g. Python and other
languages.</span> The backticks-and-braces part signal that a chunk of
code is about to begin. You write your code as needed, and then end
the chunk with a new line containing just three backticks.</p>
<p>If you keep your notes in this way, you will be able to see the code
you wrote, the output it produces, and your own commentary or
clarification on it in a convenient way. Moreover, you can turn it
into a good-looking document right away.</p>
&#13;

<h2><span class="header-section-number">2.2</span> Use R with RStudio</h2>
<div id="the-rstudio-environment" class="section level3">
<h3><span class="header-section-number">2.2.1</span> The RStudio environment</h3>
<p>R itself is a relatively small application with next to no user interface.
Everything works through a command line, or <em>console</em>. At its most
basic, you launch it from your Terminal application (on a Mac) or
Command Prompt (on Windows) by typing <code>R</code>. Once launched, R awaits
your instructions at a command line of its own, denoted by the
right angle bracket symbol, <code>&gt;</code>. When you type an instruction and hit
return, R interprets it and sends any resulting output back to the
console.</p>
<div class="figure"><span id="fig:ch-02-rterminal"/>
<p class="caption marginnote shownote">
Figure 2.2: Bare-bones R running from the Terminal.
</p>
<img src="../Images/f7cb8f4fd5b5c80f5f4080a8be3c777e.png" alt="Bare-bones R running from the Terminal." width="90%" data-original-src="https://socviz.co/assets/ch-02-r-terminal-light.png"/>
</div>
<p>In addition to interacting with the console, you can also write your
code in a text file and send that to R all at once. You can use any
good text editor to write your <code>.r</code> scripts. But although a plain text
file and a command line is the absolute minimum you need to work with
R, it is a rather spartan arrangement. We can make life easier for
ourselves by using <a href="https://rstudio.com">RStudio</a>. RStudio is an
“integrated development environment”, or IDE. It is a separate
application from R proper. When launched, it starts up an instance of
R’s console inside of itself. It also conveniently pulls together
various other elements to help you get your work done. These include
the document where you are writing your code, the output it produces,
and R’s help system. RStudio also knows about RMarkdown, and
understands a lot about the R language and the organization of your
project. When you launch RStudio, it should look much like Figure
<a href="gettingstarted.html#fig:ch-02-rstudio1">2.3</a>.</p>
<div class="figure fullwidth"><span id="fig:ch-02-rstudio1"/>
<img src="../Images/a0414452145bf50b63b622bdb5f88caa.png" alt="The RStudio IDE." width="90%" data-original-src="https://socviz.co/assets/ch-02-rstudio-annotated.png"/>
<p class="caption marginnote shownote">
Figure 2.3: The RStudio IDE.
</p>
</div>
</div>
<div id="create-a-project" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Create a project</h3>
<p>To begin, create a project. From the menu, choose File &gt; New Project … from the
menu bar, choose the New Directory option, and create the project.<label for="tufte-mn-15" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-15" class="margin-toggle"/><span class="marginnote shownote">You can create your new project wherever you like—most commonly it will go somewhere in your Documents folder.</span> Once it is set up, create an RMarkdown file in the directory, with File &gt; New File &gt; RMarkdown.
This will give you a set of choices including the default “Document”.
The <code>socviz</code> library comes with a small RMarkdown template that
follows the structure of this book. To use it instead of the default
document, after selecting File &gt; New File &gt; RMarkdown, choose the “From
Template” option in the sidebar of the dialog box that appears. Then
choose “Data Visualization Notes” from the resulting list of options.
When the RMarkdown document appears, save it right away in your
project folder, with File &gt; Save. The <code>socviz</code> template contains a
little bit of information about how RMarkdown works, together with
some headers to get you started. Read what it has to say. Look at the
code chunks and RMarkdown formatting. Experiment with knitting the
document, and compare the output to the content of the plain text
document.</p>
<p>RMarkdown is not required for R. An alternative is to use an R script, which just contains R commands only.<label for="tufte-mn-16" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-16" class="margin-toggle"/><span class="marginnote shownote">You can create an r script via File &gt; New File &gt; R Script.</span> R script files conventionally have the extension <code>.r</code> or <code>.R</code>. (RMarkdown files conventionally end in <code>.Rmd</code>.) A very brief project might just need a single <code>.r</code> file. But RMarkdown is very useful for documents, notes, or reports of any length, especially when you need to take notes. If you do use an <code>.r</code> file you can leave comments or notes to yourself by starting a line with the hash character, <code>#</code>. You can also add comments at the end of lines in this way, as for any particular line R will ignore whatever code or text that appears after a <code>#</code>.</p>
<p>RStudio has various keyboard and menu shortcuts to help you edit code and text quickly. For example you can insert chunks of code in your RMarkdown document with a keyboard shortcut.<label for="tufte-mn-17" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-17" class="margin-toggle"/><span class="marginnote shownote"><code>Command+Option+I</code> on MacOS. <code>Ctrl+Alt+I</code> on Windows.</span> This saves you from writing the backticks and braces every time. You can run the current line of code with a shortcut, too.<label for="tufte-mn-18" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-18" class="margin-toggle"/><span class="marginnote shownote"><code>Command+Enter</code> on MacOS. <code>Alt+Enter</code> on Windows.</span> A third shortcut gives you a pop-over display with summary of many other useful keystroke combinations.<label for="tufte-mn-19" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-19" class="margin-toggle"/><span class="marginnote shownote"><code>Option+Shift+K</code> on MacOS. <code>Alt-Shift-K</code> on Windows.</span> RMarkdown documents can include all kinds of other options and formatting paraphernalia, from text formatting to cross-references to bibliographical information. But never mind about those for now.</p>
<div class="figure"><span id="fig:ch-02-rstudio-window-2"/>
<p class="caption marginnote shownote">
Figure 2.4: An RMarkdown file open in R Studio. The small icons in the top right-hand corner of each code chunk can be used to set options (the gear icon), run all chunks up to the current one (the downward-facing triangle), and just run the current chunk (the right-facing triangle).
</p>
<img src="../Images/778c59a11834942c702d99559e87754e.png" alt="An RMarkdown file open in R Studio. The small icons in the top right-hand corner of each code chunk can be used to set options (the gear icon), run all chunks up to the current one (the downward-facing triangle), and just run the current chunk (the right-facing triangle)." width="90%" data-original-src="https://socviz.co/assets/ch-02-rstudio-markdown.png"/>
</div>
<p>To make sure you are ready to go, load the <code>tidyverse</code> library. The
tidyverse is a suite of related libraries for R developed by Hadley
Wickham and others. The <code>ggplot2</code> library is one of its components.
The other pieces make it easier to get data in to R and manipulate it
once it is there. Either knit the notes file you created from the
socviz template, or load the library manually at the console:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"/>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">library</span>(socviz)</a></code></pre>
<p>We load the <code>socviz</code> library after the tidyverse. This library contains datasets that we will use throughout the book, along with some other tools that will make life a little easier. If you get an error message saying either library can’t be found, then re-read the “Before you Begin” section in the Preface to this book and follow the instructions there.</p>
<p>You only need to <em>install</em> a library once, but you will need to <em>load</em> it at the beginning of each R session with <code>library()</code> if you want to use the tools it contains. In practice this means that the very first lines of your working file should contain a code chunk that loads the libraries you will need in the file. If you forget to do this, then R will be unable to find the functions you want to use later on.</p>
</div>
&#13;

<h3><span class="header-section-number">2.2.1</span> The RStudio environment</h3>
<p>R itself is a relatively small application with next to no user interface.
Everything works through a command line, or <em>console</em>. At its most
basic, you launch it from your Terminal application (on a Mac) or
Command Prompt (on Windows) by typing <code>R</code>. Once launched, R awaits
your instructions at a command line of its own, denoted by the
right angle bracket symbol, <code>&gt;</code>. When you type an instruction and hit
return, R interprets it and sends any resulting output back to the
console.</p>
<div class="figure"><span id="fig:ch-02-rterminal"/>
<p class="caption marginnote shownote">
Figure 2.2: Bare-bones R running from the Terminal.
</p>
<img src="../Images/f7cb8f4fd5b5c80f5f4080a8be3c777e.png" alt="Bare-bones R running from the Terminal." width="90%" data-original-src="https://socviz.co/assets/ch-02-r-terminal-light.png"/>
</div>
<p>In addition to interacting with the console, you can also write your
code in a text file and send that to R all at once. You can use any
good text editor to write your <code>.r</code> scripts. But although a plain text
file and a command line is the absolute minimum you need to work with
R, it is a rather spartan arrangement. We can make life easier for
ourselves by using <a href="https://rstudio.com">RStudio</a>. RStudio is an
“integrated development environment”, or IDE. It is a separate
application from R proper. When launched, it starts up an instance of
R’s console inside of itself. It also conveniently pulls together
various other elements to help you get your work done. These include
the document where you are writing your code, the output it produces,
and R’s help system. RStudio also knows about RMarkdown, and
understands a lot about the R language and the organization of your
project. When you launch RStudio, it should look much like Figure
<a href="gettingstarted.html#fig:ch-02-rstudio1">2.3</a>.</p>
<div class="figure fullwidth"><span id="fig:ch-02-rstudio1"/>
<img src="../Images/a0414452145bf50b63b622bdb5f88caa.png" alt="The RStudio IDE." width="90%" data-original-src="https://socviz.co/assets/ch-02-rstudio-annotated.png"/>
<p class="caption marginnote shownote">
Figure 2.3: The RStudio IDE.
</p>
</div>
&#13;

<h3><span class="header-section-number">2.2.2</span> Create a project</h3>
<p>To begin, create a project. From the menu, choose File &gt; New Project … from the
menu bar, choose the New Directory option, and create the project.<label for="tufte-mn-15" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-15" class="margin-toggle"/><span class="marginnote shownote">You can create your new project wherever you like—most commonly it will go somewhere in your Documents folder.</span> Once it is set up, create an RMarkdown file in the directory, with File &gt; New File &gt; RMarkdown.
This will give you a set of choices including the default “Document”.
The <code>socviz</code> library comes with a small RMarkdown template that
follows the structure of this book. To use it instead of the default
document, after selecting File &gt; New File &gt; RMarkdown, choose the “From
Template” option in the sidebar of the dialog box that appears. Then
choose “Data Visualization Notes” from the resulting list of options.
When the RMarkdown document appears, save it right away in your
project folder, with File &gt; Save. The <code>socviz</code> template contains a
little bit of information about how RMarkdown works, together with
some headers to get you started. Read what it has to say. Look at the
code chunks and RMarkdown formatting. Experiment with knitting the
document, and compare the output to the content of the plain text
document.</p>
<p>RMarkdown is not required for R. An alternative is to use an R script, which just contains R commands only.<label for="tufte-mn-16" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-16" class="margin-toggle"/><span class="marginnote shownote">You can create an r script via File &gt; New File &gt; R Script.</span> R script files conventionally have the extension <code>.r</code> or <code>.R</code>. (RMarkdown files conventionally end in <code>.Rmd</code>.) A very brief project might just need a single <code>.r</code> file. But RMarkdown is very useful for documents, notes, or reports of any length, especially when you need to take notes. If you do use an <code>.r</code> file you can leave comments or notes to yourself by starting a line with the hash character, <code>#</code>. You can also add comments at the end of lines in this way, as for any particular line R will ignore whatever code or text that appears after a <code>#</code>.</p>
<p>RStudio has various keyboard and menu shortcuts to help you edit code and text quickly. For example you can insert chunks of code in your RMarkdown document with a keyboard shortcut.<label for="tufte-mn-17" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-17" class="margin-toggle"/><span class="marginnote shownote"><code>Command+Option+I</code> on MacOS. <code>Ctrl+Alt+I</code> on Windows.</span> This saves you from writing the backticks and braces every time. You can run the current line of code with a shortcut, too.<label for="tufte-mn-18" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-18" class="margin-toggle"/><span class="marginnote shownote"><code>Command+Enter</code> on MacOS. <code>Alt+Enter</code> on Windows.</span> A third shortcut gives you a pop-over display with summary of many other useful keystroke combinations.<label for="tufte-mn-19" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-19" class="margin-toggle"/><span class="marginnote shownote"><code>Option+Shift+K</code> on MacOS. <code>Alt-Shift-K</code> on Windows.</span> RMarkdown documents can include all kinds of other options and formatting paraphernalia, from text formatting to cross-references to bibliographical information. But never mind about those for now.</p>
<div class="figure"><span id="fig:ch-02-rstudio-window-2"/>
<p class="caption marginnote shownote">
Figure 2.4: An RMarkdown file open in R Studio. The small icons in the top right-hand corner of each code chunk can be used to set options (the gear icon), run all chunks up to the current one (the downward-facing triangle), and just run the current chunk (the right-facing triangle).
</p>
<img src="../Images/778c59a11834942c702d99559e87754e.png" alt="An RMarkdown file open in R Studio. The small icons in the top right-hand corner of each code chunk can be used to set options (the gear icon), run all chunks up to the current one (the downward-facing triangle), and just run the current chunk (the right-facing triangle)." width="90%" data-original-src="https://socviz.co/assets/ch-02-rstudio-markdown.png"/>
</div>
<p>To make sure you are ready to go, load the <code>tidyverse</code> library. The
tidyverse is a suite of related libraries for R developed by Hadley
Wickham and others. The <code>ggplot2</code> library is one of its components.
The other pieces make it easier to get data in to R and manipulate it
once it is there. Either knit the notes file you created from the
socviz template, or load the library manually at the console:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"/>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">library</span>(socviz)</a></code></pre>
<p>We load the <code>socviz</code> library after the tidyverse. This library contains datasets that we will use throughout the book, along with some other tools that will make life a little easier. If you get an error message saying either library can’t be found, then re-read the “Before you Begin” section in the Preface to this book and follow the instructions there.</p>
<p>You only need to <em>install</em> a library once, but you will need to <em>load</em> it at the beginning of each R session with <code>library()</code> if you want to use the tools it contains. In practice this means that the very first lines of your working file should contain a code chunk that loads the libraries you will need in the file. If you forget to do this, then R will be unable to find the functions you want to use later on.</p>
&#13;

<h2><span class="header-section-number">2.3</span> Things to know about R</h2>
<p>Any new piece of software takes a bit of getting used to. This is especially true when using an IDE to work in a language like R. You are getting oriented to the language itself (what happens at the console), while learning to take notes in what might seem like an odd format (chunks of code interspersed with plain-text comments), in an IDE that that has a many features designed to make your life easier in the long run, but which can be hard to decipher at the beginning. Here are some general points to bear in mind about how R is designed. They might help you get a feel for how the language works.</p>
<div id="everything-has-a-name" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Everything has a name</h3>
<p>In R, everything you deal with has a name. You refer to things by
their names as you examine, use, or modify them. Named entities
include variables (like <code>x</code>, or <code>y</code>), data that you have loaded (like
<code>my_data</code>), and functions that you use. (More about functions
momentarily.) You will spend a lot of time talking about, creating,
referring to, and modifying things with names.</p>
<p>Some names are forbidden. These include reserved words like <code>FALSE</code>
and <code>TRUE</code>, core programming words like <code>Inf</code>, <code>for</code>, <code>else</code>, <code>break</code>,
<code>function</code>, and words for special entities like <code>NA</code> and <code>NaN</code>. (These
last two are codes designating missing data and “Not a Number”,
respectively.) You probably won’t use these names by accident, but
it’s good do know that they are not allowed.</p>
<p>Some names you should not use, even if they are technically permitted.
These are mostly words that are already in use for objects or
functions that form part of the core of R. These include the names of
basic functions like <code>q()</code> or <code>c()</code>, common statistical functions like
<code>mean()</code>, <code>range()</code> or <code>var()</code>, and built-in mathematical constants
like <code>pi</code>.</p>
<p>Names in R are case sensitive. The object <code>my_data</code> is not the same as
the object <code>My_Data</code>. When choosing names for things, be concise,
consistent, and informative. Follow the style of the tidyverse and
name things in lower case, separating words with the underscore
character, <code>_</code>, as needed. Do not use spaces when naming things,
including variables in your data.</p>
</div>
<div id="everything-is-an-object" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Everything is an object</h3>
<p>Some objects are built in to R, some are added via libraries, and some
are created by the user. But almost everything is some kind of object.
The code you write will create, manipulate, and use named objects as a
matter of course. We can start immediately. Let’s create a vector of numbers. The
command <code>c()</code> is a function. It’s short for “combine” or
“concatenate”. It will take a sequence of comma-separated things
inside the parentheses and join them together into a vector where each
element is still individually accessible.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">25</span>)</a></code></pre>
<pre><code>## [1]  1  2  3  1  3  5 25</code></pre>
<p>Instead of sending the result to the console, we can instead <em>assign</em> it to an object we create<label for="tufte-mn-20" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-20" class="margin-toggle"/><span class="marginnote shownote">You can type the arrow using <code>&lt;</code> and then <code>-</code>.</span>:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">my_numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">25</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">your_numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">31</span>, <span class="dv">71</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">21</span>, <span class="dv">6</span>)</a></code></pre>
<p>To see what you made, type the name of the object and hit return:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">my_numbers</a></code></pre>
<pre><code>## [1]  1  2  3  1  3  5 25</code></pre>
<p>Each of our numbers is still there, and can be accessed directly if we
want. They are now just part of a new object, a vector, called
<code>my_numbers</code>.</p>
<p>You create objects by assigning them to names. The <em>assignment
operator</em> is <code>&lt;-</code>. Think of assignment as the verb “gets”, reading
left to right. So, the bit of code above can be read as “The object
<code>my_numbers</code> gets the result of concatenating the following numbers:
1, 2, …” The<label for="tufte-mn-21" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-21" class="margin-toggle"/><span class="marginnote shownote">If you only learn one keyboard shortcut in RStudio make it this one! Always use <code>Option+minus</code> on MacOS or <code>Alt+minus</code> on Windows to type the assignment operator.</span> operator is two separate keys on your keyboard: the <code>&lt;</code> key and the <code>-</code> (minus) key. Because you type this so often in R,
there is a shortcut for it in R Studio. To write the assignment
operator in one step, hold down the <code>option</code> key and hit <code>-</code>. On
Windows hold down the <code>alt</code> key and hit <code>-</code>. You will be constantly
creating objects in this way, and trying typing the two characters
separately is both tedious and prone to error. You will make
hard-to-notice mistakes like typing <code>&lt; -</code> (with a space in between the
characters) instead of <code>&lt;-</code>.</p>
<p>When you create objects by assigning things to names, they come into
existence in R’s <em>workspace</em> or <em>environment</em>. You can think of this
most straightforwardly as your project directory. Your workspace is
specific to your current project. It is the folder from which you
launched R. Unless you have particular needs (such as extremely large
datasets or analytical tastes that take a very long time) you will not
need to give any thought to where objects “really” live. Just think of
your code and data files as the permanent features of your project.
When you start up an R project, you will generally begin by loading
your data. That is, you will read it in from disk and assign it
to a named object like <code>my_data</code>. The rest of your code will be a series of instructions to act on and create more named objects.</p>
</div>
<div id="you-do-things-using-functions" class="section level3">
<h3><span class="header-section-number">2.3.3</span> You do things using functions</h3>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:ch-02-function-schematic"/>
<img src="../Images/7a6859d77a6a3eaf81c369f8905db946.png" alt="Upper: What functions look like, very schematically. Lower: an imaginary function that takes two vectors and plots them with a title. We supply the function with the particular vectors we want it to use, and the title. The vectors are objects, so are given as-is. The title is not an object, so we enclose it in quotes." width="100%" data-original-src="https://socviz.co/assets/ch-02-function-schematic.png"/>
<!--
<p class="caption marginnote">-->Figure 2.5: Upper: What functions look like, very schematically. Lower: an imaginary function that takes two vectors and plots them with a title. We supply the function with the particular vectors we want it to use, and the title. The vectors are objects, so are given as-is. The title is not an object, so we enclose it in quotes.<!--</p>-->
<!--</div>--></span>
</p>
<p>You do almost everything in R using functions. Think of a function as
a special kind of object that can perform actions for you. It produces
output based on the input that it receives. Like a good dog, when we
want a function to do something for us, we <em>call</em> it. Somewhat less
like a dog, it will reliably do what we tell it. We give the function
some information, it acts on that information, and some results come
out the other side. Functions can be recognized by the parentheses at
the end of their names. This distinguishes them from other objects,
such as single numbers, named vectors, tables of data, and so on.</p>
<p>The parentheses are what allow you to send information to the
function. Most functions accept one or more named <em>arguments</em>. A
function’s arguments are the things it needs to know in order to do
something. They can be some bit of your data (<code>data = my_numbers</code>), or
specific instructions (<code>title = "GDP per Capita"</code>), or an option you
want to choose (<code>smoothing = "splines", show = FALSE</code>). For example,
the object <code>my_numbers</code> is a numeric vector:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">my_numbers</a></code></pre>
<pre><code>## [1]  1  2  3  1  3  5 25</code></pre>
<p>But the thing we used to create it, <code>c()</code>, is a function. It
concatenates items into a vector composed of the series of
comma-separated elements you give it. Similarly, <code>mean()</code> is a
function that calculates a simple average for a vector of numbers.
What happens if we just type <code>mean()</code> without any arguments inside the parentheses?</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">mean</span>()</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co"># Error in mean.default() : argument "x" is missing, with no default</span></a></code></pre>
<p>The error message is terse but informative. The function needs an
argument to work, and we haven’t given it one. In this case, ‘x’, the
name of another object that <code>mean()</code> can perform its calculation on:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">mean</span>(<span class="dt">x =</span> my_numbers)</a></code></pre>
<pre><code>## [1] 5.714286</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">mean</span>(<span class="dt">x =</span> your_numbers)</a></code></pre>
<pre><code>## [1] 19.71429</code></pre>
<p>While the function arguments have names that are used internally,
(here, <code>x</code>), you don’t strictly need to specify the name for the function to
work:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">mean</span>(my_numbers)</a></code></pre>
<pre><code>## [1] 5.714286</code></pre>
<p>If you omit the name of the argument, R will just
assume you are giving the function what it needs, and in a default
order. The documentation for a function will tell you what the order
of required arguments is for any particular function.<label for="tufte-mn-22" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-22" class="margin-toggle"/><span class="marginnote shownote">See the Appendix for a guide to how to read the help page for a function.</span> For simple
functions that only require one or two arguments, omitting their names
is usually not confusing. For more complex functions, you will
typically want to use the names of the arguments rather than try to
remember what the ordering is.</p>
<p>In general, when providing arguments to a function the syntax is
<code>&lt;argument&gt; = &lt;value&gt;</code>. If <code>&lt;value&gt;</code> is a named <em>object</em> that already
exists in your workspace, like a vector of numbers of a table of data,
then you provide it unquoted, as in <code>mean(my_numbers)</code>. If <code>&lt;value&gt;</code>
is not an object, a number, or a logical value like <code>TRUE</code>, then you
usually put it in quotes, e.g., <code>labels(x = "X Axis Label")</code>.</p>
<p>Functions take inputs via their arguments, do something, and return
outputs. What the output is depends on what the function does. The
<code>c()</code> function takes a sequence of comma-separated elements and
returns a vector consisting of those same elements. The <code>mean()</code>
function takes a vector of numbers and returns a single number, their
average. Functions can return far more than single numbers. The output
returned by functions can be a table of data, or a complex object such
as the results of a linear model, or the instructions needed to draw a
plot on the screen (as we shall see). They can even be other
functions. For example, the <code>summary()</code> function performs a series of
calculations on a vector and produces what is in effect a little table
with named elements.</p>
<p>A function’s argument names are internal to that function. Say you
have created an object in your environment named <code>x</code>, for example. A
function like <code>mean()</code> also has a named argument, <code>x</code>, but R will not
get confused by this. It will not use your <code>x</code> object by mistake.</p>
<p>As we have already seen with <code>c()</code> and <code>mean()</code>, you can assign the
result of a function to an object:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">my_summary &lt;-<span class="st"> </span><span class="kw">summary</span>(my_numbers)</a></code></pre>
<p>When you do this, there’s no output to the console. R just
puts the results into the new object, as you instructed. To look
inside the object you can type its name and hit return:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">my_summary</a></code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.00    1.50    3.00    5.71    4.00   25.00</code></pre>
</div>
<div id="functions-come-in-libraries" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Functions come in libraries</h3>
<p>The code you write will be more or less complex depending on the task
you want to accomplish. Once you have gotten used to working in R, you
will probably end up writing your own functions to produce the results
that you need. But as with other programming languages, you will not
have to do everything yourself. Families of useful functions are
bundled into libraries that you can install, load into your R session,
and make use of as you work. Libraries save you from reinventing the
wheel. They make it so that you do not, for example, have to figure
out how to write code from scratch to draw a shape on screen, or load
a data file into memory. Libraries are also what allow you to build on
the efforts of others in order to do your own work. Ggplot is a
library of functions. There are many other such libraries and we will
make use of several throughout this book, either by loading them with the
<code>library()</code> function, or “reaching in” to them and pulling a useful
function from them directly. Writing code and functions of your own is
a good way to get a sense of the amazing volume of effort put into R
and its associated toolkits, work freely contributed by many hands
over the years and available for anyone to use.</p>
<p>All of the visualization we will do will involve choosing the right
function or functions, and then giving those functions the right
instructions through a series of named arguments. Most of the mistakes
we will make, and the errors we will fix, will involve us having not
picked the right function, or having not fed the function the right
arguments, or having failed to provide information in a form the
function can understand.</p>
<p>For now, just remember that you do things in R by creating and
manipulating named objects. You manipulate objects by feeding
information about them to functions. The functions do something useful
with that information (calculate a mean, recode a variable, fit a
model) and give you the results back.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">table</span>(my_numbers)</a></code></pre>
<pre><code>## my_numbers
##  1  2  3  5 25 
##  2  1  2  1  1</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">sd</span>(my_numbers)</a></code></pre>
<pre><code>## [1] 8.6</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">my_numbers <span class="op">*</span><span class="st"> </span><span class="dv">5</span></a></code></pre>
<pre><code>## [1]   5  10  15   5  15  25 125</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">my_numbers <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a></code></pre>
<pre><code>## [1]  2  3  4  2  4  6 26</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">my_numbers <span class="op">+</span><span class="st"> </span>my_numbers</a></code></pre>
<pre><code>## [1]  2  4  6  2  6 10 50</code></pre>
<p>The first two functions here gave us a simple table of counts and
calculated the standard deviation of <code>my_numbers</code>. It’s worth noticing
what R did in the last three cases. First we multiplied <code>my_numbers</code>
by two. R interprets that as you asking it to take each <em>element</em> of
<code>my_numbers</code> one at a time and multiply it by five. It does the same with the instruction <code>my_numbers + 1</code>. The single value is “recycled” down the length of the vector. By contrast, in the last case we add <code>my_numbers</code> to itself. Because the two objects being added are the same length, R adds each element in the first vector to the
corresponding element in the second vector. This is an example of a <em>vectorized</em> operation.</p>
</div>
<div id="if-youre-not-sure-what-an-object-is-ask-for-its-class" class="section level3">
<h3><span class="header-section-number">2.3.5</span> If you’re not sure what an object is, ask for its class</h3>
<p>Every object has a <em>class</em>. This is the sort of object it is, whether a
vector, a character string, a function, a list, and so on. Knowing an
object’s class tells you a lot about what you can and can’t do with
it.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">class</span>(my_numbers)</a></code></pre>
<pre><code>## [1] "numeric"</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">class</span>(my_summary)</a></code></pre>
<pre><code>## [1] "summaryDefault" "table"</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">class</span>(summary)</a></code></pre>
<pre><code>## [1] "function"</code></pre>
<p>Certain actions you take may change an object’s class. For instance,
consider <code>my_numbers</code> again:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">my_new_vector &lt;-<span class="st"> </span><span class="kw">c</span>(my_numbers, <span class="st">"Apple"</span>)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">my_new_vector</a></code></pre>
<pre><code>## [1] "1"     "2"     "3"     "1"     "3"     "5"     "25"   
## [8] "Apple"</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">class</span>(my_new_vector)</a></code></pre>
<pre><code>## [1] "character"</code></pre>
<p>The function added the word “Apple” to our vector of numbers, as we
asked. But in doing so, the result is that the new object also has a
new class, switching from “numeric” to “character”. All the numbers
are now enclosed in quotes. They have been turned into character
strings. In that form, they can’t be used in calculations.</p>
<p>Most of the work we’ll be doing will not involve directly picking out
this or that value from vectors or other entities. Instead we will try
to work at a slightly higher level that will be easier and safer. But
it’s worth knowing just the very basics<label for="tufte-mn-23" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-23" class="margin-toggle"/><span class="marginnote shownote">The Appendix has a little more discussion of the basics of selecting the elements within objects.</span> of how elements of vectors can
be referred to, because the c() function in particular is a useful
tool.</p>
<p>We will spend a lot of time in this book working with a series of datasets. These typically start life as files stored locally on your computer or somewhere remotely accessible to you. Once they are imported into R, then like everything exist as objects of some kind. R has several classes of objects used to store data. A basic one is a matrix, which consists of rows and columns of numbers. But the most common kind of data object in R is a <em>data frame</em>, which you can think of as a rectangular table consisting of rows (of observations) and columns (of variables). In a data frame the columns can be of different classes. Some may be character strings, some numeric, and so on. For instance, here is a very small dataset from the <code>socviz</code> library:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">titanic</a></code></pre>
<pre><code>##       fate    sex    n percent
## 1 perished   male 1364    62.0
## 2 perished female  126     5.7
## 3 survived   male  367    16.7
## 4 survived female  344    15.6</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">class</span>(titanic)</a></code></pre>
<pre><code>## [1] "data.frame"</code></pre>
<p>In this <code>titanic</code> data, two of the columns are numeric and two are not. You can access the rows and columns in various ways. For example, the <code>$</code> operator allows you to pick out a named column of a data frame:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">titanic<span class="op">$</span>percent</a></code></pre>
<pre><code>## [1] 62.0  5.7 16.7 15.6</code></pre>
<p>In Appendix <a href="appendix.html#app-select">A.1.2</a> there is a little more information about selecting particular elements from different kinds of objects.</p>
<p>We will also regularly encounter a slightly augmented version of a data frame called a <em>tibble</em>. The tidyverse libraries make extensive use of tibbles. Like data frames, they are used to store variables of different classes all together in a single table of data. They also do a little more to let us know about what they contain, and are a little more friendly when interacted with from the console. We can convert a data frame to a tibble if we want:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">titanic_tb &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(titanic)</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">titanic_tb</a></code></pre>
<pre><code>## # A tibble: 4 x 4
##   fate     sex        n percent
##   &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 perished male    1364   62.0 
## 2 perished female   126    5.70
## 3 survived male     367   16.7 
## 4 survived female   344   15.6</code></pre>
<p>Look carefully at the top and bottom of the output to see what additional information the tibble class gives you over and above the data frame version.</p>
</div>
<div id="objectstructure" class="section level3">
<h3><span class="header-section-number">2.3.6</span> To see inside an object, ask for its structure</h3>
<p>The <code>str()</code> function is sometimes useful. It lets you see what is
inside an object.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw">str</span>(my_numbers)</a></code></pre>
<pre><code>##  num [1:7] 1 2 3 1 3 5 25</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">str</span>(my_summary)</a></code></pre>
<pre><code>## Classes 'summaryDefault', 'table'  Named num [1:6] 1 1.5 3 5.71 4 ...
##   ..- attr(*, "names")= chr [1:6] "Min." "1st Qu." "Median" "Mean" ...</code></pre>
<p>Fair warning: while some objects are relatively simple (a vector is
just a sequence of numbers), others are more complicated, so asking
about their <code>str()</code> might output a forbidding amount of information to
the console. In general, complex objects are organized collections of
simpler objects, often assembled as a big list, sometimes with a
nested structure. Think for example of a master to-do list for a
complex activity like moving house. It might be organized into
sub-tasks of different kinds, several of which would themselves have
lists of individual items. One list of tasks might be related to
scheduling the moving truck, another might cover things to be donated,
and a third list of tasks might be related to setting up utilities at
the new house. In a similar sort of way, the objects we create to make
plots will have many parts and sub-parts, as the overall task of
drawing a plot has many individual to-do items. But we will be able to
build these objects up from simple forms through a series of
well-defined steps. And unlike moving house, the computer will take
care of actually carrying out the task for us. We just need to get the
to-do list right.</p>
</div>
&#13;

<h3><span class="header-section-number">2.3.1</span> Everything has a name</h3>
<p>In R, everything you deal with has a name. You refer to things by
their names as you examine, use, or modify them. Named entities
include variables (like <code>x</code>, or <code>y</code>), data that you have loaded (like
<code>my_data</code>), and functions that you use. (More about functions
momentarily.) You will spend a lot of time talking about, creating,
referring to, and modifying things with names.</p>
<p>Some names are forbidden. These include reserved words like <code>FALSE</code>
and <code>TRUE</code>, core programming words like <code>Inf</code>, <code>for</code>, <code>else</code>, <code>break</code>,
<code>function</code>, and words for special entities like <code>NA</code> and <code>NaN</code>. (These
last two are codes designating missing data and “Not a Number”,
respectively.) You probably won’t use these names by accident, but
it’s good do know that they are not allowed.</p>
<p>Some names you should not use, even if they are technically permitted.
These are mostly words that are already in use for objects or
functions that form part of the core of R. These include the names of
basic functions like <code>q()</code> or <code>c()</code>, common statistical functions like
<code>mean()</code>, <code>range()</code> or <code>var()</code>, and built-in mathematical constants
like <code>pi</code>.</p>
<p>Names in R are case sensitive. The object <code>my_data</code> is not the same as
the object <code>My_Data</code>. When choosing names for things, be concise,
consistent, and informative. Follow the style of the tidyverse and
name things in lower case, separating words with the underscore
character, <code>_</code>, as needed. Do not use spaces when naming things,
including variables in your data.</p>
&#13;

<h3><span class="header-section-number">2.3.2</span> Everything is an object</h3>
<p>Some objects are built in to R, some are added via libraries, and some
are created by the user. But almost everything is some kind of object.
The code you write will create, manipulate, and use named objects as a
matter of course. We can start immediately. Let’s create a vector of numbers. The
command <code>c()</code> is a function. It’s short for “combine” or
“concatenate”. It will take a sequence of comma-separated things
inside the parentheses and join them together into a vector where each
element is still individually accessible.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">25</span>)</a></code></pre>
<pre><code>## [1]  1  2  3  1  3  5 25</code></pre>
<p>Instead of sending the result to the console, we can instead <em>assign</em> it to an object we create<label for="tufte-mn-20" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-20" class="margin-toggle"/><span class="marginnote shownote">You can type the arrow using <code>&lt;</code> and then <code>-</code>.</span>:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">my_numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">25</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">your_numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">31</span>, <span class="dv">71</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">21</span>, <span class="dv">6</span>)</a></code></pre>
<p>To see what you made, type the name of the object and hit return:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">my_numbers</a></code></pre>
<pre><code>## [1]  1  2  3  1  3  5 25</code></pre>
<p>Each of our numbers is still there, and can be accessed directly if we
want. They are now just part of a new object, a vector, called
<code>my_numbers</code>.</p>
<p>You create objects by assigning them to names. The <em>assignment
operator</em> is <code>&lt;-</code>. Think of assignment as the verb “gets”, reading
left to right. So, the bit of code above can be read as “The object
<code>my_numbers</code> gets the result of concatenating the following numbers:
1, 2, …” The<label for="tufte-mn-21" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-21" class="margin-toggle"/><span class="marginnote shownote">If you only learn one keyboard shortcut in RStudio make it this one! Always use <code>Option+minus</code> on MacOS or <code>Alt+minus</code> on Windows to type the assignment operator.</span> operator is two separate keys on your keyboard: the <code>&lt;</code> key and the <code>-</code> (minus) key. Because you type this so often in R,
there is a shortcut for it in R Studio. To write the assignment
operator in one step, hold down the <code>option</code> key and hit <code>-</code>. On
Windows hold down the <code>alt</code> key and hit <code>-</code>. You will be constantly
creating objects in this way, and trying typing the two characters
separately is both tedious and prone to error. You will make
hard-to-notice mistakes like typing <code>&lt; -</code> (with a space in between the
characters) instead of <code>&lt;-</code>.</p>
<p>When you create objects by assigning things to names, they come into
existence in R’s <em>workspace</em> or <em>environment</em>. You can think of this
most straightforwardly as your project directory. Your workspace is
specific to your current project. It is the folder from which you
launched R. Unless you have particular needs (such as extremely large
datasets or analytical tastes that take a very long time) you will not
need to give any thought to where objects “really” live. Just think of
your code and data files as the permanent features of your project.
When you start up an R project, you will generally begin by loading
your data. That is, you will read it in from disk and assign it
to a named object like <code>my_data</code>. The rest of your code will be a series of instructions to act on and create more named objects.</p>
&#13;

<h3><span class="header-section-number">2.3.3</span> You do things using functions</h3>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:ch-02-function-schematic"/>
<img src="../Images/7a6859d77a6a3eaf81c369f8905db946.png" alt="Upper: What functions look like, very schematically. Lower: an imaginary function that takes two vectors and plots them with a title. We supply the function with the particular vectors we want it to use, and the title. The vectors are objects, so are given as-is. The title is not an object, so we enclose it in quotes." width="100%" data-original-src="https://socviz.co/assets/ch-02-function-schematic.png"/>
<!--
<p class="caption marginnote">-->Figure 2.5: Upper: What functions look like, very schematically. Lower: an imaginary function that takes two vectors and plots them with a title. We supply the function with the particular vectors we want it to use, and the title. The vectors are objects, so are given as-is. The title is not an object, so we enclose it in quotes.<!--</p>-->
<!--</div>--></span>
</p>
<p>You do almost everything in R using functions. Think of a function as
a special kind of object that can perform actions for you. It produces
output based on the input that it receives. Like a good dog, when we
want a function to do something for us, we <em>call</em> it. Somewhat less
like a dog, it will reliably do what we tell it. We give the function
some information, it acts on that information, and some results come
out the other side. Functions can be recognized by the parentheses at
the end of their names. This distinguishes them from other objects,
such as single numbers, named vectors, tables of data, and so on.</p>
<p>The parentheses are what allow you to send information to the
function. Most functions accept one or more named <em>arguments</em>. A
function’s arguments are the things it needs to know in order to do
something. They can be some bit of your data (<code>data = my_numbers</code>), or
specific instructions (<code>title = "GDP per Capita"</code>), or an option you
want to choose (<code>smoothing = "splines", show = FALSE</code>). For example,
the object <code>my_numbers</code> is a numeric vector:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">my_numbers</a></code></pre>
<pre><code>## [1]  1  2  3  1  3  5 25</code></pre>
<p>But the thing we used to create it, <code>c()</code>, is a function. It
concatenates items into a vector composed of the series of
comma-separated elements you give it. Similarly, <code>mean()</code> is a
function that calculates a simple average for a vector of numbers.
What happens if we just type <code>mean()</code> without any arguments inside the parentheses?</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">mean</span>()</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co"># Error in mean.default() : argument "x" is missing, with no default</span></a></code></pre>
<p>The error message is terse but informative. The function needs an
argument to work, and we haven’t given it one. In this case, ‘x’, the
name of another object that <code>mean()</code> can perform its calculation on:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">mean</span>(<span class="dt">x =</span> my_numbers)</a></code></pre>
<pre><code>## [1] 5.714286</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">mean</span>(<span class="dt">x =</span> your_numbers)</a></code></pre>
<pre><code>## [1] 19.71429</code></pre>
<p>While the function arguments have names that are used internally,
(here, <code>x</code>), you don’t strictly need to specify the name for the function to
work:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">mean</span>(my_numbers)</a></code></pre>
<pre><code>## [1] 5.714286</code></pre>
<p>If you omit the name of the argument, R will just
assume you are giving the function what it needs, and in a default
order. The documentation for a function will tell you what the order
of required arguments is for any particular function.<label for="tufte-mn-22" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-22" class="margin-toggle"/><span class="marginnote shownote">See the Appendix for a guide to how to read the help page for a function.</span> For simple
functions that only require one or two arguments, omitting their names
is usually not confusing. For more complex functions, you will
typically want to use the names of the arguments rather than try to
remember what the ordering is.</p>
<p>In general, when providing arguments to a function the syntax is
<code>&lt;argument&gt; = &lt;value&gt;</code>. If <code>&lt;value&gt;</code> is a named <em>object</em> that already
exists in your workspace, like a vector of numbers of a table of data,
then you provide it unquoted, as in <code>mean(my_numbers)</code>. If <code>&lt;value&gt;</code>
is not an object, a number, or a logical value like <code>TRUE</code>, then you
usually put it in quotes, e.g., <code>labels(x = "X Axis Label")</code>.</p>
<p>Functions take inputs via their arguments, do something, and return
outputs. What the output is depends on what the function does. The
<code>c()</code> function takes a sequence of comma-separated elements and
returns a vector consisting of those same elements. The <code>mean()</code>
function takes a vector of numbers and returns a single number, their
average. Functions can return far more than single numbers. The output
returned by functions can be a table of data, or a complex object such
as the results of a linear model, or the instructions needed to draw a
plot on the screen (as we shall see). They can even be other
functions. For example, the <code>summary()</code> function performs a series of
calculations on a vector and produces what is in effect a little table
with named elements.</p>
<p>A function’s argument names are internal to that function. Say you
have created an object in your environment named <code>x</code>, for example. A
function like <code>mean()</code> also has a named argument, <code>x</code>, but R will not
get confused by this. It will not use your <code>x</code> object by mistake.</p>
<p>As we have already seen with <code>c()</code> and <code>mean()</code>, you can assign the
result of a function to an object:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">my_summary &lt;-<span class="st"> </span><span class="kw">summary</span>(my_numbers)</a></code></pre>
<p>When you do this, there’s no output to the console. R just
puts the results into the new object, as you instructed. To look
inside the object you can type its name and hit return:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">my_summary</a></code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.00    1.50    3.00    5.71    4.00   25.00</code></pre>
&#13;

<h3><span class="header-section-number">2.3.4</span> Functions come in libraries</h3>
<p>The code you write will be more or less complex depending on the task
you want to accomplish. Once you have gotten used to working in R, you
will probably end up writing your own functions to produce the results
that you need. But as with other programming languages, you will not
have to do everything yourself. Families of useful functions are
bundled into libraries that you can install, load into your R session,
and make use of as you work. Libraries save you from reinventing the
wheel. They make it so that you do not, for example, have to figure
out how to write code from scratch to draw a shape on screen, or load
a data file into memory. Libraries are also what allow you to build on
the efforts of others in order to do your own work. Ggplot is a
library of functions. There are many other such libraries and we will
make use of several throughout this book, either by loading them with the
<code>library()</code> function, or “reaching in” to them and pulling a useful
function from them directly. Writing code and functions of your own is
a good way to get a sense of the amazing volume of effort put into R
and its associated toolkits, work freely contributed by many hands
over the years and available for anyone to use.</p>
<p>All of the visualization we will do will involve choosing the right
function or functions, and then giving those functions the right
instructions through a series of named arguments. Most of the mistakes
we will make, and the errors we will fix, will involve us having not
picked the right function, or having not fed the function the right
arguments, or having failed to provide information in a form the
function can understand.</p>
<p>For now, just remember that you do things in R by creating and
manipulating named objects. You manipulate objects by feeding
information about them to functions. The functions do something useful
with that information (calculate a mean, recode a variable, fit a
model) and give you the results back.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">table</span>(my_numbers)</a></code></pre>
<pre><code>## my_numbers
##  1  2  3  5 25 
##  2  1  2  1  1</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">sd</span>(my_numbers)</a></code></pre>
<pre><code>## [1] 8.6</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">my_numbers <span class="op">*</span><span class="st"> </span><span class="dv">5</span></a></code></pre>
<pre><code>## [1]   5  10  15   5  15  25 125</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">my_numbers <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a></code></pre>
<pre><code>## [1]  2  3  4  2  4  6 26</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">my_numbers <span class="op">+</span><span class="st"> </span>my_numbers</a></code></pre>
<pre><code>## [1]  2  4  6  2  6 10 50</code></pre>
<p>The first two functions here gave us a simple table of counts and
calculated the standard deviation of <code>my_numbers</code>. It’s worth noticing
what R did in the last three cases. First we multiplied <code>my_numbers</code>
by two. R interprets that as you asking it to take each <em>element</em> of
<code>my_numbers</code> one at a time and multiply it by five. It does the same with the instruction <code>my_numbers + 1</code>. The single value is “recycled” down the length of the vector. By contrast, in the last case we add <code>my_numbers</code> to itself. Because the two objects being added are the same length, R adds each element in the first vector to the
corresponding element in the second vector. This is an example of a <em>vectorized</em> operation.</p>
&#13;

<h3><span class="header-section-number">2.3.5</span> If you’re not sure what an object is, ask for its class</h3>
<p>Every object has a <em>class</em>. This is the sort of object it is, whether a
vector, a character string, a function, a list, and so on. Knowing an
object’s class tells you a lot about what you can and can’t do with
it.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">class</span>(my_numbers)</a></code></pre>
<pre><code>## [1] "numeric"</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">class</span>(my_summary)</a></code></pre>
<pre><code>## [1] "summaryDefault" "table"</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">class</span>(summary)</a></code></pre>
<pre><code>## [1] "function"</code></pre>
<p>Certain actions you take may change an object’s class. For instance,
consider <code>my_numbers</code> again:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">my_new_vector &lt;-<span class="st"> </span><span class="kw">c</span>(my_numbers, <span class="st">"Apple"</span>)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">my_new_vector</a></code></pre>
<pre><code>## [1] "1"     "2"     "3"     "1"     "3"     "5"     "25"   
## [8] "Apple"</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">class</span>(my_new_vector)</a></code></pre>
<pre><code>## [1] "character"</code></pre>
<p>The function added the word “Apple” to our vector of numbers, as we
asked. But in doing so, the result is that the new object also has a
new class, switching from “numeric” to “character”. All the numbers
are now enclosed in quotes. They have been turned into character
strings. In that form, they can’t be used in calculations.</p>
<p>Most of the work we’ll be doing will not involve directly picking out
this or that value from vectors or other entities. Instead we will try
to work at a slightly higher level that will be easier and safer. But
it’s worth knowing just the very basics<label for="tufte-mn-23" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-23" class="margin-toggle"/><span class="marginnote shownote">The Appendix has a little more discussion of the basics of selecting the elements within objects.</span> of how elements of vectors can
be referred to, because the c() function in particular is a useful
tool.</p>
<p>We will spend a lot of time in this book working with a series of datasets. These typically start life as files stored locally on your computer or somewhere remotely accessible to you. Once they are imported into R, then like everything exist as objects of some kind. R has several classes of objects used to store data. A basic one is a matrix, which consists of rows and columns of numbers. But the most common kind of data object in R is a <em>data frame</em>, which you can think of as a rectangular table consisting of rows (of observations) and columns (of variables). In a data frame the columns can be of different classes. Some may be character strings, some numeric, and so on. For instance, here is a very small dataset from the <code>socviz</code> library:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">titanic</a></code></pre>
<pre><code>##       fate    sex    n percent
## 1 perished   male 1364    62.0
## 2 perished female  126     5.7
## 3 survived   male  367    16.7
## 4 survived female  344    15.6</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">class</span>(titanic)</a></code></pre>
<pre><code>## [1] "data.frame"</code></pre>
<p>In this <code>titanic</code> data, two of the columns are numeric and two are not. You can access the rows and columns in various ways. For example, the <code>$</code> operator allows you to pick out a named column of a data frame:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">titanic<span class="op">$</span>percent</a></code></pre>
<pre><code>## [1] 62.0  5.7 16.7 15.6</code></pre>
<p>In Appendix <a href="appendix.html#app-select">A.1.2</a> there is a little more information about selecting particular elements from different kinds of objects.</p>
<p>We will also regularly encounter a slightly augmented version of a data frame called a <em>tibble</em>. The tidyverse libraries make extensive use of tibbles. Like data frames, they are used to store variables of different classes all together in a single table of data. They also do a little more to let us know about what they contain, and are a little more friendly when interacted with from the console. We can convert a data frame to a tibble if we want:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">titanic_tb &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(titanic)</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">titanic_tb</a></code></pre>
<pre><code>## # A tibble: 4 x 4
##   fate     sex        n percent
##   &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 perished male    1364   62.0 
## 2 perished female   126    5.70
## 3 survived male     367   16.7 
## 4 survived female   344   15.6</code></pre>
<p>Look carefully at the top and bottom of the output to see what additional information the tibble class gives you over and above the data frame version.</p>
&#13;

<h3><span class="header-section-number">2.3.6</span> To see inside an object, ask for its structure</h3>
<p>The <code>str()</code> function is sometimes useful. It lets you see what is
inside an object.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw">str</span>(my_numbers)</a></code></pre>
<pre><code>##  num [1:7] 1 2 3 1 3 5 25</code></pre>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">str</span>(my_summary)</a></code></pre>
<pre><code>## Classes 'summaryDefault', 'table'  Named num [1:6] 1 1.5 3 5.71 4 ...
##   ..- attr(*, "names")= chr [1:6] "Min." "1st Qu." "Median" "Mean" ...</code></pre>
<p>Fair warning: while some objects are relatively simple (a vector is
just a sequence of numbers), others are more complicated, so asking
about their <code>str()</code> might output a forbidding amount of information to
the console. In general, complex objects are organized collections of
simpler objects, often assembled as a big list, sometimes with a
nested structure. Think for example of a master to-do list for a
complex activity like moving house. It might be organized into
sub-tasks of different kinds, several of which would themselves have
lists of individual items. One list of tasks might be related to
scheduling the moving truck, another might cover things to be donated,
and a third list of tasks might be related to setting up utilities at
the new house. In a similar sort of way, the objects we create to make
plots will have many parts and sub-parts, as the overall task of
drawing a plot has many individual to-do items. But we will be able to
build these objects up from simple forms through a series of
well-defined steps. And unlike moving house, the computer will take
care of actually carrying out the task for us. We just need to get the
to-do list right.</p>
&#13;

<h2><span class="header-section-number">2.4</span> Be patient with R, and with yourself</h2>
<p>Like all programming languages, R does exactly what you tell it to,
rather than exactly what you want it to. This can make it frustrating
to work with. It is as if one had an endlessly energetic, powerful,
but also extremely literal-minded robot to order around. Remember that
no-one writes fluent, error-free code on the first go all the time.
From simple typos to big misunderstandings, mistakes are a standard
part of the activity of programming. This is why error-checking,
debugging, and testing are also a central part of programming. So,
just try to be patient with yourself and with R while you use it. Expect
to make errors, and don’t worry when that happens. You won’t break
anything. Each time you figure out why a bit of code has gone wrong
you will have learned a new thing about how the language works.</p>
<p>Here are three very specific things to watch out for:</p>
<ul>
<li>Make sure parentheses are balanced and that every opening “<code>(</code>” has
a corresponding closing “<code>)</code>”.</li>
<li>Make sure you complete your expressions. If you think you have completed typing your code, but instead of seeing the <code>&gt;</code> command prompt at the console you see the <code>+</code>
character instead, that may mean R thinks you haven’t written a complete
expression yet. You can hit <code>Esc</code> or <code>Ctrl-C</code> to force your way back to the console and try typing your code again.</li>
<li>In ggplot specifically, as you will see, we will build up plots a
piece at a time by adding expressions to one another. When doing
this, make sure your <code>+</code> character goes at the end of the line, and
not the beginning. That is, write this:</li>
</ul>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre>
<p>and not this:</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre>
<p>R Studio will do its best to help you with the task of writing your
code. It will highlight your code by syntax; it will try to match
characters (like parentheses) that need to be balanced; it will try to
narrow down the source of errors in code that fails to run; it will
try to auto-complete the names of objects you type, so that you make fewer
typos; it will make help files more easily accessible and the
arguments of functions directly available. Go slowly and see how the
software is trying to help you out.</p>
&#13;

<h2><span class="header-section-number">2.5</span> Get data into R</h2>
<p>Before we can plot anything at all we have to get our data into R in a
format it can use. Cleaning and reading in your data is one of the
least immediately satisfying pieces of an analysis, whether you use R,
Stata<label for="tufte-mn-24" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-24" class="margin-toggle"/><span class="marginnote shownote">These are all commercial software applications for statistical analysis. Stata, in particular, is in wide use across the social sciences.</span>, SAS, SPSS, or any other statistical software. This is the reason that many of the datasets for this book are provided in a pre-prepared form via the <code>socviz</code> library rather than as data files you must manually
read in. However, it is something you will have to face, and that
you will want to do, sooner rather than later if you want to use the
skills you learn in this book. We might as well see how to do it now.
Even when learning R, it can be useful and very motivating to try out
the code on your own data rather than working with the sample
datasets.</p>
<p>Use the <code>read_csv()</code> function to read in comma separated data. This
function is in the <code>readr</code> library, one of the pieces of the
tidyverse. R and the tidyverse also have functions to import various
Stata, SAS, and SPSS formats directly. These can be found in the
<code>haven</code> library. All we need to do is point <code>read_csv()</code> at a file.
This can be a local file, e.g. in a subdirectory called <code>data/</code>, or it
can be a remote file. If <code>read_csv()</code> is given a URL or ftp address it
will follow it automatically. In this example, we have a CSV file
called <code>organdonation.csv</code> stored at a remote location. While online, we assign the
URL for the file to an object, for convenience, and then tell
<code>read_csv()</code> to fetch it for us and put it in an object named <code>organs</code>.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">url &lt;-<span class="st"> "https://cdn.rawgit.com/kjhealy/viz-organdata/master/organdonation.csv"</span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2"/>
<a class="sourceLine" id="cb61-3" data-line-number="3">organs &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> url)</a></code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   year = col_integer(),
##   donors = col_double(),
##   pop = col_integer(),
##   pop.dens = col_double(),
##   gdp = col_integer(),
##   gdp.lag = col_integer(),
##   health = col_double(),
##   health.lag = col_double(),
##   pubhealth = col_double(),
##   roads = col_double(),
##   cerebvas = col_integer(),
##   assault = col_integer(),
##   external = col_integer(),
##   txp.pop = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<p>The resulting message at the console tells us the <code>read_csv()</code> function
has assigned a class to each of the columns of the object it created
from the CSV file. There are columns with integer values, some are
character strings, and so on. (The <code>double</code> class is for numbers other
than integers.) Part of the reason <code>read_csv()</code> is telling you this
information is that it is helpful to know what class each column, or
variable, is. A variable’s class determines what sort of operations
can be performed on it. You also see this information because the
tidyverse’s <code>read_csv()</code> (with an underscore character in the middle
of its name) is more opinionated than an older, and also still very
widely-used function, <code>read.csv()</code> (with a period in the middle of its
name). The newer <code>read_csv()</code> will not classify variables as factors
unless you tell it to. This is in contrast to the older function,
which treats any vector of characters as a factor unless told
otherwise. Factors have some very useful features in R (especially
when it comes to representing various kinds of treatment and control
groups in experiments), but they often trip up users who are not fully
aware of them. Thus, <code>read_csv()</code> avoids them unless you explicitly
say otherwise.</p>
<p>R can read in data files in many different formats. The <code>haven</code> package is part of the tidyverse. It provides functions to read files created in a variety of commercial software packages.<label for="tufte-mn-25" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-25" class="margin-toggle"/><span class="marginnote shownote">R can also talk directly to databases, a topic not covered here.</span> If your dataset is a Stata <code>.dta</code> file, for instance, you can use the <code>read_dta()</code> function in much the same way as we used <code>read_csv()</code> above. This function can read and write variables stored as logical values, integers, numbers, characters and factors. Stata also has a <em>labelled</em> data class that the haven library partially supports.<label for="tufte-mn-26" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-26" class="margin-toggle"/><span class="marginnote shownote">See haven’s documentation for more details.</span> In general you will end up converting labelled variables to one of R’s basic classes. Stata also supports an extensive coding scheme for missing data. This is generally not used directly in R, where missing data is coded simply as <code>NA</code>. Again, you will need to take care that any labelled variables imported into R are coded properly, so that you do not end up mistakenly using missing data in your analysis.</p>
<p>When preparing your data for use in R, and in particular for graphing
with <code>ggplot</code>, bear in mind that it is best if it is represented in a
“tidy” format. Essentially this means that your data should be in
<em>long</em> rather than <em>wide</em> format, with every observation a row and
every variable a column. We will discuss this in more detail in
Chapter <a href="makeplot.html#makeplot">3</a>, and you can also consult the discussion of tidy data in the
Appendix.</p>
&#13;

<h2><span class="header-section-number">2.6</span> Make your first figure</h2>
<p>That’s enough ground-clearing for now. Writing code can be
frustrating, but it also allows you to do interesting things quickly.
Since the goal of this book is not to teach you all about R, but just
how to produce good graphics, we can postpone a lot of details until
later (or indeed ignore them indefinitely). We will start as we mean
to go on, by using a function to make a named object, and plot the
result. We will use the Gapminder dataset, which you should already
have available on your computer. We load the data with <code>library()</code>
and take a look.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">library</span>(gapminder)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2">gapminder</a></code></pre>
<pre><code>## # A tibble: 1,704 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333       779
##  2 Afghanistan Asia       1957    30.3  9240934       821
##  3 Afghanistan Asia       1962    32.0 10267083       853
##  4 Afghanistan Asia       1967    34.0 11537966       836
##  5 Afghanistan Asia       1972    36.1 13079460       740
##  6 Afghanistan Asia       1977    38.4 14880372       786
##  7 Afghanistan Asia       1982    39.9 12881816       978
##  8 Afghanistan Asia       1987    40.8 13867957       852
##  9 Afghanistan Asia       1992    41.7 16317921       649
## 10 Afghanistan Asia       1997    41.8 22227415       635
## # ... with 1,694 more rows</code></pre>
<p>This is a table of data about a large number of countries, each observed over several years. Let’s make a scatterplot with it. Type the code below and try to get a sense of what’s happening. Don’t worry too much yet about the details.</p>
<p class="sourceCode"/><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,</a>
<a class="sourceLine" id="cb66-2" data-line-number="2">            <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp))</a>
<a class="sourceLine" id="cb66-3" data-line-number="3">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre>
<div class="figure"><span id="fig:ch-02-gapminder-example-fig"/>
<p class="caption marginnote shownote">
Figure 2.6: Life expectancy plotted against GDP per capita for a large number of country-years.
</p>
<img src="../Images/4bb84df38c71e2e6800e0eb2e04fdea8.png" alt="Life expectancy plotted against GDP per capita for a large number of country-years." width="960" data-original-src="https://socviz.co/dataviz-pdfl_files/figure-html4/ch-02-gapminder-example-fig-1.png"/>
</div>
<p>Not a bad start. Our graph is fairly legible, it has its axes informatively labeled, and it shows some sort of relationship between the two variables we have chosen. It could also be made better. Let’s learn more about how to improve it.</p>
&#13;

<h2><span class="header-section-number">2.7</span> Where to go next</h2>
<p>You should go straight to the next Chapter. However, you could also
spend a little more time getting familiar with R and RStudio. Some
information in the Appendix to this book might already be worth glancing
at, especially the additional introductory material on R, and the
discussion there about some common problems that tend to happen when
reading in your own data. There<label for="tufte-mn-27" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-27" class="margin-toggle"/><span class="marginnote shownote"><code>swirlstats.com</code></span> are several<label for="tufte-mn-28" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-28" class="margin-toggle"/><span class="marginnote shownote"><code>tryr.codeschool.com</code></span> free or initially free online introductions<label for="tufte-mn-29" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-29" class="margin-toggle"/><span class="marginnote shownote"><code>datacamp.com</code></span> to the R language that are worth trying. You do not need to know the material they cover in order to keep going with this book, but you might find one or more of them useful. If you get a little bogged down in any of them, or find the examples they choose are not that relevant to you, don’t worry. These introductions tend to want to introduce you to a range of programming concepts and tools that we will not need right away.</p>
<p>It is also worth familiarizing yourself a little with how RStudio works and with what it can do for you. The RStudio website<label for="tufte-mn-30" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-30" class="margin-toggle"/><span class="marginnote shownote"><code>rstudio.com</code></span> has a great deal of introductory material to help you along. You can also find a number of handy cheat sheets there that summarize different pieces of RStudio, RMarkdown, and various tidyverse packages that we will use throughout the book.<label for="tufte-mn-31" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-31" class="margin-toggle"/><span class="marginnote shownote"><code>rstudio.com/resources/cheatsheets</code></span> These cheat-sheets are not meant to teach you the material. But they are helpful points of reference once you are up and running.</p>

    
</body>
</html>